(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();var X=1e-6,ve=typeof Float32Array<"u"?Float32Array:Array,Pl=Math.PI/180;function Xl(t){return t*Pl}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function Rc(){var t=new ve(9);return ve!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function ms(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Yl(t){var e=new ve(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function ql(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Il(t,e,n,r,a,s,i,o,c){var u=new ve(9);return u[0]=t,u[1]=e,u[2]=n,u[3]=r,u[4]=a,u[5]=s,u[6]=i,u[7]=o,u[8]=c,u}function Ql(t,e,n,r,a,s,i,o,c,u){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=s,t[5]=i,t[6]=o,t[7]=c,t[8]=u,t}function jt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Dc(t,e){if(t===e){var n=e[1],r=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Us(t,e){var n=e[0],r=e[1],a=e[2],s=e[3],i=e[4],o=e[5],c=e[6],u=e[7],g=e[8],f=g*i-o*u,l=-g*s+o*c,p=u*s-i*c,y=n*f+r*l+a*p;return y?(y=1/y,t[0]=f*y,t[1]=(-g*r+a*u)*y,t[2]=(o*r-a*i)*y,t[3]=l*y,t[4]=(g*n-a*c)*y,t[5]=(-o*n+a*s)*y,t[6]=p*y,t[7]=(-u*n+r*c)*y,t[8]=(i*n-r*s)*y,t):null}function Zl(t,e){var n=e[0],r=e[1],a=e[2],s=e[3],i=e[4],o=e[5],c=e[6],u=e[7],g=e[8];return t[0]=i*g-o*u,t[1]=a*u-r*g,t[2]=r*o-a*i,t[3]=o*c-s*g,t[4]=n*g-a*c,t[5]=a*s-n*o,t[6]=s*u-i*c,t[7]=r*c-n*u,t[8]=n*i-r*s,t}function Jl(t){var e=t[0],n=t[1],r=t[2],a=t[3],s=t[4],i=t[5],o=t[6],c=t[7],u=t[8];return e*(u*s-i*c)+n*(-u*a+i*o)+r*(c*a-s*o)}function Mc(t,e,n){var r=e[0],a=e[1],s=e[2],i=e[3],o=e[4],c=e[5],u=e[6],g=e[7],f=e[8],l=n[0],p=n[1],y=n[2],h=n[3],v=n[4],x=n[5],S=n[6],d=n[7],T=n[8];return t[0]=l*r+p*i+y*u,t[1]=l*a+p*o+y*g,t[2]=l*s+p*c+y*f,t[3]=h*r+v*i+x*u,t[4]=h*a+v*o+x*g,t[5]=h*s+v*c+x*f,t[6]=S*r+d*i+T*u,t[7]=S*a+d*o+T*g,t[8]=S*s+d*c+T*f,t}function e0(t,e,n){var r=e[0],a=e[1],s=e[2],i=e[3],o=e[4],c=e[5],u=e[6],g=e[7],f=e[8],l=n[0],p=n[1];return t[0]=r,t[1]=a,t[2]=s,t[3]=i,t[4]=o,t[5]=c,t[6]=l*r+p*i+u,t[7]=l*a+p*o+g,t[8]=l*s+p*c+f,t}function t0(t,e,n){var r=e[0],a=e[1],s=e[2],i=e[3],o=e[4],c=e[5],u=e[6],g=e[7],f=e[8],l=Math.sin(n),p=Math.cos(n);return t[0]=p*r+l*i,t[1]=p*a+l*o,t[2]=p*s+l*c,t[3]=p*i-l*r,t[4]=p*o-l*a,t[5]=p*c-l*s,t[6]=u,t[7]=g,t[8]=f,t}function n0(t,e,n){var r=n[0],a=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function r0(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function a0(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function s0(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function i0(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function o0(t,e){var n=e[0],r=e[1],a=e[2],s=e[3],i=n+n,o=r+r,c=a+a,u=n*i,g=r*i,f=r*o,l=a*i,p=a*o,y=a*c,h=s*i,v=s*o,x=s*c;return t[0]=1-f-y,t[3]=g-x,t[6]=l+v,t[1]=g+x,t[4]=1-u-y,t[7]=p-h,t[2]=l-v,t[5]=p+h,t[8]=1-u-f,t}function c0(t,e){var n=e[0],r=e[1],a=e[2],s=e[3],i=e[4],o=e[5],c=e[6],u=e[7],g=e[8],f=e[9],l=e[10],p=e[11],y=e[12],h=e[13],v=e[14],x=e[15],S=n*o-r*i,d=n*c-a*i,T=n*u-s*i,w=r*c-a*o,C=r*u-s*o,O=a*u-s*c,R=g*h-f*y,L=g*v-l*y,D=g*x-p*y,M=f*v-l*h,V=f*x-p*h,B=l*x-p*v,_=S*B-d*V+T*M+w*D-C*L+O*R;return _?(_=1/_,t[0]=(o*B-c*V+u*M)*_,t[1]=(c*D-i*B-u*L)*_,t[2]=(i*V-o*D+u*R)*_,t[3]=(a*V-r*B-s*M)*_,t[4]=(n*B-a*D+s*L)*_,t[5]=(r*D-n*V-s*R)*_,t[6]=(h*O-v*C+x*w)*_,t[7]=(v*T-y*O-x*d)*_,t[8]=(y*C-h*T+x*S)*_,t):null}function f0(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function u0(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function g0(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function l0(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function Lc(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function p0(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function h0(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function v0(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function y0(t,e){var n=t[0],r=t[1],a=t[2],s=t[3],i=t[4],o=t[5],c=t[6],u=t[7],g=t[8],f=e[0],l=e[1],p=e[2],y=e[3],h=e[4],v=e[5],x=e[6],S=e[7],d=e[8];return Math.abs(n-f)<=X*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-l)<=X*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-p)<=X*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-y)<=X*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(i-h)<=X*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-v)<=X*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(c-x)<=X*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(u-S)<=X*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(g-d)<=X*Math.max(1,Math.abs(g),Math.abs(d))}var d0=Mc,T0=Lc;const x0=Object.freeze(Object.defineProperty({__proto__:null,add:l0,adjoint:Zl,clone:Yl,copy:ql,create:Rc,determinant:Jl,equals:y0,exactEquals:v0,frob:g0,fromMat2d:i0,fromMat4:ms,fromQuat:o0,fromRotation:a0,fromScaling:s0,fromTranslation:r0,fromValues:Il,identity:jt,invert:Us,mul:d0,multiply:Mc,multiplyScalar:p0,multiplyScalarAndAdd:h0,normalFromMat4:c0,projection:f0,rotate:t0,scale:n0,set:Ql,str:u0,sub:T0,subtract:Lc,translate:e0,transpose:Dc},Symbol.toStringTag,{value:"Module"}));function ks(){var t=new ve(16);return ve!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function S0(t){var e=new ve(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function de(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function C0(t,e,n,r,a,s,i,o,c,u,g,f,l,p,y,h){var v=new ve(16);return v[0]=t,v[1]=e,v[2]=n,v[3]=r,v[4]=a,v[5]=s,v[6]=i,v[7]=o,v[8]=c,v[9]=u,v[10]=g,v[11]=f,v[12]=l,v[13]=p,v[14]=y,v[15]=h,v}function w0(t,e,n,r,a,s,i,o,c,u,g,f,l,p,y,h,v){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=s,t[5]=i,t[6]=o,t[7]=c,t[8]=u,t[9]=g,t[10]=f,t[11]=l,t[12]=p,t[13]=y,t[14]=h,t[15]=v,t}function A(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function te(t,e){if(t===e){var n=e[1],r=e[2],a=e[3],s=e[6],i=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=a,t[13]=i,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Oe(t,e){var n=e[0],r=e[1],a=e[2],s=e[3],i=e[4],o=e[5],c=e[6],u=e[7],g=e[8],f=e[9],l=e[10],p=e[11],y=e[12],h=e[13],v=e[14],x=e[15],S=n*o-r*i,d=n*c-a*i,T=n*u-s*i,w=r*c-a*o,C=r*u-s*o,O=a*u-s*c,R=g*h-f*y,L=g*v-l*y,D=g*x-p*y,M=f*v-l*h,V=f*x-p*h,B=l*x-p*v,_=S*B-d*V+T*M+w*D-C*L+O*R;return _?(_=1/_,t[0]=(o*B-c*V+u*M)*_,t[1]=(a*V-r*B-s*M)*_,t[2]=(h*O-v*C+x*w)*_,t[3]=(l*C-f*O-p*w)*_,t[4]=(c*D-i*B-u*L)*_,t[5]=(n*B-a*D+s*L)*_,t[6]=(v*T-y*O-x*d)*_,t[7]=(g*O-l*T+p*d)*_,t[8]=(i*V-o*D+u*R)*_,t[9]=(r*D-n*V-s*R)*_,t[10]=(y*C-h*T+x*S)*_,t[11]=(f*T-g*C-p*S)*_,t[12]=(o*L-i*M-c*R)*_,t[13]=(n*M-r*L+a*R)*_,t[14]=(h*d-y*w-v*S)*_,t[15]=(g*w-f*d+l*S)*_,t):null}function E0(t,e){var n=e[0],r=e[1],a=e[2],s=e[3],i=e[4],o=e[5],c=e[6],u=e[7],g=e[8],f=e[9],l=e[10],p=e[11],y=e[12],h=e[13],v=e[14],x=e[15];return t[0]=o*(l*x-p*v)-f*(c*x-u*v)+h*(c*p-u*l),t[1]=-(r*(l*x-p*v)-f*(a*x-s*v)+h*(a*p-s*l)),t[2]=r*(c*x-u*v)-o*(a*x-s*v)+h*(a*u-s*c),t[3]=-(r*(c*p-u*l)-o*(a*p-s*l)+f*(a*u-s*c)),t[4]=-(i*(l*x-p*v)-g*(c*x-u*v)+y*(c*p-u*l)),t[5]=n*(l*x-p*v)-g*(a*x-s*v)+y*(a*p-s*l),t[6]=-(n*(c*x-u*v)-i*(a*x-s*v)+y*(a*u-s*c)),t[7]=n*(c*p-u*l)-i*(a*p-s*l)+g*(a*u-s*c),t[8]=i*(f*x-p*h)-g*(o*x-u*h)+y*(o*p-u*f),t[9]=-(n*(f*x-p*h)-g*(r*x-s*h)+y*(r*p-s*f)),t[10]=n*(o*x-u*h)-i*(r*x-s*h)+y*(r*u-s*o),t[11]=-(n*(o*p-u*f)-i*(r*p-s*f)+g*(r*u-s*o)),t[12]=-(i*(f*v-l*h)-g*(o*v-c*h)+y*(o*l-c*f)),t[13]=n*(f*v-l*h)-g*(r*v-a*h)+y*(r*l-a*f),t[14]=-(n*(o*v-c*h)-i*(r*v-a*h)+y*(r*c-a*o)),t[15]=n*(o*l-c*f)-i*(r*l-a*f)+g*(r*c-a*o),t}function O0(t){var e=t[0],n=t[1],r=t[2],a=t[3],s=t[4],i=t[5],o=t[6],c=t[7],u=t[8],g=t[9],f=t[10],l=t[11],p=t[12],y=t[13],h=t[14],v=t[15],x=e*i-n*s,S=e*o-r*s,d=e*c-a*s,T=n*o-r*i,w=n*c-a*i,C=r*c-a*o,O=u*y-g*p,R=u*h-f*p,L=u*v-l*p,D=g*h-f*y,M=g*v-l*y,V=f*v-l*h;return x*V-S*M+d*D+T*L-w*R+C*O}function ge(t,e,n){var r=e[0],a=e[1],s=e[2],i=e[3],o=e[4],c=e[5],u=e[6],g=e[7],f=e[8],l=e[9],p=e[10],y=e[11],h=e[12],v=e[13],x=e[14],S=e[15],d=n[0],T=n[1],w=n[2],C=n[3];return t[0]=d*r+T*o+w*f+C*h,t[1]=d*a+T*c+w*l+C*v,t[2]=d*s+T*u+w*p+C*x,t[3]=d*i+T*g+w*y+C*S,d=n[4],T=n[5],w=n[6],C=n[7],t[4]=d*r+T*o+w*f+C*h,t[5]=d*a+T*c+w*l+C*v,t[6]=d*s+T*u+w*p+C*x,t[7]=d*i+T*g+w*y+C*S,d=n[8],T=n[9],w=n[10],C=n[11],t[8]=d*r+T*o+w*f+C*h,t[9]=d*a+T*c+w*l+C*v,t[10]=d*s+T*u+w*p+C*x,t[11]=d*i+T*g+w*y+C*S,d=n[12],T=n[13],w=n[14],C=n[15],t[12]=d*r+T*o+w*f+C*h,t[13]=d*a+T*c+w*l+C*v,t[14]=d*s+T*u+w*p+C*x,t[15]=d*i+T*g+w*y+C*S,t}function oe(t,e,n){var r=n[0],a=n[1],s=n[2],i,o,c,u,g,f,l,p,y,h,v,x;return e===t?(t[12]=e[0]*r+e[4]*a+e[8]*s+e[12],t[13]=e[1]*r+e[5]*a+e[9]*s+e[13],t[14]=e[2]*r+e[6]*a+e[10]*s+e[14],t[15]=e[3]*r+e[7]*a+e[11]*s+e[15]):(i=e[0],o=e[1],c=e[2],u=e[3],g=e[4],f=e[5],l=e[6],p=e[7],y=e[8],h=e[9],v=e[10],x=e[11],t[0]=i,t[1]=o,t[2]=c,t[3]=u,t[4]=g,t[5]=f,t[6]=l,t[7]=p,t[8]=y,t[9]=h,t[10]=v,t[11]=x,t[12]=i*r+g*a+y*s+e[12],t[13]=o*r+f*a+h*s+e[13],t[14]=c*r+l*a+v*s+e[14],t[15]=u*r+p*a+x*s+e[15]),t}function Ht(t,e,n){var r=n[0],a=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ue(t,e,n,r){var a=r[0],s=r[1],i=r[2],o=Math.hypot(a,s,i),c,u,g,f,l,p,y,h,v,x,S,d,T,w,C,O,R,L,D,M,V,B,_,k;return o<X?null:(o=1/o,a*=o,s*=o,i*=o,c=Math.sin(n),u=Math.cos(n),g=1-u,f=e[0],l=e[1],p=e[2],y=e[3],h=e[4],v=e[5],x=e[6],S=e[7],d=e[8],T=e[9],w=e[10],C=e[11],O=a*a*g+u,R=s*a*g+i*c,L=i*a*g-s*c,D=a*s*g-i*c,M=s*s*g+u,V=i*s*g+a*c,B=a*i*g+s*c,_=s*i*g-a*c,k=i*i*g+u,t[0]=f*O+h*R+d*L,t[1]=l*O+v*R+T*L,t[2]=p*O+x*R+w*L,t[3]=y*O+S*R+C*L,t[4]=f*D+h*M+d*V,t[5]=l*D+v*M+T*V,t[6]=p*D+x*M+w*V,t[7]=y*D+S*M+C*V,t[8]=f*B+h*_+d*k,t[9]=l*B+v*_+T*k,t[10]=p*B+x*_+w*k,t[11]=y*B+S*_+C*k,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Ns(t,e,n){var r=Math.sin(n),a=Math.cos(n),s=e[4],i=e[5],o=e[6],c=e[7],u=e[8],g=e[9],f=e[10],l=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*a+u*r,t[5]=i*a+g*r,t[6]=o*a+f*r,t[7]=c*a+l*r,t[8]=u*a-s*r,t[9]=g*a-i*r,t[10]=f*a-o*r,t[11]=l*a-c*r,t}function Gs(t,e,n){var r=Math.sin(n),a=Math.cos(n),s=e[0],i=e[1],o=e[2],c=e[3],u=e[8],g=e[9],f=e[10],l=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*a-u*r,t[1]=i*a-g*r,t[2]=o*a-f*r,t[3]=c*a-l*r,t[8]=s*r+u*a,t[9]=i*r+g*a,t[10]=o*r+f*a,t[11]=c*r+l*a,t}function bs(t,e,n){var r=Math.sin(n),a=Math.cos(n),s=e[0],i=e[1],o=e[2],c=e[3],u=e[4],g=e[5],f=e[6],l=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*a+u*r,t[1]=i*a+g*r,t[2]=o*a+f*r,t[3]=c*a+l*r,t[4]=u*a-s*r,t[5]=g*a-i*r,t[6]=f*a-o*r,t[7]=l*a-c*r,t}function Vc(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function _c(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Bc(t,e,n){var r=n[0],a=n[1],s=n[2],i=Math.hypot(r,a,s),o,c,u;return i<X?null:(i=1/i,r*=i,a*=i,s*=i,o=Math.sin(e),c=Math.cos(e),u=1-c,t[0]=r*r*u+c,t[1]=a*r*u+s*o,t[2]=s*r*u-a*o,t[3]=0,t[4]=r*a*u-s*o,t[5]=a*a*u+c,t[6]=s*a*u+r*o,t[7]=0,t[8]=r*s*u+a*o,t[9]=a*s*u-r*o,t[10]=s*s*u+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function R0(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function D0(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function M0(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Fc(t,e,n){var r=e[0],a=e[1],s=e[2],i=e[3],o=r+r,c=a+a,u=s+s,g=r*o,f=r*c,l=r*u,p=a*c,y=a*u,h=s*u,v=i*o,x=i*c,S=i*u;return t[0]=1-(p+h),t[1]=f+S,t[2]=l-x,t[3]=0,t[4]=f-S,t[5]=1-(g+h),t[6]=y+v,t[7]=0,t[8]=l+x,t[9]=y-v,t[10]=1-(g+p),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function L0(t,e){var n=new ve(3),r=-e[0],a=-e[1],s=-e[2],i=e[3],o=e[4],c=e[5],u=e[6],g=e[7],f=r*r+a*a+s*s+i*i;return f>0?(n[0]=(o*i+g*r+c*s-u*a)*2/f,n[1]=(c*i+g*a+u*r-o*s)*2/f,n[2]=(u*i+g*s+o*a-c*r)*2/f):(n[0]=(o*i+g*r+c*s-u*a)*2,n[1]=(c*i+g*a+u*r-o*s)*2,n[2]=(u*i+g*s+o*a-c*r)*2),Fc(t,e,n),t}function V0(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function mc(t,e){var n=e[0],r=e[1],a=e[2],s=e[4],i=e[5],o=e[6],c=e[8],u=e[9],g=e[10];return t[0]=Math.hypot(n,r,a),t[1]=Math.hypot(s,i,o),t[2]=Math.hypot(c,u,g),t}function fs(t,e){var n=new ve(3);mc(n,e);var r=1/n[0],a=1/n[1],s=1/n[2],i=e[0]*r,o=e[1]*a,c=e[2]*s,u=e[4]*r,g=e[5]*a,f=e[6]*s,l=e[8]*r,p=e[9]*a,y=e[10]*s,h=i+g+y,v=0;return h>0?(v=Math.sqrt(h+1)*2,t[3]=.25*v,t[0]=(f-p)/v,t[1]=(l-c)/v,t[2]=(o-u)/v):i>g&&i>y?(v=Math.sqrt(1+i-g-y)*2,t[3]=(f-p)/v,t[0]=.25*v,t[1]=(o+u)/v,t[2]=(l+c)/v):g>y?(v=Math.sqrt(1+g-i-y)*2,t[3]=(l-c)/v,t[0]=(o+u)/v,t[1]=.25*v,t[2]=(f+p)/v):(v=Math.sqrt(1+y-i-g)*2,t[3]=(o-u)/v,t[0]=(l+c)/v,t[1]=(f+p)/v,t[2]=.25*v),t}function Uc(t,e,n,r){var a=e[0],s=e[1],i=e[2],o=e[3],c=a+a,u=s+s,g=i+i,f=a*c,l=a*u,p=a*g,y=s*u,h=s*g,v=i*g,x=o*c,S=o*u,d=o*g,T=r[0],w=r[1],C=r[2];return t[0]=(1-(y+v))*T,t[1]=(l+d)*T,t[2]=(p-S)*T,t[3]=0,t[4]=(l-d)*w,t[5]=(1-(f+v))*w,t[6]=(h+x)*w,t[7]=0,t[8]=(p+S)*C,t[9]=(h-x)*C,t[10]=(1-(f+y))*C,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function _0(t,e,n,r,a){var s=e[0],i=e[1],o=e[2],c=e[3],u=s+s,g=i+i,f=o+o,l=s*u,p=s*g,y=s*f,h=i*g,v=i*f,x=o*f,S=c*u,d=c*g,T=c*f,w=r[0],C=r[1],O=r[2],R=a[0],L=a[1],D=a[2],M=(1-(h+x))*w,V=(p+T)*w,B=(y-d)*w,_=(p-T)*C,k=(1-(l+x))*C,G=(v+S)*C,b=(y+d)*O,I=(v-S)*O,m=(1-(l+h))*O;return t[0]=M,t[1]=V,t[2]=B,t[3]=0,t[4]=_,t[5]=k,t[6]=G,t[7]=0,t[8]=b,t[9]=I,t[10]=m,t[11]=0,t[12]=n[0]+R-(M*R+_*L+b*D),t[13]=n[1]+L-(V*R+k*L+I*D),t[14]=n[2]+D-(B*R+G*L+m*D),t[15]=1,t}function mr(t,e){var n=e[0],r=e[1],a=e[2],s=e[3],i=n+n,o=r+r,c=a+a,u=n*i,g=r*i,f=r*o,l=a*i,p=a*o,y=a*c,h=s*i,v=s*o,x=s*c;return t[0]=1-f-y,t[1]=g+x,t[2]=l-v,t[3]=0,t[4]=g-x,t[5]=1-u-y,t[6]=p+h,t[7]=0,t[8]=l+v,t[9]=p-h,t[10]=1-u-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function B0(t,e,n,r,a,s,i){var o=1/(n-e),c=1/(a-r),u=1/(s-i);return t[0]=s*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*c,t[6]=0,t[7]=0,t[8]=(n+e)*o,t[9]=(a+r)*c,t[10]=(i+s)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=i*s*2*u,t[15]=0,t}function kc(t,e,n,r,a){var s=1/Math.tan(e/2),i;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(i=1/(r-a),t[10]=(a+r)*i,t[14]=2*a*r*i):(t[10]=-1,t[14]=-2*r),t}var F0=kc;function m0(t,e,n,r,a){var s=1/Math.tan(e/2),i;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(i=1/(r-a),t[10]=a*i,t[14]=a*r*i):(t[10]=-1,t[14]=-r),t}function U0(t,e,n,r){var a=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),i=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),c=2/(i+o),u=2/(a+s);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((i-o)*c*.5),t[9]=(a-s)*u*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function Nc(t,e,n,r,a,s,i){var o=1/(e-n),c=1/(r-a),u=1/(s-i);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*o,t[13]=(a+r)*c,t[14]=(i+s)*u,t[15]=1,t}var Gc=Nc;function k0(t,e,n,r,a,s,i){var o=1/(e-n),c=1/(r-a),u=1/(s-i);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(e+n)*o,t[13]=(a+r)*c,t[14]=s*u,t[15]=1,t}function bc(t,e,n,r){var a,s,i,o,c,u,g,f,l,p,y=e[0],h=e[1],v=e[2],x=r[0],S=r[1],d=r[2],T=n[0],w=n[1],C=n[2];return Math.abs(y-T)<X&&Math.abs(h-w)<X&&Math.abs(v-C)<X?A(t):(g=y-T,f=h-w,l=v-C,p=1/Math.hypot(g,f,l),g*=p,f*=p,l*=p,a=S*l-d*f,s=d*g-x*l,i=x*f-S*g,p=Math.hypot(a,s,i),p?(p=1/p,a*=p,s*=p,i*=p):(a=0,s=0,i=0),o=f*i-l*s,c=l*a-g*i,u=g*s-f*a,p=Math.hypot(o,c,u),p?(p=1/p,o*=p,c*=p,u*=p):(o=0,c=0,u=0),t[0]=a,t[1]=o,t[2]=g,t[3]=0,t[4]=s,t[5]=c,t[6]=f,t[7]=0,t[8]=i,t[9]=u,t[10]=l,t[11]=0,t[12]=-(a*y+s*h+i*v),t[13]=-(o*y+c*h+u*v),t[14]=-(g*y+f*h+l*v),t[15]=1,t)}function N0(t,e,n,r){var a=e[0],s=e[1],i=e[2],o=r[0],c=r[1],u=r[2],g=a-n[0],f=s-n[1],l=i-n[2],p=g*g+f*f+l*l;p>0&&(p=1/Math.sqrt(p),g*=p,f*=p,l*=p);var y=c*l-u*f,h=u*g-o*l,v=o*f-c*g;return p=y*y+h*h+v*v,p>0&&(p=1/Math.sqrt(p),y*=p,h*=p,v*=p),t[0]=y,t[1]=h,t[2]=v,t[3]=0,t[4]=f*v-l*h,t[5]=l*y-g*v,t[6]=g*h-f*y,t[7]=0,t[8]=g,t[9]=f,t[10]=l,t[11]=0,t[12]=a,t[13]=s,t[14]=i,t[15]=1,t}function G0(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function b0(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function $0(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function $c(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function z0(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function W0(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function H0(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function A0(t,e){var n=t[0],r=t[1],a=t[2],s=t[3],i=t[4],o=t[5],c=t[6],u=t[7],g=t[8],f=t[9],l=t[10],p=t[11],y=t[12],h=t[13],v=t[14],x=t[15],S=e[0],d=e[1],T=e[2],w=e[3],C=e[4],O=e[5],R=e[6],L=e[7],D=e[8],M=e[9],V=e[10],B=e[11],_=e[12],k=e[13],G=e[14],b=e[15];return Math.abs(n-S)<=X*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(r-d)<=X*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(a-T)<=X*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(s-w)<=X*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(i-C)<=X*Math.max(1,Math.abs(i),Math.abs(C))&&Math.abs(o-O)<=X*Math.max(1,Math.abs(o),Math.abs(O))&&Math.abs(c-R)<=X*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(u-L)<=X*Math.max(1,Math.abs(u),Math.abs(L))&&Math.abs(g-D)<=X*Math.max(1,Math.abs(g),Math.abs(D))&&Math.abs(f-M)<=X*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(l-V)<=X*Math.max(1,Math.abs(l),Math.abs(V))&&Math.abs(p-B)<=X*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(y-_)<=X*Math.max(1,Math.abs(y),Math.abs(_))&&Math.abs(h-k)<=X*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(v-G)<=X*Math.max(1,Math.abs(v),Math.abs(G))&&Math.abs(x-b)<=X*Math.max(1,Math.abs(x),Math.abs(b))}var us=ge,j0=$c;const gs=Object.freeze(Object.defineProperty({__proto__:null,add:$0,adjoint:E0,clone:S0,copy:de,create:ks,determinant:O0,equals:A0,exactEquals:H0,frob:b0,fromQuat:mr,fromQuat2:L0,fromRotation:Bc,fromRotationTranslation:Fc,fromRotationTranslationScale:Uc,fromRotationTranslationScaleOrigin:_0,fromScaling:_c,fromTranslation:Vc,fromValues:C0,fromXRotation:R0,fromYRotation:D0,fromZRotation:M0,frustum:B0,getRotation:fs,getScaling:mc,getTranslation:V0,identity:A,invert:Oe,lookAt:bc,mul:us,multiply:ge,multiplyScalar:z0,multiplyScalarAndAdd:W0,ortho:Gc,orthoNO:Nc,orthoZO:k0,perspective:F0,perspectiveFromFieldOfView:U0,perspectiveNO:kc,perspectiveZO:m0,rotate:Ue,rotateX:Ns,rotateY:Gs,rotateZ:bs,scale:Ht,set:w0,str:G0,sub:j0,subtract:$c,targetTo:N0,translate:oe,transpose:te},Symbol.toStringTag,{value:"Module"}));function zc(){var t=new ve(3);return ve!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ls(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Ri(t,e,n){var r=new ve(3);return r[0]=t,r[1]=e,r[2]=n,r}function Ye(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function On(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function xt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function ht(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function K0(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Ct(t,e){var n=e[0],r=e[1],a=e[2],s=n*n+r*r+a*a;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function $s(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Jt(t,e,n){var r=e[0],a=e[1],s=e[2],i=n[0],o=n[1],c=n[2];return t[0]=a*c-s*o,t[1]=s*i-r*c,t[2]=r*o-a*i,t}function q(t,e,n){var r=e[0],a=e[1],s=e[2],i=n[3]*r+n[7]*a+n[11]*s+n[15];return i=i||1,t[0]=(n[0]*r+n[4]*a+n[8]*s+n[12])/i,t[1]=(n[1]*r+n[5]*a+n[9]*s+n[13])/i,t[2]=(n[2]*r+n[6]*a+n[10]*s+n[14])/i,t}function Di(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Mi(t,e){var n=t[0],r=t[1],a=t[2],s=e[0],i=e[1],o=e[2];return Math.abs(n-s)<=X*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-i)<=X*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(a-o)<=X*Math.max(1,Math.abs(a),Math.abs(o))}var ps=xt,Wc=ls;(function(){var t=zc();return function(e,n,r,a,s,i){var o,c;for(n||(n=3),r||(r=0),a?c=Math.min(a*n+r,e.length):c=e.length,o=r;o<c;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],s(t,t,i),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();function P0(){var t=new ve(4);return ve!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function X0(t,e,n,r){var a=new ve(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a}function Y0(t,e){var n=e[0],r=e[1],a=e[2],s=e[3],i=n*n+r*r+a*a+s*s;return i>0&&(i=1/Math.sqrt(i)),t[0]=n*i,t[1]=r*i,t[2]=a*i,t[3]=s*i,t}function Kn(t,e,n){var r=e[0],a=e[1],s=e[2],i=e[3];return t[0]=n[0]*r+n[4]*a+n[8]*s+n[12]*i,t[1]=n[1]*r+n[5]*a+n[9]*s+n[13]*i,t[2]=n[2]*r+n[6]*a+n[10]*s+n[14]*i,t[3]=n[3]*r+n[7]*a+n[11]*s+n[15]*i,t}(function(){var t=P0();return function(e,n,r,a,s,i){var o,c;for(n||(n=4),r||(r=0),a?c=Math.min(a*n+r,e.length):c=e.length,o=r;o<c;o+=n)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],s(t,t,i),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}})();function At(){var t=new ve(4);return ve!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function zs(t,e,n){n=n*.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function q0(t,e){var n=Math.acos(e[3])*2,r=Math.sin(n/2);return r>X?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function Li(t,e,n){var r=e[0],a=e[1],s=e[2],i=e[3],o=n[0],c=n[1],u=n[2],g=n[3];return t[0]=r*g+i*o+a*u-s*c,t[1]=a*g+i*c+s*o-r*u,t[2]=s*g+i*u+r*c-a*o,t[3]=i*g-r*o-a*c-s*u,t}function Sr(t,e,n,r){var a=e[0],s=e[1],i=e[2],o=e[3],c=n[0],u=n[1],g=n[2],f=n[3],l,p,y,h,v;return p=a*c+s*u+i*g+o*f,p<0&&(p=-p,c=-c,u=-u,g=-g,f=-f),1-p>X?(l=Math.acos(p),y=Math.sin(l),h=Math.sin((1-r)*l)/y,v=Math.sin(r*l)/y):(h=1-r,v=r),t[0]=h*a+v*c,t[1]=h*s+v*u,t[2]=h*i+v*g,t[3]=h*o+v*f,t}function I0(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Q0(t,e){var n=e[0]+e[4]+e[8],r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[a*3+a]&&(a=2);var s=(a+1)%3,i=(a+2)%3;r=Math.sqrt(e[a*3+a]-e[s*3+s]-e[i*3+i]+1),t[a]=.5*r,r=.5/r,t[3]=(e[s*3+i]-e[i*3+s])*r,t[s]=(e[s*3+a]+e[a*3+s])*r,t[i]=(e[i*3+a]+e[a*3+i])*r}return t}var Vi=X0,Hc=Y0;(function(){var t=zc(),e=Ri(1,0,0),n=Ri(0,1,0);return function(r,a,s){var i=$s(a,s);return i<-.999999?(Jt(t,e,a),Wc(t)<1e-6&&Jt(t,n,a),Ct(t,t),zs(r,t,Math.PI),r):i>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Jt(t,a,s),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+i,Hc(r,r))}})();(function(){var t=At(),e=At();return function(n,r,a,s,i,o){return Sr(t,r,i,o),Sr(e,a,s,o),Sr(n,t,e,2*o*(1-o)),n}})();(function(){var t=Rc();return function(e,n,r,a){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=a[0],t[4]=a[1],t[7]=a[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],Hc(e,Q0(e,t))}})();var xn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ws(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Z0(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}),n}var pa,_i;function J0(){return _i||(_i=1,pa=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var r,a,s;if(Array.isArray(e)){if(r=e.length,r!=n.length)return!1;for(a=r;a--!==0;)if(!t(e[a],n[a]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(s=Object.keys(e),r=s.length,r!==Object.keys(n).length)return!1;for(a=r;a--!==0;)if(!Object.prototype.hasOwnProperty.call(n,s[a]))return!1;for(a=r;a--!==0;){var i=s[a];if(!t(e[i],n[i]))return!1}return!0}return e!==e&&n!==n}),pa}var ep=J0();const tp=Ws(ep);var ha,Bi;function Ac(){if(Bi)return ha;Bi=1;var t=Object.prototype.toString;return ha=function(n){var r=t.call(n),a=r==="[object Arguments]";return a||(a=r!=="[object Array]"&&n!==null&&typeof n=="object"&&typeof n.length=="number"&&n.length>=0&&t.call(n.callee)==="[object Function]"),a},ha}var va,Fi;function np(){if(Fi)return va;Fi=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=Ac(),a=Object.prototype.propertyIsEnumerable,s=!a.call({toString:null},"toString"),i=a.call(function(){},"prototype"),o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(l){var p=l.constructor;return p&&p.prototype===l},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},g=function(){if(typeof window>"u")return!1;for(var l in window)try{if(!u["$"+l]&&e.call(window,l)&&window[l]!==null&&typeof window[l]=="object")try{c(window[l])}catch{return!0}}catch{return!0}return!1}(),f=function(l){if(typeof window>"u"||!g)return c(l);try{return c(l)}catch{return!1}};t=function(p){var y=p!==null&&typeof p=="object",h=n.call(p)==="[object Function]",v=r(p),x=y&&n.call(p)==="[object String]",S=[];if(!y&&!h&&!v)throw new TypeError("Object.keys called on a non-object");var d=i&&h;if(x&&p.length>0&&!e.call(p,0))for(var T=0;T<p.length;++T)S.push(String(T));if(v&&p.length>0)for(var w=0;w<p.length;++w)S.push(String(w));else for(var C in p)!(d&&C==="prototype")&&e.call(p,C)&&S.push(String(C));if(s)for(var O=f(p),R=0;R<o.length;++R)!(O&&o[R]==="constructor")&&e.call(p,o[R])&&S.push(o[R]);return S}}return va=t,va}var ya,mi;function rp(){if(mi)return ya;mi=1;var t=Array.prototype.slice,e=Ac(),n=Object.keys,r=n?function(i){return n(i)}:np(),a=Object.keys;return r.shim=function(){if(Object.keys){var i=function(){var o=Object.keys(arguments);return o&&o.length===arguments.length}(1,2);i||(Object.keys=function(c){return e(c)?a(t.call(c)):a(c)})}else Object.keys=r;return Object.keys||r},ya=r,ya}var da,Ui;function jc(){if(Ui)return da;Ui=1;var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return da=t,da}var Ta,ki;function ap(){return ki||(ki=1,Ta=SyntaxError),Ta}var xa,Ni;function sp(){return Ni||(Ni=1,xa=TypeError),xa}var Sa,Gi;function ip(){return Gi||(Gi=1,Sa=Object.getOwnPropertyDescriptor),Sa}var Ca,bi;function op(){if(bi)return Ca;bi=1;var t=ip();if(t)try{t([],"length")}catch{t=null}return Ca=t,Ca}var wa,$i;function cp(){if($i)return wa;$i=1;var t=jc(),e=ap(),n=sp(),r=op();return wa=function(s,i,o){if(!s||typeof s!="object"&&typeof s!="function")throw new n("`obj` must be an object or a function`");if(typeof i!="string"&&typeof i!="symbol")throw new n("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new n("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new n("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new n("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new n("`loose`, if provided, must be a boolean");var c=arguments.length>3?arguments[3]:null,u=arguments.length>4?arguments[4]:null,g=arguments.length>5?arguments[5]:null,f=arguments.length>6?arguments[6]:!1,l=!!r&&r(s,i);if(t)t(s,i,{configurable:g===null&&l?l.configurable:!g,enumerable:c===null&&l?l.enumerable:!c,value:o,writable:u===null&&l?l.writable:!u});else if(f||!c&&!u&&!g)s[i]=o;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},wa}var Ea,zi;function fp(){if(zi)return Ea;zi=1;var t=jc(),e=function(){return!!t};return e.hasArrayLengthDefineBug=function(){if(!t)return null;try{return t([],"length",{value:1}).length!==1}catch{return!0}},Ea=e,Ea}var Oa,Wi;function Kc(){if(Wi)return Oa;Wi=1;var t=rp(),e=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",n=Object.prototype.toString,r=Array.prototype.concat,a=cp(),s=function(u){return typeof u=="function"&&n.call(u)==="[object Function]"},i=fp()(),o=function(u,g,f,l){if(g in u){if(l===!0){if(u[g]===f)return}else if(!s(l)||!l())return}i?a(u,g,f,!0):a(u,g,f)},c=function(u,g){var f=arguments.length>2?arguments[2]:{},l=t(g);e&&(l=r.call(l,Object.getOwnPropertySymbols(g)));for(var p=0;p<l.length;p+=1)o(u,l[p],g[l[p]],f[l[p]])};return c.supportsDescriptors=!!i,Oa=c,Oa}var Sn={exports:{}},Hi;function Pc(){return Hi||(Hi=1,typeof self<"u"?Sn.exports=self:typeof window<"u"?Sn.exports=window:Sn.exports=Function("return this")()),Sn.exports}var Ra,Ai;function Xc(){if(Ai)return Ra;Ai=1;var t=Pc();return Ra=function(){return typeof xn!="object"||!xn||xn.Math!==Math||xn.Array!==Array?t:xn},Ra}var Da,ji;function up(){if(ji)return Da;ji=1;var t=Kc(),e=Xc();return Da=function(){var r=e();if(t.supportsDescriptors){var a=Object.getOwnPropertyDescriptor(r,"globalThis");(!a||a.configurable&&(a.enumerable||!a.writable||globalThis!==r))&&Object.defineProperty(r,"globalThis",{configurable:!0,enumerable:!1,value:r,writable:!0})}else(typeof globalThis!="object"||globalThis!==r)&&(r.globalThis=r);return r},Da}var Ma,Ki;function gp(){if(Ki)return Ma;Ki=1;var t=Kc(),e=Pc(),n=Xc(),r=up(),a=n(),s=function(){return a};return t(s,{getPolyfill:n,implementation:e,shim:r}),Ma=s,Ma}var lp=gp();const pp=Ws(lp),Ge=pp(),Yc={vtkObject:()=>null};function We(t){if(t==null||t.isA)return t;if(!t.vtkClass)return Ge.console&&Ge.console.error&&Ge.console.error("Invalid VTK object"),null;const e=Yc[t.vtkClass];if(!e)return Ge.console&&Ge.console.error&&Ge.console.error(`No vtk class found for Object of type ${t.vtkClass}`),null;const n={...t};Object.keys(n).forEach(a=>{n[a]&&typeof n[a]=="object"&&n[a].vtkClass&&(n[a]=We(n[a]))});const r=e(n);return r&&r.modified&&r.modified(),r}function hp(t,e){Yc[t]=e}We.register=hp;class La extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}}let hs=0;const qc=Symbol("void");function vp(){return hs}const Ic={};function kt(){}const yp=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];yp.forEach(t=>{Ic[t]=kt});Ge.console=console.hasOwnProperty("log")?console:Ic;const Et={debug:kt,error:Ge.console.error||kt,info:Ge.console.info||kt,log:Ge.console.log||kt,warn:Ge.console.warn||kt};function Qc(t,e){Et[t]&&(Et[t]=e||kt)}function Zc(){Et.log(...arguments)}function Jc(){Et.info(...arguments)}function Ur(){Et.debug(...arguments)}function j(){Et.error(...arguments)}function na(){Et.warn(...arguments)}const Pi={};function ef(t){Pi[t]||(Et.error(t),Pi[t]=!0)}const Te=Object.create(null);Te.Float32Array=Float32Array;Te.Float64Array=Float64Array;Te.Uint8Array=Uint8Array;Te.Int8Array=Int8Array;Te.Uint16Array=Uint16Array;Te.Int16Array=Int16Array;Te.Uint32Array=Uint32Array;Te.Int32Array=Int32Array;Te.Uint8ClampedArray=Uint8ClampedArray;try{Te.BigInt64Array=BigInt64Array,Te.BigUint64Array=BigUint64Array}catch{}function pn(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return new(Te[t]||Float64Array)(...n)}function Hs(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return(Te[t]||Float64Array).from(...n)}function ra(t){return t.charAt(0).toUpperCase()+t.slice(1)}function re(t){return ra(t[0]==="_"?t.slice(1):t)}function tf(t){return t.charAt(0).toLowerCase()+t.slice(1)}function nf(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;const r=["TB","GB","MB","KB"];let a=Number(t),s="B";for(;a>n;)a/=n,s=r.pop();return`${a.toFixed(e)} ${s}`}function rf(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ";const n=[];let r=t;for(;r>1e3;)n.push(`000${r%1e3}`.slice(-3)),r=Math.floor(r/1e3);return r>0&&n.push(r),n.reverse(),n.join(e)}function af(t){Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function dp(t){return Object.values(Te).some(e=>t instanceof e)}function Tp(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return!1}function xp(t,e){return Object.keys(t).find(n=>t[n]===e)}function sf(t){return t&&t.isA?t.getState():t}function As(t){setTimeout(t,0)}function of(t,e){const n=performance.now();t.finally(()=>{const r=performance.now()-n;e(r)})}function ye(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};af(e);const n=[];if(Number.isInteger(e.mtime)||(e.mtime=++hs),!("classHierarchy"in e))e.classHierarchy=new La("vtkObject");else if(!(e.classHierarchy instanceof La)){const s=new La;for(let i=0;i<e.classHierarchy.length;i++)s.push(e.classHierarchy[i]);e.classHierarchy=s}function r(s){n[s]=null}function a(s){function i(){r(s)}return Object.freeze({unsubscribe:i})}return t.isDeleted=()=>!!e.deleted,t.modified=s=>{if(e.deleted){j("instance deleted - cannot call any method");return}s&&s<t.getMTime()||(e.mtime=++hs,n.forEach(i=>i&&i(t)))},t.onModified=s=>{if(e.deleted)return j("instance deleted - cannot call any method"),null;const i=n.length;return n.push(s),a(i)},t.getMTime=()=>e.mtime,t.isA=s=>{let i=e.classHierarchy.length;for(;i--;)if(e.classHierarchy[i]===s)return!0;return!1},t.getClassName=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-s]},t.set=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=!1;return Object.keys(s).forEach(u=>{const g=o?null:t[`set${ra(u)}`];g&&Array.isArray(s[u])&&g.length>1?c=g(...s[u])||c:g?c=g(s[u])||c:(["mtime"].indexOf(u)===-1&&!i&&na(`Warning: Set value to model directly ${u}, ${s[u]}`),c=e[u]!==s[u]||c,e[u]=s[u])}),c},t.get=function(){for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];if(!i.length)return e;const c={};return i.forEach(u=>{c[u]=e[u]}),c},t.getReferenceByName=s=>e[s],t.delete=()=>{Object.keys(e).forEach(s=>delete e[s]),n.forEach((s,i)=>r(i)),e.deleted=!0},t.getState=()=>{if(e.deleted)return null;const s={...e,vtkClass:t.getClassName()};Object.keys(s).forEach(o=>{s[o]===null||s[o]===void 0||o[0]==="_"?delete s[o]:s[o].isA?s[o]=s[o].getState():Array.isArray(s[o])?s[o]=s[o].map(sf):dp(s[o])&&(s[o]=Array.from(s[o]))});const i={};return Object.keys(s).sort().forEach(o=>{i[o]=s[o]}),i.mtime&&delete i.mtime,i},t.shallowCopy=function(s){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(s.getClassName()!==t.getClassName())throw new Error(`Cannot ShallowCopy ${s.getClassName()} into ${t.getClassName()}`);const o=s.get(),c=Object.keys(e).sort();Object.keys(o).sort().forEach(g=>{const f=c.indexOf(g);f===-1?i&&Ur(`add ${g} in shallowCopy`):c.splice(f,1),e[g]=o[g]}),c.length&&i&&Ur(`Untouched keys: ${c.join(", ")}`),t.modified()},t.toJSON=function(){return t.getState()},t}const Sp={object(t,e,n){return function(){return{...e[n.name]}}}};function Re(t,e,n){n.forEach(r=>{if(typeof r=="object"){const a=Sp[r.type];a?t[`get${re(r.name)}`]=a(t,e,r):t[`get${re(r.name)}`]=()=>e[r.name]}else t[`get${re(r)}`]=()=>e[r]})}const cf={enum(t,e,n){const r=`_on${re(n.name)}Changed`;return a=>{var s;if(typeof a=="string"){if(n.enum[a]!==void 0)return e[n.name]!==n.enum[a]?(e[n.name]=n.enum[a],t.modified(),!0):!1;throw j(`Set Enum with invalid argument ${n}, ${a}`),new RangeError("Set Enum with invalid string argument")}if(typeof a=="number"){if(e[n.name]!==a){if(Object.keys(n.enum).map(i=>n.enum[i]).indexOf(a)!==-1){const i=e[n.name];return e[n.name]=a,(s=e[r])==null||s.call(e,t,e,a,i),t.modified(),!0}throw j(`Set Enum outside numeric range ${n}, ${a}`),new RangeError("Set Enum outside numeric range")}return!1}throw j(`Set Enum with invalid argument (String/Number) ${n}, ${a}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(t,e,n){var a;((a=n.params)==null?void 0:a.length)===1&&na('Setter of type "object" with a single "param" field is not supported');const r=`_on${re(n.name)}Changed`;return function(){var u,g;for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];let c;if(i.length>1&&((u=n.params)!=null&&u.length)?c=n.params.reduce((f,l,p)=>Object.assign(f,{[l]:i[p]}),{}):c=i[0],!tp(e[n.name],c)){const f=e[n.name];return e[n.name]=c,(g=e[r])==null||g.call(e,t,e,c,f),t.modified(),!0}return!1}}};function Xi(t){if(typeof t=="object"){const e=cf[t.type];if(e)return(n,r)=>e(n,r,t);throw j(`No setter for field ${t}`),new TypeError("No setter for field")}return function(n,r){const a=`_on${re(t)}Changed`;return function(i){var o;if(r.deleted)return j("instance deleted - cannot call any method"),!1;if(r[t]!==i){const c=r[t.name];return r[t]=i,(o=r[a])==null||o.call(r,n,r,i,c),n.modified(),!0}return!1}}}function Gn(t,e,n){n.forEach(r=>{typeof r=="object"?t[`set${re(r.name)}`]=Xi(r)(t,e):t[`set${re(r)}`]=Xi(r)(t,e)})}function le(t,e,n){Re(t,e,n),Gn(t,e,n)}function hn(t,e,n){n.forEach(r=>{t[`get${re(r)}`]=()=>e[r]?Array.from(e[r]):e[r],t[`get${re(r)}ByReference`]=()=>e[r]})}function js(t,e,n,r){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;n.forEach(s=>{if(e[s]&&r&&e[s].length!==r)throw new RangeError(`Invalid initial number of values for array (${s})`);const i=`_on${re(s)}Changed`;t[`set${re(s)}`]=function(){var p;if(e.deleted)return j("instance deleted - cannot call any method"),!1;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];let g=c,f,l=!1;if(g.length===1&&(g[0]==null||g[0].length>=0)&&(g=g[0],l=!0),g==null)f=e[s]!==g;else{if(r&&g.length!==r)if(g.length<r&&a!==void 0)for(g=Array.from(g),l=!1;g.length<r;)g.push(a);else throw new RangeError(`Invalid number of values for array setter (${s})`);f=e[s]==null||e[s].length!==g.length;for(let y=0;!f&&y<g.length;++y)f=e[s][y]!==g[y];f&&l&&(g=Array.from(g))}if(f){const y=e[s.name];e[s]=g,(p=e[i])==null||p.call(e,t,e,g,y),t.modified()}return f},t[`set${re(s)}From`]=o=>{const c=e[s];o.forEach((u,g)=>{c[g]=u})}})}function Ks(t,e,n,r){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;hn(t,e,n),js(t,e,n,r,a)}function bn(t,e,n){for(let r=0;r<n.length;r++){const a=n[r];e[a]!==void 0&&(e[`_${a}`]=e[a],delete e[a])}}function ff(t,e,n,r){e.inputData?e.inputData=e.inputData.map(We):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(We):e.inputConnection=[],e.output?e.output=e.output.map(We):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(We):e.inputArrayToProcess=[],e.numberOfInputs=n;function a(p){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){j("instance deleted - cannot call any method");return}if(y>=e.numberOfInputs){j(`algorithm ${t.getClassName()} only has ${e.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(e.inputData[y]!==p||e.inputConnection[y])&&(e.inputData[y]=p,e.inputConnection[y]=null,t.modified&&t.modified())}function s(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[p]&&(e.inputData[p]=e.inputConnection[p]()),e.inputData[p]}function i(p){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){j("instance deleted - cannot call any method");return}if(y>=e.numberOfInputs){let h=`algorithm ${t.getClassName()} only has `;h+=`${e.numberOfInputs}`,h+=" input ports. To add more input ports, use addInputConnection()",j(h);return}e.inputData[y]=null,e.inputConnection[y]=p}function o(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[p]}function c(){let p=e.numberOfInputs;for(;p&&!e.inputData[p-1]&&!e.inputConnection[p-1];)p--;return p===e.numberOfInputs&&e.numberOfInputs++,p}function u(p){if(e.deleted){j("instance deleted - cannot call any method");return}i(p,c())}function g(p){if(e.deleted){j("instance deleted - cannot call any method");return}a(p,c())}function f(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(j("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[p])}t.shouldUpdate=()=>{var v,x;const p=t.getMTime();let y=1/0,h=r;for(;h--;){if(!e.output[h]||e.output[h].isDeleted())return!0;const S=e.output[h].getMTime();if(S<p)return!0;S<y&&(y=S)}for(h=e.numberOfInputs;h--;)if((v=e.inputConnection[h])!=null&&v.filter.shouldUpdate()||((x=t.getInputData(h))==null?void 0:x.getMTime())>y)return!0;return!1};function l(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const y=()=>f(p);return y.filter=t,y}if(e.numberOfInputs){let p=e.numberOfInputs;for(;p--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=a,t.setInputConnection=i,t.addInputData=g,t.addInputConnection=u,t.getInputData=s,t.getInputConnection=o}r&&(t.getOutputData=f,t.getOutputPort=l),t.update=()=>{const p=[];if(e.numberOfInputs){let y=0;for(;y<e.numberOfInputs;)p[y]=t.getInputData(y),y++}t.shouldUpdate()&&t.requestData&&t.requestData(p,e.output)},t.getNumberOfInputPorts=()=>e.numberOfInputs,t.getNumberOfOutputPorts=()=>r||e.output.length,t.getInputArrayToProcess=p=>{const y=e.inputArrayToProcess[p],h=e.inputData[p];return y&&h?h[`get${y.fieldAssociation}`]().getArray(y.arrayName):null},t.setInputArrayToProcess=function(p,y,h){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;e.inputArrayToProcess.length<p;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[p]={arrayName:y,fieldAssociation:h,attributeType:v}}}const Ps=Symbol("Event abort");function uf(t,e,n){const r=[],a=t.delete;let s=1;function i(u){for(let g=0;g<r.length;++g){const[f]=r[g];if(f===u){r.splice(g,1);return}}}function o(u){function g(){i(u)}return Object.freeze({unsubscribe:g})}function c(){if(e.deleted){j("instance deleted - cannot call any method");return}const u=r.slice();for(let g=0;g<u.length;++g){const[,f,l]=u[g];if(f){if(l<0)setTimeout(()=>f.apply(t,arguments),1-l);else if(f.apply(t,arguments)===Ps)break}}}t[`invoke${re(n)}`]=c,t[`on${re(n)}`]=function(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!u.apply)return console.error(`Invalid callback for event ${n}`),null;if(e.deleted)return j("instance deleted - cannot call any method"),null;const f=s++;return r.push([f,u,g]),r.sort((l,p)=>p[2]-l[2]),o(f)},t.delete=()=>{a(),r.forEach(u=>{let[g]=u;return i(g)})}}function Z(t,e){const n=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a={},s={};return t(s,a,r),Object.freeze(s)};return e&&We.register(e,n),n}function gf(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(){for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return e.filter(i=>!!i).map(i=>i(...a))}}function Xs(t){return t&&t.isA&&t.isA("vtkObject")}function kr(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(Xs(t)){if(r.indexOf(t)>=0)return n;r.push(t);const a=e(t);a!==void 0&&n.push(a);const s=t.get();Object.keys(s).forEach(i=>{const o=s[i];Array.isArray(o)?o.forEach(c=>{kr(c,e,n,r)}):kr(o,e,n,r)})}return n}function lf(t,e,n){var r=this;let a;const s=function(){for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];const u=r,g=()=>{a=null,n||t.apply(u,o)},f=n&&!a;clearTimeout(a),a=setTimeout(g,e),f&&t.apply(u,o)};return s.cancel=()=>clearTimeout(a),s}function pf(t,e){let n=!1,r=null;function a(){n=!1,r!==null&&(s(...r),r=null)}function s(){for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];if(n){r=o;return}n=!0,t(...o),setTimeout(a,e)}return s}function Ys(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},n),t.setKey=(r,a)=>{e.keystore[r]=a},t.getKey=r=>e.keystore[r],t.getAllKeys=()=>Object.keys(e.keystore),t.deleteKey=r=>delete e.keystore[r],t.clearKeystore=()=>t.getAllKeys().forEach(r=>delete e.keystore[r])}let Cp=1;const Pn="__root__";function hf(t,e){Ys(t,e);const n=t.delete;e.proxyId=`${Cp++}`,e.ui=JSON.parse(JSON.stringify(e.ui||[])),Re(t,e,["proxyId","proxyGroup","proxyName"]),le(t,e,["proxyManager"]);const r={},a={};function s(u,g){a[g]||(a[g]=[]);const f=a[g];for(let l=0;l<u.length;l++)f.push(u[l].name),r[u[l].name]=u[l],u[l].children&&u[l].children.length&&s(u[l].children,u[l].name)}s(e.ui,Pn),t.updateUI=u=>{e.ui=JSON.parse(JSON.stringify(u||[])),Object.keys(r).forEach(g=>delete r[g]),Object.keys(a).forEach(g=>delete a[g]),s(e.ui,Pn),t.modified()};function i(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Pn;return a[u]}t.updateProxyProperty=(u,g)=>{const f=r[u];f?Object.assign(f,g):r[u]={...g}},t.activate=()=>{if(e.proxyManager){const u=`setActive${re(t.getProxyGroup().slice(0,-1))}`;e.proxyManager[u]&&e.proxyManager[u](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=(u,g)=>{g in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[g]=[]),e.propertyLinkSubscribers[g].push(u)},t.gcPropertyLinks=u=>{const g=e.propertyLinkSubscribers[u]||[];for(;g.length;)g.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[u])return e.propertyLinkMap[u];let f=null;const l=[];let p=0,y=!1;function h(T){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(y)return null;const C=[];let O=null;for(p=l.length;p--;){const L=l[p];L.instance===T?O=L:C.push(L)}if(!O)return null;const R=O.instance[`get${re(O.propertyName)}`]();if(!Tp(R,f)||w){for(f=R,y=!0;C.length;){const L=C.pop();L.instance.set({[L.propertyName]:f})}y=!1}return e.propertyLinkMap[u].persistent&&(e.propertyLinkMap[u].value=R),R}function v(T,w){const C=[];for(p=l.length;p--;){const O=l[p];O.instance===T&&(O.propertyName===w||w===void 0)&&(O.subscription.unsubscribe(),C.push(p))}for(;C.length;)l.splice(C.pop(),1)}function x(T,w){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const O=T.onModified(h),R=l[0];return l.push({instance:T,propertyName:w,subscription:O}),C&&(e.propertyLinkMap[u].persistent&&e.propertyLinkMap[u].value!==void 0?T.set({[w]:e.propertyLinkMap[u].value}):R&&h(R.instance,!0)),{unsubscribe:()=>v(T,w)}}function S(){for(;l.length;)l.pop().subscription.unsubscribe()}const d={bind:x,unbind:v,unsubscribe:S,persistent:g};return e.propertyLinkMap[u]=d,d};function o(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Pn;const g=[],f=e.proxyId,l=i(u)||[];for(let p=0;p<l.length;p++){const y=l[p],h=t[`get${re(y)}`],v=h?h():void 0,x={id:f,name:y,value:v},S=o(y);S.length&&(x.children=S),g.push(x)}return g}t.listPropertyNames=()=>o().map(u=>u.name),t.getPropertyByName=u=>o().find(g=>g.name===u),t.getPropertyDomainByName=u=>(r[u]||{}).domain,t.getProxySection=()=>({id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:o()}),t.delete=()=>{const u=Object.keys(e.propertyLinkMap);let g=u.length;for(;g--;)e.propertyLinkMap[u[g]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),n()},t.getState=()=>null;function c(){if(e.links)for(let u=0;u<e.links.length;u++){const{link:g,property:f,persistent:l,updateOnBind:p,type:y}=e.links[u];if(y==="application"){const h=e.proxyManager.getPropertyLink(g,l);t.registerPropertyLinkForGC(h,"application"),h.bind(t,f,p)}}}As(c)}function vf(t,e,n){const r=t.delete,a=[],s=Object.keys(n);let i=s.length;for(;i--;){const o=s[i],{modelKey:c,property:u,modified:g=!0}=n[o],f=re(u),l=re(o);t[`get${l}`]=e[c][`get${f}`],t[`set${l}`]=e[c][`set${f}`],g&&a.push(e[c].onModified(t.modified))}t.delete=()=>{for(;a.length;)a.pop().unsubscribe();r()}}function yf(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function a(o){const c=Object.keys(o);let u=c.length;for(;u--;){const g=c[u];e[g].set(o[g])}}const s=Object.keys(r);let i=s.length;for(;i--;){const o=s[i];e[o]=r[o];const c=n[o];t[`set${re(o)}`]=u=>{if(u!==e[o]){e[o]=u;const g=c[u];a(g),t.modified()}}}s.length&&Re(t,e,s)}const Yi=10,qi=40,Ii=800;function df(t){let e=0,n=0,r=0,a=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=e*Yi,a=n*Yi,"deltaY"in t&&(a=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||a)&&t.deltaMode&&(t.deltaMode===1?(r*=qi,a*=qi):(r*=Ii,a*=Ii)),r&&!e&&(e=r<1?-1:1),a&&!n&&(n=a<1?-1:1),{spinX:e,spinY:n||e,pixelX:r,pixelY:a||r}}var E={algo:ff,capitalize:ra,chain:gf,debounce:lf,enumToString:xp,event:uf,EVENT_ABORT:Ps,formatBytesToProperUnit:nf,formatNumbersWithThousandSeparator:rf,get:Re,getArray:hn,getCurrentGlobalMTime:vp,getStateArrayMapFunc:sf,isVtkObject:Xs,keystore:Ys,measurePromiseExecution:of,moveToProtected:bn,newInstance:Z,newTypedArray:pn,newTypedArrayFrom:Hs,normalizeWheel:df,obj:ye,proxy:hf,proxyPropertyMapping:vf,proxyPropertyState:yf,safeArrays:af,set:Gn,setArray:js,setGet:le,setGetArray:Ks,setImmediate:As,setLoggerFunction:Qc,throttle:pf,traverseInstanceTree:kr,TYPED_ARRAYS:Te,uncapitalize:tf,VOID:qc,vtkDebugMacro:Ur,vtkErrorMacro:j,vtkInfoMacro:Jc,vtkLogMacro:Zc,vtkOnceErrorMacro:ef,vtkWarningMacro:na,objectSetterMap:cf},Je=Object.freeze({__proto__:null,VOID:qc,setLoggerFunction:Qc,vtkLogMacro:Zc,vtkInfoMacro:Jc,vtkDebugMacro:Ur,vtkErrorMacro:j,vtkWarningMacro:na,vtkOnceErrorMacro:ef,TYPED_ARRAYS:Te,newTypedArray:pn,newTypedArrayFrom:Hs,capitalize:ra,_capitalize:re,uncapitalize:tf,formatBytesToProperUnit:nf,formatNumbersWithThousandSeparator:rf,setImmediateVTK:As,measurePromiseExecution:of,obj:ye,get:Re,set:Gn,setGet:le,getArray:hn,setArray:js,setGetArray:Ks,moveToProtected:bn,algo:ff,EVENT_ABORT:Ps,event:uf,newInstance:Z,chain:gf,isVtkObject:Xs,traverseInstanceTree:kr,debounce:lf,throttle:pf,keystore:Ys,proxy:hf,proxyPropertyMapping:vf,proxyPropertyState:yf,normalizeWheel:df,default:E});const{vtkErrorMacro:wp}=E,Ep=["Build","Render"];function Op(t,e){e.classHierarchy.push("vtkViewNode"),t.build=r=>{},t.render=r=>{},t.traverse=r=>{const a=r.getTraverseOperation(),s=t[a];if(s){s(r);return}t.apply(r,!0);for(let i=0;i<e.children.length;i++)e.children[i].traverse(r);t.apply(r,!1)},t.apply=(r,a)=>{const s=t[r.getOperation()];s&&s(a,r)},t.getViewNodeFor=r=>{if(e.renderable===r)return t;for(let a=0;a<e.children.length;++a){const i=e.children[a].getViewNodeFor(r);if(i)return i}},t.getFirstAncestorOfType=r=>e._parent?e._parent.isA(r)?e._parent:e._parent.getFirstAncestorOfType(r):null,t.getLastAncestorOfType=r=>{if(!e._parent)return null;const a=e._parent.getLastAncestorOfType(r);return a||(e._parent.isA(r)?e._parent:null)},t.addMissingNode=r=>{if(!r)return;const a=e._renderableChildMap.get(r);if(a!==void 0)return a.setVisited(!0),a;const s=t.createViewNode(r);if(s)return s.setParent(t),s.setVisited(!0),e._renderableChildMap.set(r,s),e.children.push(s),s},t.addMissingNodes=r=>{if(!(!r||!r.length))for(let a=0;a<r.length;++a){const s=r[a];t.addMissingNode(s)}},t.addMissingChildren=r=>{if(!(!r||!r.length))for(let a=0;a<r.length;++a){const s=r[a];if(e.children.indexOf(s)===-1){s.setParent(t),e.children.push(s);const o=s.getRenderable();o&&e._renderableChildMap.set(o,s)}s.setVisited(!0)}},t.removeNode=r=>{const a=e.children.findIndex(i=>i===r);if(a<0)return!1;const s=r.getRenderable();return s&&e._renderableChildMap.delete(s),r.delete(),e.children.splice(a,1),!0},t.prepareNodes=()=>{for(let r=0;r<e.children.length;++r)e.children[r].setVisited(!1)},t.setVisited=r=>{e.visited=r},t.removeUnusedNodes=()=>{let r=0;for(let a=0;a<e.children.length;++a){const s=e.children[a];if(s.getVisited())e.children[r++]=s,s.setVisited(!1);else{const o=s.getRenderable();o&&e._renderableChildMap.delete(o),s.delete()}}e.children.length=r},t.createViewNode=r=>{if(!e.myFactory)return wp("Cannot create view nodes without my own factory"),null;const a=e.myFactory.createNode(r);return a&&a.setRenderable(r),a};const n=t.delete;t.delete=()=>{for(let r=0;r<e.children.length;r++)e.children[r].delete();n()}}const Rp={renderable:null,myFactory:null,children:[],visited:!1};function Tf(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Rp,n),E.obj(t,e),E.event(t,e,"event"),e._renderableChildMap=new Map,E.get(t,e,["visited"]),E.setGet(t,e,["_parent","renderable","myFactory"]),E.getArray(t,e,["children"]),E.moveToProtected(t,e,["parent"]),Op(t,e)}const Dp=E.newInstance(Tf,"vtkViewNode");var ae={newInstance:Dp,extend:Tf,PASS_TYPES:Ep};function Mp(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=n=>{if(n.isDeleted())return null;let r=0,a=n.getClassName(r++),s=!1;const i=Object.keys(e.overrides);for(;a&&!s;)i.indexOf(a)!==-1?s=!0:a=n.getClassName(r++);if(!s)return null;const o=e.overrides[a]();return o.setMyFactory(t),o}}const Lp={};function xf(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Lp,n),E.obj(t,e),Mp(t,e)}const Vp=E.newInstance(xf,"vtkViewNodeFactory");var Sf={newInstance:Vp,extend:xf};const Cf=Object.create(null);function Fe(t,e){Cf[t]=e}function _p(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}const Bp={};function wf(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Bp,n),e.overrides=Cf,Sf.extend(t,e,n),_p(t,e)}const Fp=E.newInstance(wf,"vtkOpenGLViewNodeFactory");var mp={newInstance:Fp,extend:wf};function Up(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=n=>{if(n){const r=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize),e.context.scissor(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=n=>{if(n!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||n.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){de(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),ms(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),Us(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),te(e.keyMatrices.wcvc,e.keyMatrices.wcvc);const r=e._openGLRenderer.getAspectRatio();de(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(r,-1,1)),te(e.keyMatrices.vcpc,e.keyMatrices.vcpc),ge(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=n}return e.keyMatrices}}const kp={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function Np(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kp,n),ae.extend(t,e,n),e.keyMatrixTime={},ye(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},le(t,e,["context","keyMatrixTime"]),Up(t,e)}const Gp=Z(Np);Fe("vtkCamera",Gp);const{vtkDebugMacro:bp}=Je;function $p(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes()}},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let a=0;a<r.length;++a)r[a].getSwitch()>0&&n++;return n||(bp("No lights are on, creating one."),e.renderable.createLight()),n},t.zBufferPass=n=>{if(n){let r=0;const a=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),r|=a.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(a.clearDepth(1),r|=a.DEPTH_BUFFER_BIT,e.context.depthMask(!0));const s=t.getTiledSizeAndOrigin();a.enable(a.SCISSOR_TEST),a.scissor(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),a.viewport(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),a.colorMask(!0,!0,!0,!0),r&&a.clear(r),a.enable(a.DEPTH_TEST)}},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.cameraPass=n=>{n&&t.clear()},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],a=n[0]-r[0],s=n[1]-r[1],i=e._parent.normalizedDisplayToDisplay(a,s),o=Math.round(i[0]),c=Math.round(i[1]),u=n[2]-r[0],g=n[3]-r[1],f=e._parent.normalizedDisplayToDisplay(u,g);let l=Math.round(f[0])-o,p=Math.round(f[1])-c;return l<0&&(l=0),p<0&&(p=0),{usize:l,vsize:p,lowerLeftU:o,lowerLeftV:c}},t.clear=()=>{let n=0;const r=e.context;if(!e.renderable.getTransparent()){const s=e.renderable.getBackgroundByReference();r.clearColor(s[0],s[1],s[2],s[3]),n|=r.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(r.clearDepth(1),n|=r.DEPTH_BUFFER_BIT,r.depthMask(!0)),r.colorMask(!0,!0,!0,!0);const a=t.getTiledSizeAndOrigin();r.enable(r.SCISSOR_TEST),r.scissor(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),r.viewport(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),n&&r.clear(n),r.enable(r.DEPTH_TEST)},t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources(),e.renderable&&e.renderable.getViewProps().forEach(n=>{n.modified()})},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const zp={context:null,_openGLRenderWindow:null,selector:null};function Wp(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zp,n),ae.extend(t,e,n),Re(t,e,["shaderCache"]),le(t,e,["selector"]),bn(t,e,["openGLRenderWindow"]),$p(t,e)}const Hp=Z(Wp,"vtkOpenGLRenderer");Fe("vtkRenderer",Hp);function Ap(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=n=>{if(n){e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const a=e.children[r];a.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(a)):e.oglmapper=a}}},t.traverseZBufferPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOpaqueZBufferPass=n=>t.traverseOpaquePass(n),t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.zBufferPass=(n,r)=>t.opaquePass(n,r),t.opaqueZBufferPass=(n,r)=>t.opaquePass(n,r),t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(e._openGLRenderer.getSelector()&&e.renderable.getNestedPickable()),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),de(e.keyMatrices.mcwc,e.renderable.getMatrix()),te(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?jt(e.keyMatrices.normalMatrix):(ms(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),Us(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),Dc(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices)}const jp={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function Kp(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jp,n),ae.extend(t,e,n),e.keyMatrixTime={},ye(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:jt(new Float64Array(9)),mcwc:A(new Float64Array(16))},le(t,e,["context"]),Re(t,e,["activeTextures"]),Ap(t,e)}const Pp=Z(Kp);Fe("vtkActor",Pp);function Xp(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=n=>{if(n){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let r=0;r<e.children.length;r++){const a=e.children[r];a.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(a)):e.oglmapper=a}}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOverlayActorCount()}},t.traverseOpaquePass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.traverseOverlayPass=n=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(n,!0),e.oglmapper.traverse(n),t.apply(n,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let n=0;n<e.ogltextures.length;n++){const r=e.ogltextures[n];r.render(),r.getHandle()&&e.activeTextures.push(r)}}},t.opaquePass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.translucentPass=(n,r)=>{if(n)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.overlayPass=(n,r)=>{if(n)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()}}const Yp={context:null,activeTextures:null};function qp(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Yp,n),ae.extend(t,e,n),le(t,e,["context"]),Re(t,e,["activeTextures"]),Xp(t,e)}const Ip=Z(qp);Fe("vtkActor2D",Ip);function Cr(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Qp(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Ef(t){let e,n,r;t.length!==2?(e=Cr,n=(o,c)=>Cr(t(o),c),r=(o,c)=>t(o)-c):(e=t===Cr||t===Qp?t:Zp,n=t,r=t);function a(o,c,u=0,g=o.length){if(u<g){if(e(c,c)!==0)return g;do{const f=u+g>>>1;n(o[f],c)<0?u=f+1:g=f}while(u<g)}return u}function s(o,c,u=0,g=o.length){if(u<g){if(e(c,c)!==0)return g;do{const f=u+g>>>1;n(o[f],c)<=0?u=f+1:g=f}while(u<g)}return u}function i(o,c,u=0,g=o.length){const f=a(o,c,u,g-1);return f>u&&r(o[f-1],c)>-r(o[f],c)?f-1:f}return{left:a,center:i,right:s}}function Zp(){return 0}function Jp(t){return t===null?NaN:+t}const eh=Ef(Cr),th=eh.right;Ef(Jp).center;const nh=Math.sqrt(50),rh=Math.sqrt(10),ah=Math.sqrt(2);function Nr(t,e,n){const r=(e-t)/Math.max(0,n),a=Math.floor(Math.log10(r)),s=r/Math.pow(10,a),i=s>=nh?10:s>=rh?5:s>=ah?2:1;let o,c,u;return a<0?(u=Math.pow(10,-a)/i,o=Math.round(t*u),c=Math.round(e*u),o/u<t&&++o,c/u>e&&--c,u=-u):(u=Math.pow(10,a)*i,o=Math.round(t/u),c=Math.round(e/u),o*u<t&&++o,c*u>e&&--c),c<o&&.5<=n&&n<2?Nr(t,e,n*2):[o,c,u]}function sh(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[a,s,i]=r?Nr(e,t,n):Nr(t,e,n);if(!(s>=a))return[];const o=s-a+1,c=new Array(o);if(r)if(i<0)for(let u=0;u<o;++u)c[u]=(s-u)/-i;else for(let u=0;u<o;++u)c[u]=(s-u)*i;else if(i<0)for(let u=0;u<o;++u)c[u]=(a+u)/-i;else for(let u=0;u<o;++u)c[u]=(a+u)*i;return c}function vs(t,e,n){return e=+e,t=+t,n=+n,Nr(t,e,n)[2]}function ih(t,e,n){e=+e,t=+t,n=+n;const r=e<t,a=r?vs(e,t,n):vs(t,e,n);return(r?-1:1)*(a<0?1/-a:a)}function oh(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function qs(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Of(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function $n(){}var Bn=.7,Gr=1/Bn,en="\\s*([+-]?\\d+)\\s*",Fn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",qe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ch=/^#([0-9a-f]{3,8})$/,fh=new RegExp(`^rgb\\(${en},${en},${en}\\)$`),uh=new RegExp(`^rgb\\(${qe},${qe},${qe}\\)$`),gh=new RegExp(`^rgba\\(${en},${en},${en},${Fn}\\)$`),lh=new RegExp(`^rgba\\(${qe},${qe},${qe},${Fn}\\)$`),ph=new RegExp(`^hsl\\(${Fn},${qe},${qe}\\)$`),hh=new RegExp(`^hsla\\(${Fn},${qe},${qe},${Fn}\\)$`),Qi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};qs($n,mn,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Zi,formatHex:Zi,formatHex8:vh,formatHsl:yh,formatRgb:Ji,toString:Ji});function Zi(){return this.rgb().formatHex()}function vh(){return this.rgb().formatHex8()}function yh(){return Rf(this).formatHsl()}function Ji(){return this.rgb().formatRgb()}function mn(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=ch.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?eo(e):n===3?new De(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Xn(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Xn(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=fh.exec(t))?new De(e[1],e[2],e[3],1):(e=uh.exec(t))?new De(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=gh.exec(t))?Xn(e[1],e[2],e[3],e[4]):(e=lh.exec(t))?Xn(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=ph.exec(t))?ro(e[1],e[2]/100,e[3]/100,1):(e=hh.exec(t))?ro(e[1],e[2]/100,e[3]/100,e[4]):Qi.hasOwnProperty(t)?eo(Qi[t]):t==="transparent"?new De(NaN,NaN,NaN,0):null}function eo(t){return new De(t>>16&255,t>>8&255,t&255,1)}function Xn(t,e,n,r){return r<=0&&(t=e=n=NaN),new De(t,e,n,r)}function dh(t){return t instanceof $n||(t=mn(t)),t?(t=t.rgb(),new De(t.r,t.g,t.b,t.opacity)):new De}function ys(t,e,n,r){return arguments.length===1?dh(t):new De(t,e,n,r??1)}function De(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}qs(De,ys,Of($n,{brighter(t){return t=t==null?Gr:Math.pow(Gr,t),new De(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Bn:Math.pow(Bn,t),new De(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new De($t(this.r),$t(this.g),$t(this.b),br(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:to,formatHex:to,formatHex8:Th,formatRgb:no,toString:no}));function to(){return`#${bt(this.r)}${bt(this.g)}${bt(this.b)}`}function Th(){return`#${bt(this.r)}${bt(this.g)}${bt(this.b)}${bt((isNaN(this.opacity)?1:this.opacity)*255)}`}function no(){const t=br(this.opacity);return`${t===1?"rgb(":"rgba("}${$t(this.r)}, ${$t(this.g)}, ${$t(this.b)}${t===1?")":`, ${t})`}`}function br(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function $t(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function bt(t){return t=$t(t),(t<16?"0":"")+t.toString(16)}function ro(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new $e(t,e,n,r)}function Rf(t){if(t instanceof $e)return new $e(t.h,t.s,t.l,t.opacity);if(t instanceof $n||(t=mn(t)),!t)return new $e;if(t instanceof $e)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,a=Math.min(e,n,r),s=Math.max(e,n,r),i=NaN,o=s-a,c=(s+a)/2;return o?(e===s?i=(n-r)/o+(n<r)*6:n===s?i=(r-e)/o+2:i=(e-n)/o+4,o/=c<.5?s+a:2-s-a,i*=60):o=c>0&&c<1?0:i,new $e(i,o,c,t.opacity)}function xh(t,e,n,r){return arguments.length===1?Rf(t):new $e(t,e,n,r??1)}function $e(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}qs($e,xh,Of($n,{brighter(t){return t=t==null?Gr:Math.pow(Gr,t),new $e(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Bn:Math.pow(Bn,t),new $e(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,a=2*n-r;return new De(Va(t>=240?t-240:t+120,a,r),Va(t,a,r),Va(t<120?t+240:t-120,a,r),this.opacity)},clamp(){return new $e(ao(this.h),Yn(this.s),Yn(this.l),br(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=br(this.opacity);return`${t===1?"hsl(":"hsla("}${ao(this.h)}, ${Yn(this.s)*100}%, ${Yn(this.l)*100}%${t===1?")":`, ${t})`}`}}));function ao(t){return t=(t||0)%360,t<0?t+360:t}function Yn(t){return Math.max(0,Math.min(1,t||0))}function Va(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Is=t=>()=>t;function Sh(t,e){return function(n){return t+n*e}}function Ch(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function wh(t){return(t=+t)==1?Df:function(e,n){return n-e?Ch(e,n,t):Is(isNaN(e)?n:e)}}function Df(t,e){var n=e-t;return n?Sh(t,n):Is(isNaN(t)?e:t)}const so=function t(e){var n=wh(e);function r(a,s){var i=n((a=ys(a)).r,(s=ys(s)).r),o=n(a.g,s.g),c=n(a.b,s.b),u=Df(a.opacity,s.opacity);return function(g){return a.r=i(g),a.g=o(g),a.b=c(g),a.opacity=u(g),a+""}}return r.gamma=t,r}(1);function Eh(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),a;return function(s){for(a=0;a<n;++a)r[a]=t[a]*(1-s)+e[a]*s;return r}}function Oh(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Rh(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,a=new Array(r),s=new Array(n),i;for(i=0;i<r;++i)a[i]=Qs(t[i],e[i]);for(;i<n;++i)s[i]=e[i];return function(o){for(i=0;i<r;++i)s[i]=a[i](o);return s}}function Dh(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function $r(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Mh(t,e){var n={},r={},a;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(a in e)a in t?n[a]=Qs(t[a],e[a]):r[a]=e[a];return function(s){for(a in n)r[a]=n[a](s);return r}}var ds=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,_a=new RegExp(ds.source,"g");function Lh(t){return function(){return t}}function Vh(t){return function(e){return t(e)+""}}function _h(t,e){var n=ds.lastIndex=_a.lastIndex=0,r,a,s,i=-1,o=[],c=[];for(t=t+"",e=e+"";(r=ds.exec(t))&&(a=_a.exec(e));)(s=a.index)>n&&(s=e.slice(n,s),o[i]?o[i]+=s:o[++i]=s),(r=r[0])===(a=a[0])?o[i]?o[i]+=a:o[++i]=a:(o[++i]=null,c.push({i,x:$r(r,a)})),n=_a.lastIndex;return n<e.length&&(s=e.slice(n),o[i]?o[i]+=s:o[++i]=s),o.length<2?c[0]?Vh(c[0].x):Lh(e):(e=c.length,function(u){for(var g=0,f;g<e;++g)o[(f=c[g]).i]=f.x(u);return o.join("")})}function Qs(t,e){var n=typeof e,r;return e==null||n==="boolean"?Is(e):(n==="number"?$r:n==="string"?(r=mn(e))?(e=r,so):_h:e instanceof mn?so:e instanceof Date?Dh:Oh(e)?Eh:Array.isArray(e)?Rh:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Mh:$r)(t,e)}function Bh(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function Fh(t){return function(){return t}}function mh(t){return+t}var io=[0,1];function Qt(t){return t}function Ts(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Fh(isNaN(e)?NaN:.5)}function Uh(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function kh(t,e,n){var r=t[0],a=t[1],s=e[0],i=e[1];return a<r?(r=Ts(a,r),s=n(i,s)):(r=Ts(r,a),s=n(s,i)),function(o){return s(r(o))}}function Nh(t,e,n){var r=Math.min(t.length,e.length)-1,a=new Array(r),s=new Array(r),i=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++i<r;)a[i]=Ts(t[i],t[i+1]),s[i]=n(e[i],e[i+1]);return function(o){var c=th(t,o,1,r)-1;return s[c](a[c](o))}}function Gh(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function bh(){var t=io,e=io,n=Qs,r,a,s,i=Qt,o,c,u;function g(){var l=Math.min(t.length,e.length);return i!==Qt&&(i=Uh(t[0],t[l-1])),o=l>2?Nh:kh,c=u=null,f}function f(l){return l==null||isNaN(l=+l)?s:(c||(c=o(t.map(r),e,n)))(r(i(l)))}return f.invert=function(l){return i(a((u||(u=o(e,t.map(r),$r)))(l)))},f.domain=function(l){return arguments.length?(t=Array.from(l,mh),g()):t.slice()},f.range=function(l){return arguments.length?(e=Array.from(l),g()):e.slice()},f.rangeRound=function(l){return e=Array.from(l),n=Bh,g()},f.clamp=function(l){return arguments.length?(i=l?!0:Qt,g()):i!==Qt},f.interpolate=function(l){return arguments.length?(n=l,g()):n},f.unknown=function(l){return arguments.length?(s=l,f):s},function(l,p){return r=l,a=p,g()}}function $h(){return bh()(Qt,Qt)}function zh(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function zr(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function tn(t){return t=zr(Math.abs(t)),t?t[1]:NaN}function Wh(t,e){return function(n,r){for(var a=n.length,s=[],i=0,o=t[0],c=0;a>0&&o>0&&(c+o+1>r&&(o=Math.max(1,r-c)),s.push(n.substring(a-=o,a+o)),!((c+=o+1)>r));)o=t[i=(i+1)%t.length];return s.reverse().join(e)}}function Hh(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Ah=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Wr(t){if(!(e=Ah.exec(t)))throw new Error("invalid format: "+t);var e;return new Zs({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Wr.prototype=Zs.prototype;function Zs(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Zs.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function jh(t){e:for(var e=t.length,n=1,r=-1,a;n<e;++n)switch(t[n]){case".":r=a=n;break;case"0":r===0&&(r=n),a=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(a+1):t}var Mf;function Kh(t,e){var n=zr(t,e);if(!n)return t+"";var r=n[0],a=n[1],s=a-(Mf=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,i=r.length;return s===i?r:s>i?r+new Array(s-i+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+zr(t,Math.max(0,e+s-1))[0]}function oo(t,e){var n=zr(t,e);if(!n)return t+"";var r=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+r:r.length>a+1?r.slice(0,a+1)+"."+r.slice(a+1):r+new Array(a-r.length+2).join("0")}const co={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:zh,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>oo(t*100,e),r:oo,s:Kh,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function fo(t){return t}var uo=Array.prototype.map,go=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Ph(t){var e=t.grouping===void 0||t.thousands===void 0?fo:Wh(uo.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",a=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?fo:Hh(uo.call(t.numerals,String)),i=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function u(f){f=Wr(f);var l=f.fill,p=f.align,y=f.sign,h=f.symbol,v=f.zero,x=f.width,S=f.comma,d=f.precision,T=f.trim,w=f.type;w==="n"?(S=!0,w="g"):co[w]||(d===void 0&&(d=12),T=!0,w="g"),(v||l==="0"&&p==="=")&&(v=!0,l="0",p="=");var C=h==="$"?n:h==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",O=h==="$"?r:/[%p]/.test(w)?i:"",R=co[w],L=/[defgprs%]/.test(w);d=d===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,d)):Math.max(0,Math.min(20,d));function D(M){var V=C,B=O,_,k,G;if(w==="c")B=R(M)+B,M="";else{M=+M;var b=M<0||1/M<0;if(M=isNaN(M)?c:R(Math.abs(M),d),T&&(M=jh(M)),b&&+M==0&&y!=="+"&&(b=!1),V=(b?y==="("?y:o:y==="-"||y==="("?"":y)+V,B=(w==="s"?go[8+Mf/3]:"")+B+(b&&y==="("?")":""),L){for(_=-1,k=M.length;++_<k;)if(G=M.charCodeAt(_),48>G||G>57){B=(G===46?a+M.slice(_+1):M.slice(_))+B,M=M.slice(0,_);break}}}S&&!v&&(M=e(M,1/0));var I=V.length+M.length+B.length,m=I<x?new Array(x-I+1).join(l):"";switch(S&&v&&(M=e(m+M,m.length?x-B.length:1/0),m=""),p){case"<":M=V+M+B+m;break;case"=":M=V+m+M+B;break;case"^":M=m.slice(0,I=m.length>>1)+V+M+B+m.slice(I);break;default:M=m+V+M+B;break}return s(M)}return D.toString=function(){return f+""},D}function g(f,l){var p=u((f=Wr(f),f.type="f",f)),y=Math.max(-8,Math.min(8,Math.floor(tn(l)/3)))*3,h=Math.pow(10,-y),v=go[8+y/3];return function(x){return p(h*x)+v}}return{format:u,formatPrefix:g}}var qn,Lf,Vf;Xh({thousands:",",grouping:[3],currency:["$",""]});function Xh(t){return qn=Ph(t),Lf=qn.format,Vf=qn.formatPrefix,qn}function Yh(t){return Math.max(0,-tn(Math.abs(t)))}function qh(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(tn(e)/3)))*3-tn(Math.abs(t)))}function Ih(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,tn(e)-tn(t))+1}function Qh(t,e,n,r){var a=ih(t,e,n),s;switch(r=Wr(r??",f"),r.type){case"s":{var i=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(s=qh(a,i))&&(r.precision=s),Vf(r,i)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=Ih(a,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=Yh(a))&&(r.precision=s-(r.type==="%")*2);break}}return Lf(r)}function Zh(t){var e=t.domain;return t.ticks=function(n){var r=e();return sh(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var a=e();return Qh(a[0],a[a.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),a=0,s=r.length-1,i=r[a],o=r[s],c,u,g=10;for(o<i&&(u=i,i=o,o=u,u=a,a=s,s=u);g-- >0;){if(u=vs(i,o,n),u===c)return r[a]=i,r[s]=o,e(r);if(u>0)i=Math.floor(i/u)*u,o=Math.ceil(o/u)*u;else if(u<0)i=Math.ceil(i*u)/u,o=Math.floor(o*u)/u;else break;c=u}return t},t}function Js(){var t=$h();return t.copy=function(){return Gh(t,Js())},oh.apply(t,arguments),Zh(t)}var wr={exports:{}},Jh=wr.exports,lo;function e1(){return lo||(lo=1,function(t){(function(e,n,r){function a(c){var u=this,g=o();u.next=function(){var f=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=f-(u.c=f|0)},u.c=1,u.s0=g(" "),u.s1=g(" "),u.s2=g(" "),u.s0-=g(c),u.s0<0&&(u.s0+=1),u.s1-=g(c),u.s1<0&&(u.s1+=1),u.s2-=g(c),u.s2<0&&(u.s2+=1),g=null}function s(c,u){return u.c=c.c,u.s0=c.s0,u.s1=c.s1,u.s2=c.s2,u}function i(c,u){var g=new a(c),f=u&&u.state,l=g.next;return l.int32=function(){return g.next()*4294967296|0},l.double=function(){return l()+(l()*2097152|0)*11102230246251565e-32},l.quick=l,f&&(typeof f=="object"&&s(f,g),l.state=function(){return s(g,{})}),l}function o(){var c=4022871197,u=function(g){g=String(g);for(var f=0;f<g.length;f++){c+=g.charCodeAt(f);var l=.02519603282416938*c;c=l>>>0,l-=c,l*=c,c=l>>>0,l-=c,c+=l*4294967296}return(c>>>0)*23283064365386963e-26};return u}n&&n.exports?n.exports=i:this.alea=i})(Jh,t)}(wr)),wr.exports}var Er={exports:{}},t1=Er.exports,po;function n1(){return po||(po=1,function(t){(function(e,n,r){function a(o){var c=this,u="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var f=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^f^f>>>8},o===(o|0)?c.x=o:u+=o;for(var g=0;g<u.length+64;g++)c.x^=u.charCodeAt(g)|0,c.next()}function s(o,c){return c.x=o.x,c.y=o.y,c.z=o.z,c.w=o.w,c}function i(o,c){var u=new a(o),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,p=(u.next()>>>0)/4294967296,y=(l+p)/(1<<21);while(y===0);return y},f.int32=u.next,f.quick=f,g&&(typeof g=="object"&&s(g,u),f.state=function(){return s(u,{})}),f}n&&n.exports?n.exports=i:this.xor128=i})(t1,t)}(Er)),Er.exports}var Or={exports:{}},r1=Or.exports,ho;function a1(){return ho||(ho=1,function(t){(function(e,n,r){function a(o){var c=this,u="";c.next=function(){var f=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(f^f<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,o===(o|0)?c.x=o:u+=o;for(var g=0;g<u.length+64;g++)c.x^=u.charCodeAt(g)|0,g==u.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function s(o,c){return c.x=o.x,c.y=o.y,c.z=o.z,c.w=o.w,c.v=o.v,c.d=o.d,c}function i(o,c){var u=new a(o),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,p=(u.next()>>>0)/4294967296,y=(l+p)/(1<<21);while(y===0);return y},f.int32=u.next,f.quick=f,g&&(typeof g=="object"&&s(g,u),f.state=function(){return s(u,{})}),f}n&&n.exports?n.exports=i:this.xorwow=i})(r1,t)}(Or)),Or.exports}var Rr={exports:{}},s1=Rr.exports,vo;function i1(){return vo||(vo=1,function(t){(function(e,n,r){function a(o){var c=this;c.next=function(){var g=c.x,f=c.i,l,p;return l=g[f],l^=l>>>7,p=l^l<<24,l=g[f+1&7],p^=l^l>>>10,l=g[f+3&7],p^=l^l>>>3,l=g[f+4&7],p^=l^l<<7,l=g[f+7&7],l=l^l<<13,p^=l^l<<9,g[f]=p,c.i=f+1&7,p};function u(g,f){var l,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,l=0;l<f.length;++l)p[l&7]=p[l&7]<<15^f.charCodeAt(l)+p[l+1&7]<<13;for(;p.length<8;)p.push(0);for(l=0;l<8&&p[l]===0;++l);for(l==8?p[7]=-1:p[l],g.x=p,g.i=0,l=256;l>0;--l)g.next()}u(c,o)}function s(o,c){return c.x=o.x.slice(),c.i=o.i,c}function i(o,c){o==null&&(o=+new Date);var u=new a(o),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,p=(u.next()>>>0)/4294967296,y=(l+p)/(1<<21);while(y===0);return y},f.int32=u.next,f.quick=f,g&&(g.x&&s(g,u),f.state=function(){return s(u,{})}),f}n&&n.exports?n.exports=i:this.xorshift7=i})(s1,t)}(Rr)),Rr.exports}var Dr={exports:{}},o1=Dr.exports,yo;function c1(){return yo||(yo=1,function(t){(function(e,n,r){function a(o){var c=this;c.next=function(){var g=c.w,f=c.X,l=c.i,p,y;return c.w=g=g+1640531527|0,y=f[l+34&127],p=f[l=l+1&127],y^=y<<13,p^=p<<17,y^=y>>>15,p^=p>>>12,y=f[l]=y^p,c.i=l,y+(g^g>>>16)|0};function u(g,f){var l,p,y,h,v,x=[],S=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,S=Math.max(S,f.length)),y=0,h=-32;h<S;++h)f&&(p^=f.charCodeAt((h+32)%f.length)),h===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,h>=0&&(v=v+1640531527|0,l=x[h&127]^=p+v,y=l==0?y+1:0);for(y>=128&&(x[(f&&f.length||0)&127]=-1),y=127,h=4*128;h>0;--h)p=x[y+34&127],l=x[y=y+1&127],p^=p<<13,l^=l<<17,p^=p>>>15,l^=l>>>12,x[y]=p^l;g.w=v,g.X=x,g.i=y}u(c,o)}function s(o,c){return c.i=o.i,c.w=o.w,c.X=o.X.slice(),c}function i(o,c){o==null&&(o=+new Date);var u=new a(o),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,p=(u.next()>>>0)/4294967296,y=(l+p)/(1<<21);while(y===0);return y},f.int32=u.next,f.quick=f,g&&(g.X&&s(g,u),f.state=function(){return s(u,{})}),f}n&&n.exports?n.exports=i:this.xor4096=i})(o1,t)}(Dr)),Dr.exports}var Mr={exports:{}},f1=Mr.exports,To;function u1(){return To||(To=1,function(t){(function(e,n,r){function a(o){var c=this,u="";c.next=function(){var f=c.b,l=c.c,p=c.d,y=c.a;return f=f<<25^f>>>7^l,l=l-p|0,p=p<<24^p>>>8^y,y=y-f|0,c.b=f=f<<20^f>>>12^l,c.c=l=l-p|0,c.d=p<<16^l>>>16^y,c.a=y-f|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,o===Math.floor(o)?(c.a=o/4294967296|0,c.b=o|0):u+=o;for(var g=0;g<u.length+20;g++)c.b^=u.charCodeAt(g)|0,c.next()}function s(o,c){return c.a=o.a,c.b=o.b,c.c=o.c,c.d=o.d,c}function i(o,c){var u=new a(o),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,p=(u.next()>>>0)/4294967296,y=(l+p)/(1<<21);while(y===0);return y},f.int32=u.next,f.quick=f,g&&(typeof g=="object"&&s(g,u),f.state=function(){return s(u,{})}),f}n&&n.exports?n.exports=i:this.tychei=i})(f1,t)}(Mr)),Mr.exports}var Lr={exports:{}};const g1={},l1=Object.freeze(Object.defineProperty({__proto__:null,default:g1},Symbol.toStringTag,{value:"Module"})),p1=Z0(l1);var h1=Lr.exports,xo;function v1(){return xo||(xo=1,function(t){(function(e,n,r){var a=256,s=6,i=52,o="random",c=r.pow(a,s),u=r.pow(2,i),g=u*2,f=a-1,l;function p(T,w,C){var O=[];w=w==!0?{entropy:!0}:w||{};var R=x(v(w.entropy?[T,d(n)]:T??S(),3),O),L=new y(O),D=function(){for(var M=L.g(s),V=c,B=0;M<u;)M=(M+B)*a,V*=a,B=L.g(1);for(;M>=g;)M/=2,V/=2,B>>>=1;return(M+B)/V};return D.int32=function(){return L.g(4)|0},D.quick=function(){return L.g(4)/4294967296},D.double=D,x(d(L.S),n),(w.pass||C||function(M,V,B,_){return _&&(_.S&&h(_,L),M.state=function(){return h(L,{})}),B?(r[o]=M,V):M})(D,R,"global"in w?w.global:this==r,w.state)}function y(T){var w,C=T.length,O=this,R=0,L=O.i=O.j=0,D=O.S=[];for(C||(T=[C++]);R<a;)D[R]=R++;for(R=0;R<a;R++)D[R]=D[L=f&L+T[R%C]+(w=D[R])],D[L]=w;(O.g=function(M){for(var V,B=0,_=O.i,k=O.j,G=O.S;M--;)V=G[_=f&_+1],B=B*a+G[f&(G[_]=G[k=f&k+V])+(G[k]=V)];return O.i=_,O.j=k,B})(a)}function h(T,w){return w.i=T.i,w.j=T.j,w.S=T.S.slice(),w}function v(T,w){var C=[],O=typeof T,R;if(w&&O=="object")for(R in T)try{C.push(v(T[R],w-1))}catch{}return C.length?C:O=="string"?T:T+"\0"}function x(T,w){for(var C=T+"",O,R=0;R<C.length;)w[f&R]=f&(O^=w[f&R]*19)+C.charCodeAt(R++);return d(w)}function S(){try{var T;return l&&(T=l.randomBytes)?T=T(a):(T=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(T)),d(T)}catch{var w=e.navigator,C=w&&w.plugins;return[+new Date,e,C,e.screen,d(n)]}}function d(T){return String.fromCharCode.apply(0,T)}if(x(r.random(),n),t.exports){t.exports=p;try{l=p1}catch{}}else r["seed"+o]=p})(typeof self<"u"?self:h1,[],Math)}(Lr)),Lr.exports}var Ba,So;function y1(){if(So)return Ba;So=1;var t=e1(),e=n1(),n=a1(),r=i1(),a=c1(),s=u1(),i=v1();return i.alea=t,i.xor128=e,i.xorwow=n,i.xorshift7=r,i.xor4096=a,i.tychei=s,Ba=i,Ba}y1();const d1=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],T1=1e-6,x1=1e-12,{vtkErrorMacro:_O,vtkWarningMacro:Co}=E;function xs(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3;const e=Array(t);for(let n=0;n<t;++n)e[n]=0;return e}function ie(t){return t/180*Math.PI}function Un(t){return t*180/Math.PI}const{round:In}=Math;function be(t){let e=1;for(;e<t;)e*=2;return e}function Qn(t){return t===be(t)}function Ss(t,e,n){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n}function wt(t,e,n){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n}function wo(t,e,n,r){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function K(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function kn(t,e,n){const r=t[1]*e[2]-t[2]*e[1],a=t[2]*e[0]-t[0]*e[2],s=t[0]*e[1]-t[1]*e[0];return n[0]=r,n[1]=a,n[2]=s,n}function _f(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{let n=0;for(let r=0;r<e;r++)n+=t[r]*t[r];return Math.sqrt(n)}}}function Nn(t){const e=_f(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function Pe(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function S1(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function C1(t){const e=S1(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function Vr(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function w1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:T1;if(t.length!==e.length)return!1;function r(a,s){return Math.abs(a-e[s])<=n}return t.every(r)}const Bf=w1;function Fa(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${t}`.includes("e"))return+`${Math.round(`${t}e+${e}`)}e-${e}`;const n=`${t}`.split("e");let r="";return+n[1]+e>0&&(r="+"),+`${Math.round(`${+n[0]}e${r}${+n[1]+e}`)}e-${e}`}function Eo(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=Fa(t[0],n),e[1]=Fa(t[1],n),e[2]=Fa(t[2],n),e}function E1(t,e,n){let r,a,s,i,o=0,c,u,g;const f=xs(n);for(r=0;r<n;r++){for(i=0,a=0;a<n;a++)(g=Math.abs(t[r*n+a]))>i&&(i=g);if(i===0)return Co("Unable to factor linear system"),0;f[r]=1/i}for(a=0;a<n;a++){for(r=0;r<a;r++){for(c=t[r*n+a],s=0;s<r;s++)c-=t[r*n+s]*t[s*n+a];t[r*n+a]=c}for(i=0,r=a;r<n;r++){for(c=t[r*n+a],s=0;s<a;s++)c-=t[r*n+s]*t[s*n+a];t[r*n+a]=c,(u=f[r]*Math.abs(c))>=i&&(i=u,o=r)}if(a!==o){for(s=0;s<n;s++)u=t[o*n+s],t[o*n+s]=t[a*n+s],t[a*n+s]=u;f[o]=f[a]}if(e[a]=o,Math.abs(t[a*n+a])<=x1)return Co("Unable to factor linear system"),0;if(a!==n-1)for(u=1/t[a*n+a],r=a+1;r<n;r++)t[r*n+a]*=u}return 1}function O1(t,e,n,r){let a,s,i,o,c;for(i=-1,a=0;a<r;a++){if(o=e[a],c=n[o],n[o]=n[a],i>=0)for(s=i;s<=a-1;s++)c-=t[a*r+s]*n[s];else c!==0&&(i=a);n[a]=c}for(a=r-1;a>=0;a--){for(c=n[a],s=a+1;s<r;s++)c-=t[a*r+s]*n[s];n[a]=c/t[a*r+a]}}function R1(t,e,n){if(n===2){const a=xs(2),s=Vr(t[0],t[1],t[2],t[3]);return s===0?0:(a[0]=(t[3]*e[0]-t[1]*e[1])/s,a[1]=(-(t[2]*e[0])+t[0]*e[1])/s,e[0]=a[0],e[1]=a[1],1)}if(n===1)return t[0]===0?0:(e[0]/=t[0],1);const r=xs(n);return E1(t,r,n)===0?0:(O1(t,r,e,n),1)}function D1(t,e){const[n,r,a]=t,s=1/3,i=1/6,o=2/3,c=5/6;let u,g,f;n>i&&n<=s?(g=1,u=(s-n)/i,f=0):n>s&&n<=.5?(g=1,f=(n-s)/i,u=0):n>.5&&n<=o?(f=1,g=(o-n)/i,u=0):n>o&&n<=c?(f=1,u=(n-o)/i,g=0):n>c&&n<=1?(u=1,f=(1-n)/i,g=0):(u=1,g=n/i,f=0),u=r*u+(1-r),g=r*g+(1-r),f=r*f+(1-r),u*=a,g*=a,f*=a,e[0]=u,e[1]=g,e[2]=f}function ei(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function ma(t){return!(t[1]-t[0]<0)}function Ua(t,e,n){return t<e?e:t>n?n:t}function Oo(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return r[0]=Ua(t[0],e[0],n[0]),r[1]=Ua(t[1],e[1],n[1]),r[2]=Ua(t[2],e[2],n[2]),r}const{isNaN:M1}=Number,Ff=M1;function ti(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function L1(t,e){e.classHierarchy.push("vtkImplicitFunction"),t.functionValue=n=>{if(!e.transform)return t.evaluateFunction(n);const r=[];return e.transform.transformPoint(n,r),t.evaluateFunction(r)},t.evaluateFunction=n=>{E.vtkErrorMacro("not implemented")}}const V1={};function mf(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,V1,n),E.obj(t,e),E.setGet(t,e,["transform"]),L1(t,e)}const _1=E.newInstance(mf,"vtkImplicitFunction");var B1={newInstance:_1,extend:mf};const Cs=1e-6,Uf="coincide",kf="disjoint";function F1(t,e,n){return t[0]*(n[0]-e[0])+t[1]*(n[1]-e[1])+t[2]*(n[2]-e[2])}function Nf(t,e,n){const r=n[0]*(t[0]-e[0])+n[1]*(t[1]-e[1])+n[2]*(t[2]-e[2]);return Math.abs(r)}function Gf(t,e,n,r){const a=[];wt(t,e,a);const s=K(n,a);r[0]=t[0]-s*n[0],r[1]=t[1]-s*n[1],r[2]=t[2]-s*n[2]}function bf(t,e,n){const r=K(t,e);let a=K(e,e);return a===0&&(a=1),n[0]=t[0]-r*e[0]/a,n[1]=t[1]-r*e[1]/a,n[2]=t[2]-r*e[2]/a,n}function $f(t,e,n,r){const a=[];wt(t,e,a);const s=K(n,a),i=K(n,n);i!==0?(r[0]=t[0]-s*n[0]/i,r[1]=t[1]-s*n[1]/i,r[2]=t[2]-s*n[2]/i):(r[0]=t[0],r[1]=t[1],r[2]=t[2])}function zf(t,e,n,r){const a={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},s=[],i=[];wt(e,t,s),wt(n,t,i);const o=K(r,i),c=K(r,s);let u,g;return c<0?u=-c:u=c,o<0?g=-o*Cs:g=o*Cs,u<=g||(a.t=o/c,a.x[0]=t[0]+a.t*s[0],a.x[1]=t[1]+a.t*s[1],a.x[2]=t[2]+a.t*s[2],a.intersection=!0,a.betweenPoints=a.t>=0&&a.t<=1),a}function Wf(t,e,n,r){const a={intersection:!1,l0:[],l1:[],error:null},s=[];kn(e,r,s);const i=s.map(f=>Math.abs(f));if(i[0]+i[1]+i[2]<Cs){const f=[];return wt(t,n,f),K(e,f)===0?a.error=Uf:a.error=kf,a}let o;i[0]>i[1]&&i[0]>i[2]?o="x":i[1]>i[2]?o="y":o="z";const c=[],u=-K(e,t),g=-K(r,n);switch(o){case"x":c[0]=0,c[1]=(g*e[2]-u*r[2])/s[0],c[2]=(u*r[1]-g*e[1])/s[0];break;case"y":c[0]=(u*r[2]-g*e[2])/s[1],c[1]=0,c[2]=(g*e[0]-u*r[0])/s[1];break;case"z":c[0]=(g*e[1]-u*r[1])/s[2],c[1]=(u*r[0]-g*e[0])/s[2],c[2]=0;break}return a.l0=c,Ss(c,s,a.l1),a.intersection=!0,a}const m1={evaluate:F1,distanceToPlane:Nf,projectPoint:Gf,projectVector:bf,generalizedProjectPoint:$f,intersectWithLine:zf,intersectWithPlane:Wf,DISJOINT:kf,COINCIDE:Uf};function U1(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=n=>Nf(n,e.origin,e.normal),t.projectPoint=(n,r)=>{Gf(n,e.origin,e.normal,r)},t.projectVector=(n,r)=>bf(n,e.normal,r),t.push=n=>{if(n!==0)for(let r=0;r<3;r++)e.origin[r]+=n*e.normal[r]},t.generalizedProjectPoint=(n,r)=>{$f(n,e.origin,e.normal,r)},t.evaluateFunction=(n,r,a)=>Array.isArray(n)?e.normal[0]*(n[0]-e.origin[0])+e.normal[1]*(n[1]-e.origin[1])+e.normal[2]*(n[2]-e.origin[2]):e.normal[0]*(n-e.origin[0])+e.normal[1]*(r-e.origin[1])+e.normal[2]*(a-e.origin[2]),t.evaluateGradient=n=>[e.normal[0],e.normal[1],e.normal[2]],t.intersectWithLine=(n,r)=>zf(n,r,e.origin,e.normal),t.intersectWithPlane=(n,r)=>Wf(n,r,e.origin,e.normal)}const k1={normal:[0,0,1],origin:[0,0,0]};function Hf(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,k1,n),B1.extend(t,e,n),E.setGetArray(t,e,["normal","origin"],3),U1(t,e)}const N1=E.newInstance(Hf,"vtkPlane");var _e={newInstance:N1,extend:Hf,...m1};const aa=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function Af(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function ot(t){return(t==null?void 0:t.length)>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function ni(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function ri(t){return ni(t,aa)}function Hr(t,e,n,r){const[a,s,i,o,c,u]=t;return t[0]=a<e?a:e,t[1]=s>e?s:e,t[2]=i<n?i:n,t[3]=o>n?o:n,t[4]=c<r?c:r,t[5]=u>r?u:r,t}function ai(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(let n=0;n<e.length;++n)Hr(t,...e[n]);else for(let n=0;n<e.length;n+=3)Hr(t,...e.slice(n,n+3));return t}function jf(t,e,n,r,a,s,i){const[o,c,u,g,f,l]=t;return i===void 0?(t[0]=Math.min(e[0],o),t[1]=Math.max(e[1],c),t[2]=Math.min(e[2],u),t[3]=Math.max(e[3],g),t[4]=Math.min(e[4],f),t[5]=Math.max(e[5],l)):(t[0]=Math.min(e,o),t[1]=Math.max(n,c),t[2]=Math.min(r,u),t[3]=Math.max(a,g),t[4]=Math.min(s,f),t[5]=Math.max(i,l)),t}function Kf(t,e,n,r){const[a,s,i,o,c,u]=t;return t[0]=e,t[1]=e>s?e:s,t[2]=n,t[3]=n>o?n:o,t[4]=r,t[5]=r>u?r:u,a!==e||i!==n||c!==r}function Pf(t,e,n,r){const[a,s,i,o,c,u]=t;return t[0]=e<a?e:a,t[1]=e,t[2]=n<i?n:i,t[3]=n,t[4]=r<c?r:c,t[5]=r,s!==e||o!==n||u!==r}function Xf(t,e){return t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t}function si(t,e,n,r){return ot(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),n>=0?(t[2]*=n,t[3]*=n):(t[2]=n*t[3],t[3]=n*t[2]),r>=0?(t[4]*=r,t[5]*=r):(t[4]=r*t[5],t[5]=r*t[4]),!0):!1}function ii(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function G1(t,e,n,r){if(!ot(t))return!1;const a=ii(t);return t[0]-=a[0],t[1]-=a[0],t[2]-=a[1],t[3]-=a[1],t[4]-=a[2],t[5]-=a[2],si(t,e,n,r),t[0]+=a[0],t[1]+=a[0],t[2]+=a[1],t[3]+=a[1],t[4]+=a[2],t[5]+=a[2],!0}function Ln(t,e){return t[e*2+1]-t[e*2]}function sa(t){return[Ln(t,0),Ln(t,1),Ln(t,2)]}function Yf(t){return t.slice(0,2)}function qf(t){return t.slice(2,4)}function If(t){return t.slice(4,6)}function Qf(t){const e=sa(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function Zf(t){if(ot(t)){const e=sa(t);return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}return null}function oi(t){return[t[0],t[2],t[4]]}function ci(t){return[t[1],t[3],t[5]]}function Zn(t,e){return t<=0&&e>=0||t>=0&&e<=0}function fi(t,e){let n=0;for(let r=0;r<2;r++)for(let a=2;a<4;a++)for(let s=4;s<6;s++)e[n++]=[t[r],t[a],t[s]];return e}function Jf(t,e,n){return e[0]=t[0],e[1]=t[2],e[2]=t[4],n[0]=t[1],n[1]=t[3],n[2]=t[5],e}function eu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const r=fi(t,[]);for(let a=0;a<r.length;++a)q(r[a],r[a],e);return ri(n),ai(n,r)}function tu(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function nu(t,e,n,r){const a=[].concat(aa),s=t.getData();for(let i=0;i<s.length;i+=3){const o=[s[i],s[i+1],s[i+2]],c=K(o,e);a[0]=Math.min(c,a[0]),a[1]=Math.max(c,a[1]);const u=K(o,n);a[2]=Math.min(u,a[2]),a[3]=Math.max(u,a[3]);const g=K(o,r);a[4]=Math.min(g,a[4]),a[5]=Math.max(g,a[5])}return a}function ru(t,e,n,r,a){let s=!0;const i=[];let o=0;const c=[],u=[0,0,0],g=0,f=1,l=2;for(let p=0;p<3;p++)e[p]<t[2*p]?(i[p]=f,u[p]=t[2*p],s=!1):e[p]>t[2*p+1]?(i[p]=g,u[p]=t[2*p+1],s=!1):i[p]=l;if(s)return r[0]=e[0],r[1]=e[1],r[2]=e[2],a[0]=0,1;for(let p=0;p<3;p++)i[p]!==l&&n[p]!==0?c[p]=(u[p]-e[p])/n[p]:c[p]=-1;for(let p=0;p<3;p++)c[o]<c[p]&&(o=p);if(c[o]>1||c[o]<0)return 0;a[0]=c[o];for(let p=0;p<3;p++)if(o!==p){if(r[p]=e[p]+c[o]*n[p],r[p]<t[2*p]||r[p]>t[2*p+1])return 0}else r[p]=u[p];return 1}function au(t,e,n){const r=[];let a=0,s=1,i=1;for(let o=4;o<=5;++o){r[2]=t[o];for(let c=2;c<=3;++c){r[1]=t[c];for(let u=0;u<=1;++u)if(r[0]=t[u],a=_e.evaluate(n,e,r),i&&(s=a>=0?1:-1,i=0),a===0||s>0&&a<0||s<0&&a>0)return 1}}return 0}function su(t,e){if(!(ot(t)&&ot(e)))return!1;const n=[0,0,0,0,0,0];let r;for(let a=0;a<3;a++)if(r=!1,e[a*2]>=t[a*2]&&e[a*2]<=t[a*2+1]?(r=!0,n[a*2]=e[a*2]):t[a*2]>=e[a*2]&&t[a*2]<=e[a*2+1]&&(r=!0,n[a*2]=t[a*2]),e[a*2+1]>=t[a*2]&&e[a*2+1]<=t[a*2+1]?(r=!0,n[a*2+1]=e[2*a+1]):t[a*2+1]>=e[a*2]&&t[a*2+1]<=e[a*2+1]&&(r=!0,n[a*2+1]=t[a*2+1]),!r)return!1;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],!0}function Ar(t,e){if(!(ot(t)&&ot(e)))return!1;for(let n=0;n<3;n++)if(!(e[n*2]>=t[n*2]&&e[n*2]<=t[n*2+1])&&!(t[n*2]>=e[n*2]&&t[n*2]<=e[n*2+1])&&!(e[n*2+1]>=t[n*2]&&e[n*2+1]<=t[n*2+1])&&!(t[n*2+1]>=e[n*2]&&t[n*2+1]<=e[n*2+1]))return!1;return!0}function jr(t,e,n,r){return!(e<t[0]||e>t[1]||n<t[2]||n>t[3]||r<t[4]||r>t[5])}function b1(t,e){return!(!Ar(t,e)||!jr(t,...oi(e))||!jr(t,...ci(e)))}function iu(t,e,n){const r=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],a=[0,0,0,0,0,0,0,0];let s=0;for(let f=0;f<2;f++)for(let l=2;l<4;l++)for(let p=4;p<6;p++){const y=[t[f],t[l],t[p]];a[s++]=_e.evaluate(n,e,y)}let i=2;for(;i--&&!(Zn(a[r[i][0]],a[r[i][4]])&&Zn(a[r[i][1]],a[r[i][5]])&&Zn(a[r[i][2]],a[r[i][6]])&&Zn(a[r[i][3]],a[r[i][7]])););if(i<0)return!1;const o=Math.sign(n[i]),c=Math.abs((t[i*2+1]-t[i*2])*n[i]);let u=o>0?1:0;for(let f=0;f<4;f++){if(c===0)continue;const l=Math.abs(a[r[i][f]])/c;o>0&&l<u&&(u=l),o<0&&l>u&&(u=l)}const g=(1-u)*t[i*2]+u*t[i*2+1];return o>0?t[i*2]=g:t[i*2+1]=g,!0}class $1{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(aa))}getBounds(){return this.bounds}equals(e){return Af(this.bounds,e)}isValid(){return ot(this.bounds)}setBounds(e){return ni(this.bounds,e)}reset(){return ri(this.bounds)}addPoint(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Hr(this.bounds,...n)}addPoints(e){return ai(this.bounds,e)}addBounds(e,n,r,a,s,i){return jf(this.bounds,e,n,r,a,s,i)}setMinPoint(e,n,r){return Kf(this.bounds,e,n,r)}setMaxPoint(e,n,r){return Pf(this.bounds,e,n,r)}inflate(e){return Xf(this.bounds,e)}scale(e,n,r){return si(this.bounds,e,n,r)}getCenter(){return ii(this.bounds)}getLength(e){return Ln(this.bounds,e)}getLengths(){return sa(this.bounds)}getMaxLength(){return Qf(this.bounds)}getDiagonalLength(){return Zf(this.bounds)}getMinPoint(){return oi(this.bounds)}getMaxPoint(){return ci(this.bounds)}getXRange(){return Yf(this.bounds)}getYRange(){return qf(this.bounds)}getZRange(){return If(this.bounds)}getCorners(e){return fi(this.bounds,e)}computeCornerPoints(e,n){return Jf(this.bounds,e,n)}computeLocalBounds(e,n,r){return nu(this.bounds,e,n,r)}transformBounds(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return eu(this.bounds,e,n)}computeScale3(e){return tu(this.bounds,e)}cutWithPlane(e,n){return iu(this.bounds,e,n)}intersectBox(e,n,r,a){return ru(this.bounds,e,n,r,a)}intersectPlane(e,n){return au(this.bounds,e,n)}intersect(e){return su(this.bounds,e)}intersects(e){return Ar(this.bounds,e)}containsPoint(e,n,r){return jr(this.bounds,e,n,r)}contains(e){return Ar(this.bounds,e)}}function z1(t){const e=t&&t.bounds;return new $1(e)}const W1={equals:Af,isValid:ot,setBounds:ni,reset:ri,addPoint:Hr,addPoints:ai,addBounds:jf,setMinPoint:Kf,setMaxPoint:Pf,inflate:Xf,scale:si,scaleAboutCenter:G1,getCenter:ii,getLength:Ln,getLengths:sa,getMaxLength:Qf,getDiagonalLength:Zf,getMinPoint:oi,getMaxPoint:ci,getXRange:Yf,getYRange:qf,getZRange:If,getCorners:fi,computeCornerPoints:Jf,computeLocalBounds:nu,transformBounds:eu,computeScale3:tu,cutWithPlane:iu,intersectBox:ru,intersectPlane:au,intersect:su,intersects:Ar,containsPoint:jr,contains:b1,INIT_BOUNDS:aa};var ee={newInstance:z1,...W1};const H1={DISPLAY:0,WORLD:1};var ou={CoordinateSystem:H1};const{CoordinateSystem:ws}=ou;function Ro(t){return()=>E.vtkErrorMacro(`vtkProp::${t} - NOT IMPLEMENTED`)}function A1(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=()=>{let n=e.mtime;for(let r=0;r<e.textures.length;++r){const a=e.textures[r].getMTime();a>n&&(n=a)}return n},t.processSelectorPixelBuffers=(n,r)=>{},t.getNestedProps=()=>null,t.getActors=()=>[],t.getActors2D=()=>[],t.getVolumes=()=>[],t.pick=Ro("pick"),t.hasKey=Ro("hasKey"),t.getNestedVisibility=()=>e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility()),t.getNestedPickable=()=>e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable()),t.getNestedDragable=()=>e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable()),t.getRedrawMTime=()=>e.mtime,t.setEstimatedRenderTime=n=>{e.estimatedRenderTime=n,e.savedEstimatedRenderTime=n},t.restoreEstimatedRenderTime=()=>{e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=n=>{e.estimatedRenderTime+=n},t.setAllocatedRenderTime=n=>{e.allocatedRenderTime=n,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=()=>!1,t.getTextures=()=>e.textures,t.hasTexture=n=>e.textures.indexOf(n)!==-1,t.addTexture=n=>{n&&!t.hasTexture(n)&&(e.textures=e.textures.concat(n),t.modified())},t.removeTexture=n=>{const r=e.textures.filter(a=>a!==n);e.textures.length!==r.length&&(e.textures=r,t.modified())},t.removeAllTextures=()=>{e.textures=[],t.modified()},t.setCoordinateSystemToWorld=()=>t.setCoordinateSystem(ws.WORLD),t.setCoordinateSystemToDisplay=()=>t.setCoordinateSystem(ws.DISPLAY)}const j1={allocatedRenderTime:10,coordinateSystem:ws.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function cu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,j1,n),E.obj(t,e),E.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),E.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),E.moveToProtected(t,e,["parentProp"]),A1(t,e)}const K1=E.newInstance(cu,"vtkProp");var zn={newInstance:K1,extend:cu,...ou};const P1=1e-6;function X1(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=r=>{e.position=e.position.map((a,s)=>a+r[s]),t.modified()},t.getOrientationWXYZ=()=>{const r=At();fs(r,e.rotation);const a=new Float64Array(3),s=q0(a,r);return[Un(s),a[0],a[1],a[2]]},t.getOrientationQuaternion=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return fs(r,e.rotation)},t.rotateX=r=>{r!==0&&(Ns(e.rotation,e.rotation,ie(r)),t.modified())},t.rotateY=r=>{r!==0&&(Gs(e.rotation,e.rotation,ie(r)),t.modified())},t.rotateZ=r=>{r!==0&&(bs(e.rotation,e.rotation,ie(r)),t.modified())},t.rotateWXYZ=(r,a,s,i)=>{if(r===0||a===0&&s===0&&i===0)return;const o=ie(r),c=At();zs(c,[a,s,i],o);const u=new Float64Array(16);mr(u,c),ge(e.rotation,e.rotation,u),t.modified()},t.rotateQuaternion=r=>{if(Math.abs(r[3])>=1-P1)return;const a=mr(new Float64Array(16),r);ge(e.rotation,e.rotation,a),t.modified()},t.setOrientation=(r,a,s)=>r===e.orientation[0]&&a===e.orientation[1]&&s===e.orientation[2]?!1:(e.orientation=[r,a,s],A(e.rotation),t.rotateZ(s),t.rotateX(r),t.rotateY(a),t.modified(),!0),t.setUserMatrix=r=>Bf(e.userMatrix,r)?!1:(de(e.userMatrix,r),t.modified(),!0),t.getMatrix=()=>(t.computeMatrix(),e.matrix),t.computeMatrix=()=>{if(t.getMTime()>e.matrixMTime.getMTime()){A(e.matrix),e.userMatrix&&ge(e.matrix,e.matrix,e.userMatrix),oe(e.matrix,e.matrix,e.origin),oe(e.matrix,e.matrix,e.position),ge(e.matrix,e.matrix,e.rotation),Ht(e.matrix,e.matrix,e.scale),oe(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),te(e.matrix,e.matrix),e.isIdentity=!0;for(let r=0;r<4;++r)for(let a=0;a<4;++a)(r===a?1:0)!==e.matrix[r+a*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getCenter=()=>ee.getCenter(e.bounds),t.getLength=()=>ee.getLength(e.bounds),t.getXRange=()=>ee.getXRange(e.bounds),t.getYRange=()=>ee.getYRange(e.bounds),t.getZRange=()=>ee.getZRange(e.bounds),t.getUserMatrix=()=>e.userMatrix;function n(){t.computeMatrix()}t.onModified(n)}const Y1={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[1,-1,1,-1,1,-1],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function fu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Y1,n),zn.extend(t,e,n),e.matrixMTime={},E.obj(e.matrixMTime),E.get(t,e,["bounds","isIdentity"]),E.getArray(t,e,["orientation"]),E.setGetArray(t,e,["origin","position","scale"],3),e.matrix=A(new Float64Array(16)),e.rotation=A(new Float64Array(16)),e.userMatrix=A(new Float64Array(16)),e.transform=null,X1(t,e)}const q1=E.newInstance(fu,"vtkProp3D");var I1={newInstance:q1,extend:fu};const uu={FLAT:0,GOURAUD:1,PHONG:2},Ve={POINTS:0,WIREFRAME:1,SURFACE:2},Q1=uu;var gu={Shading:uu,Representation:Ve,Interpolation:Q1};const{Representation:Rn,Interpolation:Dn}=gu;function Do(t){return()=>E.vtkErrorMacro(`vtkProperty::${t} - NOT IMPLEMENTED`)}function Z1(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=(n,r,a)=>{Array.isArray(n)?(e.color[0]!==n[0]||e.color[1]!==n[1]||e.color[2]!==n[2])&&(e.color[0]=n[0],e.color[1]=n[1],e.color[2]=n[2],t.modified()):(e.color[0]!==n||e.color[1]!==r||e.color[2]!==a)&&(e.color[0]=n,e.color[1]=r,e.color[2]=a,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=Do("ComputeCompositeColor"),t.getColor=()=>{let n=0;e.ambient+e.diffuse+e.specular>0&&(n=1/(e.ambient+e.diffuse+e.specular));for(let r=0;r<3;r++)e.color[r]=n*(e.ambient*e.ambientColor[r]+e.diffuse*e.diffuseColor[r]+e.specular*e.specularColor[r]);return[].concat(e.color)},t.setSpecularPower=n=>{const r=1/Math.max(1,n);(e.roughness!==r||e.specularPower!==n)&&(e.specularPower=n,e.roughness=r,t.modified())},t.addShaderVariable=Do("AddShaderVariable"),t.setInterpolationToFlat=()=>t.setInterpolation(Dn.FLAT),t.setInterpolationToGouraud=()=>t.setInterpolation(Dn.GOURAUD),t.setInterpolationToPhong=()=>t.setInterpolation(Dn.PHONG),t.getInterpolationAsString=()=>E.enumToString(Dn,e.interpolation),t.setRepresentationToWireframe=()=>t.setRepresentation(Rn.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(Rn.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(Rn.POINTS),t.getRepresentationAsString=()=>E.enumToString(Rn,e.representation)}const J1={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:Dn.GOURAUD,representation:Rn.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null};function ev(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,J1,n),E.obj(t,e),E.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture"]),E.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),Z1(t,e)}const tv=E.newInstance(ev,"vtkProperty");var vn={newInstance:tv,...gu};const{vtkDebugMacro:nv}=E;function rv(t,e){e.classHierarchy.push("vtkActor");const n={...t};t.getActors=()=>[t],t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();let r=e.property.getOpacity()>=1;return r=r&&(!e.texture||!e.texture.isTranslucent()),r=r&&(!e.mapper||e.mapper.getIsOpaque()),r},t.hasTranslucentPolygonalGeometry=()=>e.mapper===null?!1:(e.property===null&&t.setProperty(t.makeProperty()),!t.getIsOpaque()),t.makeProperty=vn.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const r=e.mapper.getBounds();if(!r||r.length!==6)return r;if(r[0]>r[1])return e.mapperBounds=r.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),r;if(!e.mapperBounds||r[0]!==e.mapperBounds[0]||r[1]!==e.mapperBounds[1]||r[2]!==e.mapperBounds[2]||r[3]!==e.mapperBounds[3]||r[4]!==e.mapperBounds[4]||r[5]!==e.mapperBounds[5]||t.getMTime()>e.boundsMTime.getMTime()){nv("Recomputing bounds..."),e.mapperBounds=r.concat();const a=[];ee.getCorners(r,a),t.computeMatrix();const s=new Float64Array(16);te(s,e.matrix),a.forEach(i=>q(i,i,s)),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map((i,o)=>o%2===0?a.reduce((c,u)=>c>u[o/2]?u[o/2]:c,i):a.reduce((c,u)=>c<u[(o-1)/2]?u[(o-1)/2]:c,i)),e.boundsMTime.modified()}return e.bounds},t.getMTime=()=>{let r=n.getMTime();if(e.property!==null){const a=e.property.getMTime();r=a>r?a:r}if(e.backfaceProperty!==null){const a=e.backfaceProperty.getMTime();r=a>r?a:r}return r},t.getRedrawMTime=()=>{let r=e.mtime;if(e.mapper!==null){let a=e.mapper.getMTime();r=a>r?a:r,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),a=e.mapper.getInput().getMTime(),r=a>r?a:r)}return r},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1,t.processSelectorPixelBuffers=(r,a)=>{e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(r,a)}}const av={mapper:null,property:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1,bounds:[1,-1,1,-1,1,-1]};function lu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,av,n),I1.extend(t,e,n),e.boundsMTime={},E.obj(e.boundsMTime),E.set(t,e,["property"]),E.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),rv(t,e)}const sv=E.newInstance(lu,"vtkActor");var Qe={newInstance:sv,extend:lu};const pu={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},ce={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},iv=ce.FLOAT;var hu={DefaultDataType:iv,DataTypeByteSize:pu,VtkDataTypes:ce};const{vtkErrorMacro:ov}=Je,{DefaultDataType:cv}=hu,fv=1e-6;function Es(t,e,n){const r=t.length;let a=Number.MAX_VALUE,s=-Number.MAX_VALUE,i,o;for(o=e;o<r;o+=n)if(!Number.isNaN(t[o])){a=t[o],s=a;break}for(;o<r;o+=n)i=t[o],i<a?a=i:i>s&&(s=i);return{min:a,max:s}}function uv(){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,n=0,r=0;return{add(a){t>a&&(t=a),e<a&&(e=a),n++,r+=a},get(){return{min:t,max:e,count:n,sum:r,mean:r/n}},getRange(){return{min:t,max:e}}}}function vu(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&n>1){const a=t.length/n,s=new Float64Array(a);for(let i=0,o=0;i<a;++i){for(let c=o+n;o<c;++o)s[i]+=t[o]*t[o];s[i]**=.5}return Es(s,0,1)}return Es(t,e<0?0:e,n)}function Mo(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=t||[];for(;n.length<=e;)n.push(null);return n}function ui(t){return Object.prototype.toString.call(t).slice(8,-1)}function gv(t){const e=t.getNumberOfComponents();let n=0;const r=new Array(e);for(let a=0;a<t.getNumberOfTuples();++a){t.getTuple(a,r);const s=_f(r,e);s>n&&(n=s)}return n}const lv={computeRange:vu,createRangeHelper:uv,fastComputeRange:Es,getDataType:ui,getMaxNorm:gv};function pv(t,e){e.classHierarchy.push("vtkDataArray");function n(r){if(r<0)return!1;const a=t.getNumberOfComponents(),s=e.values.length/(a>0?a:1);if(r===s)return!0;if(r>s){const i=e.values;return e.values=pn(e.dataType,(r+s)*a),e.values.set(i),!0}return e.size>r*a&&(e.size=r*a,t.dataChange()),!0}t.dataChange=()=>{e.ranges=null,t.modified()},t.resize=r=>{n(r);const a=r*t.getNumberOfComponents();return e.size!==a?(e.size=a,t.dataChange(),!0):!1},t.initialize=()=>{t.resize(0)},t.getElementComponentSize=()=>e.values.BYTES_PER_ELEMENT,t.getComponent=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[r*e.numberOfComponents+a]},t.setComponent=(r,a,s)=>{s!==e.values[r*e.numberOfComponents+a]&&(e.values[r*e.numberOfComponents+a]=s,t.dataChange())},t.getValue=r=>{const a=r/e.numberOfComponents,s=r%e.numberOfComponents;return t.getComponent(a,s)},t.setValue=(r,a)=>{const s=r/e.numberOfComponents,i=r%e.numberOfComponents;t.setComponent(s,i,a)},t.getData=()=>e.size===e.values.length?e.values:e.values.subarray(0,e.size),t.getRange=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,a=r;a<0&&(a=e.numberOfComponents===1?0:e.numberOfComponents);let s=null;return e.ranges||(e.ranges=Mo(e.ranges,e.numberOfComponents)),s=e.ranges[a],s?(e.rangeTuple[0]=s.min,e.rangeTuple[1]=s.max,e.rangeTuple):(s=vu(t.getData(),r,e.numberOfComponents),e.ranges[a]=s,e.rangeTuple[0]=s.min,e.rangeTuple[1]=s.max,e.rangeTuple)},t.setRange=(r,a)=>{e.ranges||(e.ranges=Mo(e.ranges,e.numberOfComponents));const s={min:r.min,max:r.max};return e.ranges[a]=s,e.rangeTuple[0]=s.min,e.rangeTuple[1]=s.max,e.rangeTuple},t.setTuple=(r,a)=>{const s=r*e.numberOfComponents;for(let i=0;i<e.numberOfComponents;i++)e.values[s+i]=a[i]},t.setTuples=(r,a)=>{let s=r*e.numberOfComponents;const i=Math.min(a.length,e.size-s);for(let o=0;o<i;)e.values[s++]=a[o++]},t.insertTuple=(r,a)=>(e.size<=r*e.numberOfComponents&&(e.size=(r+1)*e.numberOfComponents,n(r+1)),t.setTuple(r,a),r),t.insertTuples=(r,a)=>{const s=r+a.length/e.numberOfComponents;return e.size<s*e.numberOfComponents&&(e.size=s*e.numberOfComponents,n(s)),t.setTuples(r,a),s},t.insertNextTuple=r=>{const a=e.size/e.numberOfComponents;return t.insertTuple(a,r)},t.insertNextTuples=r=>{const a=e.size/e.numberOfComponents;return t.insertTuples(a,r)},t.findTuple=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fv;for(let s=0;s<e.size;s+=e.numberOfComponents)if(Math.abs(r[0]-e.values[s])<=a){let i=!0;for(let o=1;o<e.numberOfComponents;++o)if(Math.abs(r[o]-e.values[s+o])>a){i=!1;break}if(i)return s/e.numberOfComponents}return-1},t.getTuple=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const s=e.numberOfComponents||1,i=r*s;switch(s){case 4:a[3]=e.values[i+3];case 3:a[2]=e.values[i+2];case 2:a[1]=e.values[i+1];case 1:a[0]=e.values[i];break;default:for(let o=s-1;o>=0;--o)a[o]=e.values[i+o]}return a},t.getTuples=(r,a)=>{const s=(r??0)*e.numberOfComponents,i=(a??t.getNumberOfTuples())*e.numberOfComponents,o=t.getData().subarray(s,i);return o.length>0?o:null},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.size,t.getNumberOfTuples=()=>e.size/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>du({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents}),t.getName=()=>(e.name||(t.modified(),e.name=`vtkDataArray${t.getMTime()}`),e.name),t.setData=(r,a)=>{e.values=r,e.size=r.length,e.dataType=ui(r),a&&(e.numberOfComponents=a),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=()=>{if(e.deleted)return null;const r={...e,vtkClass:t.getClassName()};r.values=Array.from(r.values),delete r.buffer,Object.keys(r).forEach(s=>{r[s]||delete r[s]});const a={};return Object.keys(r).sort().forEach(s=>{a[s]=r[s]}),a.mtime&&delete a.mtime,a},t.deepCopy=r=>{const a=t.getDataType(),s=e.values;t.shallowCopy(r),(s==null?void 0:s.length)>=r.getNumberOfValues()&&a===r.getDataType()?(s.set(r.getData()),e.values=s,t.dataChange()):t.setData(r.getData().slice())},t.interpolateTuple=(r,a,s,i,o,c)=>{const u=e.numberOfComponents||1;(u!==a.getNumberOfComponents()||u!==i.getNumberOfComponents())&&ov("numberOfComponents must match");const g=a.getTuple(s),f=i.getTuple(o),l=[];switch(l.length=u,u){case 4:l[3]=g[3]+(f[3]-g[3])*c;case 3:l[2]=g[2]+(f[2]-g[2])*c;case 2:l[1]=g[1]+(f[1]-g[1])*c;case 1:l[0]=g[0]+(f[0]-g[0])*c;break;default:for(let p=0;p<u;p++)l[p]=g[p]+(f[p]-g[p])*c}return t.insertTuple(r,l)}}const hv={name:"",numberOfComponents:1,dataType:cv,rangeTuple:[0,0]};function yu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,hv,n),Array.isArray(n.values)&&n.dataType===void 0&&console.warn("vtkDataArray.newInstance: no dataType provided, converting to Float32Array"),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=Hs(e.dataType,e.values)):e.values=pn(e.dataType,e.size),e.values&&(e.size=e.size??e.values.length,e.dataType=ui(e.values)),ye(t,e),Gn(t,e,["name","numberOfComponents"]),e.size%e.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");pv(t,e)}const du=Z(yu,"vtkDataArray");var Y={newInstance:du,extend:yu,...lv,...hu};function vv(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=()=>{t.getInputData()},t.addClippingPlane=n=>n.isA("vtkPlane")?e.clippingPlanes.includes(n)?!1:(e.clippingPlanes.push(n),t.modified(),!0):!1,t.getNumberOfClippingPlanes=()=>e.clippingPlanes.length,t.removeAllClippingPlanes=()=>e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0),t.removeClippingPlane=n=>{const r=e.clippingPlanes.indexOf(n);return r===-1?!1:(e.clippingPlanes.splice(r,1),t.modified(),!0)},t.getClippingPlanes=()=>e.clippingPlanes,t.setClippingPlanes=n=>{if(n)if(!Array.isArray(n))t.addClippingPlane(n);else{const r=n.length;for(let a=0;a<r&&a<6;a++)t.addClippingPlane(n[a])}},t.getClippingPlaneInDataCoords=(n,r,a)=>{const s=e.clippingPlanes,i=n;if(s){const o=s.length;if(r>=0&&r<o){const c=s[r],u=c.getNormal(),g=c.getOrigin(),f=u[0],l=u[1],p=u[2],y=-(f*g[0]+l*g[1]+p*g[2]);a[0]=f*i[0]+l*i[4]+p*i[8]+y*i[12],a[1]=f*i[1]+l*i[5]+p*i[9]+y*i[13],a[2]=f*i[2]+l*i[6]+p*i[10]+y*i[14],a[3]=f*i[3]+l*i[7]+p*i[11]+y*i[15];return}}E.vtkErrorMacro(`Clipping plane index ${r} is out of range.`)}}const yv={clippingPlanes:[]};function dv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yv,n),E.obj(t,e),E.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),vv(t,e)}var Tu={extend:dv};function Tv(t,e){t.getBounds=()=>(E.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),ti()),t.getCenter=()=>{var r;const n=t.getBounds();return e.center=ee.isValid(n)?ee.getCenter(n):null,(r=e.center)==null?void 0:r.slice()},t.getLength=()=>{const n=t.getBounds();return ee.getDiagonalLength(n)}}const xv=t=>({bounds:[...ee.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...t});function Sv(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xv(n)),Tu.extend(t,e,n),E.setGet(t,e,["viewSpecificProperties"]),Tv(t,e)}var Cv={extend:Sv};const{vtkErrorMacro:Lo,vtkWarningMacro:wv}=E;function Ev(t,e){e.classHierarchy.push("vtkFieldData");const n=t.getState;e.arrays&&(e.arrays=e.arrays.map(r=>({data:We(r.data)}))),t.initialize=()=>{t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=()=>{e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=r=>{t.initializeFields(),e.copyFieldFlags=r.getCopyFieldFlags().map(a=>a),e.arrays=r.arrays().map(a=>({array:a}))},t.getNumberOfArrays=()=>e.arrays.length,t.getNumberOfActiveArrays=()=>e.arrays.length,t.addArray=r=>{const a=r.getName(),{array:s,index:i}=t.getArrayWithIndex(a);return s!=null?(e.arrays[i]={data:r},i):(e.arrays=[].concat(e.arrays,{data:r}),e.arrays.length-1)},t.removeAllArrays=()=>{e.arrays=[]},t.removeArray=r=>{const a=e.arrays.findIndex(s=>s.data.getName()===r);return t.removeArrayByIndex(a)},t.removeArrayByIndex=r=>r!==-1&&r<e.arrays.length?(e.arrays.splice(r,1),!0):!1,t.getArrays=()=>e.arrays.map(r=>r.data),t.getArray=r=>typeof r=="number"?t.getArrayByIndex(r):t.getArrayByName(r),t.getArrayByName=r=>e.arrays.reduce((a,s,i)=>s.data.getName()===r?s.data:a,null),t.getArrayWithIndex=r=>{const a=e.arrays.findIndex(s=>s.data.getName()===r);return{array:a!==-1?e.arrays[a].data:null,index:a}},t.getArrayByIndex=r=>r>=0&&r<e.arrays.length?e.arrays[r].data:null,t.hasArray=r=>t.getArrayWithIndex(r).index>=0,t.getArrayName=r=>{const a=e.arrays[r];return a?a.data.getName():""},t.getCopyFieldFlags=()=>e.copyFieldFlags,t.getFlag=r=>e.copyFieldFlags[r],t.passData=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;r.getArrays().forEach(i=>{const o=t.getFlag(i.getName());if(o!==!1&&!(e.doCopyAllOff&&o!==!0)&&i){let c=t.getArrayByName(i.getName());if(c)if(i.getNumberOfComponents()===c.getNumberOfComponents())if(a>-1&&a<i.getNumberOfTuples()){const u=s>-1?s:a;c.insertTuple(u,i.getTuple(a))}else c.insertTuples(0,i.getTuples());else Lo("Unhandled case in passData");else if(a<0||a>i.getNumberOfTuples())t.addArray(i),r.getAttributes(i).forEach(u=>{t.setAttribute(i,u)});else{const u=i.getNumberOfComponents();let g=i.getNumberOfValues();const f=s>-1?s:a;g<=f*u&&(g=(f+1)*u),c=Y.newInstance({name:i.getName(),dataType:i.getDataType(),numberOfComponents:u,values:E.newTypedArray(i.getDataType(),g),size:0}),c.insertTuple(f,i.getTuple(a)),t.addArray(c),r.getAttributes(i).forEach(l=>{t.setAttribute(c,l)})}}})},t.interpolateData=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;r.getArrays().forEach(c=>{const u=t.getFlag(c.getName());if(u!==!1&&!(e.doCopyAllOff&&u!==!0)&&c){let g=t.getArrayByName(c.getName());if(g)if(c.getNumberOfComponents()===g.getNumberOfComponents())if(a>-1&&a<c.getNumberOfTuples()){const f=i>-1?i:a;g.interpolateTuple(f,c,a,c,s,o),wv("Unexpected case in interpolateData")}else g.insertTuples(c.getTuples());else Lo("Unhandled case in interpolateData");else if(a<0||s<0||a>c.getNumberOfTuples())t.addArray(c),r.getAttributes(c).forEach(f=>{t.setAttribute(c,f)});else{const f=c.getNumberOfComponents();let l=c.getNumberOfValues();const p=i>-1?i:a;l<=p*f&&(l=(p+1)*f),g=Y.newInstance({name:c.getName(),dataType:c.getDataType(),numberOfComponents:f,values:E.newTypedArray(c.getDataType(),l),size:0}),g.interpolateTuple(p,c,a,c,s,o),t.addArray(g),r.getAttributes(c).forEach(y=>{t.setAttribute(g,y)})}}})},t.copyFieldOn=r=>{e.copyFieldFlags[r]=!0},t.copyFieldOff=r=>{e.copyFieldFlags[r]=!1},t.copyAllOn=()=>{(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=()=>{(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=()=>{e.copyFieldFlags={}},t.deepCopy=r=>{e.arrays=r.getArrays().map(a=>{const s=a.newClone();return s.deepCopy(a),{data:s}})},t.copyFlags=r=>r.getCopyFieldFlags().map(a=>a),t.reset=()=>e.arrays.forEach(r=>r.data.reset()),t.getMTime=()=>e.arrays.reduce((r,a)=>a.data.getMTime()>r?a.data.getMTime():r,e.mtime),t.getNumberOfComponents=()=>e.arrays.reduce((r,a)=>r+a.data.getNumberOfComponents(),0),t.getNumberOfTuples=()=>e.arrays.length>0?e.arrays[0].getNumberOfTuples():0,t.getState=()=>{const r=n();return r&&(r.arrays=e.arrays.map(a=>({data:a.data.getState()}))),r}}const Ov={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function xu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ov,n),E.obj(t,e),Ev(t,e)}const Rv=E.newInstance(xu,"vtkFieldData");var Dv={newInstance:Rv,extend:xu};const Mv={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},Lv={MAX:0,EXACT:1,NOLIMIT:2},Vv={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},_v={DUPLICATEPOINT:1,HIDDENPOINT:2},Bv={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},Fv="vtkGhostType",Kr={DEFAULT:0,SINGLE:1,DOUBLE:2};var Su={AttributeCopyOperations:Bv,AttributeLimitTypes:Lv,AttributeTypes:Mv,CellGhostTypes:Vv,DesiredOutputPrecision:Kr,PointGhostTypes:_v,ghostArrayName:Fv};const{AttributeTypes:ft,AttributeCopyOperations:Dt}=Su,{vtkWarningMacro:Jn}=E;function mv(t,e){const n=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function r(i){let o=n.find(c=>ft[c.toUpperCase()]===i||typeof i!="number"&&c.toLowerCase()===i.toLowerCase());return typeof o>"u"&&(o=null),o}e.classHierarchy.push("vtkDataSetAttributes");const a={...t};t.checkNumberOfComponents=i=>!0,t.setAttribute=(i,o)=>{const c=r(o);if(i&&c.toUpperCase()==="PEDIGREEIDS"&&!i.isA("vtkDataArray"))return Jn(`Cannot set attribute ${c}. The attribute must be a vtkDataArray.`),-1;if(i&&!t.checkNumberOfComponents(i,c))return Jn(`Cannot set attribute ${c}. Incorrect number of components.`),-1;let u=e[`active${c}`];if(u>=0&&u<e.arrays.length){if(e.arrays[u]===i)return u;t.removeArrayByIndex(u)}return i?(u=t.addArray(i),e[`active${c}`]=u):e[`active${c}`]=-1,t.modified(),e[`active${c}`]},t.getAttributes=i=>n.filter(o=>t[`get${o}`]()===i),t.setActiveAttributeByName=(i,o)=>t.setActiveAttributeByIndex(t.getArrayWithIndex(i).index,o),t.setActiveAttributeByIndex=(i,o)=>{const c=r(o);if(i>=0&&i<e.arrays.length){if(c.toUpperCase()!=="PEDIGREEIDS"){const u=t.getArrayByIndex(i);if(!u.isA("vtkDataArray"))return Jn(`Cannot set attribute ${c}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!t.checkNumberOfComponents(u,c))return Jn(`Cannot set attribute ${c}. Incorrect number of components.`),-1}return e[`active${c}`]=i,t.modified(),i}return i===-1&&(e[`active${c}`]=i,t.modified()),-1},t.getActiveAttribute=i=>{const o=r(i);return t[`get${o}`]()},t.removeAllArrays=()=>{n.forEach(i=>{e[`active${i}`]=-1}),a.removeAllArrays()},t.removeArrayByIndex=i=>(i!==-1&&n.forEach(o=>{i===e[`active${o}`]?e[`active${o}`]=-1:i<e[`active${o}`]&&(e[`active${o}`]-=1)}),a.removeArrayByIndex(i)),n.forEach(i=>{const o=`active${i}`;t[`get${i}`]=()=>t.getArrayByIndex(e[o]),t[`set${i}`]=c=>t.setAttribute(c,i),t[`setActive${i}`]=c=>t.setActiveAttributeByIndex(t.getArrayWithIndex(c).index,i),t[`copy${i}Off`]=()=>{const c=i.toUpperCase();e.copyAttributeFlags[Dt.PASSDATA][ft[c]]=!1},t[`copy${i}On`]=()=>{const c=i.toUpperCase();e.copyAttributeFlags[Dt.PASSDATA][ft[c]]=!0}}),t.initializeAttributeCopyFlags=()=>{e.copyAttributeFlags=[],Object.keys(Dt).filter(i=>i!=="ALLCOPY").forEach(i=>{e.copyAttributeFlags[Dt[i]]=Object.keys(ft).filter(o=>o!=="NUM_ATTRIBUTES").reduce((o,c)=>(o[ft[c]]=!0,o),[])}),e.copyAttributeFlags[Dt.COPYTUPLE][ft.GLOBALIDS]=!1,e.copyAttributeFlags[Dt.INTERPOLATE][ft.GLOBALIDS]=!1,e.copyAttributeFlags[Dt.COPYTUPLE][ft.PEDIGREEIDS]=!1},t.initialize=E.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(i=>{!e.dataArrays[i].ref&&e.dataArrays[i].type==="vtkDataArray"&&t.addArray(Y.newInstance(e.dataArrays[i]))});const s=t.shallowCopy;t.shallowCopy=(i,o)=>{s(i,o),e.arrays=i.getArrays().map(c=>{const u=c.newClone();return u.shallowCopy(c,o),{data:u}})},t.initializeAttributeCopyFlags()}const Uv={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function Cu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Uv,n),Dv.extend(t,e,n),E.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),mv(t,e)}const kv=E.newInstance(Cu,"vtkDataSetAttributes");var Vo={newInstance:kv,extend:Cu,...Su};const Nv={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},Gv={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7};var bv={FieldDataTypes:Nv,FieldAssociations:Gv};const Os=["pointData","cellData","fieldData"];function $v(t,e){e.classHierarchy.push("vtkDataSet"),Os.forEach(r=>{e[r]?e[r]=We(e[r]):e[r]=Vo.newInstance()});const n=t.shallowCopy;t.shallowCopy=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,a),Os.forEach(s=>{e[s]=Vo.newInstance(),e[s].shallowCopy(r.getReferenceByName(s))})}}const zv={};function wu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zv,n),E.obj(t,e),E.setGet(t,e,Os),$v(t,e)}const Wv=E.newInstance(wu,"vtkDataSet");var Kt={newInstance:Wv,extend:wu,...bv};const ke={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9};var Eu={StructuredType:ke};const{StructuredType:tt}=Eu;function Hv(t){let e=0;for(let n=0;n<3;++n)t[n*2]<t[n*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?tt.EMPTY:e===3?tt.XYZ_GRID:e===2?t[0]===t[1]?tt.YZ_PLANE:t[2]===t[3]?tt.XZ_PLANE:tt.XY_PLANE:e===1?t[0]<t[1]?tt.X_LINE:t[2]<t[3]?tt.Y_LINE:tt.Z_LINE:tt.SINGLE_POINT}var Av={getDataDescriptionFromExtent:Hv,...Eu};const{vtkErrorMacro:Mt}=E;function jv(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return Mt("instance deleted - cannot call any method"),!1;for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];const s=r.length===1?r[0]:r;if(s.length!==6)return!1;const i=e.extent.some((o,c)=>o!==s[c]);return i&&(e.extent=s.slice(),e.dataDescription=Av.getDataDescriptionFromExtent(e.extent),t.modified()),i},t.setDimensions=function(){let n,r,a;if(e.deleted){Mt("instance deleted - cannot call any method");return}if(arguments.length===1){const s=arguments.length<=0?void 0:arguments[0];n=s[0],r=s[1],a=s[2]}else if(arguments.length===3)n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],a=arguments.length<=2?void 0:arguments[2];else{Mt("Bad dimension specification");return}t.setExtent(0,n-1,0,r-1,0,a-1)},t.getDimensions=()=>[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1],t.getNumberOfCells=()=>{const n=t.getDimensions();let r=1;for(let a=0;a<3;a++){if(n[a]===0)return 0;n[a]>1&&(r*=n[a]-1)}return r},t.getNumberOfPoints=()=>{const n=t.getDimensions();return n[0]*n[1]*n[2]},t.getPoint=n=>{const r=t.getDimensions();if(r[0]===0||r[1]===0||r[2]===0)return Mt("Requesting a point from an empty image."),null;const a=new Float64Array(3);switch(e.dataDescription){case ke.EMPTY:return null;case ke.SINGLE_POINT:break;case ke.X_LINE:a[0]=n;break;case ke.Y_LINE:a[1]=n;break;case ke.Z_LINE:a[2]=n;break;case ke.XY_PLANE:a[0]=n%r[0],a[1]=n/r[0];break;case ke.YZ_PLANE:a[1]=n%r[1],a[2]=n/r[1];break;case ke.XZ_PLANE:a[0]=n%r[0],a[2]=n/r[0];break;case ke.XYZ_GRID:a[0]=n%r[0],a[1]=n/r[0]%r[1],a[2]=n/(r[0]*r[1]);break;default:Mt("Invalid dataDescription");break}const s=[0,0,0];return t.indexToWorld(a,s),s},t.getBounds=()=>t.extentToBounds(t.getSpatialExtent()),t.extentToBounds=n=>ee.transformBounds(n,e.indexToWorld),t.getSpatialExtent=()=>ee.inflate([...e.extent],.5),t.computeTransforms=()=>{Vc(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],Ht(e.indexToWorld,e.indexToWorld,e.spacing),Oe(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return q(r,n,e.indexToWorld),r},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return q(r,n,e.worldToIndex),r},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return ee.transformBounds(n,e.indexToWorld,r)},t.worldToIndexBounds=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return ee.transformBounds(n,e.worldToIndex,r)},t.onModified(t.computeTransforms),t.computeTransforms(),t.getCenter=()=>ee.getCenter(t.getBounds()),t.computeHistogram=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const a=[0,0,0,0,0,0];t.worldToIndexBounds(n,a);const s=[0,0,0],i=[0,0,0];ee.computeCornerPoints(a,s,i),Eo(s,s),Eo(i,i);const o=t.getDimensions();Oo(s,[0,0,0],[o[0]-1,o[1]-1,o[2]-1],s),Oo(i,[0,0,0],[o[0]-1,o[1]-1,o[2]-1],i);const c=o[0],u=o[0]*o[1],g=t.getPointData().getScalars().getData();let f=-1/0,l=1/0,p=0,y=0,h=0;for(let d=s[2];d<=i[2];d++)for(let T=s[1];T<=i[1];T++){let w=s[0]+T*c+d*u;for(let C=s[0];C<=i[0];C++){if(!r||r([C,T,d],a)){const O=g[w];O>f&&(f=O),O<l&&(l=O),p+=O*O,y+=O,h+=1}++w}}const v=h>0?y/h:0,x=h?Math.abs(p/h-v*v):0,S=Math.sqrt(x);return{minimum:l,maximum:f,average:v,variance:x,sigma:S,count:h}},t.computeIncrements=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const a=[];let s=r;for(let i=0;i<3;++i)a[i]=s,s*=n[i*2+1]-n[i*2]+1;return a},t.computeOffsetIndex=n=>{let[r,a,s]=n;const i=t.getExtent(),o=t.getPointData().getScalars().getNumberOfComponents(),c=t.computeIncrements(i,o);return Math.floor((Math.round(r)-i[0])*c[0]+(Math.round(a)-i[2])*c[1]+(Math.round(s)-i[4])*c[2])},t.getOffsetIndexFromWorld=n=>{const r=t.getExtent(),a=t.worldToIndex(n);for(let s=0;s<3;++s)if(a[s]<r[s*2]||a[s]>r[s*2+1])return Mt(`GetScalarPointer: Pixel ${a} is not in memory. Current extent = ${r}`),NaN;return t.computeOffsetIndex(a)},t.getScalarValueFromWorld=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const a=t.getPointData().getScalars().getNumberOfComponents();if(r<0||r>=a)return Mt(`GetScalarPointer: Scalar Component ${r} is not within bounds. Current Scalar numberOfComponents: ${a}`),NaN;const s=t.getOffsetIndexFromWorld(n);return Number.isNaN(s)?s:t.getPointData().getScalars().getComponent(s,r)}}const Kv={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:ke.EMPTY};function Ou(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Kv,n),Kt.extend(t,e,n),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=jt(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),E.get(t,e,["indexToWorld","worldToIndex"]),E.setGetArray(t,e,["origin","spacing"],3),E.setGetArray(t,e,["direction"],9),E.getArray(t,e,["extent"],6),jv(t,e)}const Pv=E.newInstance(Ou,"vtkImageData");var Xv={newInstance:Pv,extend:Ou};const Yv={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},Rs={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4};var gi={VectorMode:Yv,ScalarMappingTarget:Rs};const qv={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},Iv={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},Qv={BY_ID:0,BY_NAME:1};var ia={ColorMode:qv,GetArray:Qv,ScalarMode:Iv};const{ScalarMappingTarget:_o,VectorMode:Ke}=gi,{VtkDataTypes:ut}=Y,{ColorMode:er}=ia,{vtkErrorMacro:Bo}=E;function Zv(t){return t}function Fo(t){return Math.floor(t*255+.5)}function Jv(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=()=>t.setVectorMode(Ke.MAGNITUDE),t.setVectorModeToComponent=()=>t.setVectorMode(Ke.COMPONENT),t.setVectorModeToRGBColors=()=>t.setVectorMode(Ke.RGBCOLORS),t.build=()=>{},t.isOpaque=()=>!0,t.setAnnotations=(n,r)=>{if(!(n&&!r||!n&&r)){if(n&&r&&n.length!==r.length){Bo("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],r&&n){const a=r.length;for(let s=0;s<a;s++)e.annotationArray.push({value:n[s],annotation:String(r[s])})}t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=(n,r)=>{let a=t.checkForAnnotatedValue(n),s=!1;return a>=0?e.annotationArray[a].annotation!==r&&(e.annotationArray[a].annotation=r,s=!0):(e.annotationArray.push({value:n,annotation:r}),a=e.annotationArray.length-1,s=!0),s&&(t.updateAnnotatedValueMap(),t.modified()),a},t.getNumberOfAnnotatedValues=()=>e.annotationArray.length,t.getAnnotatedValue=n=>n<0||n>=e.annotationArray.length?null:e.annotationArray[n].value,t.getAnnotation=n=>e.annotationArray[n]===void 0?null:e.annotationArray[n].annotation,t.getAnnotatedValueIndex=n=>e.annotationArray.length?t.checkForAnnotatedValue(n):-1,t.removeAnnotation=n=>{const r=t.checkForAnnotatedValue(n),a=r>=0;return a&&(e.annotationArray.splice(r,1),t.updateAnnotatedValueMap(),t.modified()),a},t.resetAnnotations=()=>{e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=(n,r)=>{if(e.indexedLookup){const a=t.getAnnotatedValueIndex(n);t.getIndexedColor(a,r)}else t.getColor(parseFloat(n),r),r[3]=1},t.checkForAnnotatedValue=n=>t.getAnnotatedValueIndexInternal(n),t.getAnnotatedValueIndexInternal=n=>{if(e.annotatedValueMap[n]!==void 0){const r=e.annotationArray.length;return e.annotatedValueMap[n]%r}return-1},t.getIndexedColor=(n,r)=>{r[0]=0,r[1]=0,r[2]=0,r[3]=0},t.updateAnnotatedValueMap=()=>{e.annotatedValueMap=[];const n=e.annotationArray.length;for(let r=0;r<n;r++)e.annotatedValueMap[e.annotationArray[r].value]=r},t.mapScalars=(n,r,a)=>{const s=n.getNumberOfComponents();let i=null;if(r===er.DEFAULT&&(n.getDataType()===ut.UNSIGNED_CHAR||n.getDataType()===ut.UNSIGNED_CHAR_CLAMPED)||r===er.DIRECT_SCALARS&&n)i=t.convertToRGBA(n,s,n.getNumberOfTuples());else{const o={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:ut.UNSIGNED_CHAR},c=E.newTypedArray(o.dataType,4*n.getNumberOfTuples());o.values=c,o.size=c.length,i=Y.newInstance(o);let u=a;u<0&&s>1?t.mapVectorsThroughTable(n,i,_o.RGBA,-1,-1):(u<0&&(u=0),u>=s&&(u=s-1),t.mapScalarsThroughTable(n,i,_o.RGBA,u))}return i},t.mapVectorsToMagnitude=(n,r,a)=>{const s=n.getNumberOfTuples(),i=n.getNumberOfComponents(),o=r.getData(),c=n.getData();for(let u=0;u<s;u++){let g=0;for(let f=0;f<a;f++)g+=c[u*i+f]*c[u*i+f];o[u]=Math.sqrt(g)}},t.mapVectorsThroughTable=(n,r,a,s,i)=>{let o=t.getVectorMode(),c=i,u=s;const g=n.getNumberOfComponents();o===Ke.COMPONENT?(u===-1&&(u=t.getVectorComponent()),u<0&&(u=0),u>=g&&(u=g-1)):(c===-1&&(c=t.getVectorSize()),c<=0?(u=0,c=g):(u<0&&(u=0),u>=g&&(u=g-1),u+c>g&&(c=g-u)),o===Ke.MAGNITUDE&&(g===1||c===1)&&(o=Ke.COMPONENT));let f=0;switch(u>0&&(f=u),o){case Ke.COMPONENT:{t.mapScalarsThroughTable(n,r,a,f);break}case Ke.RGBCOLORS:break;case Ke.MAGNITUDE:default:{const l=Y.newInstance({numberOfComponents:1,values:new Float32Array(n.getNumberOfTuples())});t.mapVectorsToMagnitude(n,l,c),t.mapScalarsThroughTable(l,r,a,0);break}}},t.luminanceToRGBA=(n,r,a,s)=>{const i=s(a),o=r.getData(),c=n.getData(),u=o.length,g=0,f=1;let l=0;for(let p=g;p<u;p+=f){const y=s(o[p]);c[l*4]=y,c[l*4+1]=y,c[l*4+2]=y,c[l*4+3]=i,l++}},t.luminanceAlphaToRGBA=(n,r,a,s)=>{const i=r.getData(),o=n.getData(),c=i.length,u=0,g=2;let f=0;for(let l=u;l<c;l+=g){const p=s(i[l]);o[f]=p,o[f+1]=p,o[f+2]=p,o[f+3]=s(i[l+1])*a,f+=4}},t.rGBToRGBA=(n,r,a,s)=>{const i=Fo(a),o=r.getData(),c=n.getData(),u=o.length,g=0,f=3;let l=0;for(let p=g;p<u;p+=f)c[l*4]=s(o[p]),c[l*4+1]=s(o[p+1]),c[l*4+2]=s(o[p+2]),c[l*4+3]=i,l++},t.rGBAToRGBA=(n,r,a,s)=>{const i=r.getData(),o=n.getData(),c=i.length,u=0,g=4;let f=0;for(let l=u;l<c;l+=g)o[f*4]=s(i[l]),o[f*4+1]=s(i[l+1]),o[f*4+2]=s(i[l+2]),o[f*4+3]=s(i[l+3])*a,f++},t.convertToRGBA=(n,r,a)=>{let{alpha:s}=e;if(r===4&&s>=1&&n.getDataType()===ut.UNSIGNED_CHAR)return n;const i=Y.newInstance({numberOfComponents:4,empty:!0,size:4*a,dataType:ut.UNSIGNED_CHAR});if(a<=0)return i;s=s>0?s:0,s=s<1?s:1;let o=Zv;switch((n.getDataType()===ut.FLOAT||n.getDataType()===ut.DOUBLE)&&(o=Fo),r){case 1:t.luminanceToRGBA(i,n,s,o);break;case 2:t.luminanceAlphaToRGBA(i,n,o);break;case 3:t.rGBToRGBA(i,n,s,o);break;case 4:t.rGBAToRGBA(i,n,s,o);break;default:return Bo("Cannot convert colors"),null}return i},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>256*256*256,t.setRange=(n,r)=>t.setMappingRange(n,r),t.getRange=()=>t.getMappingRange(),t.areScalarsOpaque=(n,r,a)=>{if(!n)return t.isOpaque();const s=n.getNumberOfComponents();return r===er.DEFAULT&&n.getDataType()===ut.UNSIGNED_CHAR||r===er.DIRECT_SCALARS?s===3||s===1?e.alpha>=1:n.getRange(s-1)[0]===255:!0}}const ey={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:Ke.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1};function Ru(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ey,n),E.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],E.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),E.setArray(t,e,["mappingRange"],2),E.getArray(t,e,["mappingRange"]),Jv(t,e)}const ty=E.newInstance(Ru,"vtkScalarsToColors");var Du={newInstance:ty,extend:Ru,...gi};const{vtkErrorMacro:mo}=E,Uo=0,ko=1,ka=2;function ny(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=()=>{if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){let n=!0;e.nanColor[3]<1&&(n=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(n=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(n=0);for(let r=3;r<e.table.length&&n;r+=4)e.table[r]<255&&(n=!1);e.opaqueFlag=n,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>e.table.length/4-3,t.linearIndexLookup=(n,r)=>{let a=0;const s=Number(n);return s<r.range[0]?a=r.maxIndex+Uo+1.5:s>r.range[1]?a=r.maxIndex+ko+1.5:(a=(s+r.shift)*r.scale,a=a<r.maxIndex?a:r.maxIndex),Math.floor(a)},t.linearLookup=(n,r,a)=>{let s=0;Ff(n)?s=Math.floor(a.maxIndex+1.5+ka):s=t.linearIndexLookup(n,a);const i=4*s;return r.slice(i,i+4)},t.indexedLookupFunction=(n,r,a)=>{let s=t.getAnnotatedValueIndexInternal(n);s===-1&&(s=e.numberOfColors+ka);const i=4*s;return[r[i],r[i+1],r[i+2],r[i+3]]},t.lookupShiftAndScale=(n,r)=>{r.shift=-n[0],r.scale=Number.MAX_VALUE,n[1]>n[0]&&(r.scale=(r.maxIndex+1)/(n[1]-n[0]))},t.mapScalarsThroughTable=(n,r,a,s)=>{let i=t.linearLookup;e.indexedLookup&&(i=t.indexedLookupFunction);const o=t.getMappingRange(),c={maxIndex:t.getNumberOfColors()-1,range:o,shift:0,scale:0};t.lookupShiftAndScale(o,c);const u=t.getAlpha(),g=n.getNumberOfTuples(),f=n.getNumberOfComponents(),l=r.getData(),p=n.getData();if(u>=1){if(a===Rs.RGBA)for(let y=0;y<g;y++){const h=i(p[y*f+s],e.table,c);l[y*4]=h[0],l[y*4+1]=h[1],l[y*4+2]=h[2],l[y*4+3]=h[3]}}else if(a===Rs.RGBA)for(let y=0;y<g;y++){const h=i(p[y*f+s],e.table,c);l[y*4]=h[0],l[y*4+1]=h[1],l[y*4+2]=h[2],l[y*4+3]=Math.floor(h[3]*u+.5)}},t.forceBuild=()=>{let n=0,r=0,a=0,s=0;const i=e.numberOfColors-1;i&&(n=(e.hueRange[1]-e.hueRange[0])/i,r=(e.saturationRange[1]-e.saturationRange[0])/i,a=(e.valueRange[1]-e.valueRange[0])/i,s=(e.alphaRange[1]-e.alphaRange[0])/i),e.table.length=4*i+16;const o=[],c=[];for(let u=0;u<=i;u++)o[0]=e.hueRange[0]+u*n,o[1]=e.saturationRange[0]+u*r,o[2]=e.valueRange[0]+u*a,D1(o,c),c[3]=e.alphaRange[0]+u*s,e.table[u*4]=c[0]*255+.5,e.table[u*4+1]=c[1]*255+.5,e.table[u*4+2]=c[2]*255+.5,e.table[u*4+3]=c[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=n=>{if(Array.isArray(n)){const a=n[0].length;e.numberOfColors=n.length;const s=4-a;let i=0;for(let o=0;o<e.numberOfColors;o++)e.table[o*4]=255,e.table[o*4+1]=255,e.table[o*4+2]=255,e.table[o*4+3]=255;for(let o=0;o<n.length;o++){const c=n[o];for(let u=0;u<a;u++)e.table[i++]=c[u];i+=s}return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0}if(n.getNumberOfComponents()!==4)return mo("Expected 4 components for RGBA colors"),!1;if(n.getDataType()!==ce.UNSIGNED_CHAR)return mo("Expected unsigned char values for RGBA colors"),!1;e.numberOfColors=n.getNumberOfTuples();const r=n.getData();e.table.length=r.length;for(let a=0;a<r.length;a++)e.table[a]=r[a];return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0},t.buildSpecialColors=()=>{const{numberOfColors:n}=e,r=e.table;let a=(n+Uo)*4;e.useBelowRangeColor||n===0?(r[a]=e.belowRangeColor[0]*255+.5,r[a+1]=e.belowRangeColor[1]*255+.5,r[a+2]=e.belowRangeColor[2]*255+.5,r[a+3]=e.belowRangeColor[3]*255+.5):(r[a]=r[0],r[a+1]=r[1],r[a+2]=r[2],r[a+3]=r[3]),a=(n+ko)*4,e.useAboveRangeColor||n===0?(r[a]=e.aboveRangeColor[0]*255+.5,r[a+1]=e.aboveRangeColor[1]*255+.5,r[a+2]=e.aboveRangeColor[2]*255+.5,r[a+3]=e.aboveRangeColor[3]*255+.5):(r[a]=r[4*(n-1)+0],r[a+1]=r[4*(n-1)+1],r[a+2]=r[4*(n-1)+2],r[a+3]=r[4*(n-1)+3]),a=(n+ka)*4,r[a]=e.nanColor[0]*255+.5,r[a+1]=e.nanColor[1]*255+.5,r[a+2]=e.nanColor[2]*255+.5,r[a+3]=e.nanColor[3]*255+.5},t.build=()=>{(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&(t.buildSpecialColors(),e.insertTime.modified())}const ry={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function Mu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ry,n),Du.extend(t,e,n),e.table||(e.table=[]),e.buildTime={},E.obj(e.buildTime),e.opaqueFlagBuildTime={},E.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},E.obj(e.insertTime,{mtime:0}),E.get(t,e,["buildTime"]),E.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),E.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),E.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),E.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),ny(t,e)}const ay=E.newInstance(Mu,"vtkLookupTable");var Pr={newInstance:ay,extend:Mu};const Ot={Off:0,PolygonOffset:1};let Ds=Ot.PolygonOffset,Xr=Ot.Off;const sy=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function iy(){return Ds}function oy(t){const e=Ds===t;return Ds=t,e}function cy(){return Xr}function oa(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const e=Xr===t;return Xr=t,e}function fy(){return oa(Ot.Off)}function uy(){return oa(Ot.Off)}function gy(){return oa(Ot.PolygonOffset)}function ly(){return sy[Xr]}var Ms={Resolve:Ot,getResolveCoincidentTopologyAsString:ly,getResolveCoincidentTopologyPolygonOffsetFaces:iy,getResolveCoincidentTopology:cy,setResolveCoincidentTopology:oa,setResolveCoincidentTopologyPolygonOffsetFaces:oy,setResolveCoincidentTopologyToDefault:fy,setResolveCoincidentTopologyToOff:uy,setResolveCoincidentTopologyToPolygonOffset:gy};function Lu(t,e,n){n.forEach(r=>{t[`get${r.method}`]=()=>e[r.key],t[`set${r.method}`]=E.objectSetterMap.object(t,e,{name:r.key,params:["factor","offset"]})})}const li=["Polygon","Line","Point"],py={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},hy=()=>{},Nt={modified:hy};Lu(Nt,py,li.map(t=>({key:t,method:`ResolveCoincidentTopology${t}OffsetParameters`})));function vy(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),E.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(Ms).forEach(n=>{t[n]=Ms[n]}),Object.keys(Nt).filter(n=>n!=="modified").forEach(n=>{t[n]=Nt[n]}),Lu(t,e.topologyOffset,li.map(n=>({key:n,method:`RelativeCoincidentTopology${n}OffsetParameters`}))),t.getCoincidentTopologyPolygonOffsetParameters=()=>{const n=Nt.getResolveCoincidentTopologyPolygonOffsetParameters(),r=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyLineOffsetParameters=()=>{const n=Nt.getResolveCoincidentTopologyLineOffsetParameters(),r=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}},t.getCoincidentTopologyPointOffsetParameter=()=>{const n=Nt.getResolveCoincidentTopologyPointOffsetParameters(),r=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:n.factor+r.factor,offset:n.offset+r.offset}}}var Vu={implementCoincidentTopologyMethods:vy,staticOffsetAPI:Nt,otherStaticMethods:Ms,CATEGORIES:li,Resolve:Ot};const we={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3};var _u={PassTypes:we};const{FieldAssociations:No}=Kt,{staticOffsetAPI:yy,otherStaticMethods:dy}=Vu,{ColorMode:tr,ScalarMode:Lt,GetArray:Na}=ia,{VectorMode:Ty}=gi,{VtkDataTypes:xy}=Y;function Cn(t){return()=>E.vtkErrorMacro(`vtkMapper::${t} - NOT IMPLEMENTED`)}function Sy(t,e){const n=t[1]%2===0?1:-1;if(t[0]+=n,t[0]>=e[0]||t[0]<0){const r=t[2]%2===0?1:-1;t[0]-=n,t[1]+=r,(t[1]>=e[1]||t[1]<0)&&(t[1]-=r,t[2]++)}}function Cy(t,e){return t[0]+e[0]*(t[1]+e[1]*t[2])}function Go(t,e,n){const r=Math.floor(e),a=r%(2*n[0]);let s,i;a<n[0]?(t[0]=a,s=1,i=t[0]===n[0]-1):(t[0]=2*n[0]-1-a,s=-1,i=t[0]===0);const o=Math.floor(r/n[0]),c=o%(2*n[1]);let u,g;c<n[1]?(t[1]=c,u=1,g=t[1]===n[1]-1):(t[1]=2*n[1]-1-c,u=-1,g=t[1]===0),t[2]=Math.floor(o/n[1]);const f=e-r;i?g?t[2]+=f:t[1]+=u*f:t[0]+=s*f,t[0]=(t[0]+.5)/n[0],t[1]=(t[1]+.5)/n[1],t[2]=(t[2]+.5)/n[2]}const bo=new WeakMap;function wy(t,e,n,r,a,s,i){var V;const o=new Array(arguments.length);for(let B=0;B<arguments.length;++B){const _=arguments[B];o[B]=((V=_.getMTime)==null?void 0:V.call(_))??_}const c=o.join("/"),u=bo.get(t);if(u&&u.stringHash===c)return u.textureCoordinates;const g=(n[1]-n[0])/(r-1),[f,l]=[n[0]-g,n[1]+g],p=f-.5*g,y=1/(l-f+g),h=f,v=(r+1)/(l-f),x=t.getData(),S=t.getNumberOfTuples(),d=t.getNumberOfComponents(),T=e<0||e>=d,w=a[2]<=1?2:3,C=Y.newInstance({numberOfComponents:w,values:new Float32Array(S*w)}),O=C.getData(),R=[0,0,0];Go(R,r+2,a);let L=0,D=0;const M=[.5,.5,.5];for(let B=0;B<S;++B){let _;if(T){let k=0;for(let G=0;G<d;++G){const b=x[L+G];k+=b*b}_=Math.sqrt(k)}else _=x[L+e];if(L+=d,s&&(_=Pr.applyLogScale(_,n,n)),Ff(_))M[0]=R[0],M[1]=R[1],M[2]=R[2];else if(i){let k=(_-h)*v;k<1?k=0:k>r&&(k=r+1),Go(M,k,a)}else{M[1]=.49;const k=(_-p)*y;k>1e3?M[0]=1e3:k<-1e3?M[0]=-1e3:M[0]=k}for(let k=0;k<w;++k)O[D++]=M[k]}return bo.set(t,{stringHash:c,textureCoordinates:C}),C}function Ey(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=()=>{const n=t.getInputData();return n?(e.static||t.update(),e.bounds=n.getBounds()):e.bounds=ti(),e.bounds},t.setForceCompileOnly=n=>{e.forceCompileOnly=n},t.setSelectionWebGLIdsToVTKIds=n=>{e.selectionWebGLIdsToVTKIds=n},t.createDefaultLookupTable=()=>{e.lookupTable=Pr.newInstance()},t.getColorModeAsString=()=>E.enumToString(tr,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>E.enumToString(Lt,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(n,r,a,s,i)=>{if(!n||!e.scalarVisibility)return{scalars:null,cellFlag:!1};let o=null,c=!1;if(r===Lt.DEFAULT)o=n.getPointData().getScalars(),o||(o=n.getCellData().getScalars(),c=!0);else if(r===Lt.USE_POINT_DATA)o=n.getPointData().getScalars();else if(r===Lt.USE_CELL_DATA)o=n.getCellData().getScalars(),c=!0;else if(r===Lt.USE_POINT_FIELD_DATA){const u=n.getPointData();a===Na.BY_ID?o=u.getArrayByIndex(s):o=u.getArrayByName(i)}else if(r===Lt.USE_CELL_FIELD_DATA){const u=n.getCellData();c=!0,a===Na.BY_ID?o=u.getArrayByIndex(s):o=u.getArrayByName(i)}else if(r===Lt.USE_FIELD_DATA){const u=n.getFieldData();a===Na.BY_ID?o=u.getArrayByIndex(s):o=u.getArrayByName(i)}return{scalars:o,cellFlag:c}},t.mapScalars=(n,r)=>{const{scalars:a,cellFlag:s}=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName);if(e.areScalarsMappedFromCells=s,!a){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}const i=`${t.getMTime()}${a.getMTime()}${r}`;if(e.colorBuildString!==i){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(a,s))e.mapScalarsToTexture(a,s,r);else{e.colorCoordinates=null,e.colorTextureMap=null;const o=t.getLookupTable();o&&(o.build(),e.colorMapColors=o.mapScalars(a,e.colorMode,e.fieldDataTupleId))}e.colorBuildString=`${t.getMTime()}${a.getMTime()}${r}`}},e.mapScalarsToTexture=(n,r,a)=>{const s=e.lookupTable.getRange(),i=e.lookupTable.usingLogScale();i&&Pr.getLogRange(s,s);const o=e.lookupTable.getAlpha();if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==a){e.lookupTable.setAlpha(a),e.colorTextureMap=null,e.lookupTable.build();const u=e.lookupTable.getNumberOfAvailableColors(),g=2048,f=g**3-3,p=4096-2,y=2,h=r?f:p;e.numberOfColorsInRange=Math.min(Math.max(u,y),h);const v=e.numberOfColorsInRange+3,x=e.numberOfColorsInRange+2,S=r?[Math.min(Math.ceil(v/g**0),g),Math.min(Math.ceil(v/g**1),g),Math.min(Math.ceil(v/g**2),g)]:[x,2,1],d=S[0]*S[1]*S[2],T=new Float64Array(d);T.fill(NaN);const w=e.numberOfColorsInRange,C=w+2,O=[0,0,0],R=s[0],L=s[1]-s[0];for(let V=0;V<C;++V){const B=Cy(O,S),_=R+L*(V-1)/(w-1);T[B]=i?10**_:_,Sy(O,S)}const D=Y.newInstance({numberOfComponents:1,values:T}),M=e.lookupTable.mapScalars(D,e.colorMode,0);e.colorTextureMap=Xv.newInstance(),e.colorTextureMap.setDimensions(S),e.colorTextureMap.getPointData().setScalars(M),e.lookupTable.setAlpha(o)}const c=e.lookupTable.getVectorMode()===Ty.MAGNITUDE&&n.getNumberOfComponents()>1?-1:e.lookupTable.getVectorComponent();e.colorCoordinates=wy(n,c,s,e.numberOfColorsInRange,e.colorTextureMap.getDimensions(),i,r)},t.getIsOpaque=()=>{const n=t.getInputData(),a=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!e.scalarVisibility||a==null)return!0;const s=t.getLookupTable();return s?(s.build(),s.areScalarsOpaque(a,e.colorMode,-1)):!0},t.canUseTextureMapForColoring=(n,r)=>r&&e.colorMode!==tr.DIRECT_SCALARS?!0:!(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup()||!n||e.colorMode===tr.DEFAULT&&n.getDataType()===xy.UNSIGNED_CHAR||e.colorMode===tr.DIRECT_SCALARS),t.clearColorArrays=()=>{e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let n=e.mtime;if(e.lookupTable!==null){const r=e.lookupTable.getMTime();n=r>n?r:n}return n},t.getPrimitiveCount=()=>{const n=t.getInputData();return{points:n.getPoints().getNumberOfValues()/3,verts:n.getVerts().getNumberOfValues()-n.getVerts().getNumberOfCells(),lines:n.getLines().getNumberOfValues()-2*n.getLines().getNumberOfCells(),triangles:n.getPolys().getNumberOfValues()-3*n.getPolys().getNumberOfCells()}},t.acquireInvertibleLookupTable=Cn("AcquireInvertibleLookupTable"),t.valueToColor=Cn("ValueToColor"),t.colorToValue=Cn("ColorToValue"),t.useInvertibleColorFor=Cn("UseInvertibleColorFor"),t.clearInvertibleColor=Cn("ClearInvertibleColor"),t.processSelectorPixelBuffers=(n,r)=>{if(!n||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)return;const a=n.getRawPixelBuffer(we.ID_LOW24),s=n.getRawPixelBuffer(we.ID_HIGH24),i=n.getCurrentPass(),o=n.getFieldAssociation();let c=null;o===No.FIELD_ASSOCIATION_POINTS?c=e.selectionWebGLIdsToVTKIds.points:o===No.FIELD_ASSOCIATION_CELLS&&(c=e.selectionWebGLIdsToVTKIds.cells),c&&r.forEach(u=>{if(i===we.ID_LOW24){let g=0;s&&(g+=s[u],g*=256),g+=a[u+2],g*=256,g+=a[u+1],g*=256,g+=a[u];const f=c[g],l=n.getPixelBuffer(we.ID_LOW24);l[u]=f&255,l[u+1]=(f&65280)>>8,l[u+2]=(f&16711680)>>16}else if(i===we.ID_HIGH24&&s){let g=0;g+=s[u],g*=256,g+=a[u+2],g*=256,g+=a[u+1],g*=256,g+=a[u];const f=c[g],l=n.getPixelBuffer(we.ID_HIGH24);l[u]=(f&4278190080)>>24}})}}const Oy={colorMapColors:null,areScalarsMappedFromCells:!1,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,numberOfColorsInRange:0,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function Bu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Oy,n),Cv.extend(t,e,n),E.get(t,e,["areScalarsMappedFromCells","colorCoordinates","colorMapColors","colorTextureMap","numberOfColorsInRange","selectionWebGLIdsToVTKIds"]),E.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","static","useLookupTableScalarRange","customShaderAttributes"]),E.setGetArray(t,e,["scalarRange"],2),Vu.implementCoincidentTopologyMethods(t,e),Ey(t,e)}const Ry=E.newInstance(Bu,"vtkMapper");var Ze={newInstance:Ry,extend:Bu,...yy,...dy,...ia};function Fu(t){let e=0;return t.filter((n,r)=>r===e?(e+=n+1,!0):!1)}function mu(t){let e=0;for(let n=0;n<t.length;)n+=t[n]+1,e++;return e}const Dy={extractCellSizes:Fu,getNumberOfCells:mu};function My(t,e){e.classHierarchy.push("vtkCellArray");const n={...t};t.getNumberOfCells=r=>(e.numberOfCells!==void 0&&!r||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=mu(t.getData())),e.numberOfCells),t.getCellSizes=r=>(e.cellSizes!==void 0&&!r||(e.cellSizes=Fu(t.getData())),e.cellSizes),t.resize=r=>{const a=t.getNumberOfTuples();n.resize(r);const s=t.getNumberOfTuples();s<a&&(s===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=r=>{n.setData(r,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=r=>{let a=r;const s=e.values[a++];return e.values.subarray(a,a+s)},t.insertNextCell=r=>{const a=t.getNumberOfCells();return t.insertNextTuples([r.length,...r]),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(r.length),a}}function Ly(t){return{empty:!0,numberOfComponents:1,dataType:ce.UNSIGNED_INT,...t}}function Uu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Y.extend(t,e,Ly(n)),My(t,e)}const Vy=E.newInstance(Uu,"vtkCellArray");var Yr={newInstance:Vy,extend:Uu,...Dy};const{vtkErrorMacro:_y}=E,By=[1,-1,1,-1,1,-1];function Fy(t,e){e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==n&&(e.size=n*r,e.values=E.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(r),t.modified())},t.setPoint=function(n){for(var r=arguments.length,a=new Array(r>1?r-1:0),s=1;s<r;s++)a[s-1]=arguments[s];t.setTuple(n,a)},t.getPoint=t.getTuple,t.findPoint=t.findTuple,t.insertNextPoint=(n,r,a)=>t.insertNextTuple([n,r,a]),t.getBounds=()=>{if(t.getNumberOfComponents()===3){const a=t.getRange(0);e.bounds[0]=a[0],e.bounds[1]=a[1];const s=t.getRange(1);e.bounds[2]=s[0],e.bounds[3]=s[1];const i=t.getRange(2);return e.bounds[4]=i[0],e.bounds[5]=i[1],e.bounds}if(t.getNumberOfComponents()!==2)return _y(`getBounds called on an array with components of
        ${t.getNumberOfComponents()}`),By;const n=t.getRange(0);e.bounds[0]=n[0],e.bounds[1]=n[1];const r=t.getRange(1);return e.bounds[2]=r[0],e.bounds[3]=r[1],e.bounds[4]=0,e.bounds[5]=0,e.bounds},t.computeBounds=t.getBounds,t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}const my={empty:!0,numberOfComponents:3,dataType:ce.FLOAT,bounds:[1,-1,1,-1,1,-1]};function ku(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,my,n),Y.extend(t,e,n),Fy(t,e)}const Uy=E.newInstance(ku,"vtkPoints");var nn={newInstance:Uy,extend:ku};function ky(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(r){e.pointsIds=r;let a=e.points.getData();a.length!==3*e.pointsIds.length&&(a=E.newTypedArray(n.getDataType(),3*e.pointsIds.length));const s=n.getData();e.pointsIds.forEach((i,o)=>{let c=3*i,u=3*o;a[u]=s[c],a[++u]=s[++c],a[++u]=s[++c]}),e.points.setData(a)}else{e.points=n,e.pointsIds=new Array(n.getNumberOfPoints());for(let a=n.getNumberOfPoints()-1;a>=0;--a)e.pointsIds[a]=a}},t.getBounds=()=>{const n=e.points.getNumberOfPoints(),r=[];if(n){e.points.getPoint(0,r),e.bounds[0]=r[0],e.bounds[1]=r[0],e.bounds[2]=r[1],e.bounds[3]=r[1],e.bounds[4]=r[2],e.bounds[5]=r[2];for(let a=1;a<n;a++)e.points.getPoint(a,r),e.bounds[0]=r[0]<e.bounds[0]?r[0]:e.bounds[0],e.bounds[1]=r[0]>e.bounds[1]?r[0]:e.bounds[1],e.bounds[2]=r[1]<e.bounds[2]?r[1]:e.bounds[2],e.bounds[3]=r[1]>e.bounds[3]?r[1]:e.bounds[3],e.bounds[4]=r[2]<e.bounds[4]?r[2]:e.bounds[4],e.bounds[5]=r[2]>e.bounds[5]?r[2]:e.bounds[5]}else ei(e.bounds);return e.bounds},t.getLength2=()=>{t.getBounds();let n=0,r=0;for(let a=0;a<3;a++)r=e.bounds[2*a+1]-e.bounds[2*a],n+=r*r;return n},t.getParametricDistance=n=>{let r,a=0;for(let s=0;s<3;s++)n[s]<0?r=-n[s]:n[s]>1?r=n[s]-1:r=0,r>a&&(a=r);return a},t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.deepCopy=n=>{n.initialize(e.points,e.pointsIds)},t.getCellDimension=()=>{},t.intersectWithLine=(n,r,a,s,i,o,c)=>{},t.evaluatePosition=(n,r,a,s,i,o)=>{E.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}const Ny={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function Nu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ny,n),E.obj(t,e),e.points||(e.points=nn.newInstance()),E.get(t,e,["points","pointsIds"]),ky(t,e)}const Gy=E.newInstance(Nu,"vtkCell");var qr={newInstance:Gy,extend:Nu};function by(t,e){let n=e;for(e>=t.array.length&&(n+=t.array.length);n>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=n}function $y(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=n=>{const r=n.getPoints().getNumberOfPoints(),a=n.getNumberOfCells(),s=new Uint32Array(r);if(n.isA("vtkPolyData")){for(let i=0;i<a;++i){const{cellPointIds:o}=n.getCellPoints(i);o.forEach(c=>{t.incrementLinkCount(c)})}t.allocateLinks(r),e.maxId=r-1;for(let i=0;i<a;++i){const{cellPointIds:o}=n.getCellPoints(i);o.forEach(c=>{t.insertCellReference(c,s[c]++,i)})}}else{for(let i=0;i<a;i++)qr.newInstance().getPointsIds().forEach(c=>{t.incrementLinkCount(c)});t.allocateLinks(r),e.maxId=r-1;for(let i=0;i<a;++i)qr.newInstance().getPointsIds().forEach(c=>{t.insertCellReference(c,s[c]++,i)})}},t.allocate=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(n).fill().map(()=>({ncells:0,cells:null})),e.extend=r,e.maxId=-1},t.initialize=()=>{e.array=null},t.getLink=n=>e.array[n],t.getNcells=n=>e.array[n].ncells,t.getCells=n=>e.array[n].cells,t.insertNextPoint=n=>{e.array.push({ncells:n,cells:Array(n)}),++e.maxId},t.insertNextCellReference=(n,r)=>{e.array[n].cells[e.array[n].ncells++]=r},t.deletePoint=n=>{e.array[n].ncells=0,e.array[n].cells=null},t.removeCellReference=(n,r)=>{e.array[r].cells=e.array[r].cells.filter(a=>a!==n),e.array[r].ncells=e.array[r].cells.length},t.addCellReference=(n,r)=>{e.array[r].cells[e.array[r].ncells++]=n},t.resizeCellList=(n,r)=>{e.array[n].cells.length=r},t.squeeze=()=>{by(e,e.maxId+1)},t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{e.array=[...n.array],e.extend=n.extend,e.maxId=n.maxId},t.incrementLinkCount=n=>{++e.array[n].ncells},t.allocateLinks=n=>{for(let r=0;r<n;++r)e.array[r].cells=new Array(e.array[r].ncells)},t.insertCellReference=(n,r,a)=>{e.array[n].cells[r]=a}}const zy={array:null,maxId:0,extend:0};function Gu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zy,n),E.obj(t,e),$y(t,e)}const Wy=E.newInstance(Gu,"vtkCellLinks");var Hy={newInstance:Wy,extend:Gu};const J={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_QUAD:9,VTK_QUADRATIC_EDGE:21,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42},Ls=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function Ay(t){return t<Ls.length?Ls[t]:"UnknownClass"}function jy(t){return Ls.findIndex(t)}function Ky(t){return t<J.VTK_QUADRATIC_EDGE||t===J.VTK_CONVEX_POINT_SET||t===J.VTK_POLYHEDRON}function Py(t){return t===J.VTK_TRIANGLE_STRIP||t===J.VTK_POLY_LINE||t===J.VTK_POLY_VERTEX}const Xy={getClassNameFromTypeId:Ay,getTypeIdFromClassName:jy,isLinear:Ky,hasSubCells:Py};function Yy(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=n>0?n:1,e.extend=r>0?r:1,e.maxId=-1,e.typeArray=new Uint8Array(n),e.locationArray=new Uint32Array(n)},t.insertCell=(n,r,a)=>{e.typeArray[n]=r,e.locationArray[n]=a,n>e.maxId&&(e.maxId=n)},t.insertNextCell=(n,r)=>(t.insertCell(++e.maxId,n,r),e.maxId),t.setCellTypes=(n,r,a)=>{e.size=n,e.typeArray=r,e.locationArray=a,e.maxId=n-1},t.getCellLocation=n=>e.locationArray[n],t.deleteCell=n=>{e.typeArray[n]=J.VTK_EMPTY_CELL},t.getNumberOfTypes=()=>e.maxId+1,t.isType=n=>{const r=t.getNumberOfTypes();for(let a=0;a<r;++a)if(n===t.getCellType(a))return!0;return!1},t.insertNextType=n=>t.insertNextCell(n,-1),t.getCellType=n=>e.typeArray[n],t.reset=()=>{e.maxId=-1},t.deepCopy=n=>{t.allocate(n.getSize(),n.getExtend()),e.typeArray.set(n.getTypeArray()),e.locationArray.set(n.getLocationArray()),e.maxId=n.getMaxId()}}const qy={size:0,maxId:-1,extend:1e3};function bu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qy,n),E.obj(t,e),E.get(t,e,["size","maxId","extend"]),E.getArray(t,e,["typeArray","locationArray"]),Yy(t,e)}const Iy=E.newInstance(bu,"vtkCellTypes");var Qy={newInstance:Iy,extend:bu,...Xy};const Zy={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2};var $u={IntersectionState:Zy};const{IntersectionState:_r}=$u;function Zt(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;const a={t:Number.MIN_VALUE,distance:0},s=[];let i;s[0]=n[0]-e[0],s[1]=n[1]-e[1],s[2]=n[2]-e[2];const o=s[0]*(t[0]-e[0])+s[1]*(t[1]-e[1])+s[2]*(t[2]-e[2]),c=K(s,s);let u=1e-5*o;return c!==0&&(a.t=o/c),u<0&&(u=-u),-u<c&&c<u||c<=0||a.t<0?i=e:a.t>1?i=n:(i=s,s[0]=e[0]+a.t*s[0],s[1]=e[1]+a.t*s[1],s[2]=e[2]+a.t*s[2]),r&&(r[0]=i[0],r[1]=i[1],r[2]=i[2]),a.distance=Pe(i,t),a}function zu(t,e,n,r,a,s){const i=[],o=[],c=[];a[0]=0,s[0]=0,wt(e,t,i),wt(r,n,o),wt(n,t,c);const u=[K(i,i),-K(i,o),-K(i,o),K(o,o)],g=[];if(g[0]=K(i,c),g[1]=-K(o,c),R1(u,g,2)===0){let f=Number.MAX_VALUE;const l=[t,e,n,r],p=[n,n,t,t],y=[r,r,e,e];s[0],s[0],a[0],a[0],a[0],a[0],s[0],s[0];let h;for(let v=0;v<4;v++)h=Zt(l[v],p[v],y[v]),h.distance<f&&(f=h.distance);return _r.ON_LINE}return a[0]=g[0],s[0]=g[1],a[0]>=0&&a[0]<=1&&s[0]>=0&&s[0]<=1?_r.YES_INTERSECTION:_r.NO_INTERSECTION}const Jy={distanceToLine:Zt,intersection:zu};function ed(t,e){e.classHierarchy.push("vtkLine");function n(r){return r>=0&&r<=1}t.getCellDimension=()=>1,t.intersectWithLine=(r,a,s,i,o)=>{const c={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};o[1]=0,o[2]=0;const u=[],g=[],f=[];e.points.getPoint(0,g),e.points.getPoint(1,f);const l=[],p=[],y=zu(r,a,g,f,l,p);if(c.t=l[0],c.betweenPoints=n(c.t),o[0]=p[0],y===_r.YES_INTERSECTION){for(let h=0;h<3;h++)i[h]=g[h]+o[0]*(f[h]-g[h]),u[h]=r[h]+c.t*(a[h]-r[h]);if(Pe(i,u)<=s*s)return c.intersect=1,c}else{let h;if(c.t<0)return h=Zt(r,g,f,i),h.distance<=s*s&&(c.t=0,c.intersect=1,c.betweenPoints=!0),c;if(c.t>1)return h=Zt(a,g,f,i),h.distance<=s*s&&(c.t=1,c.intersect=1,c.betweenPoints=!0),c;if(o[0]<0)return o[0]=0,h=Zt(g,r,a,i),c.t=h.t,h.distance<=s*s&&(c.intersect=1),c;if(o[0]>1)return o[0]=1,h=Zt(f,r,a,i),c.t=h.t,h.distance<=s*s&&(c.intersect=1),c}return c},t.evaluateLocation=(r,a,s)=>{const i=[],o=[];e.points.getPoint(0,i),e.points.getPoint(1,o);for(let c=0;c<3;c++)a[c]=i[c]+r[0]*(o[c]-i[c]);s[0]=1-r[0],s[1]=r[0]},t.evaluateOrientation=(r,a,s)=>e.orientations?(Sr(a,e.orientations[0],e.orientations[1],r[0]),s[0]=1-r[0],s[1]=r[0],!0):!1}const td={orientations:null};function Wu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,td,n),qr.extend(t,e,n),E.setGet(t,e,["orientations"]),ed(t,e)}const nd=E.newInstance(Wu,"vtkLine");var Le={newInstance:nd,extend:Wu,...Jy,...$u};function rd(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=We(e.points):e.points=nn.newInstance(),t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.getBounds=()=>e.points.getBounds(),t.computeBounds=()=>{t.getBounds()};const n=t.shallowCopy;t.shallowCopy=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(r,a),e.points=nn.newInstance(),e.points.shallowCopy(r.getPoints())}}const ad={};function Hu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ad,n),Kt.extend(t,e,n),E.setGet(t,e,["points"]),rd(t,e)}const sd=E.newInstance(Hu,"vtkPointSet");var id={newInstance:sd,extend:Hu};function pi(t,e,n,r){const a=n[0]-e[0],s=n[1]-e[1],i=n[2]-e[2],o=t[0]-e[0],c=t[1]-e[1],u=t[2]-e[2];r[0]=s*u-i*c,r[1]=i*o-a*u,r[2]=a*c-s*o}function Ir(t,e,n,r){pi(t,e,n,r);const a=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);a!==0&&(r[0]/=a,r[1]/=a,r[2]/=a)}function od(t,e,n,r,a,s){let i=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,o=!1;const c=[],u=[],g=[],f=[],l=[];Ir(t,e,n,f),Ir(r,a,s,l);const p=-K(f,t),y=-K(l,r),h=[K(l,t)+y,K(l,e)+y,K(l,n)+y];if(h[0]*h[1]>i&&h[0]*h[2]>i)return{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g};const v=[K(f,r)+p,K(f,a)+p,K(f,s)+p];if(v[0]*v[1]>i&&v[0]*v[2]>i)return{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g};if(Math.abs(f[0]-l[0])<1e-9&&Math.abs(f[1]-l[1])<1e-9&&Math.abs(f[2]-l[2])<1e-9&&Math.abs(p-y)<1e-9)return o=!0,{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g};const x=[t,e,n],S=[r,a,s],d=K(f,l),T=(p-y*d)/(d*d-1),w=(y-p*d)/(d*d-1),C=[T*f[0]+w*l[0],T*f[1]+w*l[1],T*f[2]+w*l[2]],O=kn(f,l,[]);Nn(O);let R=0,L=0;const D=[],M=[];let V=50,B=50;for(let G=0;G<3;G++){const b=G,I=(G+1)%3,m=_e.intersectWithLine(x[b],x[I],r,l);m.intersection&&m.t>0-i&&m.t<1+i&&(m.t<1+i&&m.t>1-i&&(V=R),D[R++]=K(m.x,O)-K(C,O));const U=_e.intersectWithLine(S[b],S[I],t,f);U.intersection&&U.t>0-i&&U.t<1+i&&(U.t<1+i&&U.t>1-i&&(B=L),M[L++]=K(U.x,O)-K(C,O))}if(R>2){R--;const G=D[2];D[2]=D[V],D[V]=G}if(L>2){L--;const G=M[2];M[2]=M[B],M[B]=G}if(R!==2||L!==2)return{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g};if(Number.isNaN(D[0])||Number.isNaN(D[1])||Number.isNaN(M[0])||Number.isNaN(M[1]))return{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g};if(D[0]>D[1]){const G=D[1];D[1]=D[0],D[0]=G}if(M[0]>M[1]){const G=M[1];M[1]=M[0],M[0]=G}let _,k;return D[1]<M[0]||M[1]<D[0]?{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g}:(D[0]<M[0]?D[1]<M[1]?(g[0]=2,g[1]=1,_=M[0],k=D[1]):(g[0]=2,g[1]=2,_=M[0],k=M[1]):D[1]<M[1]?(g[0]=1,g[1]=1,_=D[0],k=D[1]):(g[0]=1,g[1]=2,_=D[0],k=M[1]),wo(C,O,_,c),wo(C,O,k,u),{intersect:!0,coplanar:o,pt1:c,pt2:u,surfaceId:g})}const cd={computeNormalDirection:pi,computeNormal:Ir,intersectWithTriangle:od};function fd(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=()=>2,t.intersectWithLine=(n,r,a,s,i)=>{const o={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};i[2]=0;const c=[],u=a*a,g=[],f=[],l=[];e.points.getPoint(0,g),e.points.getPoint(1,f),e.points.getPoint(2,l);const p=[],y=[];if(Ir(g,f,l,p),p[0]!==0||p[1]!==0||p[2]!==0){const d=_e.intersectWithLine(n,r,g,p);if(o.betweenPoints=d.betweenPoints,o.t=d.t,s[0]=d.x[0],s[1]=d.x[1],s[2]=d.x[2],!d.intersection)return i[0]=0,i[1]=0,o.intersect=0,o;const T=t.evaluatePosition(s,c,i,y);if(T.evaluation>=0)return T.dist2<=u?(o.intersect=1,o):(o.intersect=T.evaluation,o)}const h=Pe(g,f),v=Pe(f,l),x=Pe(l,g);e.line||(e.line=Le.newInstance()),h>v&&h>x?(e.line.getPoints().setPoint(0,g),e.line.getPoints().setPoint(1,f)):v>x&&v>h?(e.line.getPoints().setPoint(0,f),e.line.getPoints().setPoint(1,l)):(e.line.getPoints().setPoint(0,l),e.line.getPoints().setPoint(1,g));const S=e.line.intersectWithLine(n,r,a,s,i);if(o.betweenPoints=S.betweenPoints,o.t=S.t,S.intersect){const d=[],T=[],w=[];for(let C=0;C<3;C++)d[C]=g[C]-l[C],T[C]=f[C]-l[C],w[C]=s[C]-l[C];return i[0]=K(w,d)/x,i[1]=K(w,T)/v,o.intersect=1,o}return i[0]=0,i[1]=0,o.intersect=0,o},t.evaluatePosition=(n,r,a,s)=>{const i={subId:0,dist2:0,evaluation:-1};let o,c;const u=[],g=[],f=[],l=[];let p;const y=[],h=[],v=[];let x=0,S=0;const d=[];let T,w,C,O=[];const R=[],L=[],D=[];i.subId=0,a[2]=0,e.points.getPoint(1,u),e.points.getPoint(2,g),e.points.getPoint(0,f),pi(u,g,f,l),_e.generalizedProjectPoint(n,u,l,D);let M=0;for(o=0;o<3;o++)l[o]<0?p=-l[o]:p=l[o],p>M&&(M=p,S=o);for(c=0,o=0;o<3;o++)o!==S&&(d[c++]=o);for(o=0;o<2;o++)y[o]=D[d[o]]-f[d[o]],h[o]=u[d[o]]-f[d[o]],v[o]=g[d[o]]-f[d[o]];if(x=Vr(h,v),x===0)return a[0]=0,a[1]=0,i.evaluation=-1,i;if(a[0]=Vr(y,v)/x,a[1]=Vr(h,y)/x,s[0]=1-(a[0]+a[1]),s[1]=a[0],s[2]=a[1],s[0]>=0&&s[0]<=1&&s[1]>=0&&s[1]<=1&&s[2]>=0&&s[2]<=1)r&&(i.dist2=Pe(D,n),r[0]=D[0],r[1]=D[1],r[2]=D[2]),i.evaluation=1;else{let V;if(r){if(s[1]<0&&s[2]<0)for(T=Pe(n,f),w=Le.distanceToLine(n,u,f,V,R),C=Le.distanceToLine(n,f,g,V,L),T<w?(i.dist2=T,O=f):(i.dist2=w,O=R),C<i.dist2&&(i.dist2=C,O=L),o=0;o<3;o++)r[o]=O[o];else if(s[2]<0&&s[0]<0)for(T=Pe(n,u),w=Le.distanceToLine(n,u,f,V,R),C=Le.distanceToLine(n,u,g,V,L),T<w?(i.dist2=T,O=u):(i.dist2=w,O=R),C<i.dist2&&(i.dist2=C,O=L),o=0;o<3;o++)r[o]=O[o];else if(s[1]<0&&s[0]<0)for(T=Pe(n,g),w=Le.distanceToLine(n,g,f,V,R),C=Le.distanceToLine(n,u,g,V,L),T<w?(i.dist2=T,O=g):(i.dist2=w,O=R),C<i.dist2&&(i.dist2=C,O=L),o=0;o<3;o++)r[o]=O[o];else if(s[0]<0){const B=Le.distanceToLine(n,u,g,r);i.dist2=B.distance}else if(s[1]<0){const B=Le.distanceToLine(n,g,f,r);i.dist2=B.distance}else if(s[2]<0){const B=Le.distanceToLine(n,u,f,r);i.dist2=B.distance}}i.evaluation=0}return i},t.evaluateLocation=(n,r,a)=>{const s=[],i=[],o=[];e.points.getPoint(0,s),e.points.getPoint(1,i),e.points.getPoint(2,o);const c=1-n[0]-n[1];for(let u=0;u<3;u++)r[u]=s[u]*c+i[u]*n[0]+o[u]*n[1];a[0]=c,a[1]=n[0],a[2]=n[1]},t.getParametricDistance=n=>{let r,a=0;const s=[];s[0]=n[0],s[1]=n[1],s[2]=1-n[0]-n[1];for(let i=0;i<3;i++)s[i]<0?r=-s[i]:s[i]>1?r=s[i]-1:r=0,r>a&&(a=r);return a}}const ud={};function Au(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ud,n),qr.extend(t,e,n),fd(t,e)}const gd=E.newInstance(Au,"vtkTriangle");var ld={newInstance:gd,extend:Au,...cd};const Ga=["verts","lines","polys","strips"],{vtkWarningMacro:$o}=E,pd={[J.VTK_LINE]:Le,[J.VTK_POLY_LINE]:Le,[J.VTK_TRIANGLE]:ld};function hd(t,e){e.classHierarchy.push("vtkPolyData");function n(a){return a.replace(/(?:^\w|[A-Z]|\b\w)/g,s=>s.toUpperCase()).replace(/\s+/g,"")}Ga.forEach(a=>{t[`getNumberOf${n(a)}`]=()=>e[a].getNumberOfCells(),e[a]?e[a]=We(e[a]):e[a]=Yr.newInstance()}),t.getNumberOfCells=()=>Ga.reduce((a,s)=>a+e[s].getNumberOfCells(),0);const r=t.shallowCopy;t.shallowCopy=function(a){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(a,s),Ga.forEach(i=>{e[i]=Yr.newInstance(),e[i].shallowCopy(a.getReferenceByName(i))})},t.buildCells=()=>{const a=t.getNumberOfVerts(),s=t.getNumberOfLines(),i=t.getNumberOfPolys(),o=t.getNumberOfStrips(),c=a+s+i+o,u=new Uint8Array(c);let g=u;const f=new Uint32Array(c);let l=f;if(a){let p=0;e.verts.getCellSizes().forEach((y,h)=>{l[h]=p,g[h]=y>1?J.VTK_POLY_VERTEX:J.VTK_VERTEX,p+=y+1}),l=l.subarray(a),g=g.subarray(a)}if(s){let p=0;e.lines.getCellSizes().forEach((y,h)=>{l[h]=p,g[h]=y>2?J.VTK_POLY_LINE:J.VTK_LINE,y===1&&$o("Building VTK_LINE ",h," with only one point, but VTK_LINE needs at least two points. Check the input."),p+=y+1}),l=l.subarray(s),g=g.subarray(s)}if(i){let p=0;e.polys.getCellSizes().forEach((y,h)=>{switch(l[h]=p,y){case 3:g[h]=J.VTK_TRIANGLE;break;case 4:g[h]=J.VTK_QUAD;break;default:g[h]=J.VTK_POLYGON;break}y<3&&$o("Building VTK_TRIANGLE ",h," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),p+=y+1}),l+=l.subarray(i),g+=g.subarray(i)}if(o){let p=0;g.fill(J.VTK_TRIANGLE_STRIP,0,o),e.strips.getCellSizes().forEach((y,h)=>{l[h]=p,p+=y+1})}e.cells=Qy.newInstance(),e.cells.setCellTypes(c,u,f)},t.buildLinks=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells===void 0&&t.buildCells(),e.links=Hy.newInstance(),a>0?e.links.allocate(a):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=a=>e.cells.getCellType(a),t.getCellPoints=a=>{const s=t.getCellType(a);let i=null;switch(s){case J.VTK_VERTEX:case J.VTK_POLY_VERTEX:i=e.verts;break;case J.VTK_LINE:case J.VTK_POLY_LINE:i=e.lines;break;case J.VTK_TRIANGLE:case J.VTK_QUAD:case J.VTK_POLYGON:i=e.polys;break;case J.VTK_TRIANGLE_STRIP:i=e.strips;break;default:return i=null,{type:0,cellPointIds:null}}const o=e.cells.getCellLocation(a),c=i.getCell(o);return{cellType:s,cellPointIds:c}},t.getPointCells=a=>e.links.getCells(a),t.getCellEdgeNeighbors=(a,s,i)=>{const o=e.links.getLink(s),c=e.links.getLink(i);return o.cells.filter(u=>u!==a&&c.cells.indexOf(u)!==-1)},t.getCell=function(a){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const i=t.getCellPoints(a),o=s||pd[i.cellType].newInstance();return o.initialize(t.getPoints(),i.cellPointIds),o}}const vd={};function ju(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vd,n),id.extend(t,e,n),E.get(t,e,["cells","links"]),E.setGet(t,e,["verts","lines","polys","strips"]),hd(t,e)}const yd=E.newInstance(ju,"vtkPolyData");var Be={newInstance:yd,extend:ju};function dd(t,e){e.classHierarchy.push("vtkTexture"),t.imageLoaded=()=>{e.image.removeEventListener("load",t.imageLoaded),e.imageLoaded=!0,t.modified()},t.setJsImageData=n=>{e.jsImageData!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null),e.jsImageData=n,e.imageLoaded=!0,t.modified())},t.setCanvas=n=>{e.canvas!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.jsImageData=null),e.canvas=n,t.modified())},t.setImage=n=>{e.image!==n&&(n!==null&&(t.setInputData(null),t.setInputConnection(null),e.canvas=null,e.jsImageData=null),e.image=n,e.imageLoaded=!1,n.complete?t.imageLoaded():n.addEventListener("load",t.imageLoaded),t.modified())},t.getDimensionality=()=>{let n=0,r=0,a=1;if(t.getInputData()){const i=t.getInputData();n=i.getDimensions()[0],r=i.getDimensions()[1],a=i.getDimensions()[2]}return e.jsImageData&&(n=e.jsImageData.width,r=e.jsImageData.height),e.canvas&&(n=e.canvas.width,r=e.canvas.height),e.image&&(n=e.image.width,r=e.image.height),(n>1)+(r>1)+(a>1)},t.getInputAsJsImageData=()=>{if(!e.imageLoaded||t.getInputData())return null;if(e.jsImageData)return e.jsImageData();if(e.canvas)return e.canvas.getContext("2d").getImageData(0,0,e.canvas.width,e.canvas.height);if(e.image){const n=document.createElement("canvas");n.width=e.image.width,n.height=e.image.height;const r=n.getContext("2d");return r.translate(0,n.height),r.scale(1,-1),r.drawImage(e.image,0,0,e.image.width,e.image.height),r.getImageData(0,0,n.width,n.height)}return null}}const Td=(t,e,n,r)=>{const a=[1,2,1],s=4,i=a,o=s,c=t.length/(e*n);let u=e,g=n,f=t;const l=[f];for(let p=0;p<r;p++){const y=[...f];u/=2,g/=2,f=new Uint8ClampedArray(u*g*c);const h=c*u;let v=0;for(let S=0;S<f.length;S+=c){S%h===0&&(v+=2*c*u);for(let d=0;d<c;d++){let T=y[v+d];T+=y[v+c+d],T+=y[v-2*h+d],T+=y[v-2*h+c+d],T/=4,f[S+d]=T}v+=2*c}let x=[...f];for(let S=0;S<f.length;S+=c)for(let d=0;d<c;d++){let T=-(i.length-1)/2,w=o,C=0;for(let O=0;O<i.length;O++){let R=S+d+T*c;const L=R%h-(S+d)%h;L>c&&(R+=h),L<-c&&(R-=h),x[R]?C+=x[R]*i[O]:w-=i[O],T+=1}f[S+d]=C/w}x=[...f];for(let S=0;S<f.length;S+=c)for(let d=0;d<c;d++){let T=-(i.length-1)/2,w=o,C=0;for(let O=0;O<i.length;O++){const R=S+d+T*h;x[R]?C+=x[R]*i[O]:w-=i[O],T+=1}f[S+d]=C/w}l.push(f)}return l},xd={image:null,canvas:null,jsImageData:null,imageLoaded:!1,repeat:!1,interpolate:!1,edgeClamp:!1,mipLevel:0,resizable:!1};function Ku(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xd,n),E.obj(t,e),E.algo(t,e,6,0),E.get(t,e,["canvas","image","jsImageData","imageLoaded","resizable"]),E.setGet(t,e,["repeat","edgeClamp","interpolate","mipLevel"]),dd(t,e)}const Sd=E.newInstance(Ku,"vtkTexture"),Cd={generateMipmaps:Td};var ca={newInstance:Sd,extend:Ku,...Cd};const wd=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],zo=[[8,7,11,3],[9,1,10,5],[4,9,0,8],[2,11,6,10],[0,3,2,1],[4,5,6,7]],nr=[[0,1],[1,3],[2,3],[0,2],[4,5],[5,7],[6,7],[4,6],[0,4],[1,5],[3,7],[2,6]],Wo=[0,1,0,1,0,1,0,1,2,2,2,2],ne=[[1,2],[1,2],[0,2],[0,2],[0,1],[0,1]],z=new Float64Array(3),rr=new Float64Array(3),Q=new Float64Array(3),Gt=new Float64Array(3),Vt=new Float64Array(3),ar=new Float64Array(3),ba=new Float64Array(16);function $a(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function Pu(t){const e=[],n=[];for(let r=0;r<3;r++){const a=Js().domain([t[r*2],t[r*2+1]]);e[r]=a.ticks(5);const s=a.tickFormat(5);n[r]=e[r].map(s)}return{ticks:e,tickStrings:n}}function Ed(t,e){e.classHierarchy.push("vtkCubeAxesActorHelper"),t.setRenderable=n=>{e.renderable!==n&&(e.renderable=n,e.tmActor.addTexture(e.renderable.getTmTexture()),e.tmActor.setProperty(n.getProperty()),e.tmActor.setParentProp(n),t.modified())},t.createPolyDataForOneLabel=(n,r,a,s,i,o,c)=>{const u=e.renderable.get_tmAtlas().get(n);if(!u)return;const g=e.renderable.getTextPolyData().getPoints().getData(),f=e.lastSize;z[0]=g[r*3],z[1]=g[r*3+1],z[2]=g[r*3+2],q(Q,z,a),Q[0]+=.1,q(rr,Q,s),xt(Vt,rr,z),Q[0]-=.1,Q[1]+=.1,q(rr,Q,s),xt(ar,rr,z);for(let y=0;y<3;y++)Vt[y]/=.5*.1*f[0],ar[y]/=.5*.1*f[1];let l=c.ptIdx,p=c.cellIdx;z[0]=g[r*3],z[1]=g[r*3+1],z[2]=g[r*3+2],i[0]<-.5?ht(Q,Vt,i[0]*o-u.width):i[0]>.5?ht(Q,Vt,i[0]*o):ht(Q,Vt,i[0]*o-u.width/2),On(z,z,Q),ht(Q,ar,i[1]*o-u.height/2),On(z,z,Q),c.points[l*3]=z[0],c.points[l*3+1]=z[1],c.points[l*3+2]=z[2],c.tcoords[l*2]=u.tcoords[0],c.tcoords[l*2+1]=u.tcoords[1],l++,ht(Q,Vt,u.width),On(z,z,Q),c.points[l*3]=z[0],c.points[l*3+1]=z[1],c.points[l*3+2]=z[2],c.tcoords[l*2]=u.tcoords[2],c.tcoords[l*2+1]=u.tcoords[3],l++,ht(Q,ar,u.height),On(z,z,Q),c.points[l*3]=z[0],c.points[l*3+1]=z[1],c.points[l*3+2]=z[2],c.tcoords[l*2]=u.tcoords[4],c.tcoords[l*2+1]=u.tcoords[5],l++,ht(Q,Vt,u.width),xt(z,z,Q),c.points[l*3]=z[0],c.points[l*3+1]=z[1],c.points[l*3+2]=z[2],c.tcoords[l*2]=u.tcoords[6],c.tcoords[l*2+1]=u.tcoords[7],l++,c.polys[p*4]=3,c.polys[p*4+1]=l-4,c.polys[p*4+2]=l-3,c.polys[p*4+3]=l-2,p++,c.polys[p*4]=3,c.polys[p*4+1]=l-4,c.polys[p*4+2]=l-2,c.polys[p*4+3]=l-1,c.ptIdx+=4,c.cellIdx+=2},t.updateTexturePolyData=()=>{const n=e.camera.getCompositeProjectionMatrix(e.lastAspectRatio,-1,1);te(n,n);const r=e.renderable.getTextValues().length,a=r*4,s=r*2,i=new Float64Array(a*3),o=new Uint16Array(s*4),c=new Float32Array(a*2);Oe(ba,n);const u={ptIdx:0,cellIdx:0,polys:o,points:i,tcoords:c};let g=0,f=0,l=0;const p=e.renderable.getTextPolyData().getPoints().getData(),y=e.renderable.getTextValues();for(;g<p.length/3;){z[0]=p[g*3],z[1]=p[g*3+1],z[2]=p[g*3+2],q(Q,z,n),z[0]=p[g*3+3],z[1]=p[g*3+4],z[2]=p[g*3+5],q(Gt,z,n),xt(Q,Q,Gt);const v=[Q[0],Q[1]];C1(v),t.createPolyDataForOneLabel(y[f],g,n,ba,v,e.renderable.getAxisTitlePixelOffset(),u),g+=2,f++;for(let x=0;x<e.renderable.getTickCounts()[l];x++)t.createPolyDataForOneLabel(y[f],g,n,ba,v,e.renderable.getTickLabelPixelOffset(),u),g++,f++;l++}const h=Y.newInstance({numberOfComponents:2,values:c,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(h),e.tmPolyData.getPoints().setData(i,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(o,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updateAPISpecificData=(n,r,a)=>{(e.lastSize[0]!==n[0]||e.lastSize[1]!==n[1])&&(e.lastSize[0]=n[0],e.lastSize[1]=n[1],e.lastAspectRatio=n[0]/n[1],e.forceUpdate=!0),e.camera=r,t.updateTexturePolyData()}}const Od=E.newInstance(function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},n),E.obj(t,e),e.tmPolyData=Be.newInstance(),e.tmMapper=Ze.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmActor=Qe.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),E.setGet(t,e,["renderable"]),E.get(t,e,["lastSize","lastAspectRatio","axisTextStyle","tickTextStyle","tmActor","ticks"]),e.forceUpdate=!1,e.lastRedrawTime={},E.obj(e.lastRedrawTime,{mtime:0}),e.lastRebuildTime={},E.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.lastTickBounds=[],Ed(t,e)},"vtkCubeAxesActorHelper");function Rd(t,e){e.classHierarchy.push("vtkCubeAxesActor"),t.setCamera=r=>{e.camera!==r&&(e.cameraModifiedSub&&(e.cameraModifiedSub.unsubscribe(),e.cameraModifiedSub=null),e.camera=r,r&&(e.cameraModifiedSub=r.onModified(t.update)),t.update(),t.modified())},t.computeFacesToDraw=()=>{const r=e.camera.getViewMatrix();te(r,r);let a=!1;const s=ee.getDiagonalLength(e.dataBounds),i=Math.sin(e.faceVisibilityAngle*Math.PI/180);for(let o=0;o<6;o++){let c=!1;const u=Math.floor(o/2),g=(u+1)%3,f=(u+2)%3;e.dataBounds[g*2]!==e.dataBounds[g*2+1]&&e.dataBounds[f*2]!==e.dataBounds[f*2+1]&&(z[u]=e.dataBounds[o]-.1*s*wd[o][u],z[g]=.5*(e.dataBounds[g*2]+e.dataBounds[g*2+1]),z[f]=.5*(e.dataBounds[f*2]+e.dataBounds[f*2+1]),q(Q,z,r),z[u]=e.dataBounds[o],q(Gt,z,r),xt(Q,Gt,Q),Ct(Q,Q),c=Q[2]>i,e.camera.getParallelProjection()||(Ct(Gt,Gt),c=$s(Gt,Q)>i)),c!==e.lastFacesToDraw[o]&&(e.lastFacesToDraw[o]=c,a=!0)}return a},t.updatePolyData=(r,a,s)=>{let i=0,o=0;i+=8;let c=0;for(let p=0;p<12;p++)a[p]>0&&c++;if(o+=c,e.gridLines)for(let p=0;p<6;p++)r[p]&&(i+=s[ne[p][0]].length*2+s[ne[p][1]].length*2,o+=s[ne[p][0]].length+s[ne[p][1]].length);const u=new Float64Array(i*3),g=new Uint32Array(o*3);let f=0,l=0;for(let p=0;p<2;p++)for(let y=0;y<2;y++)for(let h=0;h<2;h++)u[f*3]=e.dataBounds[h],u[f*3+1]=e.dataBounds[2+y],u[f*3+2]=e.dataBounds[4+p],f++;for(let p=0;p<12;p++)a[p]>0&&(g[l*3]=2,g[l*3+1]=nr[p][0],g[l*3+2]=nr[p][1],l++);if(e.gridLines){for(let p=0;p<6;p++)if(r[p]){const y=Math.floor(p/2);let h=s[ne[p][0]];for(let v=0;v<h.length;v++)u[f*3+y]=e.dataBounds[p],u[f*3+ne[p][0]]=h[v],u[f*3+ne[p][1]]=e.dataBounds[ne[p][1]*2],f++,u[f*3+y]=e.dataBounds[p],u[f*3+ne[p][0]]=h[v],u[f*3+ne[p][1]]=e.dataBounds[ne[p][1]*2+1],f++,g[l*3]=2,g[l*3+1]=f-2,g[l*3+2]=f-1,l++;h=s[ne[p][1]];for(let v=0;v<h.length;v++)u[f*3+y]=e.dataBounds[p],u[f*3+ne[p][1]]=h[v],u[f*3+ne[p][0]]=e.dataBounds[ne[p][0]*2],f++,u[f*3+y]=e.dataBounds[p],u[f*3+ne[p][1]]=h[v],u[f*3+ne[p][0]]=e.dataBounds[ne[p][0]*2+1],f++,g[l*3]=2,g[l*3+1]=f-2,g[l*3+2]=f-1,l++}}e.polyData.getPoints().setData(u,3),e.polyData.getPoints().modified(),e.polyData.getLines().setData(g,1),e.polyData.getLines().modified(),e.polyData.modified()},t.updateTextData=(r,a,s,i)=>{let o=0;for(let p=0;p<12;p++)a[p]===1&&(o+=2,o+=s[Wo[p]].length);const c=e.polyData.getPoints().getData(),u=new Float64Array(o*3);let g=0,f=0,l=0;for(let p=0;p<6;p++)if(r[p])for(let y=0;y<4;y++){const h=zo[p][y];if(a[h]===1){const v=Wo[h],x=nr[h][0]*3,S=nr[h][1]*3;u[g*3]=.5*(c[x]+c[S]),u[g*3+1]=.5*(c[x+1]+c[S+1]),u[g*3+2]=.5*(c[x+2]+c[S+2]),g++;const d=Math.floor(p/2);u[g*3+d]=e.dataBounds[p],u[g*3+ne[p][0]]=.5*(e.dataBounds[ne[p][0]*2]+e.dataBounds[ne[p][0]*2+1]),u[g*3+ne[p][1]]=.5*(e.dataBounds[ne[p][1]*2]+e.dataBounds[ne[p][1]*2+1]),g++,e.textValues[f]=e.axisLabels[v],f++;const T=(v+1)%3,w=(v+2)%3,C=s[v],O=i[v];e.tickCounts[l]=C.length;for(let R=0;R<C.length;R++)u[g*3+v]=C[R],u[g*3+T]=c[x+T],u[g*3+w]=c[x+w],g++,e.textValues[f]=O[R],f++;l++}}e.textPolyData.getPoints().setData(u,3),e.textPolyData.modified()},t.update=()=>{if(!e.camera)return;const r=t.computeFacesToDraw(),a=e.lastFacesToDraw;let s=!1;for(let i=0;i<6;i++)e.dataBounds[i]!==e.lastTickBounds[i]&&(s=!0,e.lastTickBounds[i]=e.dataBounds[i]);if(r||s||e.forceUpdate){const i=new Array(12).fill(0);for(let c=0;c<6;c++)if(a[c])for(let u=0;u<4;u++)i[zo[c][u]]++;const o=e.generateTicks(e.dataBounds);t.updatePolyData(a,i,o.ticks),t.updateTextData(a,i,o.ticks,o.tickStrings),(s||e.forceUpdate)&&t.updateTextureAtlas(o.tickStrings)}e.forceUpdate=!1},t.updateTextureAtlas=r=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e._tmAtlas.clear();let a=0,s=1;for(let i=0;i<3;i++){if(!e._tmAtlas.has(e.axisLabels[i])){$a(e.tmContext,e.axisTextStyle);const o=e.tmContext.measureText(e.axisLabels[i]),c={height:o.actualBoundingBoxAscent+2,startingHeight:s,width:o.width+2,textStyle:e.axisTextStyle};e._tmAtlas.set(e.axisLabels[i],c),s+=c.height,a<c.width&&(a=c.width)}$a(e.tmContext,e.tickTextStyle);for(let o=0;o<r[i].length;o++)if(!e._tmAtlas.has(r[i][o])){const c=e.tmContext.measureText(r[i][o]),u={height:c.actualBoundingBoxAscent+2,startingHeight:s,width:c.width+2,textStyle:e.tickTextStyle};e._tmAtlas.set(r[i][o],u),s+=u.height,a<u.width&&(a=u.width)}}a=be(a),s=be(s),e._tmAtlas.forEach(i=>{i.tcoords=[0,(s-i.startingHeight-i.height)/s,i.width/a,(s-i.startingHeight-i.height)/s,i.width/a,(s-i.startingHeight)/s,0,(s-i.startingHeight)/s]}),e.tmCanvas.width=a,e.tmCanvas.height=s,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,a,s),e._tmAtlas.forEach((i,o)=>{$a(e.tmContext,i.textStyle),e.tmContext.fillText(o,1,i.startingHeight+i.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified()},t.onModified(()=>{e.forceUpdate=!0,t.update()}),t.setTickTextStyle=r=>{e.tickTextStyle={...e.tickTextStyle,...r},t.modified()},t.setAxisTextStyle=r=>{e.axisTextStyle={...e.axisTextStyle,...r},t.modified()},t.get_tmAtlas=()=>e._tmAtlas,t.getBounds=()=>(t.update(),ee.setBounds(e.bounds,e.gridActor.getBounds()),ee.scaleAboutCenter(e.bounds,e.boundsScaleFactor,e.boundsScaleFactor,e.boundsScaleFactor),e.bounds);const n=E.chain(t.setProperty,e.gridActor.setProperty);t.setProperty=r=>n(r)[0]}function Dd(t,e,n){return{boundsScaleFactor:1.3,camera:null,dataBounds:[...ee.INIT_BOUNDS],faceVisibilityAngle:8,gridLines:!0,axisLabels:null,axisTitlePixelOffset:35,tickLabelPixelOffset:12,generateTicks:Pu,...n,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif",...n==null?void 0:n.axisTextStyle},tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif",...n==null?void 0:n.tickTextStyle}}}function Xu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Qe.extend(t,e,Dd(t,e,n)),e.lastFacesToDraw=[!1,!1,!1,!1,!1,!1],e.axisLabels=["X-Axis","Y-Axis","Z-Axis"],e.tickCounts=[],e.textValues=[],e.lastTickBounds=[],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.tmTexture=ca.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),e.gridMapper=Ze.newInstance(),e.polyData=Be.newInstance(),e.gridMapper.setInputData(e.polyData),e.gridActor=Qe.newInstance(),e.gridActor.setMapper(e.gridMapper),e.gridActor.setProperty(t.getProperty()),e.gridActor.setParentProp(t),e.textPolyData=Be.newInstance(),E.setGet(t,e,["axisTitlePixelOffset","boundsScaleFactor","faceVisibilityAngle","gridLines","tickLabelPixelOffset","generateTicks"]),E.setGetArray(t,e,["dataBounds"],6),E.setGetArray(t,e,["axisLabels"],3),E.get(t,e,["axisTextStyle","tickTextStyle","camera","tmTexture","textValues","textPolyData","tickCounts","gridActor"]),Rd(t,e)}const Md=E.newInstance(Xu,"vtkCubeAxesActor");var Yu={newInstance:Md,extend:Xu,newCubeAxesActorHelper:Od,defaultGenerateTicks:Pu};function Ld(t,e){e.classHierarchy.push("vtkOpenGLCubeAxesActor"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const a=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,s=e._openGLRenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([s.usize,s.vsize],a,e._openGLRenderWindow.getRenderable())}}}const Vd={};function _d(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Vd,n),ae.extend(t,e,n),e.CubeAxesActorHelper=Yu.newCubeAxesActorHelper(),Ld(t,e)}const Bd=Z(_d,"vtkOpenGLCubeAxesActor");Fe("vtkCubeAxesActor",Bd);const Vn={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2};var qu={ObjectType:Vn};const{ObjectType:Br}=qu,Fd={};function md(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function n(o){switch(o){case Br.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case Br.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case Br.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}let r=null,a=null,s=!0,i="";t.getType=()=>r,t.setType=o=>{r=o},t.getHandle=()=>a,t.isReady=()=>s===!1,t.generateBuffer=o=>{const c=n(o);return a===null&&(a=e.context.createBuffer(),r=o),n(r)===c},t.upload=(o,c)=>t.generateBuffer(c)?(e.context.bindBuffer(n(r),a),e.context.bufferData(n(r),o,e.context.STATIC_DRAW),e.allocatedGPUMemoryInBytes=o.length*o.BYTES_PER_ELEMENT,s=!1,!0):(i="Trying to upload array buffer to incompatible buffer.",!1),t.bind=()=>a?(e.context.bindBuffer(n(r),a),!0):!1,t.release=()=>a?(e.context.bindBuffer(n(r),null),!0):!1,t.releaseGraphicsResources=()=>{a!==null&&(e.context.bindBuffer(n(r),null),e.context.deleteBuffer(a),a=null,e.allocatedGPUMemoryInBytes=0)},t.setOpenGLRenderWindow=o=>{e._openGLRenderWindow!==o&&(t.releaseGraphicsResources(),e._openGLRenderWindow=o,e.context=null,o&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=()=>i}const Ud={objectType:Br.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function Iu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ud,n),E.obj(t,e),E.get(t,e,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),E.moveToProtected(t,e,["openGLRenderWindow"]),md(t,e)}const kd=E.newInstance(Iu);var Qu={newInstance:kd,extend:Iu,...Fd,...qu};const{vtkErrorMacro:Ho}=E;function Nd(t,e){const n=new Float64Array(3);K0(n,e);const r=new Float64Array(16);return Uc(r,At(),t,n),r}function Gd(t,e){return t===null||e===null?!1:!(Di(t,[0,0,0])&&Di(e,[1,1,1]))}function bd(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(Vn.ARRAY_BUFFER),t.createVBO=function(n,r,a,s){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!n.getData()||!n.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];const o=s.points.getData();let c=null,u=null,g=null;const f=s.colors?s.colors.getNumberOfComponents():0,l=s.tcoords?s.tcoords.getNumberOfComponents():0;s.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,c=s.normals.getData()),s.customAttributes&&s.customAttributes.forEach(m=>{m&&(e.customData.push({data:m.getData(),offset:4*e.blockSize,components:m.getNumberOfComponents(),name:m.getName()}),e.blockSize+=m.getNumberOfComponents())}),s.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=l,e.blockSize+=l,u=s.tcoords.getData()),s.colors?(e.colorComponents=s.colors.getNumberOfComponents(),e.colorOffset=0,g=s.colors.getData(),e.colorBO||(e.colorBO=Qu.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;let p=0,y=0,h=0,v=0,x=0,S=0,d;const T={anythingToPoints(m,U,$,W){for(let N=0;N<m;++N)d(U[$+N],W)},linesToWireframe(m,U,$,W){for(let N=0;N<m-1;++N)d(U[$+N],W),d(U[$+N+1],W)},polysToWireframe(m,U,$,W){if(m>2)for(let N=0;N<m;++N)d(U[$+N],W),d(U[$+(N+1)%m],W)},stripsToWireframe(m,U,$,W){if(m>2){for(let N=0;N<m-1;++N)d(U[$+N],W),d(U[$+N+1],W);for(let N=0;N<m-2;N++)d(U[$+N],W),d(U[$+N+2],W)}},polysToSurface(m,U,$,W){for(let N=0;N<m-2;N++)d(U[$+0],W),d(U[$+N+1],W),d(U[$+N+2],W)},stripsToSurface(m,U,$,W){for(let N=0;N<m-2;N++)d(U[$+N],W),d(U[$+N+1+N%2],W),d(U[$+N+1+(N+1)%2],W)}},w={anythingToPoints(m,U){return m},linesToWireframe(m,U){return m>1?(m-1)*2:0},polysToWireframe(m,U){return m>2?m*2:0},stripsToWireframe(m,U){return m>2?m*4-6:0},polysToSurface(m,U){return m>2?(m-2)*3:0},stripsToSurface(m,U,$){return m>2?(m-2)*3:0}};let C=null,O=null;a===Ve.POINTS||r==="verts"?(C=T.anythingToPoints,O=w.anythingToPoints):a===Ve.WIREFRAME||r==="lines"?(C=T[`${r}ToWireframe`],O=w[`${r}ToWireframe`]):(C=T[`${r}ToSurface`],O=w[`${r}ToSurface`]);const R=n.getData(),L=R.length;let D=0;for(let m=0;m<L;)D+=O(R[m],R),m+=R[m]+1;let M=null;const V=new Float32Array(D*e.blockSize);g&&(M=new Uint8Array(D*4));let B=0,_=0,k=0,G=0;for(let m=0;m<3;++m){const U=s.points.getRange(m),$=U[1]-U[0];k+=$*$;const W=.5*(U[1]+U[0]);G+=W*W}if(k>0&&(Math.abs(G)/k>1e6||Math.abs(Math.log10(k))>3||k===0&&G>1e6)){const m=new Float64Array(3),U=new Float64Array(3);for(let $=0;$<3;++$){const W=s.points.getRange($),N=W[1]-W[0];m[$]=.5*(W[1]+W[0]),U[$]=N>0?1/N:1}t.setCoordShiftAndScale(m,U)}else e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null);if(i)if(!i.points&&!i.cells)i.points=new Int32Array(D),i.cells=new Int32Array(D);else{const m=new Int32Array(D+i.points.length);m.set(i.points),i.points=m;const U=new Int32Array(D+i.cells.length);U.set(i.cells),i.cells=U}let I=s.vertexOffset;d=function(U,$){if(i&&(i.points[I]=U,i.cells[I]=S+s.cellOffset),++I,p=U*3,e.coordShiftAndScaleEnabled?(V[B++]=(o[p++]-e.coordShift[0])*e.coordScale[0],V[B++]=(o[p++]-e.coordShift[1])*e.coordScale[1],V[B++]=(o[p++]-e.coordShift[2])*e.coordScale[2]):(V[B++]=o[p++],V[B++]=o[p++],V[B++]=o[p++]),c!==null&&(s.haveCellNormals?y=(S+s.cellOffset)*3:y=U*3,V[B++]=c[y++],V[B++]=c[y++],V[B++]=c[y++]),e.customData.forEach(W=>{x=U*W.components;for(let N=0;N<W.components;++N)V[B++]=W.data[x++]}),u!==null){s.useTCoordsPerCell?h=$*l:h=U*l;for(let W=0;W<l;++W)V[B++]=u[h++]}g!==null&&(s.haveCellScalars?v=(S+s.cellOffset)*f:v=U*f,M[_++]=g[v++],M[_++]=g[v++],M[_++]=g[v++],M[_++]=f===4?g[v++]:255)};for(let m=0;m<L;m+=R[m]+1,S++)C(R[m],R,m+1,S+s.cellOffset);return e.elementCount=D,t.upload(V,Vn.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(M,Vn.ARRAY_BUFFER)),S},t.setCoordShiftAndScale=(n,r)=>{if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){Ho("Wrong type for coordShift, expected vec3 or null");return}if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){Ho("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||n===null||!Mi(n,e.coordShift))&&(e.coordShift=n),(e.coordScale===null||r===null||!Mi(r,e.coordScale))&&(e.coordScale=r),e.coordShiftAndScaleEnabled=Gd(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=Nd(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}const $d={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function Zu(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$d,n),Qu.extend(t,e,n),E.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),E.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),bd(t,e)}const zd=E.newInstance(Zu);var Wd={newInstance:zd,extend:Zu};const{vtkErrorMacro:Hd}=E;function Ad(t,e){e.classHierarchy.push("vtkShader"),t.compile=()=>{let n=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":n=e.context.FRAGMENT_SHADER;break;case"Vertex":default:n=e.context.VERTEX_SHADER;break}if(e.handle=e.context.createShader(n),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle),!e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS)){const a=e.context.getShaderInfoLog(e.handle);return Hd(`Error compiling shader '${e.source}': ${a}`),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}const jd={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function Ju(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,jd,n),E.obj(t,e),E.setGet(t,e,["shaderType","source","error","handle","context"]),Ad(t,e)}const Kd=E.newInstance(Ju,"vtkShader");var za={newInstance:Kd,extend:Ju};const{vtkErrorMacro:Ae}=E;function Pd(t,e,n,r){const a=typeof n=="string"?n:n.join(`
`),s=r===!1?e:new RegExp(e,"g"),i=t.replace(s,a);return{replace:i!==a,result:i}}function Xd(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=()=>e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?(Ae(e.error),0):t.link()?(t.setCompiled(!0),1):(Ae(`Links failed: ${e.error}`),0):(Ae(e.fragmentShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),Ae(e.fragmentShader.getError()),0):(Ae(e.vertexShader.getSource().split(`
`).map((n,r)=>`${r}: ${n}`).join(`
`)),Ae(e.vertexShader.getError()),0),t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(t.release(),e.vertexShaderHandle!==0&&(e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=0),e.fragmentShaderHandle!==0&&(e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=0),e.context.deleteProgram(e.handle),e.handle=0,t.setCompiled(!1))},t.bind=()=>!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0),t.isBound=()=>!!e.bound,t.release=()=>{e.context.useProgram(null),t.setBound(!1)},t.setContext=n=>{e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.link=()=>{if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;if(e.uniformLocs={},e.context.linkProgram(e.handle),!e.context.getProgramParameter(e.handle,e.context.LINK_STATUS)){const r=e.context.getProgramInfoLog(e.handle);return Ae(`Error linking shader ${r}`),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=(n,r)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const s=new Float32Array(r);return e.context.uniformMatrix4fv(a,!1,s),!0},t.setUniformMatrix3x3=(n,r)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;const s=new Float32Array(r);return e.context.uniformMatrix3fv(a,!1,s),!0},t.setUniformf=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1f(a,r),!0)},t.setUniformfv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1fv(a,r),!0)},t.setUniformi=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1i(a,r),!0)},t.setUniformiv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform1iv(a,r),!0)},t.setUniform2f=(n,r,a)=>{const s=t.findUniform(n);if(s===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(s,r,a),!0},t.setUniform2fv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2fv(a,r),!0)},t.setUniform2i=(n,r,a)=>{const s=t.findUniform(n);if(s===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(s,r,a),!0},t.setUniform2iv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform2iv(a,r),!0)},t.setUniform3f=(n,r,a,s)=>{const i=t.findUniform(n);if(i===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(s===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(i,r,a,s),!0},t.setUniform3fArray=(n,r)=>{const a=t.findUniform(n);if(a===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;if(!Array.isArray(r)||r.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(a,r[0],r[1],r[2]),!0},t.setUniform3fv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3fv(a,r),!0)},t.setUniform3i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var a=arguments.length,s=new Array(a>1?a-1:0),i=1;i<a;i++)s[i-1]=arguments[i];let o=s;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(r,o[0],o[1],o[2]),!0},t.setUniform3iv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform3iv(a,r),!0)},t.setUniform4f=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var a=arguments.length,s=new Array(a>1?a-1:0),i=1;i<a;i++)s[i-1]=arguments[i];let o=s;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(r,o[0],o[1],o[2],o[3]),!0},t.setUniform4fv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4fv(a,r),!0)},t.setUniform4i=function(n){const r=t.findUniform(n);if(r===-1)return e.error=`Could not set uniform ${n} . No such uniform.`,!1;for(var a=arguments.length,s=new Array(a>1?a-1:0),i=1;i<a;i++)s[i-1]=arguments[i];let o=s;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(r,o[0],o[1],o[2],o[3]),!0},t.setUniform4iv=(n,r)=>{const a=t.findUniform(n);return a===-1?(e.error=`Could not set uniform ${n} . No such uniform.`,!1):(e.context.uniform4iv(a,r),!0)},t.findUniform=n=>{if(!n||!e.linked)return-1;let r=e.uniformLocs[n];return r!==void 0?r:(r=e.context.getUniformLocation(e.handle,n),r===null?(e.error=`Uniform ${n} not found in current shader program.`,e.uniformLocs[n]=-1,-1):(e.uniformLocs[n]=r,r))},t.isUniformUsed=n=>{if(!n)return!1;let r=e.uniformLocs[n];return r!==void 0?r!==null:e.linked?(r=e.context.getUniformLocation(e.handle,n),e.uniformLocs[n]=r,r!==null):(Ae("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=n=>{if(!n)return!1;if(n in e.attributeLocs)return!0;if(!e.linked)return Ae("attempt to find uniform when the shader program is not linked"),!1;const r=e.context.getAttribLocation(e.handle,n);return r===-1?!1:(e.attributeLocs[n]=r,!0)},t.attachShader=n=>{if(n.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){const r=e.context.createProgram();if(r===0)return e.error="Could not create shader program.",!1;e.handle=r,e.linked=!1}return n.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=n.getHandle()),n.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=n.getHandle()),e.context.attachShader(e.handle,n.getHandle()),t.setLinked(!1),!0},t.detachShader=n=>{if(n.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(n.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),n.getShaderType()){case"Vertex":return e.vertexShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==n.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,n.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=n=>{e.context=n,e.vertexShader.setContext(n),e.fragmentShader.setContext(n),e.geometryShader.setContext(n)},t.setLastCameraMTime=n=>{e.lastCameraMTime=n}}const Yd={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function eg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Yd,n),e.attributesLocs={},e.uniformLocs={},e.vertexShader=za.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=za.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=za.newInstance(),e.geometryShader.setShaderType("Geometry"),E.obj(t,e),E.get(t,e,["lastCameraMTime"]),E.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),Xd(t,e)}const qd=E.newInstance(eg,"vtkShaderProgram");var F={newInstance:qd,extend:eg,substitute:Pd};function Id(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=()=>{},t.initialize=()=>{e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=()=>e.handleVAO!==0||e.supported===!1,t.bind=()=>{if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const a=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,a.buffer);for(let s=0;s<a.attributes.length;++s){const i=a.attributes[s],o=i.isMatrix?i.size:1;for(let c=0;c<o;++c)n.enableVertexAttribArray(i.index+c),n.vertexAttribPointer(i.index+c,i.size,i.type,i.normalize,i.stride,i.offset+i.stride*c/i.size),i.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(i.index+c,1):n.vertexAttribDivisor(i.index+c,1))}}}},t.release=()=>{if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady()){const n=e.context;for(let r=0;r<e.buffers.length;++r){const a=e.buffers[r];e.context.bindBuffer(n.ARRAY_BUFFER,a.buffer);for(let s=0;s<a.attributes.length;++s){const i=a.attributes[s],o=i.isMatrix?i.size:1;for(let c=0;c<o;++c)n.enableVertexAttribArray(i.index+c),n.vertexAttribPointer(i.index+c,i.size,i.type,i.normalize,i.stride,i.offset+i.stride*c/i.size),i.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(i.index+c,0):n.vertexAttribDivisor(i.index+c,0)),n.disableVertexAttribArray(i.index+c)}}}},t.shaderProgramChanged=()=>{t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=()=>{t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=(n,r,a,s,i,o,c,u)=>t.addAttributeArrayWithDivisor(n,r,a,s,i,o,c,u,0,!1),t.addAttributeArrayWithDivisor=(n,r,a,s,i,o,c,u,g,f)=>{if(!n||!n.isBound()||r.getHandle()===0||r.getType()!==Vn.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=n.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==n.getHandle()))return!1;const l=e.context,p={};if(p.name=a,p.index=l.getAttribLocation(e.handleProgram,a),p.offset=s,p.stride=i,p.type=o,p.size=c,p.normalize=u,p.isMatrix=f,p.divisor=g,p.Index===-1)return!1;if(r.bind(),l.enableVertexAttribArray(p.index),l.vertexAttribPointer(p.index,p.size,p.type,p.normalize,p.stride,p.offset),g>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(p.index,1):l.vertexAttribDivisor(p.index,1)),p.buffer=r.getHandle(),!e.supported){let y=!1;for(let h=0;h<e.buffers.length;++h){const v=e.buffers[h];if(v.buffer===p.buffer){y=!0;let x=!1;for(let S=0;S<v.attributes.length;++S)v.attributes[S].name===a&&(x=!0,v.attributes[S]=p);x||v.attributes.push(p)}}y||e.buffers.push({buffer:p.buffer,attributes:[p]})}return!0},t.addAttributeMatrixWithDivisor=(n,r,a,s,i,o,c,u,g)=>{const f=t.addAttributeArrayWithDivisor(n,r,a,s,i,o,c,u,g,!0);if(!f)return f;const l=e.context,p=l.getAttribLocation(e.handleProgram,a);for(let y=1;y<c;y++)l.enableVertexAttribArray(p+y),l.vertexAttribPointer(p+y,c,o,u,i,s+i*y/c),g>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(p+y,1):l.vertexAttribDivisor(p+y,1));return!0},t.removeAttributeArray=n=>{if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(let r=0;r<e.buffers.length;++r){const a=e.buffers[r];for(let s=0;s<a.attributes.length;++s)if(a.attributes[s].name===n)return a.attributes.splice(s,1),a.attributes.length||e.buffers.splice(r,1),!0}return!0},t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))}}const Qd={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function tg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Qd,n),e.buffers=[],E.obj(t,e),E.get(t,e,["supported"]),E.setGet(t,e,["forceEmulation"]),Id(t,e)}const Zd=E.newInstance(tg,"vtkOpenGLVertexArrayObject");var ng={newInstance:Zd,extend:tg};const vt={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function Jd(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=n=>{e.context=n.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(n),e.CABO.setOpenGLRenderWindow(n)},t.releaseGraphicsResources=n=>{e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=(n,r,a,s)=>{if(e.CABO.getElementCount()){const i=t.getOpenGLMode(a),o=t.haveWideLines(n,r),c=e.context,u=c.getParameter(c.DEPTH_WRITEMASK);e.pointPicking&&c.depthMask(!1),i===c.LINES&&o?(t.updateShaders(n,r,s),c.drawArraysInstanced(i,0,e.CABO.getElementCount(),2*Math.ceil(r.getProperty().getLineWidth()))):(c.lineWidth(r.getProperty().getLineWidth()),t.updateShaders(n,r,s),c.drawArrays(i,0,e.CABO.getElementCount()),c.lineWidth(1));const f=(i===c.POINTS?1:0)||(i===c.LINES?2:3);return e.pointPicking&&c.depthMask(u),e.CABO.getElementCount()/f}return 0},t.getOpenGLMode=n=>{if(e.pointPicking)return e.context.POINTS;const r=e.primitiveType;return n===Ve.POINTS||r===vt.Points?e.context.POINTS:n===Ve.WIREFRAME||r===vt.Lines||r===vt.TrisEdges||r===vt.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=(n,r)=>r.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=r.getProperty().getLineWidth()):!1,t.getNeedToRebuildShaders=(n,r,a)=>!!(a.getNeedToRebuildShaders(t,n,r)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<a.getMTime()||t.getShaderSourceTime().getMTime()<r.getMTime()),t.updateShaders=(n,r,a)=>{if(t.getNeedToRebuildShaders(n,r,a)){const s={Vertex:null,Fragment:null,Geometry:null};a.buildShaders(s,n,r);const i=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);i!==t.getProgram()&&(t.setProgram(i),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),a.setMapperShaderParameters(t,n,r),a.setPropertyShaderParameters(t,n,r),a.setCameraShaderParameters(t,n,r),a.setLightingShaderParameters(t,n,r),a.invokeShaderCallbacks(t,n,r)},t.setMapperShaderParameters=(n,r,a)=>{if(t.haveWideLines(n,r)){t.getProgram().setUniform2f("viewportSize",a.usize,a.vsize);const s=parseFloat(r.getProperty().getLineWidth()),i=s/2;t.getProgram().setUniformf("lineWidthStepSize",s/Math.ceil(s)),t.getProgram().setUniformf("halfLineWidth",i)}e.primitiveType===vt.Points||r.getProperty().getRepresentation()===Ve.POINTS?t.getProgram().setUniformf("pointSize",r.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=(n,r,a)=>{let s=n.Vertex;s=F.substitute(s,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,s=F.substitute(s,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(a.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(r,a)&&(s=F.substitute(s,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,s=F.substitute(s,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),n.Vertex=s},t.getPointPickingPrimitiveSize=()=>e.primitiveType===vt.Points?2:e.primitiveType===vt.Lines?4:6,t.getAllocatedGPUMemoryInBytes=()=>t.getCABO().getAllocatedGPUMemoryInBytes()}const eT={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function rg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eT,n),E.obj(t,e),e.shaderSourceTime={},E.obj(e.shaderSourceTime),e.attributeUpdateTime={},E.obj(e.attributeUpdateTime),E.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=F.newInstance(),e.VAO=ng.newInstance(),e.CABO=Wd.newInstance(),Jd(t,e)}const tT=E.newInstance(rg);var yn={newInstance:tT,extend:rg,primTypes:vt};const nT={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},Vs={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5};var ag={Wrap:nT,Filter:Vs};const sg=new Float32Array(1),rT=new Int32Array(sg.buffer);function aT(t){sg[0]=t;const e=rT[0];let n=e>>16&32768,r=e>>12&2047;const a=e>>23&255;return a<103?n:a>142?(n|=31744,n|=(a===255?0:1)&&e&8388607,n):a<113?(r|=2048,n|=(r>>114-a)+(r>>113-a&1),n):(n|=a-112<<10|r>>1,n+=r&1,n)}function sT(t){const e=(t&32768)>>15,n=(t&31744)>>10,r=t&1023;return n===0?(e?-1:1)*2**-14*(r/2**10):n===31?r?NaN:(e?-1:1)*(1/0):(e?-1:1)*2**(n-15)*(1+r/2**10)}var ze={fromHalf:sT,toHalf:aT};function iT(){try{const r=new Int16Array([0,32767]),a=[1,1],s=document.createElement("canvas");s.width=4,s.height=4;const i=s.getContext("webgl2");if(!i)return!1;const o=i.getExtension("EXT_texture_norm16");if(!o)return!1;const c=`#version 300 es
    void main() {
      gl_PointSize = ${4 .toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,u=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `,g=i.createShader(i.VERTEX_SHADER);if(i.shaderSource(g,c),i.compileShader(g),!i.getShaderParameter(g,i.COMPILE_STATUS))return!1;const f=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(f,u),i.compileShader(f),!i.getShaderParameter(f,i.COMPILE_STATUS))return!1;const l=i.createProgram();if(i.attachShader(l,g),i.attachShader(l,f),i.linkProgram(l),!i.getProgramParameter(l,i.LINK_STATUS))return!1;const p=i.createTexture();i.bindTexture(i.TEXTURE_2D,p),i.texImage2D(i.TEXTURE_2D,0,o.R16_SNORM_EXT,2,1,0,i.RED,i.SHORT,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.useProgram(l),i.drawArrays(i.POINTS,0,1);const y=new Uint8Array(4);i.readPixels(a[0],a[1],1,1,i.RGBA,i.UNSIGNED_BYTE,y);const[h,v,x]=y,S=i.getExtension("WEBGL_lose_context");return S&&S.loseContext(),h===v&&v===x&&h!==0}catch{return!1}}let Wa;function oT(){return Wa===void 0&&(Wa=iT()),Wa}const{Wrap:rt,Filter:fe}=ag,{VtkDataTypes:P}=Y,{vtkDebugMacro:Ha,vtkErrorMacro:Pt,vtkWarningMacro:Ao}=Je,{toHalf:cT}=ze;function fT(t,e){e.classHierarchy.push("vtkOpenGLTexture"),t.render=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(u?e._openGLRenderWindow=u:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow")),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(fe.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(fe.LINEAR),t.setMagnificationFilter(fe.LINEAR)):(t.setMinificationFilter(fe.NEAREST),t.setMagnificationFilter(fe.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(rt.REPEAT),t.setWrapS(rt.REPEAT),t.setWrapT(rt.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(fe.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(fe.LINEAR_MIPMAP_LINEAR));const f=e.renderable.getCanvas();t.create2DFromRaw(f.width,f.height,4,P.UNSIGNED_CHAR,f,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){const f=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(fe.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw(f.width,f.height,4,P.UNSIGNED_CHAR,f.data,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}const g=e.renderable.getInputData(0);if(g&&g.getPointData().getScalars()){const f=g.getExtent(),l=g.getPointData().getScalars(),p=[];for(let y=0;y<e.renderable.getNumberOfInputPorts();++y){const h=e.renderable.getInputData(y),v=h?h.getPointData().getScalars().getData():null;v&&p.push(v)}e.renderable.getInterpolate()&&l.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(fe.LINEAR_MIPMAP_LINEAR)),p.length%6===0?t.createCubeFromRaw(f[1]-f[0]+1,f[3]-f[2]+1,l.getNumberOfComponents(),l.getDataType(),p):t.create2DFromRaw(f[1]-f[0]+1,f[3]-f[2]+1,l.getNumberOfComponents(),l.getDataType(),l.getData()),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()};const n=()=>{if(!((e.minificationFilter===fe.LINEAR||e.magnificationFilter===fe.LINEAR)&&!oT()))return e.oglNorm16Ext};t.destroyTexture=()=>{t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=()=>{e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=()=>e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1,t.activate=()=>{e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=()=>{e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=u=>{u&&e.handle&&(u.activateTexture(t),u.deactivateTexture(t),e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0,e.allocatedGPUMemoryInBytes=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(u),e.shaderProgram=null)},t.bind=()=>{e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=()=>{let u=!1;if(e.context&&e.handle){let g=0;switch(e.target){case e.context.TEXTURE_2D:g=e.context.TEXTURE_BINDING_2D;break;default:Ao("impossible case");break}u=e.context.getIntegerv(g)===e.handle}return u},t.sendParameters=()=>{e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=(u,g)=>(e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(u,g)),e.internalFormat||Ha(`Unable to find suitable internal format for T=${u} NC= ${g}`),[e.context.R32F,e.context.RG32F,e.context.RGB32F,e.context.RGBA32F].includes(e.internalFormat)&&!e.context.getExtension("OES_texture_float_linear")&&Ao("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),e.internalFormat),t.getDefaultInternalFormat=(u,g)=>{let f=0;return f=e._openGLRenderWindow.getDefaultTextureInternalFormat(u,g,n(),t.useHalfFloat()),f||(f||(Ha("Unsupported internal texture type!"),Ha(`Unable to find suitable internal format for T=${u} NC= ${g}`)),f)},t.useHalfFloat=()=>e.enableUseHalfFloat&&e.canUseHalfFloat,t.setInternalFormat=u=>{e._forceInternalFormat=!0,u!==e.internalFormat&&(e.internalFormat=u,t.modified())},t.getFormat=(u,g)=>(e.format=t.getDefaultFormat(u,g),e.format),t.getDefaultFormat=(u,g)=>{if(e._openGLRenderWindow.getWebgl2())switch(g){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(g){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=()=>{e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=u=>{const g=t.useHalfFloat();if(e._openGLRenderWindow.getWebgl2())switch(u){case P.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(n()&&!g&&P.SHORT):return e.context.SHORT;case(n()&&!g&&P.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(g&&P.SHORT):return e.context.HALF_FLOAT;case(g&&P.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case P.FLOAT:case P.VOID:default:return e.context.FLOAT}switch(u){case P.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case P.FLOAT:case P.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{const f=e.context.getExtension("OES_texture_half_float");if(f&&e.context.getExtension("OES_texture_half_float_linear"))return f.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||g)&&(e.openGLDataType=t.getDefaultDataType(u)),e.openGLDataType},t.getShiftAndScale=()=>{let u=0,g=1;switch(e.openGLDataType){case e.context.BYTE:g=127.5,u=g-128;break;case e.context.UNSIGNED_BYTE:g=255,u=0;break;case e.context.SHORT:g=32767.5,u=g-32768;break;case e.context.UNSIGNED_SHORT:g=65536,u=0;break;case e.context.INT:g=21474836475e-1,u=g-2147483648;break;case e.context.UNSIGNED_INT:g=4294967295,u=0;break;case e.context.FLOAT:}return{shift:u,scale:g}},t.getOpenGLFilterMode=u=>{switch(u){case fe.NEAREST:return e.context.NEAREST;case fe.LINEAR:return e.context.LINEAR;case fe.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case fe.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case fe.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case fe.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=u=>{switch(u){case rt.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case rt.REPEAT:return e.context.REPEAT;case rt.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}},t.updateArrayDataTypeForGL=function(u,g){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const l=[];let p=e.width*e.height*e.components;if(f&&(p*=e.depth),u!==P.FLOAT&&e.openGLDataType===e.context.FLOAT)for(let h=0;h<g.length;h++)if(g[h]){const v=g[h].length>p?g[h].subarray(0,p):g[h];l.push(new Float32Array(v))}else l.push(null);if(u!==P.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(let h=0;h<g.length;h++)if(g[h]){const v=g[h].length>p?g[h].subarray(0,p):g[h];l.push(new Uint8Array(v))}else l.push(null);let y=!1;if(e._openGLRenderWindow.getWebgl2())y=e.openGLDataType===e.context.HALF_FLOAT;else{const h=e.context.getExtension("OES_texture_half_float");y=h&&e.openGLDataType===h.HALF_FLOAT_OES}if(y)for(let h=0;h<g.length;h++)if(g[h]){const v=new Uint16Array(p),x=g[h];for(let S=0;S<p;S++)v[S]=cT(x[S]);l.push(v)}else l.push(null);if(l.length===0)for(let h=0;h<g.length;h++)l.push(g[h]);return l};function r(u){if(e._openGLRenderWindow.getWebgl2())return u;const g=[],f=e.width,l=e.height,p=e.components;if(u&&(!Qn(f)||!Qn(l))){const y=e.context.getExtension("OES_texture_half_float"),h=be(f),v=be(l),x=h*v*e.components;for(let S=0;S<u.length;S++)if(u[S]!==null){let d=null;const T=l/v,w=f/h;let C=!1;e.openGLDataType===e.context.FLOAT?d=new Float32Array(x):y&&e.openGLDataType===y.HALF_FLOAT_OES?(d=new Uint16Array(x),C=!0):d=new Uint8Array(x);for(let O=0;O<v;O++){const R=O*h*p,L=O*T;let D=Math.floor(L),M=Math.ceil(L);M>=l&&(M=l-1);const V=L-D,B=1-V;D=D*f*p,M=M*f*p;for(let _=0;_<h;_++){const k=_*p,G=_*w;let b=Math.floor(G),I=Math.ceil(G);I>=f&&(I=f-1);const m=G-b;b*=p,I*=p;for(let U=0;U<p;U++)C?d[R+k+U]=ze.toHalf(ze.fromHalf(u[S][D+b+U])*B*(1-m)+ze.fromHalf(u[S][D+I+U])*B*m+ze.fromHalf(u[S][M+b+U])*V*(1-m)+ze.fromHalf(u[S][M+I+U])*V*m):d[R+k+U]=u[S][D+b+U]*B*(1-m)+u[S][D+I+U]*B*m+u[S][M+b+U]*V*(1-m)+u[S][M+I+U]*V*m}}g.push(d),e.width=h,e.height=v}else g.push(null)}if(g.length===0)for(let y=0;y<u.length;y++)g.push(u[y]);return g}function a(u){var g;return e._openGLRenderWindow?e.resizable||(g=e.renderable)!=null&&g.getResizable()?!1:e._openGLRenderWindow.getWebgl2()?!(e._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&n()&&(u===P.UNSIGNED_SHORT||u===P.SHORT)):!1:!1}t.create2DFromRaw=function(u,g,f,l,p){let y=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(t.getOpenGLDataType(l,!0),t.getInternalFormat(l,f),t.getFormat(l,f),!e.internalFormat||!e.format||!e.openGLDataType)return Pt("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=f,e.width=u,e.height=g,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const h=[p],v=t.updateArrayDataTypeForGL(l,h),x=r(v);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,y),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),a(l)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),x[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,x[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,x[0]),e.generateMipmap&&e.context.generateMipmap(e.target),y&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*f*e._openGLRenderWindow.getDefaultTextureByteSize(l,n(),t.useHalfFloat()),t.deactivate(),!0},t.createCubeFromRaw=(u,g,f,l,p)=>{if(t.getOpenGLDataType(l),t.getInternalFormat(l,f),t.getFormat(l,f),!e.internalFormat||!e.format||!e.openGLDataType)return Pt("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=f,e.width=u,e.height=g,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=p.length/6-1,t.createTexture(),t.bind();const y=t.updateArrayDataTypeForGL(l,p),h=r(y),v=[];let x=e.width,S=e.height;for(let d=0;d<h.length;d++){d%6===0&&d!==0&&(x/=2,S/=2),v[d]=pn(l,S*x*e.components);for(let T=0;T<S;++T){const w=T*x*e.components,C=(S-T-1)*x*e.components;v[d].set(h[d].slice(C,C+x*e.components),w)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),a(l)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(let d=0;d<6;d++){let T=0,w=e.width,C=e.height;for(;w>=1&&C>=1;){let O=null;T<=e.maxLevel&&(O=v[6*T+d]),a(l)?O!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+d,T,0,0,w,C,e.format,e.openGLDataType,O):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+d,T,e.internalFormat,w,C,0,e.format,e.openGLDataType,O),T++,w/=2,C/=2}}return e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*f*e._openGLRenderWindow.getDefaultTextureByteSize(l,n(),t.useHalfFloat()),t.deactivate(),!0},t.createDepthFromRaw=(u,g,f,l)=>(t.getOpenGLDataType(f),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?f===P.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?(Pt("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=u,e.height=g,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),a(f)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),l!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,l)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,l),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(f,n(),t.useHalfFloat()),t.deactivate(),!0)),t.create2DFromImage=u=>{if(t.getOpenGLDataType(P.UNSIGNED_CHAR),t.getInternalFormat(P.UNSIGNED_CHAR,4),t.getFormat(P.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return Pt("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1);const g=!e._openGLRenderWindow.getWebgl2()&&(!Qn(u.width)||!Qn(u.height)),f=document.createElement("canvas");f.width=g?be(u.width):u.width,f.height=g?be(u.height):u.height,e.width=f.width,e.height=f.height;const l=f.getContext("2d");l.translate(0,f.height),l.scale(1,-1),l.drawImage(u,0,0,u.width,u.height,0,0,f.width,f.height);const p=f;return a(P.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),p!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,p)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,p),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(P.UNSIGNED_CHAR,n(),t.useHalfFloat()),t.deactivate(),!0};function s(u,g,f){const l=new Array(f),p=new Array(f);for(let y=0;y<f;++y)l[y]=u[y],p[y]=g[y]-u[y]||1;return{scale:p,offset:l}}function i(u,g){for(let f=0;f<u.length;f++){const l=u[f],p=g[f]+l;if(l<-2048||l>2048||p<-2048||p>2048)return!1}return!0}function o(u,g,f,l){t.getOpenGLDataType(u);const p=i(g,f)||l;let y=!1;if(e._openGLRenderWindow.getWebgl2())y=e.openGLDataType===e.context.FLOAT&&e.context.getExtension("OES_texture_float_linear")===null&&p||e.openGLDataType===e.context.HALF_FLOAT;else{const h=e.context.getExtension("OES_texture_half_float");y=h&&e.openGLDataType===h.HALF_FLOAT_OES}e.canUseHalfFloat=y&&p}function c(u,g){const f=u.getNumberOfComponents(),l=u.getDataType(),p=u.getData(),y=new Array(f),h=new Array(f);for(let x=0;x<f;++x){const[S,d]=u.getRange(x);y[x]=S,h[x]=d}const v=s(y,h,f);return o(l,v.offset,v.scale,g),t.useHalfFloat()||t.getOpenGLDataType(l,!0),{numComps:f,dataType:l,data:p,scaleOffsets:v}}t.create2DFilterableFromRaw=function(u,g,f,l,p){let y=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;return t.create2DFilterableFromDataArray(u,g,Y.newInstance({numberOfComponents:f,dataType:l,values:p}),y)},t.create2DFilterableFromDataArray=function(u,g,f){let l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const{numComps:p,dataType:y,data:h}=c(f,l);t.create2DFromRaw(u,g,p,y,h)},t.updateVolumeInfoForGL=(u,g)=>{var p,y;let f=!1;const l=t.useHalfFloat();(!((p=e.volumeInfo)!=null&&p.scale)||!((y=e.volumeInfo)!=null&&y.offset))&&(e.volumeInfo={scale:new Array(g),offset:new Array(g)});for(let h=0;h<g;++h)e.volumeInfo.scale[h]=1,e.volumeInfo.offset[h]=0;if(n()&&!l&&u===P.SHORT){for(let h=0;h<g;++h)e.volumeInfo.scale[h]=32767;f=!0}if(n()&&!l&&u===P.UNSIGNED_SHORT){for(let h=0;h<g;++h)e.volumeInfo.scale[h]=65535;f=!0}if(u===P.UNSIGNED_CHAR){for(let h=0;h<g;++h)e.volumeInfo.scale[h]=255;f=!0}return(u===P.FLOAT||l&&(u===P.SHORT||u===P.UNSIGNED_SHORT))&&(f=!0),f},t.create3DFromRaw=(u,g,f,l,p,y)=>{let h=p,v=y;if(!t.updateVolumeInfoForGL(h,l)&&v){const w=u*g*f,C=structuredClone(e.volumeInfo),O=new Float32Array(w*l);e.volumeInfo.offset=C.offset,e.volumeInfo.scale=C.scale;let R=0;const L=C.scale.map(D=>1/D);for(let D=0;D<w;D++)for(let M=0;M<l;M++)O[R]=(v[R]-C.offset[M])*L[M],R++;h=P.FLOAT,v=O}if(t.getOpenGLDataType(h),t.getInternalFormat(h,l),t.getFormat(h,l),!e.internalFormat||!e.format||!e.openGLDataType)return Pt("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=l,e.width=u,e.height=g,e.depth=f,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const x=[v],d=t.updateArrayDataTypeForGL(h,x,!0),T=r(d);return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),a(h)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),T[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,T[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,T[0]),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(h,n(),t.useHalfFloat()),t.deactivate(),!0},t.create3DFilterableFromRaw=function(u,g,f,l,p,y){let h=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1;return t.create3DFilterableFromDataArray(u,g,f,Y.newInstance({numberOfComponents:l,dataType:p,values:y}),h)},t.create3DFilterableFromDataArray=function(u,g,f,l){let p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{numComps:y,dataType:h,data:v,scaleOffsets:x}=c(l,p),S=[],d=[];for(let U=0;U<y;++U)S[U]=0,d[U]=1;if(e.volumeInfo={scale:d,offset:S,dataComputedScale:x.scale,dataComputedOffset:x.offset,width:u,height:g,depth:f},e._openGLRenderWindow.getWebgl2())return t.create3DFromRaw(u,g,f,y,h,v);const T=u*g*f,w=structuredClone(x);let C=(U,$,W,N,He)=>{U[$]=W},O=P.UNSIGNED_CHAR;if(h===P.UNSIGNED_CHAR)for(let U=0;U<y;++U)w.offset[U]=0,w.scale[U]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(O=P.FLOAT,C=(U,$,W,N,He)=>{U[$]=(W-N)/He}):(O=P.UNSIGNED_CHAR,C=(U,$,W,N,He)=>{U[$]=255*(W-N)/He});if(t.getOpenGLDataType(O),t.getInternalFormat(O,y),t.getFormat(O,y),!e.internalFormat||!e.format||!e.openGLDataType)return Pt("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=y,e.depth=1,e.numberOfDimensions=2;let R=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);R>4096&&(O===P.FLOAT||y>=3)&&(R=4096);let L=1,D=1;T>R*R&&(L=Math.ceil(Math.sqrt(T/(R*R))),D=L);let M=Math.sqrt(T)/L;M=be(M);const V=Math.floor(M*L/u),B=Math.ceil(f/V),_=be(g*B/D);e.width=M,e.height=_,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=V,e.volumeInfo.yreps=B,e.volumeInfo.xstride=L,e.volumeInfo.ystride=D,e.volumeInfo.offset=w.offset,e.volumeInfo.scale=w.scale;let k;const G=M*_*y;O===P.FLOAT?k=new Float32Array(G):k=new Uint8Array(G);let b=0;const I=Math.floor(u/L),m=Math.floor(g/D);for(let U=0;U<B;U++){const $=Math.min(V,f-U*V),W=y*(e.width-$*Math.floor(u/L));for(let N=0;N<m;N++){for(let He=0;He<$;He++){const ga=y*((U*V+He)*u*g+D*N*u);for(let An=0;An<I;An++)for(let me=0;me<y;me++)C(k,b,v[ga+L*An*y+me],w.offset[me],w.scale[me]),b++}b+=W}}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),a(O)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),k!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,k)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,k),t.deactivate(),!0},t.setOpenGLRenderWindow=u=>{e._openGLRenderWindow!==u&&(t.releaseGraphicsResources(),e._openGLRenderWindow=u,e.context=null,u&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=u=>u&&u.isCurrent()?u.getIntegerv(u.MAX_TEXTURE_SIZE):-1,t.enableUseHalfFloat=u=>{e.enableUseHalfFloat=u}}const uT={_openGLRenderWindow:null,_forceInternalFormat:!1,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:rt.CLAMP_TO_EDGE,wrapT:rt.CLAMP_TO_EDGE,wrapR:rt.CLAMP_TO_EDGE,minificationFilter:fe.NEAREST,magnificationFilter:fe.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0,enableUseHalfFloat:!0,canUseHalfFloat:!1};function ig(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uT,n),ae.extend(t,e,n),e.sendParametersTime={},ye(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},ye(e.textureBuildTime,{mtime:0}),Gn(t,e,["format","openGLDataType"]),le(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),Re(t,e,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),bn(t,e,["openGLRenderWindow"]),fT(t,e)}const og=Z(ig,"vtkOpenGLTexture");var zt={newInstance:og,extend:ig,...ag};Fe("vtkTexture",og);var gT=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`,lT=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// label outline 
//VTK::LabelOutline::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

//VTK::LabelOutlineHelperFunction

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;function pT(t,e){t.replaceShaderCoincidentOffset=(n,r,a)=>{const s=t.getCoincidentParameters(r,a);if(s&&(s.factor!==0||s.offset!==0)){let i=n.Fragment;i=F.substitute(i,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(s.factor!==0?(i=F.substitute(i,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,i=F.substitute(i,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):i=F.substitute(i,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(s.factor!==0?(i=F.substitute(i,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,i=F.substitute(i,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):i=F.substitute(i,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),n.Fragment=i}}}function hT(t,e){t.applyShaderReplacements=(n,r,a)=>{let s=null;if(r&&(s=r.ShaderReplacements),s)for(let i=0;i<s.length;i++){const o=s[i];if(a&&o.replaceFirst||!a&&!o.replaceFirst){const c=o.shaderType,u=n[c],g=F.substitute(u,o.originalValue,o.replacementValue,o.replaceAll);n[c]=g.result}}},t.buildShaders=(n,r,a)=>{t.getReplacedShaderTemplate(n,r,a),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(n);const s=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(n,s,!0),t.replaceShaderValues(n,r,a),t.applyShaderReplacements(n,s)},t.getReplacedShaderTemplate=(n,r,a)=>{const s=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(n,r,a);let i=n.Vertex;if(s){const u=s.VertexShaderCode;u!==void 0&&u!==""&&(i=u)}n.Vertex=i;let o=n.Fragment;if(s){const u=s.FragmentShaderCode;u!==void 0&&u!==""&&(o=u)}n.Fragment=o;let c=n.Geometry;if(s){const u=s.GeometryShaderCode;u!==void 0&&(c=u)}n.Geometry=c}}var Qr={implementReplaceShaderCoincidentOffset:pT,implementBuildShadersWithReplacements:hT};const{FieldAssociations:Aa}=Kt,{primTypes:ue}=yn,{Representation:Xt,Shading:jo}=vn,{ScalarMode:sr}=Ze,{Filter:Ko,Wrap:Po}=zt,{vtkErrorMacro:_t}=Je,vT={type:"StartEvent"},yT={type:"EndEvent"},{CoordinateSystem:dT}=zn;function TT(t){const e=t.getSelector();return e?e.getCurrentPass():we.MIN_KNOWN_PASS-1}function xT(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=r=>{r&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e._openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=(r,a)=>{r&&(e.currentRenderPass=a,t.render())},t.zBufferPass=r=>{r&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.opaquePass=r=>{r&&t.render()},t.render=()=>{const r=e._openGLRenderWindow.getContext();if(e.context!==r){e.context=r;for(let i=ue.Start;i<ue.End;i++)e.primitives[i].setOpenGLRenderWindow(e._openGLRenderWindow)}const a=e.openGLActor.getRenderable(),s=e._openGLRenderer.getRenderable();t.renderPiece(s,a)},t.getShaderTemplate=(r,a,s)=>{r.Vertex=gT,r.Fragment=lT,r.Geometry=""},t.replaceShaderColor=(r,a,s)=>{let i=r.Vertex,o=r.Geometry,c=r.Fragment;const u=e.lastBoundBO.getReferenceByName("lastLightComplexity");let g=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];u&&(g=g.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let f=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];u&&(f=f.concat(["  vec3 specularColor;","  float specularPower;"])),f=f.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),u&&(f=f.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(g=g.concat(["varying vec4 vertexColorVSOutput;"]),i=F.substitute(i,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,i=F.substitute(i,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,o=F.substitute(o,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,o=F.substitute(o,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?c=F.substitute(c,"//VTK::Color::Impl",f.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:(e.renderable.getAreScalarsMappedFromCells()||e.renderable.getInterpolateScalarsBeforeMapping())&&e.renderable.getColorCoordinates()&&!e.drawingEdges?c=F.substitute(c,"//VTK::Color::Impl",f.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(s.getBackfaceProperty()&&!e.drawingEdges&&(g=g.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),u?(g=g.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),f=f.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):f=f.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(g=g.concat(["uniform samplerBuffer texture1;"])),c=F.substitute(c,"//VTK::Color::Impl",f).result),c=F.substitute(c,"//VTK::Color::Dec",g).result,r.Vertex=i,r.Geometry=o,r.Fragment=c},t.replaceShaderLight=(r,a,s)=>{let i=r.Fragment;const o="",c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),u=e.lastBoundBO.getReferenceByName("lastLightCount");let g=[];switch(c){case 0:i=F.substitute(i,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:i=F.substitute(i,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(let f=0;f<u;++f)g=g.concat([`uniform vec3 lightColor${f};`,`uniform vec3 lightDirectionVC${f}; // normalized`,`uniform vec3 lightHalfAngleVC${f}; // normalized`]);i=F.substitute(i,"//VTK::Light::Dec",g).result,g=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(let f=0;f<u;++f)g=g.concat([`  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC${f}));`,`  diffuseL += ((df${o}) * lightColor${f});`,`  if (dot(normalVCVSOutput, lightDirectionVC${f}) < 0.0)`,"    {",`    float sf = sign(df)*pow(max(1e-5,
                                              dot(reflect(lightDirectionVC${f},normalVCVSOutput),
                                                  normalize(-vertexVC.xyz))),
                                         specularPower);`,`    specularL += (sf${o} * lightColor${f});`,"    }"]);g=g.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),i=F.substitute(i,"//VTK::Light::Impl",g,!1).result;break;case 3:for(let f=0;f<u;++f)g=g.concat([`uniform vec3 lightColor${f};`,`uniform vec3 lightDirectionVC${f}; // normalized`,`uniform vec3 lightHalfAngleVC${f}; // normalized`,`uniform vec3 lightPositionVC${f};`,`uniform vec3 lightAttenuation${f};`,`uniform float lightConeAngle${f};`,`uniform float lightExponent${f};`,`uniform int lightPositional${f};`]);i=F.substitute(i,"//VTK::Light::Dec",g).result,g=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(let f=0;f<u;++f)g=g.concat(["  attenuation = 1.0;",`  if (lightPositional${f} == 0)`,"    {",`      vertLightDirectionVC = lightDirectionVC${f};`,"    }","  else","    {",`    vertLightDirectionVC = vertexVC.xyz - lightPositionVC${f};`,"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /",`      (lightAttenuation${f}.x`,`       + lightAttenuation${f}.y * distanceVC`,`       + lightAttenuation${f}.z * distanceVC * distanceVC);`,"    // per OpenGL standard cone angle is 90 or less for a spot light",`    if (lightConeAngle${f} <= 90.0)`,"      {",`      float coneDot = dot(vertLightDirectionVC, lightDirectionVC${f});`,"      // if inside the cone",`      if (coneDot >= cos(radians(lightConeAngle${f})))`,"        {",`        attenuation = attenuation * pow(coneDot, lightExponent${f});`,"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));",`    diffuseL += ((df${o}) * lightColor${f});`,"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {",`      float sf = sign(df)*attenuation*pow(max(1e-5,
                                                           dot(reflect(lightDirectionVC${f},
                                                                       normalVCVSOutput),
                                                               normalize(-vertexVC.xyz))),
                                                       specularPower);`,`    specularL += ((sf${o}) * lightColor${f});`,"    }"]);g=g.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),i=F.substitute(i,"//VTK::Light::Impl",g,!1).result;break;default:_t("bad light complexity")}r.Fragment=i},t.replaceShaderNormal=(r,a,s)=>{if(e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let o=r.Vertex,c=r.Geometry,u=r.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(o=F.substitute(o,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,o=F.substitute(o,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,c=F.substitute(c,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,c=F.substitute(c,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,u=F.substitute(u,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,u=F.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(u=F.substitute(u,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,u=F.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(s.getProperty().getRepresentation())===e.context.LINES?(u=F.substitute(u,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,u=F.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(u=F.substitute(u,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,u=F.substitute(u,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,u=F.substitute(u,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),r.Vertex=o,r.Geometry=c,r.Fragment=u}},t.replaceShaderPositionVC=(r,a,s)=>{e.lastBoundBO.replaceShaderPositionVC(r,a,s);let i=r.Vertex,o=r.Geometry,c=r.Fragment;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(i=F.substitute(i,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,i=F.substitute(i,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,i=F.substitute(i,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,o=F.substitute(o,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,o=F.substitute(o,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,c=F.substitute(c,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,c=F.substitute(c,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(i=F.substitute(i,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,i=F.substitute(i,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),r.Vertex=i,r.Geometry=o,r.Fragment=c},t.replaceShaderTCoord=(r,a,s)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let i=r.Vertex,o=r.Geometry,c=r.Fragment;if(e.drawingEdges)return;i=F.substitute(i,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;const u=e.openGLActor.getActiveTextures();let g=2,f=2;if(u&&u.length>0&&(g=u[0].getComponents(),u[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(f=3)),e.renderable.getColorTextureMap()&&(g=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),f=2),f===2){if(i=F.substitute(i,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,o=F.substitute(o,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,o=F.substitute(o,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=F.substitute(c,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,u&&u.length>=1)switch(g){case 1:c=F.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=F.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=F.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(i=F.substitute(i,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,o=F.substitute(o,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,o=F.substitute(o,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=F.substitute(c,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,g){case 1:c=F.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=F.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=F.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}r.Vertex=i,r.Geometry=o,r.Fragment=c}},t.replaceShaderClip=(r,a,s)=>{let i=r.Vertex,o=r.Fragment;if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes();i=F.substitute(i,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${c}];`,`varying float clipDistancesVSOutput[${c}];`]).result,i=F.substitute(i,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=F.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${c}];`]).result,o=F.substitute(o,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}r.Vertex=i,r.Fragment=o},t.getCoincidentParameters=(r,a)=>{let s={factor:0,offset:0};const i=a.getProperty();if(e.renderable.getResolveCoincidentTopology()==Ot.PolygonOffset||i.getEdgeVisibility()&&i.getRepresentation()===Xt.SURFACE){const c=e.lastBoundBO.getPrimitiveType();c===ue.Points||i.getRepresentation()===Xt.POINTS?s=e.renderable.getCoincidentTopologyPointOffsetParameter():c===ue.Lines||i.getRepresentation()===Xt.WIREFRAME?s=e.renderable.getCoincidentTopologyLineOffsetParameters():(c===ue.Tris||c===ue.TriStrips)&&(s=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(c===ue.TrisEdges||c===ue.TriStripsEdges)&&(s=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),s.factor/=2,s.offset/=2)}const o=e._openGLRenderer.getSelector();return o&&o.getFieldAssociation()===Aa.FIELD_ASSOCIATION_POINTS&&(s.offset-=2),s},t.replaceShaderPicking=(r,a,s)=>{let i=r.Fragment,o=r.Vertex;if(i=F.substitute(i,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e._openGLRenderer.getSelector()){switch((e.lastSelectionState===we.ID_LOW24||e.lastSelectionState===we.ID_HIGH24)&&(o=F.substitute(o,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,o=F.substitute(o,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,i=F.substitute(i,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,i=F.substitute(i,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case we.ID_LOW24:i=F.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case we.ID_HIGH24:i=F.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float((idx/16777216)%256)/255.0, 0.0, 0.0, 1.0);").result;break;default:i=F.substitute(i,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,i=F.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}r.Fragment=i,r.Vertex=o}},t.replaceShaderValues=(r,a,s)=>{if(t.replaceShaderColor(r,a,s),t.replaceShaderNormal(r,a,s),t.replaceShaderLight(r,a,s),t.replaceShaderTCoord(r,a,s),t.replaceShaderPicking(r,a,s),t.replaceShaderClip(r,a,s),t.replaceShaderCoincidentOffset(r,a,s),t.replaceShaderPositionVC(r,a,s),e.haveSeenDepthRequest){let i=r.Fragment;i=F.substitute(i,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,i=F.substitute(i,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,r.Fragment=i}},t.getNeedToRebuildShaders=(r,a,s)=>{let i=0,o=0;const c=r.getPrimitiveType(),u=e.currentInput;let g=!1;const f=u.getPointData().getNormals(),l=u.getCellData().getNormals(),p=s.getProperty().getInterpolation()===jo.FLAT,y=s.getProperty().getRepresentation(),h=r.getOpenGLMode(y,c);if((h===e.context.TRIANGLES||l&&!f||!p&&f||!p&&h===e.context.LINES)&&(g=!0),s.getProperty().getLighting()&&g){i=0;const d=a.getLightsByReference();for(let T=0;T<d.length;++T){const w=d[T];w.getSwitch()>0&&(o++,i===0&&(i=1)),i===1&&(o>1||w.getIntensity()!==1||!w.lightTypeIsHeadLight())&&(i=2),i<3&&w.getPositional()&&(i=3)}}let v=!1;const x=e.lastBoundBO.getReferenceByName("lastLightComplexity"),S=e.lastBoundBO.getReferenceByName("lastLightCount");return(x!==i||S!==o)&&(e.lastBoundBO.set({lastLightComplexity:i},!0),e.lastBoundBO.set({lastLightCount:o},!0),v=!0),(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(v=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||r.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||v?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=(r,a,s)=>{const i=e.renderable.getViewSpecificProperties().ShadersCallbacks;i&&i.forEach(o=>{o.callback(o.userData,r,a,s)})},t.setMapperShaderParameters=(r,a,s)=>{if(r.getProgram().isUniformUsed("PrimitiveIDOffset")&&r.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),r.getProgram().isUniformUsed("VertexIDOffset")&&r.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){const c=e.lastBoundBO.getReferenceByName("lastLightComplexity");r.getProgram().isAttributeUsed("vertexMC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexMC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||_t("Error setting vertexMC in shader VAO.")),r.getProgram().isAttributeUsed("normalMC")&&r.getCABO().getNormalOffset()&&c>0?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"normalMC",r.getCABO().getNormalOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||_t("Error setting normalMC in shader VAO."):r.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach((u,g)=>{r.getProgram().isAttributeUsed(`${u}MC`)&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),`${u}MC`,r.getCABO().getCustomData()[g].offset,r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getCustomData()[g].components,!1)||_t(`Error setting ${u}MC in shader VAO.`))}),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),!1)||_t("Error setting tcoordMC in shader VAO."):r.getVAO().removeAttributeArray("tcoordMC"),r.getProgram().isAttributeUsed("scalarColor")&&r.getCABO().getColorComponents()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO().getColorBO(),"scalarColor",r.getCABO().getColorOffset(),r.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||_t("Error setting scalarColor in shader VAO."):r.getVAO().removeAttributeArray("scalarColor"),r.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes(),u=[],f=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,l=f?de(e.tmpMat4,s.getMatrix()):s.getMatrix();f&&(te(l,l),ge(l,l,f),te(l,l));for(let p=0;p<c;p++){const y=[];e.renderable.getClippingPlaneInDataCoords(l,p,y);for(let h=0;h<4;h++)u.push(y[h])}r.getProgram().setUniformi("numClipPlanes",c),r.getProgram().setUniform4fv("clipPlanes",u)}e.internalColorTexture&&r.getProgram().isUniformUsed("texture1")&&r.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const i=e.openGLActor.getActiveTextures();if(i)for(let c=0;c<i.length;++c){const g=i[c].getTextureUnit(),f=`texture${g+1}`;r.getProgram().isUniformUsed(f)&&r.getProgram().setUniformi(f,g)}if(e.haveSeenDepthRequest&&r.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),r.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(a,s);r.getProgram().setUniformf("coffset",c.offset),r.getProgram().isUniformUsed("cfactor")&&r.getProgram().setUniformf("cfactor",c.factor)}r.setMapperShaderParameters(a,s,e._openGLRenderer.getTiledSizeAndOrigin());const o=e._openGLRenderer.getSelector();r.getProgram().setUniform3fArray("mapperIndex",o?o.getPropColorValue():[0,0,0]),r.getProgram().setUniformi("picking",o?o.getCurrentPass()+1:0)},t.setLightingShaderParameters=(r,a,s)=>{const i=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(i<2)return;const o=r.getProgram();let c=0;const u=a.getLightsByReference();for(let l=0;l<u.length;++l){const p=u[l];if(p.getSwitch()>0){const h=p.getColorByReference(),v=p.getIntensity();e.lightColor[0]=h[0]*v,e.lightColor[1]=h[1]*v,e.lightColor[2]=h[2]*v;const x=p.getDirection(),S=a.getActiveCamera().getViewMatrix(),d=[...x];p.lightTypeIsSceneLight()&&(d[0]=S[0]*x[0]+S[1]*x[1]+S[2]*x[2],d[1]=S[4]*x[0]+S[5]*x[1]+S[6]*x[2],d[2]=S[8]*x[0]+S[9]*x[1]+S[10]*x[2],Nn(d)),e.lightDirection[0]=d[0],e.lightDirection[1]=d[1],e.lightDirection[2]=d[2],Nn(e.lightDirection),o.setUniform3fArray(`lightColor${c}`,e.lightColor),o.setUniform3fArray(`lightDirectionVC${c}`,e.lightDirection),c++}}if(i<3)return;const f=a.getActiveCamera().getViewMatrix();te(f,f),c=0;for(let l=0;l<u.length;++l){const p=u[l];if(p.getSwitch()>0){const h=p.getTransformedPosition(),v=new Float64Array(3);q(v,h,f),o.setUniform3fArray(`lightAttenuation${c}`,p.getAttenuationValuesByReference()),o.setUniformi(`lightPositional${c}`,p.getPositional()),o.setUniformf(`lightExponent${c}`,p.getExponent()),o.setUniformf(`lightConeAngle${c}`,p.getConeAngle()),o.setUniform3fArray(`lightPositionVC${c}`,[v[0],v[1],v[2]]),c++}}};function n(r,a,s){return a.identity(s),r.reduce((i,o,c)=>c===0?o?a.copy(i,o):a.identity(i):o?a.multiply(i,i,o):i,s)}t.setCameraShaderParameters=(r,a,s)=>{const i=r.getProgram(),o=e.openGLCamera.getKeyMatrices(a),c=a.getActiveCamera(),u=e.openGLCamera.getKeyMatrixTime().getMTime(),g=i.getLastCameraMTime(),l=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,p=s.getIsIdentity(),y=p?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();if(s.getCoordinateSystem()===dT.DISPLAY){const h=e._openGLRenderer.getTiledSizeAndOrigin();A(e.tmpMat4),e.tmpMat4[0]=2/h.usize,e.tmpMat4[12]=-1,e.tmpMat4[5]=2/h.vsize,e.tmpMat4[13]=-1,ge(e.tmpMat4,e.tmpMat4,l),i.setUniformMatrix("MCPCMatrix",e.tmpMat4)}else i.setUniformMatrix("MCPCMatrix",n([o.wcpc,y.mcwc,l],gs,e.tmpMat4));i.isUniformUsed("MCVCMatrix")&&i.setUniformMatrix("MCVCMatrix",n([o.wcvc,y.mcwc,l],gs,e.tmpMat4)),i.isUniformUsed("normalMatrix")&&i.setUniformMatrix3x3("normalMatrix",n([o.normalMatrix,y.normalMatrix],x0,e.tmpMat3)),g!==u&&(i.isUniformUsed("cameraParallel")&&i.setUniformi("cameraParallel",c.getParallelProjection()),i.setLastCameraMTime(u)),p||i.setLastCameraMTime(0)},t.setPropertyShaderParameters=(r,a,s)=>{const i=r.getProgram();let o=s.getProperty(),c=o.getOpacity(),u=e.drawingEdges?o.getEdgeColorByReference():o.getAmbientColorByReference(),g=e.drawingEdges?o.getEdgeColorByReference():o.getDiffuseColorByReference(),f=e.drawingEdges?1:o.getAmbient(),l=e.drawingEdges?0:o.getDiffuse(),p=e.drawingEdges?0:o.getSpecular();const y=o.getSpecularPower();i.setUniformf("opacityUniform",c),i.setUniform3fArray("ambientColorUniform",u),i.setUniform3fArray("diffuseColorUniform",g),i.setUniformf("ambient",f),i.setUniformf("diffuse",l);const h=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(h<1)return;let v=o.getSpecularColorByReference();if(i.setUniform3fArray("specularColorUniform",v),i.setUniformf("specularPowerUniform",y),i.setUniformf("specular",p),i.isUniformUsed("ambientIntensityBF")){if(o=s.getBackfaceProperty(),c=o.getOpacity(),u=o.getAmbientColor(),f=o.getAmbient(),g=o.getDiffuseColor(),l=o.getDiffuse(),v=o.getSpecularColor(),p=o.getSpecular(),i.setUniformf("ambientIntensityBF",f),i.setUniformf("diffuseIntensityBF",l),i.setUniformf("opacityUniformBF",c),i.setUniform3fArray("ambientColorUniformBF",u),i.setUniform3fArray("diffuseColorUniformBF",g),h<1)return;i.setUniformf("specularIntensityBF",p),i.setUniform3fArray("specularColorUniformBF",v),i.setUniformf("specularPowerUniformBF",y)}},t.updateMaximumPointCellIds=(r,a)=>{var o,c,u,g;const s=e._openGLRenderer.getSelector();if(!s)return;if((c=(o=e.selectionWebGLIdsToVTKIds)==null?void 0:o.points)!=null&&c.length){const f=e.selectionWebGLIdsToVTKIds.points.length;s.setMaximumPointId(f-1)}if((g=(u=e.selectionWebGLIdsToVTKIds)==null?void 0:u.cells)!=null&&g.length){const f=e.selectionWebGLIdsToVTKIds.cells.length;s.setMaximumCellId(f-1)}s.getFieldAssociation()===Aa.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)},t.renderPieceStart=(r,a)=>{e.primitiveIDOffset=0,e.vertexIDOffset=0;const s=TT(e._openGLRenderer);if(e.lastSelectionState!==s&&(e.selectionStateChanged.modified(),e.lastSelectionState=s),e._openGLRenderer.getSelector())switch(s){default:e._openGLRenderer.getSelector().renderProp(a)}t.updateBufferObjects(r,a),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=(r,a)=>{const s=a.getProperty().getRepresentation(),i=a.getProperty().getEdgeVisibility()&&s===Xt.SURFACE,o=e._openGLRenderer.getSelector(),c=o&&o.getFieldAssociation()===Aa.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===we.ID_LOW24||e.lastSelectionState===we.ID_HIGH24);for(let u=ue.Start;u<ue.End;u++)e.primitives[u].setPointPicking(c),e.primitives[u].getCABO().getElementCount()&&(e.drawingEdges=i&&(u===ue.TrisEdges||u===ue.TriStripsEdges),(!e.drawingEdges||!(e.renderDepth||e.lastSelectionState>=0))&&(e.lastBoundBO=e.primitives[u],e.primitiveIDOffset+=e.primitives[u].drawArrays(r,a,s,t),e.vertexIDOffset+=e.primitives[u].getCABO().getElementCount()))},t.renderPieceFinish=(r,a)=>{e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=(r,a)=>{if(t.invokeEvent(vT),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(yT),!e.currentInput){_t("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const s=e.context,i=a.getProperty().getBackfaceCulling(),o=a.getProperty().getFrontfaceCulling();!i&&!o?e._openGLRenderWindow.disableCullFace():o?(e._openGLRenderWindow.enableCullFace(),s.cullFace(s.FRONT)):(e._openGLRenderWindow.enableCullFace(),s.cullFace(s.BACK)),t.renderPieceStart(r,a),t.renderPieceDraw(r,a),t.renderPieceFinish(r,a)},t.computeBounds=(r,a)=>{if(!t.getInput()){ei(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(r,a)=>{t.getNeedToRebuildBufferObjects(r,a)&&t.buildBufferObjects(r,a),t.updateMaximumPointCellIds()},t.getNeedToRebuildBufferObjects=(r,a)=>{const s=e.VBOBuildTime.getMTime();return s<t.getMTime()||s<e.renderable.getMTime()||s<a.getMTime()||s<e.currentInput.getMTime()},t.buildBufferObjects=(r,a)=>{const s=e.currentInput;if(s===null)return;e.renderable.mapScalars(s,1);const i=e.renderable.getColorMapColors();e.haveCellScalars=!1;const o=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(o===sr.USE_CELL_DATA||o===sr.USE_CELL_FIELD_DATA||o===sr.USE_FIELD_DATA||!s.getPointData().getScalars())&&o!==sr.USE_POINT_FIELD_DATA&&i&&(e.haveCellScalars=!0);let c=a.getProperty().getInterpolation()!==jo.FLAT?s.getPointData().getNormals():null;c===null&&s.getCellData().getNormals()&&(e.haveCellNormals=!0,c=s.getCellData().getNormals());const u=a.getProperty().getRepresentation();let g=s.getPointData().getTCoords();e.openGLActor.getActiveTextures()||(g=null);let f=!1;if(e.renderable.getColorCoordinates()){g=e.renderable.getColorCoordinates(),f=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=zt.newInstance({resizable:!0}));const p=e.internalColorTexture;p.setMinificationFilter(Ko.NEAREST),p.setMagnificationFilter(Ko.NEAREST),p.setWrapS(Po.CLAMP_TO_EDGE),p.setWrapT(Po.CLAMP_TO_EDGE),p.setOpenGLRenderWindow(e._openGLRenderWindow);const y=e.renderable.getColorTextureMap(),h=y.getExtent(),v=y.getPointData().getScalars();p.create2DFromRaw(h[1]-h[0]+1,h[3]-h[2]+1,v.getNumberOfComponents(),v.getDataType(),v.getData()),p.activate(),p.sendParameters(),p.deactivate()}const l=`${s.getMTime()}A${u}B${s.getMTime()}C${c?c.getMTime():1}D${i?i.getMTime():1}E${a.getProperty().getEdgeVisibility()}F${g?g.getMTime():1}`;if(e.VBOBuildString!==l){const y={points:s.getPoints(),normals:c,tcoords:g,colors:i,cellOffset:0,vertexOffset:0,useTCoordsPerCell:f,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(x=>s.getPointData().getArrayByName(x))};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});const h=[{inRep:"verts",cells:s.getVerts()},{inRep:"lines",cells:s.getLines()},{inRep:"polys",cells:s.getPolys()},{inRep:"strips",cells:s.getStrips()},{inRep:"polys",cells:s.getPolys()},{inRep:"strips",cells:s.getStrips()}],v=a.getProperty().getEdgeVisibility()&&u===Xt.SURFACE;for(let x=ue.Start;x<ue.End;x++)x!==ue.TrisEdges&&x!==ue.TriStripsEdges?(y.cellOffset+=e.primitives[x].getCABO().createVBO(h[x].cells,h[x].inRep,u,y,e.selectionWebGLIdsToVTKIds),y.vertexOffset+=e.primitives[x].getCABO().getElementCount()):v?e.primitives[x].getCABO().createVBO(h[x].cells,h[x].inRep,Xt.WIREFRAME,{...y,tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1}):e.primitives[x].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),e.VBOBuildString=l}e.VBOBuildTime.modified()},t.getAllocatedGPUMemoryInBytes=()=>{let r=0;return e.primitives.forEach(a=>{r+=a.getAllocatedGPUMemoryInBytes()}),r}}const ST={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:we.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function CT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ST,n),ae.extend(t,e,n),Qr.implementReplaceShaderCoincidentOffset(t,e,n),Qr.implementBuildShadersWithReplacements(t,e,n),e.primitives=[],e.primTypes=ue,e.tmpMat3=jt(new Float64Array(9)),e.tmpMat4=A(new Float64Array(16));for(let r=ue.Start;r<ue.End;r++)e.primitives[r]=yn.newInstance(),e.primitives[r].setPrimitiveType(r),e.primitives[r].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);le(t,e,["context"]),e.VBOBuildTime={},ye(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},ye(e.selectionStateChanged,{mtime:0}),xT(t,e)}const wT=Z(CT,"vtkOpenGLPolyDataMapper");Fe("vtkMapper",wT);const{ColorMode:ET,ScalarMode:Bt,GetArray:ja}=ia;function OT(t,e){e.classHierarchy.push("vtkMapper2D"),t.createDefaultLookupTable=()=>{e.lookupTable=Pr.newInstance()},t.getColorModeAsString=()=>E.enumToString(ET,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>E.enumToString(Bt,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(n,r,a,s,i)=>{if(!n||!e.scalarVisibility)return{scalars:null,cellFLag:!1};let o=null,c=!1;if(r===Bt.DEFAULT)o=n.getPointData().getScalars(),o||(o=n.getCellData().getScalars(),c=!0);else if(r===Bt.USE_POINT_DATA)o=n.getPointData().getScalars();else if(r===Bt.USE_CELL_DATA)o=n.getCellData().getScalars(),c=!0;else if(r===Bt.USE_POINT_FIELD_DATA){const u=n.getPointData();a===ja.BY_ID?o=u.getArrayByIndex(s):o=u.getArrayByName(i)}else if(r===Bt.USE_CELL_FIELD_DATA){const u=n.getCellData();c=!0,a===ja.BY_ID?o=u.getArrayByIndex(s):o=u.getArrayByName(i)}else if(r===Bt.USE_FIELD_DATA){const u=n.getFieldData();a===ja.BY_ID?o=u.getArrayByIndex(s):o=u.getArrayByName(i)}return{scalars:o,cellFlag:c}},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let n=e.mtime;if(e.lookupTable!==null){const r=e.lookupTable.getMTime();n=r>n?r:n}return n},t.mapScalars=(n,r)=>{const a=t.getAbstractScalars(n,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!a){e.colorMapColors=null;return}const s=`${t.getMTime()}${a.getMTime()}${r}`;if(e.colorBuildString===s)return;e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]);const i=t.getLookupTable();i&&(i.build(),e.colorMapColors=i.mapScalars(a,e.colorMode,e.fieldDataTupleId)),e.colorBuildString=`${t.getMTime()}${a.getMTime()}${r}`},t.getPrimitiveCount=()=>{const n=t.getInputData();return{points:n.getPoints().getNumberOfValues()/3,verts:n.getVerts().getNumberOfValues()-n.getVerts().getNumberOfCells(),lines:n.getLines().getNumberOfValues()-2*n.getLines().getNumberOfCells(),triangles:n.getPolys().getNumberOfValues()-3*n.getPolys().getNumberOfCells()}}}const RT={static:!1,lookupTable:null,scalarVisibility:!1,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,transformCoordinate:null,viewSpecificProperties:null,customShaderAttributes:[]};function DT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,RT,n),Tu.extend(t,e,n),E.get(t,e,["colorMapColors"]),E.setGet(t,e,["arrayAccessMode","colorByArrayName","colorMode","lookupTable","renderTime","scalarMode","scalarVisibility","static","transformCoordinate","useLookupTableScalarRange","viewSpecificProperties","customShaderAttributes"]),E.setGetArray(t,e,["scalarRange"],2),e.viewSpecificProperties||(e.viewSpecificProperties={}),OT(t,e)}E.newInstance(DT,"vtkMapper2D");var MT={},LT=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

uniform int PrimitiveIDOffset;

// Texture coordinates
//VTK::TCoord::Dec

// Scalar coloring
//VTK::Color::Dec

// Depth Peeling
//VTK::DepthPeeling::Dec

// picking support
//VTK::Picking::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Color::Impl
  //VTK::TCoord::Impl

  //VTK::DepthPeeling::Impl
  //VTK::Picking::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }
}
`,VT=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model Coordinates
// WC - WC world coordinates
// VC - View Coordinates
// DC - Display Coordinates

in vec4 vertexWC;

// frag position in VC
//VTK::PositionVC::Dec

// material property values
//VTK::Color::Dec

// Texture coordinates
//VTK::TCoord::Dec

// Apple Bug
//VTK::PrimID::Dec

uniform mat4 WCVCMatrix;  // World to view matrix

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  gl_Position = WCVCMatrix*vertexWC;

  //VTK::TCoord::Impl

  //VTK::Color::Impl

  //VTK::PositionVC::Impl
}
`;const cg={BACKGROUND:0,FOREGROUND:1};var fg={DisplayLocation:cg};const{primTypes:Ne}=yn,{ScalarMode:ir}=MT,{vtkErrorMacro:or}=Je,_T={type:"StartEvent"},BT={type:"EndEvent"};function FT(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper2D"),t.buildPass=r=>{r&&(e.openGLActor2D=t.getFirstAncestorOfType("vtkOpenGLActor2D"),e._openGLRenderer=e.openGLActor2D.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.overlayPass=r=>{r&&t.render()},t.getShaderTemplate=(r,a,s)=>{r.Vertex=VT,r.Fragment=LT,r.Geometry=""},t.render=()=>{const r=e._openGLRenderWindow.getContext();if(e.context!==r){e.context=r;for(let i=Ne.Start;i<Ne.End;i++)e.primitives[i].setOpenGLRenderWindow(e._openGLRenderWindow)}const a=e.openGLActor2D.getRenderable(),s=e._openGLRenderer.getRenderable();t.renderPiece(s,a)},t.renderPiece=(r,a)=>{if(t.invokeEvent(_T),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(BT),!e.currentInput){or("No input!");return}!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues()||(t.renderPieceStart(r,a),t.renderPieceDraw(r,a),t.renderPieceFinish(r,a))},t.renderPieceStart=(r,a)=>{if(e.primitiveIDOffset=0,e._openGLRenderer.getSelector())switch(e._openGLRenderer.getSelector().getCurrentPass()){default:e._openGLRenderer.getSelector().renderProp(a)}t.updateBufferObjects(r,a),e.lastBoundBO=null},t.getNeedToRebuildShaders=(r,a,s)=>r.getShaderSourceTime().getMTime()<e.renderable.getMTime()||r.getShaderSourceTime().getMTime()<e.currentInput.getMTime(),t.updateBufferObjects=(r,a)=>{t.getNeedToRebuildBufferObjects(r,a)&&t.buildBufferObjects(r,a)},t.getNeedToRebuildBufferObjects=(r,a)=>{const s=e.VBOBuildTime.getMTime();return!!(s<t.getMTime()||s<e._openGLRenderWindow.getMTime()||s<e.renderable.getMTime()||s<a.getMTime()||s<e.currentInput.getMTime()||e.renderable.getTransformCoordinate()&&s<r.getMTime())},t.buildBufferObjects=(r,a)=>{const s=e.currentInput;if(s===null)return;e.renderable.mapScalars(s,a.getProperty().getOpacity());const i=e.renderable.getColorMapColors();e.haveCellScalars=!1;const o=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(o===ir.USE_CELL_DATA||o===ir.USE_CELL_FIELD_DATA||o===ir.USE_FIELD_DATA||!s.getPointData().getScalars())&&o!==ir.USE_POINT_FIELD_DATA&&i&&(e.haveCellScalars=!0);const c=a.getProperty().getRepresentation();let u=s.getPointData().getTCoords();e.openGLActor2D.getActiveTextures()||(u=null);const g=e.renderable.getTransformCoordinate(),l=r.getRenderWindow().getViews()[0].getViewportSize(r),p=`${s.getMTime()}A${c}B${s.getMTime()}C${i?i.getMTime():1}D${u?u.getMTime():1}E${g?r.getMTime():1}F${l}`;if(e.VBOBuildString!==p){let y=s.getPoints();if(g){const v=nn.newInstance(),x=y.getNumberOfPoints();v.setNumberOfPoints(x);const S=[];for(let d=0;d<x;++d){y.getPoint(d,S),g.setValue(S);const T=g.getComputedDoubleViewportValue(r);v.setPoint(d,T[0],T[1],0)}y=v}const h={points:y,tcoords:u,colors:i,cellOffset:0,haveCellScalars:e.haveCellSCalars,customAttributes:e.renderable.getCustomShaderAttributes().map(v=>s.getPointData().getArrayByName(v))};h.cellOffset+=e.primitives[Ne.Points].getCABO().createVBO(s.getVerts(),"verts",c,h),h.cellOffset+=e.primitives[Ne.Lines].getCABO().createVBO(s.getLines(),"lines",c,h),h.cellOffset+=e.primitives[Ne.Tris].getCABO().createVBO(s.getPolys(),"polys",c,h),h.cellOffset+=e.primitives[Ne.TriStrips].getCABO().createVBO(s.getStrips(),"strips",c,h),e.VBOBuildTime.modified(),e.VBOBuildString=p}},t.renderPieceDraw=(r,a)=>{const s=a.getProperty().getRepresentation();e.context.depthMask(!0);for(let o=Ne.Start;o<Ne.End;o++)e.primitives[o].getCABO().getElementCount()&&(e.lastBoundBO=e.primitives[o],e.primitiveIDOffset+=e.primitives[o].drawArrays(r,a,s,t))},t.renderPieceFinish=(r,a)=>{e.lastBoundBO&&e.lastBoundBO.getVAO().release()},t.replaceShaderValues=(r,a,s)=>{t.replaceShaderColor(r,a,s),t.replaceShaderTCoord(r,a,s),t.replaceShaderPicking(r,a,s),t.replaceShaderPositionVC(r,a,s)},t.replaceShaderColor=(r,a,s)=>{let i=r.Vertex,o=r.Geometry,c=r.Fragment;e.haveCellScalars&&(c=F.substitute(c,"//VTK::Color::Dec",["uniform samplerBuffer texture1;"]).result,c=F.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = texelFetchBuffer(texture1, gl_PrimitiveID + PrimitiveIDOffset);"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0?(i=F.substitute(i,"//VTK::Color::Dec",["in vec4 diffuseColor;","out vec4 fcolorVSOutput;"]).result,i=F.substitute(i,"//VTK::Color::Impl",["fcolorVSOutput = diffuseColor;"]).result,o=F.substitute(o,"//VTK::Color::Dec",[`in vec4 fcolorVSOutput[];
`,"out vec4 fcolorGSOutput;"]).result,o=F.substitute(o,"//VTK::Color::Impl",["fcolorGSOutput = fcolorVSOutput[i];"]).result,c=F.substitute(c,"//VTK::Color::Dec",["in vec4 fcolorVSOutput;"]).result,c=F.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = fcolorVSOutput;"]).result):(c=F.substitute(c,"//VTK::Color::Dec",["uniform vec4 diffuseColor;"]).result,c=F.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = diffuseColor;"]).result),r.Vertex=i,r.Geometry=o,r.Fragment=c},t.replaceShaderTCoord=(r,a,s)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let i=r.Vertex,o=r.Geometry,c=r.Fragment;const u=e.lastBoundBO.getCABO().getTCoordComponents();u===1?(i=F.substitute(i,"//VTK::TCoord::Dec",["in float tcoordMC;","out float tcoordVCVSOutput;"]).result,i=F.substitute(i,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,o=F.substitute(o,"//VTK::TCoord::Dec",[`in float tcoordVCVSOutput[];
`,"out float tcoordVCGSOutput;"]).result,o=F.substitute(o,["//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=F.substitute(c,"//VTK::TCoord::Dec",["in float tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=F.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, vec2(tcoordVCVSOutput,0));"]).result):u===2&&(i=F.substitute(i,"//VTK::TCoord::Dec",["in vec2 tcoordMC;","out vec2 tcoordVCVSOutput;"]).result,i=F.substitute(i,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,o=F.substitute(o,"//VTK::TCoord::Dec",[`in vec2 tcoordVCVSOutput[];
`,"out vec2 tcoordVCGSOutput;"]).result,o=F.substitute(o,"//VTK::TCoord::Impl",["tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=F.substitute(c,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=F.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, tcoordVCVSOutput.st);"]).result),e.haveCellScalars&&(o=F.substitute(o,"//VTK::PrimID::Impl",["gl_PrimitiveID = gl_PrimitiveIDIn;"]).result),r.Vertex=i,r.Geometry=o,r.Fragment=c}},t.replaceShaderPicking=(r,a,s)=>{let i=r.Fragment;i=F.substitute(i,"//VTK::Picking::Dec",["uniform vec3 mapperIndex;","uniform int picking;"]).result,i=F.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result,r.Fragment=i},t.replaceShaderPositionVC=(r,a,s)=>{e.lastBoundBO.replaceShaderPositionVC(r,a,s)},t.invokeShaderCallbacks=(r,a,s)=>{const i=e.renderable.getViewSpecificProperties().ShadersCallbacks;i&&i.forEach(o=>{o.callback(o.userData,r,a,s)})},t.setMapperShaderParameters=(r,a,s)=>{if(r.getProgram().isUniformUsed("PrimitiveIDOffset")&&r.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),r.getProgram().isAttributeUsed("vertexWC")&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"vertexWC",r.getCABO().getVertexOffset(),r.getCABO().getStride(),e.context.FLOAT,3,!1)||or("Error setting vertexWC in shader VAO.")),r.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>r.getAttributeUpdateTime().getMTime()||r.getShaderSourceTime().getMTime()>r.getAttributeUpdateTime().getMTime())){e.renderable.getCustomShaderAttributes().forEach((c,u)=>{r.getProgram().isAttributeUsed(`${c}MC`)&&(r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),`${c}MC`,r.getCABO().getCustomData()[u].offset,r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getCustomData()[u].components,!1)||or(`Error setting ${c}MC in shader VAO.`))}),r.getProgram().isAttributeUsed("tcoordMC")&&r.getCABO().getTCoordOffset()?r.getVAO().addAttributeArray(r.getProgram(),r.getCABO(),"tcoordMC",r.getCABO().getTCoordOffset(),r.getCABO().getStride(),e.context.FLOAT,r.getCABO().getTCoordComponents(),!1)||or("Error setting tcoordMC in shader VAO."):r.getVAO().removeAttributeArray("tcoordMC"),e.internalColorTexture&&r.getProgram().isUniformUsed("texture1")&&r.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const i=e.openGLActor2D.getActiveTextures();if(i)for(let c=0;c<i.length;++c){const g=i[c].getTextureUnit(),f=`texture${g+1}`;r.getProgram().isUniformUsed(f)&&r.getProgram().setUniformi(f,g)}r.setMapperShaderParameters(a,s,e._openGLRenderer.getTiledSizeAndOrigin());const o=e._openGLRenderer.getSelector();r.getProgram().setUniform3fArray("mapperIndex",o?o.getPropColorValue():[0,0,0]),r.getProgram().setUniformi("picking",o?o.getCurrentPass()+1:0)}},t.setPropertyShaderParameters=(r,a,s)=>{const i=e.renderable.getColorMapColors();if(!i||i.getNumberOfComponents()===0){const o=r.getProgram(),c=s.getProperty(),u=c.getOpacity(),g=c.getColor(),f=[g[0],g[1],g[2],u];o.setUniform4f("diffuseColor",f)}},t.setLightingShaderParameters=(r,a,s)=>{};function n(r,a,s){return a.identity(s),r.reduce((i,o,c)=>c===0?o?a.copy(i,o):a.identity(i):o?a.multiply(i,i,o):i,s)}t.setCameraShaderParameters=(r,a,s)=>{const i=r.getProgram(),c=r.getCABO().getCoordShiftAndScaleEnabled()?r.getCABO().getInverseShiftAndScaleMatrix():null,g=a.getRenderWindow().getViews()[0].getViewportSize(a),f=a.getViewport(),l=s.getActualPositionCoordinate().getComputedDoubleViewportValue(a),p=[0,0,1,1],y=[0,0,1,1];if(y[0]=f[0]>=p[0]?f[0]:p[0],y[1]=f[1]>=p[1]?f[1]:p[1],y[2]=f[2]<=p[2]?f[2]:p[2],y[3]=f[3]<=p[3]?f[3]:p[3],y[0]>=y[2]||y[1]>=y[3])return;g[0]=In(g[0]*(y[2]-y[0])/(f[2]-f[0])),g[1]=In(g[1]*(y[3]-y[1])/(f[3]-f[1]));const h=e._openGLRenderer.getParent().getSize(),v=In(l[0]-(y[0]-f[0])*h[0]),x=In(l[1]-(y[1]-f[1])*h[1]),S=-v;let d=-v+g[0];const T=-x;let w=-x+g[1];S===d&&(d=S+1),T===w&&(w=T+1);const C=A(new Float64Array(16));C[0]=2/(d-S),C[1*4+1]=2/(w-T),C[0*4+3]=-1*(d+S)/(d-S),C[1*4+3]=-1*(w+T)/(w-T),C[2*4+2]=0,C[2*4+3]=s.getProperty().getDisplayLocation()===cg.FOREGROUND?-1:1,C[3*4+3]=1,te(C,C),i.setUniformMatrix("WCVCMatrix",n([C,c],gs,e.tmpMat4))},t.getAllocatedGPUMemoryInBytes=()=>{let r=0;return e.primitives.forEach(a=>{r+=a.getAllocatedGPUMemoryInBytes()}),r}}const mT={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null};function UT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mT,n),ae.extend(t,e,n),Qr.implementReplaceShaderCoincidentOffset(t,e,n),Qr.implementBuildShadersWithReplacements(t,e,n),e.primitives=[],e.primTypes=Ne,e.tmpMat4=A(new Float64Array(16));for(let r=Ne.Start;r<Ne.End;r++)e.primitives[r]=yn.newInstance(),e.primitives[r].setPrimitiveType(r),e.primitives[r].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);le(t,e,["context"]),e.VBOBuildTime={},ye(e.VBOBuildTime,{mtime:0}),FT(t,e)}const kT=Z(UT,"vtkOpenGLPolyDataMapper2D");Fe("vtkMapper2D",kT);const{VectorMode:NT}=Du;function Ka(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function ug(t,e){return n=>{const r=n.getLastSize(),a=(r[0]/700)**.8,s=(r[1]/700)**.8,i=Math.min(a,s),o=n.getAxisTextStyle(),c=n.getTickTextStyle();Object.assign(o,e.axisTextStyle),Object.assign(c,e.tickTextStyle),o.fontSize=Math.max(24*i,12),n.getLastAspectRatio()>1?c.fontSize=Math.max(20*i,10):c.fontSize=Math.max(16*i,10);const u=n.updateTextureAtlas();n.setTopTitle(!1);const g=n.getBoxSizeByReference();if(n.getLastAspectRatio()>1)n.setTickLabelPixelOffset(.3*c.fontSize),u.titleWidth<=u.tickWidth+n.getTickLabelPixelOffset()+.8*c.fontSize?(n.setTopTitle(!0),n.setAxisTitlePixelOffset(.2*c.fontSize),g[0]=2*(u.tickWidth+n.getTickLabelPixelOffset()+.8*c.fontSize)/r[0],n.setBoxPosition([.98-g[0],-.92])):(n.setAxisTitlePixelOffset(.2*c.fontSize),g[0]=2*(u.titleHeight+n.getAxisTitlePixelOffset()+u.tickWidth+n.getTickLabelPixelOffset()+.8*c.fontSize)/r[0],n.setBoxPosition([.99-g[0],-.92])),g[1]=Math.max(1.2,Math.min(1.84/s,1.84));else{n.setAxisTitlePixelOffset(1.2*c.fontSize),n.setTickLabelPixelOffset(.1*c.fontSize);const f=2*(.8*c.fontSize+u.titleHeight+n.getAxisTitlePixelOffset())/r[1],l=2*u.tickWidth/r[0];g[0]=Math.min(1.9,Math.max(1.4,1.4*l*(n.getTicks().length+3))),g[1]=f,n.setBoxPosition([-.5*g[0],-.97])}n.recomputeBarSegments(u)}}function gg(t,e){return n=>{const r=n.getLastTickBounds(),a=Js().domain([r[0],r[1]]),s=a.ticks(5),i=a.tickFormat(5);n.setTicks(s),n.setTickStrings(s.map(i))}}function GT(t,e){e.classHierarchy.push("vtkScalarBarActorHelper"),t.setRenderable=a=>{e.renderable!==a&&(e.renderable=a,e.barActor.setProperty(a.getProperty()),e.barActor.setParentProp(a),e.barActor.setCoordinateSystemToDisplay(),e.tmActor.setProperty(a.getProperty()),e.tmActor.setParentProp(a),e.tmActor.setCoordinateSystemToDisplay(),e.generateTicks=a.generateTicks,e.axisTextStyle={...a.getAxisTextStyle()},e.tickTextStyle={...a.getTickTextStyle()},t.modified())},t.updateAPISpecificData=(a,s,i)=>{(e.lastSize[0]!==a[0]||e.lastSize[1]!==a[1])&&(e.lastSize[0]=a[0],e.lastSize[1]=a[1],e.lastAspectRatio=a[0]/a[1],e.forceUpdate=!0);const o=e.renderable.getScalarsToColors();if(!(!o||!e.renderable.getVisibility())&&(e.barMapper.setLookupTable(o),e.camera=s,e.renderWindow=i,e.forceUpdate||Math.max(o.getMTime(),t.getMTime(),e.renderable.getMTime())>e.lastRebuildTime.getMTime())){const c=o.getMappingRange();if(e.lastTickBounds=[...c],e.renderable.getGenerateTicks()(t),e.renderable.getAutomated())e.renderable.getAutoLayout()(t);else{e.axisTextStyle={...e.renderable.getAxisTextStyle()},e.tickTextStyle={...e.renderable.getTickTextStyle()},e.barPosition=[...e.renderable.getBarPosition()],e.barSize=[...e.renderable.getBarSize()],e.boxPosition=[...e.renderable.getBoxPosition()],e.boxSize=[...e.renderable.getBoxSize()],e.axisTitlePixelOffset=e.renderable.getAxisTitlePixelOffset(),e.tickLabelPixelOffset=e.renderable.getTickLabelPixelOffset();const u=t.updateTextureAtlas();t.recomputeBarSegments(u)}t.updatePolyDataForLabels(),t.updatePolyDataForBarSegments(),e.lastRebuildTime.modified(),e.forceUpdate=!1}},t.updateTextureAtlas=()=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left";const a={},s=new Map;let i=0,o=1;Ka(e.tmContext,e.axisTextStyle);let c=e.tmContext.measureText(e.renderable.getAxisLabel()),u={height:c.actualBoundingBoxAscent+2,startingHeight:o,width:c.width+2,textStyle:e.axisTextStyle};s.set(e.renderable.getAxisLabel(),u),o+=u.height,i=u.width,a.titleWidth=u.width,a.titleHeight=u.height,a.tickWidth=0,a.tickHeight=0,Ka(e.tmContext,e.tickTextStyle);const g=[...t.getTickStrings(),"NaN","Below","Above"];for(let f=0;f<g.length;f++)s.has(g[f])||(c=e.tmContext.measureText(g[f]),u={height:c.actualBoundingBoxAscent+2,startingHeight:o,width:c.width+2,textStyle:e.tickTextStyle},s.set(g[f],u),o+=u.height,i<u.width&&(i=u.width),a.tickWidth<u.width&&(a.tickWidth=u.width),a.tickHeight<u.height&&(a.tickHeight=u.height));return i=be(i),o=be(o),s.forEach(f=>{f.tcoords=[0,(o-f.startingHeight-f.height)/o,f.width/i,(o-f.startingHeight-f.height)/o,f.width/i,(o-f.startingHeight)/o,0,(o-f.startingHeight)/o]}),e.tmCanvas.width=i,e.tmCanvas.height=o,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,i,o),s.forEach((f,l)=>{Ka(e.tmContext,f.textStyle),e.tmContext.fillText(l,1,f.startingHeight+f.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified(),e._tmAtlas=s,a},t.computeBarSize=a=>{e.vertical=e.boxSize[1]>e.boxSize[0];const s=2*a.tickHeight/e.lastSize[1],i=[1,1];if(e.vertical){const o=2*(a.tickWidth+e.tickLabelPixelOffset)/e.lastSize[0];if(e.topTitle){const c=2*(a.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0]-o,e.barSize[1]=e.boxSize[1]-c}else{const c=2*(a.titleHeight+e.axisTitlePixelOffset)/e.lastSize[0];e.barSize[0]=e.boxSize[0]-c-o,e.barSize[1]=e.boxSize[1]}e.barPosition[0]=e.boxPosition[0]+o,e.barPosition[1]=e.boxPosition[1],i[1]=s}else{const o=(2*a.tickWidth-8)/e.lastSize[0],c=2*(a.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0],e.barPosition[0]=e.boxPosition[0],e.barSize[1]=e.boxSize[1]-c,e.barPosition[1]=e.boxPosition[1],i[0]=o}return i},t.recomputeBarSegments=a=>{var l,p,y,h;const s=t.computeBarSize(a);e.barSegments=[];const i=[0,0],o=e.vertical?1:0,c=e.vertical?.01:.02;function u(v,x){e.barSegments.push({corners:[[...i],[i[0]+s[0],i[1]],[i[0]+s[0],i[1]+s[1]],[i[0],i[1]+s[1]]],scalars:x,title:v}),i[o]+=s[o]+c}e.renderable.getDrawNanAnnotation()&&e.renderable.getScalarsToColors().getNanColor()&&u("NaN",[NaN,NaN,NaN,NaN]),e.renderable.getDrawBelowRangeSwatch()&&((p=(l=e.renderable.getScalarsToColors()).getUseBelowRangeColor)!=null&&p.call(l))&&u("Below",[-.1,-.1,-.1,-.1]);const g=(h=(y=e.renderable.getScalarsToColors()).getUseAboveRangeColor)==null?void 0:h.call(y);i[o]+=c;const f=s[o];s[o]=g?1-2*c-s[o]-i[o]:1-c-i[o],u("ticks",e.vertical?[0,0,.995,.995]:[0,.995,.995,0]),e.renderable.getDrawAboveRangeSwatch()&&g&&(s[o]=f,i[o]+=c,u("Above",[1.1,1.1,1.1,1.1]))};const n=new Float64Array(3);t.createPolyDataForOneLabel=(a,s,i,o,c,u)=>{const g=e._tmAtlas.get(a);if(!g)return;let f=u.ptIdx,l=u.cellIdx;n[0]=(.5*s[0]+.5)*e.lastSize[0],n[1]=(.5*s[1]+.5)*e.lastSize[1],n[2]=s[2],n[0]+=c[0],n[1]+=c[1];const p=[],y=o==="vertical"?[1,0]:[0,1];o==="vertical"?(p[0]=g.width,p[1]=-g.height,i[0]==="middle"?n[1]-=g.width/2:i[0]==="right"&&(n[1]-=g.width),i[1]==="middle"?n[0]+=g.height/2:i[1]==="top"&&(n[0]+=g.height)):(p[0]=g.width,p[1]=g.height,i[0]==="middle"?n[0]-=g.width/2:i[0]==="right"&&(n[0]-=g.width),i[1]==="middle"?n[1]-=g.height/2:i[1]==="top"&&(n[1]-=g.height)),u.points[f*3]=n[0],u.points[f*3+1]=n[1],u.points[f*3+2]=n[2],u.tcoords[f*2]=g.tcoords[0],u.tcoords[f*2+1]=g.tcoords[1],f++,n[y[0]]+=p[0],u.points[f*3]=n[0],u.points[f*3+1]=n[1],u.points[f*3+2]=n[2],u.tcoords[f*2]=g.tcoords[2],u.tcoords[f*2+1]=g.tcoords[3],f++,n[y[1]]+=p[1],u.points[f*3]=n[0],u.points[f*3+1]=n[1],u.points[f*3+2]=n[2],u.tcoords[f*2]=g.tcoords[4],u.tcoords[f*2+1]=g.tcoords[5],f++,n[y[0]]-=p[0],u.points[f*3]=n[0],u.points[f*3+1]=n[1],u.points[f*3+2]=n[2],u.tcoords[f*2]=g.tcoords[6],u.tcoords[f*2+1]=g.tcoords[7],f++,u.polys[l*4]=3,u.polys[l*4+1]=f-4,u.polys[l*4+2]=f-3,u.polys[l*4+3]=f-2,l++,u.polys[l*4]=3,u.polys[l*4+1]=f-4,u.polys[l*4+2]=f-2,u.polys[l*4+3]=f-1,u.ptIdx+=4,u.cellIdx+=2};const r=new Float64Array(3);t.updatePolyDataForLabels=()=>{const a=t.getTickStrings().length+e.barSegments.length,s=a*4,i=a*2,o=new Float64Array(s*3),c=new Uint16Array(i*4),u=new Float32Array(s*2),g={ptIdx:0,cellIdx:0,polys:c,points:o,tcoords:u},f=e.vertical?0:1,l=e.vertical?1:0;r[2]=-.99;const p=e.vertical?["right","middle"]:["middle","bottom"];let y=[0,1];const h=[0,0];e.vertical?(h[0]=-e.tickLabelPixelOffset,e.topTitle?(r[0]=e.boxPosition[0]+.5*e.boxSize[0],r[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],g)):(r[0]=e.barPosition[0]+e.barSize[0],r[1]=e.barPosition[1]+.5*e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","top"],"vertical",[e.axisTitlePixelOffset,0],g)),y=[-1,0]):(h[1]=e.tickLabelPixelOffset,r[0]=e.barPosition[0]+.5*e.barSize[0],r[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),r,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],g)),r[f]=e.barPosition[f]+(.5*y[f]+.5)*e.barSize[f],r[l]=e.barPosition[l]+e.barSize[l]*.5;let v=null;for(let C=0;C<e.barSegments.length;C++){const O=e.barSegments[C];O.title==="ticks"?v=O:(r[l]=e.barPosition[l]+.5*e.barSize[l]*(O.corners[2][l]+O.corners[0][l]),t.createPolyDataForOneLabel(O.title,r,p,"horizontal",h,g))}const x=e.barPosition[l]+e.barSize[l]*v.corners[0][l],S=e.barSize[l]*(v.corners[2][l]-v.corners[0][l]),d=t.getTicks(),T=t.getTickStrings();for(let C=0;C<d.length;C++){const O=(d[C]-e.lastTickBounds[0])/(e.lastTickBounds[1]-e.lastTickBounds[0]);r[l]=x+S*O,t.createPolyDataForOneLabel(T[C],r,p,"horizontal",h,g)}const w=Y.newInstance({numberOfComponents:2,values:u,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(w),e.tmPolyData.getPoints().setData(o,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(c,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updatePolyDataForBarSegments=()=>{var h,v;const a=e.renderable.getScalarsToColors();let s=0;e.renderable.getDrawNanAnnotation()&&a.getNanColor()&&(s+=1),e.renderable.getDrawBelowRangeSwatch()&&((h=a.getUseBelowRangeColor)!=null&&h.call(a))&&(s+=1),e.renderable.getDrawAboveRangeSwatch()&&((v=a.getUseAboveRangeColor)!=null&&v.call(a))&&(s+=1);const i=4*(1+s),o=i;let c=1;a.getVectorMode()===NT.COMPONENT&&(c=a.getVectorComponent()+1);const u=new Float64Array(i*3),g=new Uint16Array(o*5),f=new Float32Array(i*c);let l=0,p=0;for(let x=0;x<e.barSegments.length;x++){const S=e.barSegments[x];for(let d=0;d<4;d++){r[0]=e.barPosition[0]+S.corners[d][0]*e.barSize[0],r[1]=e.barPosition[1]+S.corners[d][1]*e.barSize[1],u[l*3]=(.5*r[0]+.5)*e.lastSize[0],u[l*3+1]=(.5*r[1]+.5)*e.lastSize[1],u[l*3+2]=r[2];for(let T=0;T<c;T++)f[l*c+T]=e.lastTickBounds[0]+S.scalars[d]*(e.lastTickBounds[1]-e.lastTickBounds[0]);l++}g[p*5]=4,g[p*5+1]=l-4,g[p*5+2]=l-3,g[p*5+3]=l-2,g[p*5+4]=l-1,p++}const y=Y.newInstance({numberOfComponents:c,values:f,name:"Scalars"});e.polyData.getPointData().setScalars(y),e.polyData.getPoints().setData(u,3),e.polyData.getPoints().modified(),e.polyData.getPolys().setData(g,1),e.polyData.getPolys().modified(),e.polyData.modified()}}const bT=E.newInstance(function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},n),E.obj(t,e),E.setGet(t,e,["axisTitlePixelOffset","tickLabelPixelOffset","renderable","topTitle","ticks","tickStrings"]),E.get(t,e,["lastSize","lastAspectRatio","lastTickBounds","axisTextStyle","tickTextStyle","barActor","tmActor"]),E.getArray(t,e,["boxPosition","boxSize"]),E.setArray(t,e,["boxPosition","boxSize"],2),e.forceUpdate=!1,e.lastRebuildTime={},E.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.barMapper=Ze.newInstance(),e.barMapper.setInterpolateScalarsBeforeMapping(!0),e.barMapper.setUseLookupTableScalarRange(!0),e.polyData=Be.newInstance(),e.barMapper.setInputData(e.polyData),e.barActor=Qe.newInstance(),e.barActor.setMapper(e.barMapper),e.tmPolyData=Be.newInstance(),e.tmMapper=Ze.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmTexture=ca.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),e.tmActor=Qe.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),e.tmActor.addTexture(e.tmTexture),e.barPosition=[0,0],e.barSize=[0,0],e.boxPosition=[.88,-.92],e.boxSize=[.1,1.1],e.lastTickBounds=[],GT(t,e)},"vtkScalarBarActorHelper");function $T(t,e){e.classHierarchy.push("vtkScalarBarActor"),t.setTickTextStyle=n=>{e.tickTextStyle={...e.tickTextStyle,...n},t.modified()},t.setAxisTextStyle=n=>{e.axisTextStyle={...e.axisTextStyle,...n},t.modified()},t.resetAutoLayoutToDefault=()=>{t.setAutoLayout(ug(t,e))},t.resetGenerateTicksToDefault=()=>{t.setGenerateTicks(gg())}}function zT(t){return{automated:!0,autoLayout:null,axisLabel:"Scalar Value",barPosition:[0,0],barSize:[0,0],boxPosition:[.88,-.92],boxSize:[.1,1.1],scalarToColors:null,axisTitlePixelOffset:36,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif"},tickLabelPixelOffset:14,tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif"},generateTicks:null,drawNanAnnotation:!0,drawBelowRangeSwatch:!0,drawAboveRangeSwatch:!0,...t}}function lg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zT(n)),e.autoLayout||(e.autoLayout=ug(t,e)),e.generateTicks||(e.generateTicks=gg()),Qe.extend(t,e,n),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),E.setGet(t,e,["automated","autoLayout","axisTitlePixelOffset","axisLabel","scalarsToColors","tickLabelPixelOffset","generateTicks","drawNanAnnotation","drawBelowRangeSwatch","drawAboveRangeSwatch"]),E.get(t,e,["axisTextStyle","tickTextStyle"]),E.getArray(t,e,["barPosition","barSize","boxPosition","boxSize"]),E.setArray(t,e,["barPosition","barSize","boxPosition","boxSize"],2),$T(t,e)}const WT=E.newInstance(lg,"vtkScalarBarActor");var pg={newInstance:WT,extend:lg,newScalarBarActorHelper:bT};function HT(t,e){e.classHierarchy.push("vtkOpenGLScalarBarActor"),t.buildPass=n=>{n&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const a=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,s=e._openGLRenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([s.usize,s.vsize],a,e._openGLRenderWindow.getRenderable())}}}const AT={};function jT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AT,n),ae.extend(t,e,n),e.scalarBarActorHelper=pg.newScalarBarActorHelper(),HT(t,e)}const KT=Z(jT,"vtkOpenGLScalarBarActor");Fe("vtkScalarBarActor",KT);const{vtkErrorMacro:Xo}=Je;function PT(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=n=>{if(n){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const r=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(r.getActiveCamera())}},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;r.incrementOpaqueActorCount()}},t.opaquePass=(n,r)=>{if(n&&!e._openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);const a=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",a);const s=e._openGLRenderer.getRenderable(),i=e.openGLCamera.getKeyMatrices(s),o=new Float64Array(16);if(Oe(o,i.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",o),e.lastFormat==="box"){const c=s.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",c[0],c[1],c[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=()=>{if(!e.tris.getCABO().getElementCount()){const r=new Float32Array(12);for(let o=0;o<4;o++)r[o*3]=o%2*2-1,r[o*3+1]=o>1?1:-1,r[o*3+2]=1;const a=Y.newInstance({numberOfComponents:3,values:r});a.setName("points");const s=new Uint16Array(8);s[0]=3,s[1]=0,s[2]=1,s[3]=3,s[4]=3,s[5]=0,s[6]=3,s[7]=2;const i=Y.newInstance({numberOfComponents:1,values:s});e.tris.getCABO().createVBO(i,"polys",Ve.SURFACE,{points:a,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Xo("Error setting vertexMC in shader VAO."));const n=e.renderable.getTextures();n.length||Xo("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==n[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(n[0]))}}const XT={context:null};function YT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XT,n),ae.extend(t,e,n),e.openGLTexture=zt.newInstance(),e.tris=yn.newInstance(),e.keyMatrixTime={},ye(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:jt(new Float64Array(9)),mcwc:A(new Float64Array(16))},le(t,e,["context"]),Re(t,e,["activeTextures"]),PT(t,e)}const qT=Z(YT);Fe("vtkSkybox",qT);const{vtkDebugMacro:IT}=Je;function QT(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow");const a=e._openGLRenderer.getAspectRatio(),s=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,i=e._openGLRenderer.getTiledSizeAndOrigin();let o=null;if(e.renderable.getUseZValues()){const c=r.getZBufferTexture(),u=Math.floor(c.getWidth()),g=Math.floor(c.getHeight()),f=e._openGLRenderWindow.getContext();c.bind();const l=r.getFramebuffer();l?l.saveCurrentBindingsAndBuffers():IT("No framebuffer to save/restore");const p=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,p),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,c.getHandle(),0),f.checkFramebufferStatus(f.FRAMEBUFFER)===f.FRAMEBUFFER_COMPLETE&&(o=new Uint8Array(u*g*4),f.viewport(0,0,u,g),f.readPixels(0,0,u,g,f.RGBA,f.UNSIGNED_BYTE,o)),l&&l.restorePreviousBindingsAndBuffers(),f.deleteFramebuffer(p)}e.renderable.invokeCallback(e.renderable.getInputData(),s,a,i,o)},t.queryPass=(n,r)=>{n&&e.renderable.getUseZValues()&&r.requestDepth()}}const ZT={};function JT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZT,n),ae.extend(t,e,n),QT(t,e)}const ex=Z(JT,"vtkOpenGLPixelSpaceCallbackMapper");Fe("vtkPixelSpaceCallbackMapper",ex);const hg=Object.create(null);function et(t,e){hg[t]=e}function tx(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}const nx={};function vg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nx,n),e.overrides=hg,Sf.extend(t,e,n),tx(t,e)}const rx=E.newInstance(vg,"vtkWebGPUViewNodeFactory");var ax={newInstance:rx,extend:vg};function sx(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=(n,r,a,s)=>{if(A(n),e.renderable.getParallelProjection()){const i=e.renderable.getParallelScale(),o=i*r,c=i,u=(s[0]-1)*o,g=(s[0]+1)*o,f=(s[1]-1)*c,l=(s[1]+1)*c,p=1/(g-u),y=1/(l-f);n[0]=2*p,n[5]=2*y,n[10]=1/(a[1]-a[0]),n[12]=(g+u)*p,n[13]=(l+f)*y,n[14]=a[1]/(a[1]-a[0])}else{const i=Math.tan(Math.PI*e.renderable.getViewAngle()/360);let o,c;e.renderable.getUseHorizontalViewAngle()===!0?(o=a[0]*i,c=a[0]*i/r):(o=a[0]*i*r,c=a[0]*i);const u=(s[0]-1)*o,g=(s[0]+1)*o,f=(s[1]-1)*c,l=(s[1]+1)*c;n[0]=2*a[0]/(g-u),n[5]=2*a[0]/(l-f),n[12]=(u+g)/(g-u),n[13]=(f+l)/(l-f),n[10]=0,n[14]=a[0],n[11]=-1,n[15]=0}},t.convertToOpenGLDepth=n=>{if(e.renderable.getParallelProjection())return 1-n;const r=e.renderable.getClippingRangeByReference();let a=-r[0]/n;return a=(r[0]+r[1])/(r[1]-r[0])+2*r[0]*r[1]/(a*(r[1]-r[0])),.5*a+.5},t.getKeyMatrices=n=>{const r=n.getRenderable(),a=n.getParent();if(Math.max(a.getMTime(),t.getMTime(),r.getMTime(),e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatrixTime.getMTime()){const s=e.renderable.getViewMatrix();de(e.keyMatrices.normalMatrix,s),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Oe(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),te(e.keyMatrices.wcvc,s);const i=n.getStabilizedCenterByReference();oe(e.keyMatrices.scvc,e.keyMatrices.wcvc,i);const o=n.getAspectRatio(),c=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,o,c,e.renderable.getWindowCenterByReference()),ge(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),Oe(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}const ix={keyMatrixTime:null,keyMatrices:null};function ox(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ix,n),ae.extend(t,e,n),e.keyMatrixTime={},E.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},E.setGet(t,e,["keyMatrixTime"]),sx(t,e)}const cx=E.newInstance(ox);et("vtkCamera",cx);function fx(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=n=>{if(e.bindables.length===n.length){let r=!0;for(let a=0;a<e.bindables.length;a++)e.bindables[a]!==n[a]&&(r=!1);if(r)return}e.bindables=n,t.modified()},t.getBindGroupLayout=n=>{const r=[];for(let a=0;a<e.bindables.length;a++){const s=e.bindables[a].getBindGroupLayoutEntry();s.binding=a,r.push(s)}return n.getBindGroupLayout({entries:r})},t.getBindGroup=n=>{let r=t.getMTime();for(let s=0;s<e.bindables.length;s++){const i=e.bindables[s].getBindGroupTime().getMTime();r=i>r?i:r}if(r<e.bindGroupTime.getMTime())return e.bindGroup;const a=[];for(let s=0;s<e.bindables.length;s++){const i=e.bindables[s].getBindGroupEntry();i.binding=s,a.push(i)}return e.bindGroup=n.getHandle().createBindGroup({layout:t.getBindGroupLayout(n),entries:a,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=n=>{const r=[],a=n.getBindGroupLayoutCount(e.label);for(let s=0;s<e.bindables.length;s++)r.push(e.bindables[s].getShaderCode(s,a));return r.join(`
`)}}const ux={device:null,handle:null,label:null};function yg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ux,n),E.obj(t,e),e.bindables=[],e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),E.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),E.setGet(t,e,["label","device","arrayInformation"]),fx(t,e)}const gx=E.newInstance(yg);var dg={newInstance:gx,extend:yg};function lx(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=(n,r)=>{e.device=n,e.handle=e.device.getHandle().createShaderModule({code:r.getCode()})}}const px={device:null,handle:null};function Tg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,px,n),E.obj(t,e),E.get(t,e,["lastCameraMTime"]),E.setGet(t,e,["device","handle"]),lx(t,e)}const hx=E.newInstance(Tg,"vtkWebGPUShaderModule");var vx={newInstance:hx,extend:Tg};function yx(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;const a=Array.isArray(n)?n.join(`
`):n;let s=!1;t.search(e)!==-1&&(s=!0);let i="";r&&(i="g");const o=new RegExp(e,i),c=t.replace(o,a);return{replace:s,result:c}}function dx(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=n=>{const r=n.getType(),a=n.getHash(),s=e._shaderModules.keys();for(let o=0;o<s.length;o++){const c=s[o];if(c.getHash()===a&&c.getType()===r)return e._shaderModules.get(c)}const i=vx.newInstance();return i.initialize(e.device,n),e._shaderModules.set(n,i),i}}const Tx={shaderModules:null,device:null,window:null};function xg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Tx,n),e._shaderModules=new Map,E.obj(t,e),E.setGet(t,e,["device","window"]),dx(t,e)}const xx=E.newInstance(xg,"vtkWebGPUShaderCache");var H={newInstance:xx,extend:xg,substitute:yx};function Sx(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=()=>e.shaderDescriptions,t.initialize=(n,r)=>{e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=r;const a=[];for(let s=0;s<e.layouts.length;s++)a.push(e.layouts[s].layout);e.pipelineLayout=n.getHandle().createPipelineLayout({bindGroupLayouts:a}),e.pipelineDescription.layout=e.pipelineLayout;for(let s=0;s<e.shaderDescriptions.length;s++){const i=e.shaderDescriptions[s],o=n.getShaderModule(i);i.getType()==="vertex"&&(e.pipelineDescription.vertex.module=o.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),i.getType()==="fragment"&&(e.pipelineDescription.fragment.module=o.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=n.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=n=>{for(let r=0;r<e.shaderDescriptions.length;r++)if(e.shaderDescriptions[r].getType()===n)return e.shaderDescriptions[r];return null},t.addBindGroupLayout=n=>{n&&e.layouts.push({layout:n.getBindGroupLayout(e.device),label:n.getLabel()})},t.getBindGroupLayout=n=>e.layouts[n].layout,t.getBindGroupLayoutCount=n=>{for(let r=0;r<e.layouts.length;r++)if(e.layouts[r].label===n)return r;return 0},t.bindVertexInput=(n,r)=>{r.bindBuffers(n)}}const Cx={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function Sg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Cx,n),ye(t,e),e.layouts=[],e.shaderDescriptions=[],Re(t,e,["handle","pipelineDescription"]),le(t,e,["device","renderEncoder","topology","vertexState"]),Sx(t,e)}const wx=Z(Sg,"vtkWebGPUPipeline");var Ex={newInstance:wx,extend:Sg};function Ox(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=n=>e.outputNames.includes(n),t.addOutput=function(n,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(n),e.outputNames.push(r),e.outputInterpolations.push(a)},t.addBuiltinOutput=(n,r)=>{e.builtinOutputTypes.push(n),e.builtinOutputNames.push(r)},t.addBuiltinInput=(n,r)=>{e.builtinInputTypes.push(n),e.builtinInputNames.push(r)},t.replaceShaderCode=(n,r)=>{const a=[];let s=[];if(r&&a.push(r.getShaderCode()),n||e.builtinInputNames.length){const i=[];if(i.push(`struct ${e.type}Input
{`),n){const o=n.getOutputNamesByReference(),c=n.getOutputTypesByReference(),u=n.getOutputInterpolationsByReference();for(let g=0;g<o.length;g++)u[g]!==void 0?i.push(`  @location(${g}) @interpolate(${u[g]}) ${o[g]} : ${c[g]},`):i.push(`  @location(${g}) ${o[g]} : ${c[g]},`)}for(let o=0;o<e.builtinInputNames.length;o++)i.push(`  ${e.builtinInputNames[o]} : ${e.builtinInputTypes[o]},`);i.length>1&&(i.push("};"),s=i,a[a.length-1]+=",",a.push(`input: ${e.type}Input`))}if(a.length&&(e.code=H.substitute(e.code,"//VTK::IOStructs::Input",a).result),e.outputNames.length+e.builtinOutputNames.length){const i=[`struct ${e.type}Output
{`];for(let o=0;o<e.outputNames.length;o++)e.outputInterpolations[o]!==void 0?i.push(`  @location(${o}) @interpolate(${e.outputInterpolations[o]}) ${e.outputNames[o]} : ${e.outputTypes[o]},`):i.push(`  @location(${o}) ${e.outputNames[o]} : ${e.outputTypes[o]},`);for(let o=0;o<e.builtinOutputNames.length;o++)i.push(`  ${e.builtinOutputNames[o]} : ${e.builtinOutputTypes[o]},`);i.push("};"),s=s.concat(i),e.code=H.substitute(e.code,"//VTK::IOStructs::Output",[`-> ${e.type}Output`]).result}e.code=H.substitute(e.code,"//VTK::IOStructs::Dec",s).result}}const Rx={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function Cg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Rx,n),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],E.obj(t,e),E.setGet(t,e,["type","hash","code"]),E.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),Ox(t,e)}const Dx=E.newInstance(Cg,"vtkWebGPUShaderDescription");var Yo={newInstance:Dx,extend:Cg};const qo={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function Mx(t){return!t||t.length<6?0:t in qo?qo[t]:(j(`unknown format ${t}`),null)}function Lx(t){if(!t||t.length<5)return 0;let e=1;t[t.length-2]==="x"&&(e=Number(t[t.length-1]));const n=e===1?t.length-1:t.length-3,r=Number(t[n]);if(Number.isNaN(r))return j(`unknown format ${t}`),0;const a=5-r/2;return e*a}function Vx(t){if(!t||t.length<5)return 0;let e=1;return t[t.length-2]==="x"&&(e=Number(t[t.length-1])),e}function _x(t){if(!t||t.length<5)return 0;let e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{j(`unknown format ${t}`);return}const n=t.split("x")[0],r=Number(n[n.length-1]);if(Number.isNaN(r)){j(`unknown format ${t}`);return}return e+=8*(5-r/2),e+="Array",e}function Bx(t){let e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{j(`unknown format ${t}`);return}let n=1;return t[t.length-2]==="x"&&(n=Number(t[t.length-1])),n===4?`vec4<${e}>`:n===3?`vec3<${e}>`:n===2?`vec2<${e}>`:e}function Fx(t){if(!t)return 0;let e=1;return t.substring(0,3)==="vec"?e=Number(t[3]):t.substring(0,3)==="mat"&&(e=t[3]*t[5]),e*4}function mx(t){if(t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";j(`unknown format ${t}`)}}var he={getDetailsFromTextureFormat:Mx,getByteStrideFromBufferFormat:Lx,getNumberOfComponentsFromBufferFormat:Vx,getNativeTypeFromBufferFormat:_x,getShaderTypeFromBufferFormat:Bx,getByteStrideFromShaderFormat:Fx,getNativeTypeFromShaderFormat:mx};function Ux(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!e.includes(t[n]))return!1;return!0}function kx(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(n,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",s=r;Array.isArray(s)||(s=[s]);for(let i=0;i<e.inputs.length;i++)if(Ux(e.inputs[i].names,s)){if(e.inputs[i].buffer===n)return;e.inputs[i].buffer=n;return}e.inputs.push({buffer:n,stepMode:a,names:s}),e.inputs=e.inputs.sort((i,o)=>i.names[0]<o.names[0]?-1:i.names[0]>o.names[0]?1:0)},t.removeBufferIfPresent=n=>{for(let r=0;r<e.inputs.length;r++)e.inputs[r].names.includes(n)&&e.inputs.splice(r,1)},t.getBuffer=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer;return null},t.hasAttribute=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return!0;return!1},t.getAttributeTime=n=>{for(let r=0;r<e.inputs.length;r++)if(e.inputs[r].names.includes(n))return e.inputs[r].buffer.getSourceTime();return 0},t.getShaderCode=()=>{let n="",r=0;for(let a=0;a<e.inputs.length;a++)for(let s=0;s<e.inputs[a].names.length;s++){const i=e.inputs[a].buffer.getArrayInformation()[s],o=he.getShaderTypeFromBufferFormat(i.format);r>0&&(n+=`,
`),n=`${n}  @location(${r}) ${e.inputs[a].names[s]} : ${o}`,r++}return n},t.getVertexInputInformation=()=>{const n={};if(e.inputs.length){const r=[];let a=0;for(let s=0;s<e.inputs.length;s++){const i=e.inputs[s].buffer,o={arrayStride:i.getStrideInBytes(),stepMode:e.inputs[s].stepMode,attributes:[]},c=i.getArrayInformation();for(let u=0;u<e.inputs[s].names.length;u++)o.attributes.push({shaderLocation:a,offset:c[u].offset,format:c[u].format}),a++;r.push(o)}n.buffers=r}return n},t.bindBuffers=n=>{for(let r=0;r<e.inputs.length;r++)n.setVertexBuffer(r,e.inputs[r].buffer.getHandle());e.indexBuffer&&n.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=()=>{},t.releaseGraphicsResources=()=>{e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}const Nx={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function wg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Nx,n),ye(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],le(t,e,["created","device","handle","indexBuffer"]),kx(t,e)}const Gx=Z(wg,"vtkWebGPUVertexInput");var bx={newInstance:Gx,extend:wg};const $x=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,zx=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function Wx(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=(n,r,a)=>{const s=Yo.newInstance({type:"vertex",hash:n,code:e.vertexShaderTemplate}),i=Yo.newInstance({type:"fragment",hash:n,code:e.fragmentShaderTemplate}),o=r.getShaderDescriptions();o.push(s),o.push(i);const c=e.vertexShaderTemplate+e.fragmentShaderTemplate,u=new RegExp("//VTK::[^:]*::","g"),f=c.match(u).filter((l,p,y)=>y.indexOf(l)===p).map(l=>`replaceShader${l.substring(7,l.length-2)}`);for(let l=0;l<f.length;l++){const p=f[l];p!=="replaceShaderIOStructs"&&e.shaderReplacements.has(p)&&e.shaderReplacements.get(p)(n,r,a)}t.replaceShaderIOStructs(n,r,a)},t.replaceShaderIOStructs=(n,r,a)=>{const s=r.getShaderDescription("vertex");s.replaceShaderCode(null,a),r.getShaderDescription("fragment").replaceShaderCode(s)},t.replaceShaderRenderEncoder=(n,r,a)=>{e.renderEncoder.replaceShaderCode(r)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=(n,r,a)=>{if(!e.WebGPURenderer)return;const s=e.WebGPURenderer.getBindGroup().getShaderCode(r),i=r.getShaderDescription("vertex");let o=i.getCode();o=H.substitute(o,"//VTK::Renderer::Dec",[s]).result,i.setCode(o);const c=r.getShaderDescription("fragment");o=c.getCode(),o=H.substitute(o,"//VTK::Renderer::Dec",[s]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=(n,r,a)=>{const s=e.bindGroup.getShaderCode(r),i=r.getShaderDescription("vertex");let o=i.getCode();o=H.substitute(o,"//VTK::Mapper::Dec",[s]).result,i.setCode(o);const c=r.getShaderDescription("fragment");c.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),o=c.getCode(),o=H.substitute(o,"//VTK::Mapper::Dec",[s]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=(n,r,a)=>{const s=r.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let i=s.getCode();i=H.substitute(i,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,s.setCode(i)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(n,r,a)=>{r.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=n=>{e.textureViews.includes(n)||e.textureViews.push(n)},t.prepareToDraw=n=>{e.renderEncoder=n,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=()=>{},t.updateBuffers=()=>{},t.updateBindings=()=>{e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=()=>{},t.registerDrawCallback=n=>{n.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=n=>{t.prepareToDraw(n),n.setPipeline(e.pipeline),t.draw(n)},t.draw=n=>{const r=n.getBoundPipeline();n.activateBindGroup(e.bindGroup),e.WebGPURenderer&&e.WebGPURenderer.bindUBO(n),r.bindVertexInput(n,e.vertexInput);const a=e.vertexInput.getIndexBuffer();a?n.drawIndexed(a.getIndexCount(),e.numberOfInstances,0,0,0):n.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=()=>{const n=[...e.additionalBindables];e.UBO&&n.push(e.UBO),e.SSBO&&n.push(e.SSBO);for(let r=0;r<e.textureViews.length;r++){n.push(e.textureViews[r]);const a=e.textureViews[r].getSampler();a&&n.push(a)}return n},t.updatePipeline=()=>{t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=Ex.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}const Hx={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function Eg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Hx,n),ae.extend(t,e,n),e.textureViews=[],e.vertexInput=bx.newInstance(),e.bindGroup=dg.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||zx,e.vertexShaderTemplate=e.vertexShaderTemplate||$x,e.shaderReplacements=new Map,E.get(t,e,["pipeline","vertexInput"]),E.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),Wx(t,e)}const Ax=E.newInstance(Eg,"vtkWebGPUSimpleMapper");var hi={newInstance:Ax,extend:Eg};function jx(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=(n,r,a)=>{const s=r.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),s.addOutput("vec4<f32>","vertexVC");let i=s.getCode();i=H.substitute(i,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,s.setCode(i)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=()=>{const n=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(n,["vertexBC"]),e.numberOfVertices=6}}const Kx={};function Og(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Kx,n),hi.extend(t,e,n),jx(t,e)}const Px=E.newInstance(Og,"vtkWebGPUFullScreenQuad");var rn={newInstance:Px,extend:Og};const Xx={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},Yx={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6};var Wn={BufferUsage:Xx,PrimitiveTypes:Yx};const Pa=["getMappedRange","mapAsync","unmap"];function qx(t,e,n,r){const a=r.byteLength,s=t.createBuffer({size:a,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),i=s.getMappedRange(0,a);new Uint8Array(i).set(new Uint8Array(r)),s.unmap();const o=t.createCommandEncoder();o.copyBufferToBuffer(s,0,e,n,a);const c=o.finish();t.queue.submit([c]),s.destroy()}function Ix(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n,usage:r,label:e.label}),e.sizeInBytes=n,e.usage=r},t.write=n=>{qx(e.device.getHandle(),e.handle,0,n.buffer)},t.createAndWrite=(n,r)=>{e.handle=e.device.getHandle().createBuffer({size:n.byteLength,usage:r,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=n.byteLength,e.usage=r,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(n.buffer)),e.handle.unmap()};for(let n=0;n<Pa.length;n++)t[Pa[n]]=function(){return e.handle[Pa[n]](...arguments)}}const Qx={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function Rg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Qx,n),E.obj(t,e),E.get(t,e,["handle","sizeInBytes","usage"]),E.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),Ix(t,e)}const Zx=E.newInstance(Rg);var an={newInstance:Zx,extend:Rg,...Wn};const{Representation:Io}=vn,{PrimitiveTypes:dt}=Wn;class Jx{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return!0}get(e){for(let n=0;n<this.count;n++)if(this.keys[n]===e)return this.values[n]}set(e,n){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=n)}}function eS(t){switch(t){case dt.Points:return"points";case dt.Lines:return"lines";case dt.Triangles:case dt.TriangleEdges:return"polys";case dt.TriangleStripEdges:case dt.TriangleStrips:return"strips";default:return""}}function cr(t,e,n){let r=t.pointIdToFlatId[e];return r<0&&(r=t.flatId,t.pointIdToFlatId[e]=r,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=n,t.flatId++),r}function tS(t,e,n){const r=t.length;for(let i=0;i<r;i++){let o=t[i];if(n.cellProvokedMap.has(o)){n.ibo[n.iboId++]=n.cellProvokedMap.get(o);for(let c=i+1;c<i+r;c++){o=t[c%r];const u=cr(n,o,e);n.ibo[n.iboId++]=u}return}}for(let i=0;i<r;i++){let o=t[i];if(!n.provokedPointIds[o]){let c=cr(n,o,e);n.provokedPointIds[o]=1,n.cellProvokedMap.set(o,c),n.flatIdToCellId[c]=e,n.ibo[n.iboId++]=c;for(let u=i+1;u<i+r;u++)o=t[u%r],c=cr(n,o,e),n.ibo[n.iboId++]=c;return}}let a=t[0],s=n.flatId;n.cellProvokedMap.set(a,s),n.flatIdToPointId[n.flatId]=a,n.flatIdToCellId[n.flatId]=e,n.flatId++,n.ibo[n.iboId++]=s;for(let i=1;i<r;i++)a=t[i],s=cr(n,a,e),n.ibo[n.iboId++]=s}function nS(t,e,n){const r=t.length;n.iboSize+=r;for(let a=0;a<r;a++){const s=t[a];if(n.cellProvokedMap.has(s))return}for(let a=0;a<r;a++){const s=t[a];if(!n.provokedPointIds[s]){n.provokedPointIds[s]=1,n.cellProvokedMap.set(s,1);return}}n.cellProvokedMap.set(t[0],1),n.extraPoints++}let nt;const Qo=new Uint32Array(1),Me=new Uint32Array(2),gt=new Uint32Array(3),Xa={anythingToPoints(t,e,n,r,a){for(let s=0;s<t;++s)Qo[0]=e[n+s],nt(Qo,r,a)},linesToWireframe(t,e,n,r,a){for(let s=0;s<t-1;++s)Me[0]=e[n+s],Me[1]=e[n+s+1],nt(Me,r,a)},polysToWireframe(t,e,n,r,a){if(t>2)for(let s=0;s<t;++s)Me[0]=e[n+s],Me[1]=e[n+(s+1)%t],nt(Me,r,a)},stripsToWireframe(t,e,n,r,a){if(t>2){for(let s=0;s<t-1;++s)Me[0]=e[n+s],Me[1]=e[n+s+1],nt(Me,r,a);for(let s=0;s<t-2;s++)Me[0]=e[n+s],Me[1]=e[n+s+2],nt(Me,r,a)}},polysToSurface(t,e,n,r,a){for(let s=0;s<t-2;s++)gt[0]=e[n],gt[1]=e[n+s+1],gt[2]=e[n+s+2],nt(gt,r,a)},stripsToSurface(t,e,n,r,a){for(let s=0;s<t-2;s++)gt[0]=e[n+s],gt[1]=e[n+s+1+s%2],gt[2]=e[n+s+1+(s+1)%2],nt(gt,r,a)}};function rS(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=n=>{const r=n.cells,a=n.primitiveType,s=n.representation,i=n.cellOffset,o=r.getData(),c=o.length,u=eS(a),g=n.numberOfPoints,f={provokedPointIds:new Uint8Array(g),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new Jx};let l=null;s===Io.POINTS||a===dt.Points?l=Xa.anythingToPoints:s===Io.WIREFRAME||a===dt.Lines?l=Xa[`${u}ToWireframe`]:l=Xa[`${u}ToSurface`],nt=nS;let p=i||0;for(let y=0;y<c;)f.cellProvokedMap.clear(),l(o[y],o,y+1,p,f),y+=o[y]+1,p++;g<=65535?f.flatIdToPointId=new Uint16Array(g+f.extraPoints):f.flatIdToPointId=new Uint32Array(g+f.extraPoints),g+f.extraPoints<36863?f.pointIdToFlatId=new Int16Array(g):f.pointIdToFlatId=new Int32Array(g),g+f.extraPoints<=65535?(f.ibo=new Uint16Array(f.iboSize),n.format="uint16"):(f.ibo=new Uint32Array(f.iboSize),n.format="uint32"),p<=65535?f.flatIdToCellId=new Uint16Array(g+f.extraPoints):f.flatIdToCellId=new Uint32Array(g+f.extraPoints),f.pointIdToFlatId.fill(-1),f.provokedPointIds.fill(0),nt=tS,p=i||0;for(let y=0;y<c;)f.cellProvokedMap.clear(),l(o[y],o,y+1,p,f),y+=o[y]+1,p++;delete f.provokedPointIds,delete f.pointIdToFlatId,n.nativeArray=f.ibo,e.flatIdToPointId=f.flatIdToPointId,e.flatIdToCellId=f.flatIdToCellId,e.flatSize=f.flatId,e.indexCount=f.iboId}}const aS={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function Dg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,aS,n),an.extend(t,e,n),E.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),rS(t,e)}const sS=E.newInstance(Dg);var iS={newInstance:sS,extend:Dg,...Wn};const{BufferUsage:lt}=Wn,{vtkErrorMacro:oS}=Je,{VtkDataTypes:Ft}=Y,cS={};function fS(t){let e;switch(t.getDataType()){case Ft.UNSIGNED_CHAR:e="uint8";break;case Ft.FLOAT:e="float32";break;case Ft.UNSIGNED_INT:e="uint32";break;case Ft.INT:e="sint32";break;case Ft.DOUBLE:e="float32";break;case Ft.UNSIGNED_SHORT:e="uint16";break;case Ft.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.includes("32")||oS(`unsupported x3 type for ${e}`),e+="x3";break;case 4:e+="x4";break}return e}function Zo(t,e,n,r,a){const s={},i=t.getFlatSize();if(!i)return s;let o=[0,0,0,0];a.shift&&(a.shift.length?o=a.shift:o.fill(a.shift));let c=[1,1,1,1];a.scale&&(a.scale.length?c=a.scale:c.fill(a.scale));const u=Object.prototype.hasOwnProperty.call(a,"packExtra")?a.packExtra:!1;let g,f=0;const l=n+(u?1:0),p=pn(r,i*l);let y=t.getFlatIdToPointId();a.cellData&&(y=t.getFlatIdToCellId()),n===1?g=function(v){p[f++]=c[0]*e[v]+o[0]}:n===2?g=function(v){p[f++]=c[0]*e[v]+o[0],p[f++]=c[1]*e[v+1]+o[1]}:n===3&&!u?g=function(v){p[f++]=c[0]*e[v]+o[0],p[f++]=c[1]*e[v+1]+o[1],p[f++]=c[2]*e[v+2]+o[2]}:n===3&&u?g=function(v){p[f++]=c[0]*e[v]+o[0],p[f++]=c[1]*e[v+1]+o[1],p[f++]=c[2]*e[v+2]+o[2],p[f++]=c[3]*1+o[3]}:n===4&&(g=function(v){p[f++]=c[0]*e[v]+o[0],p[f++]=c[1]*e[v+1]+o[1],p[f++]=c[2]*e[v+2]+o[2],p[f++]=c[3]*e[v+3]+o[3]});for(let h=0;h<i;h++){const v=n*y[h];g(v)}return s.nativeArray=p,s}function uS(t,e,n,r){const a=[t[r*3]-t[n*3],t[r*3+1]-t[n*3+1],t[r*3+2]-t[n*3+2]],s=[t[e*3]-t[n*3],t[e*3+1]-t[n*3+1],t[e*3+2]-t[n*3+2]],i=[];return kn(a,s,i),Nn(i),i}function gS(t,e){const n=e.getData(),r=t.getData();if(!r||!n)return null;const a=new Int8Array(t.getNumberOfCells()*4),s=r.length;let i=0;for(let o=0;o<s;){const c=uS(n,r[o+1],r[o+2],r[o+3]);a[i++]=127*c[0],a[i++]=127*c[1],a[i++]=127*c[2],a[i++]=127,o+=r[o]+1}return a}function lS(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function n(r){r.dataArray&&!r.nativeArray&&(r.nativeArray=r.dataArray.getData());let a,s;if(r.usage===lt.Index&&(a=iS.newInstance({label:r.label}),a.setDevice(e.device),s=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,a.buildIndexBuffer(r),a.createAndWrite(r.nativeArray,s),a.setArrayInformation([{format:r.format}])),a||(a=an.newInstance({label:r.label}),a.setDevice(e.device)),r.usage===lt.UniformArray&&(s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a.createAndWrite(r.nativeArray,s)),r.usage===lt.Storage&&(s=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,a.createAndWrite(r.nativeArray,s)),r.usage===lt.Texture&&(s=GPUBufferUsage.COPY_SRC,a.createAndWrite(r.nativeArray,s)),r.usage===lt.PointArray){s=GPUBufferUsage.VERTEX;const i=he.getNativeTypeFromBufferFormat(r.format),o=Zo(r.indexBuffer,r.dataArray.getData(),r.dataArray.getNumberOfComponents(),i,{packExtra:r.packExtra,shift:r.shift,scale:r.scale,cellData:r.cellData,cellOffset:r.cellOffset});a.createAndWrite(o.nativeArray,s),a.setStrideInBytes(he.getByteStrideFromBufferFormat(r.format)),a.setArrayInformation([{offset:0,format:r.format,interpolation:r.cellData?"flat":"perspective"}])}if(r.usage===lt.NormalsFromPoints){s=GPUBufferUsage.VERTEX;const i=he.getNativeTypeFromBufferFormat(r.format),o=gS(r.cells,r.dataArray),c=Zo(r.indexBuffer,o,4,i,{cellData:!0});a.createAndWrite(c.nativeArray,s),a.setStrideInBytes(he.getByteStrideFromBufferFormat(r.format)),a.setArrayInformation([{offset:0,format:r.format,interpolation:"flat"}])}return r.usage===lt.RawVertex&&(s=GPUBufferUsage.VERTEX,a.createAndWrite(r.nativeArray,s),a.setStrideInBytes(he.getByteStrideFromBufferFormat(r.format)),a.setArrayInformation([{offset:0,format:r.format}])),a.setSourceTime(r.time),a}t.hasBuffer=r=>e.device.hasCachedObject(r),t.getBuffer=r=>r.hash?e.device.getCachedObject(r.hash,n,r):n(r),t.getBufferForPointArray=(r,a)=>{const s=fS(r),i={hash:`${r.getMTime()}I${a.getMTime()}${s}`,usage:lt.PointArray,format:s,dataArray:r,indexBuffer:a};return t.getBuffer(i)},t.getFullScreenQuadBuffer=()=>{if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=an.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);const r=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(r,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}const pS={device:null,fullScreenQuadBuffer:null};function Mg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pS,n),ye(t,e),le(t,e,["device"]),lS(t,e)}const hS=Z(Mg);var Rt={newInstance:hS,extend:Mg,...cS,...Wn};const{BufferUsage:vS}=Rt,{vtkErrorMacro:Yt}=E;function yS(t,e){e.classHierarchy.push("vtkWebGPUStorageBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){Yt(`entry named ${n} already exists`);return}e._bufferEntryNames.set(n,e.bufferEntries.length);const a=he.getByteStrideFromShaderFormat(r);e.bufferEntries.push({name:n,type:r,sizeInBytes:a,offset:e.sizeInBytes,nativeType:he.getNativeTypeFromShaderFormat(r)}),e.sizeInBytes+=a},t.send=n=>{if(!e._buffer){const r={nativeArray:e.Float32Array,usage:vS.Storage,label:e.label};e._buffer=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e._sendTime.modified();return}n.getHandle().queue.writeBuffer(e._buffer.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes*e.numberOfInstances),e._sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes*e.numberOfInstances)),e[n]=E.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r,a)=>{const s=e._bufferEntryNames.get(n);if(s===void 0){Yt(`entry named ${n} not found in UBO`);return}const i=e.bufferEntries[s];t.createView(i.nativeType);const o=e[i.nativeType];o[(i.offset+r*e.sizeInBytes)/o.BYTES_PER_ELEMENT]=a},t.setArray=(n,r,a)=>{const s=e._bufferEntryNames.get(n);if(s===void 0){Yt(`entry named ${n} not found in UBO`);return}const i=e.bufferEntries[s];t.createView(i.nativeType);const o=e[i.nativeType],c=(i.offset+r*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let u=0;u<a.length;u++)o[c+u]=a[u]},t.setAllInstancesFromArray=(n,r)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){Yt(`entry named ${n} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const i=e[s.nativeType],o=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const u=(s.offset+c*e.sizeInBytes)/i.BYTES_PER_ELEMENT;for(let g=0;g<o;g++)i[u+g]=r[c*o+g]}},t.setAllInstancesFromArrayColorToFloat=(n,r)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){Yt(`entry named ${n} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const i=e[s.nativeType],o=r.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const u=(s.offset+c*e.sizeInBytes)/i.BYTES_PER_ELEMENT;for(let g=0;g<o;g++)i[u+g]=r[c*o+g]/255}},t.setAllInstancesFromArray3x3To4x4=(n,r)=>{const a=e._bufferEntryNames.get(n);if(a===void 0){Yt(`entry named ${n} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const i=e[s.nativeType],o=9;for(let c=0;c<e.numberOfInstances;c++){const u=(s.offset+c*e.sizeInBytes)/i.BYTES_PER_ELEMENT;for(let g=0;g<3;g++)for(let f=0;f<3;f++)i[u+g*4+f]=r[c*o+g*3+f]}},t.getSendTime=()=>e._sendTime.getMTime(),t.getShaderCode=(n,r)=>{const a=[`struct ${e.label}StructEntry
{`];for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];a.push(`  ${i.name}: ${i.type},`)}return a.push(`
};
struct ${e.label}Struct
{
  values: array<${e.label}StructEntry>,
};
@binding(${n}) @group(${r}) var<storage, read> ${e.label}: ${e.label}Struct;
`),a.join(`
`)},t.getBindGroupEntry=()=>({resource:{buffer:e._buffer.getHandle()}}),t.clearData=()=>{e.numberOfInstances=0,e.sizeInBytes=0,e.bufferEntries=[],e._bufferEntryNames=new Map,e._buffer=null,delete e.arrayBuffer,delete e.Float32Array}}const dS={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function Lg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,dS,n),E.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e._sendTime={},E.obj(e._sendTime,{mtime:0}),e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},E.get(t,e,["bindGroupTime"]),E.setGet(t,e,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),yS(t,e)}const TS=E.newInstance(Lg,"vtkWebGPUStorageBuffer");var _s={newInstance:TS,extend:Lg};const{BufferUsage:xS}=Rt,{vtkErrorMacro:Ya}=E;function SS(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=(n,r)=>{if(e._bufferEntryNames.has(n)){Ya(`entry named ${n} already exists`);return}e.sortDirty=!0,e._bufferEntryNames.set(n,e.bufferEntries.length),e.bufferEntries.push({name:n,type:r,sizeInBytes:he.getByteStrideFromShaderFormat(r),offset:-1,nativeType:he.getNativeTypeFromShaderFormat(r),packed:!1})},t.sortBufferEntries=()=>{if(!e.sortDirty)return;let n=0;const r=[];let a=4;for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];i.sizeInBytes%16===0&&(a=Math.max(16,a)),i.sizeInBytes%8===0&&(a=Math.max(8,a))}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];i.packed===!1&&i.sizeInBytes%16===0&&(i.packed=!0,i.offset=n,r.push(i),n+=i.sizeInBytes)}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];if(i.packed===!1&&i.sizeInBytes===12)for(let o=0;o<e.bufferEntries.length;o++){const c=e.bufferEntries[o];if(c.packed===!1&&c.sizeInBytes===4){i.packed=!0,i.offset=n,r.push(i),n+=i.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];if(!i.packed&&i.sizeInBytes%8===0)for(let o=s+1;o<e.bufferEntries.length;o++){const c=e.bufferEntries[o];if(!c.packed&&c.sizeInBytes%8===0){i.packed=!0,i.offset=n,r.push(i),n+=i.sizeInBytes,c.packed=!0,c.offset=n,r.push(c),n+=c.sizeInBytes;break}}}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];if(!i.packed&&i.sizeInBytes%8===0){let o=!1;for(let c=0;!o&&c<e.bufferEntries.length;c++){const u=e.bufferEntries[c];if(!u.packed&&u.sizeInBytes===4)for(let g=c+1;g<e.bufferEntries.length;g++){const f=e.bufferEntries[g];if(!f.packed&&f.sizeInBytes===4){i.packed=!0,i.offset=n,r.push(i),n+=i.sizeInBytes,u.packed=!0,u.offset=n,r.push(u),n+=u.sizeInBytes,f.packed=!0,f.offset=n,r.push(f),n+=f.sizeInBytes,o=!0;break}}}}}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];!i.packed&&i.sizeInBytes>4&&(i.packed=!0,i.offset=n,r.push(i),n+=i.sizeInBytes)}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];i.packed||(i.packed=!0,i.offset=n,r.push(i),n+=i.sizeInBytes)}e.bufferEntries=r,e._bufferEntryNames.clear();for(let s=0;s<e.bufferEntries.length;s++)e._bufferEntryNames.set(e.bufferEntries[s].name,s);e.sizeInBytes=n,e.sizeInBytes=a*Math.ceil(e.sizeInBytes/a),e.sortDirty=!1},t.sendIfNeeded=n=>{if(!e.UBO){const r={nativeArray:e.Float32Array,usage:xS.UniformArray,label:e.label};e.UBO=n.getBufferManager().getBuffer(r),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(n.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=n=>{n in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[n]=E.newTypedArray(n,e.arrayBuffer))},t.setValue=(n,r)=>{t.sortBufferEntries();const a=e._bufferEntryNames.get(n);if(a===void 0){Ya(`entry named ${n} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const i=e[s.nativeType];s.lastValue!==r&&(i[s.offset/i.BYTES_PER_ELEMENT]=r,e.sendDirty=!0),s.lastValue=r},t.setArray=(n,r)=>{t.sortBufferEntries();const a=e._bufferEntryNames.get(n);if(a===void 0){Ya(`entry named ${n} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const i=e[s.nativeType];let o=!1;for(let c=0;c<r.length;c++)(!s.lastValue||s.lastValue[c]!==r[c])&&(i[s.offset/i.BYTES_PER_ELEMENT+c]=r[c],o=!0);o&&(e.sendDirty=!0,s.lastValue=[...r])},t.getBindGroupEntry=()=>({resource:{buffer:e.UBO.getHandle()}}),t.getSendTime=()=>e.sendTime.getMTime(),t.getShaderCode=(n,r)=>{t.sortBufferEntries();const a=[`struct ${e.label}Struct
{`];for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];a.push(`  ${i.name}: ${i.type},`)}return a.push(`};
@binding(${n}) @group(${r}) var<uniform> ${e.label}: ${e.label}Struct;`),a.join(`
`)}}const CS={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function Vg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CS,n),E.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},E.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,E.get(t,e,["binding","bindGroupTime"]),E.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),SS(t,e)}const wS=E.newInstance(Vg,"vtkWebGPUUniformBuffer");var Wt={newInstance:wS,extend:Vg};const{vtkDebugMacro:ES}=Je,Jo=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`,OS=`
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);
  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);
  // textureSampleLevel gets rid of some ugly artifacts
  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);
  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);

  //VTK::RenderEncoder::Impl
  return output;
}
`,fr=new Float64Array(16),ec=new Float64Array(16);function RS(t){return t.getPositional()?t.getConeAngle()>=90?0:2:1}function DS(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=n=>{if(n){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=()=>{const n=e.camera.getClippingRange(),r=e.camera.getPositionByReference(),a=e.camera.getDirectionOfProjectionByReference(),s=[],i=[];ht(i,a,.5*(n[0]+n[1])),On(s,r,i),ps(i,s,e.stabilizedCenter),Wc(i)/(n[1]-n[0])>e.recenterThreshold&&(e.stabilizedCenter=s,e.stabilizedTime.modified())},t.updateLights=()=>{let n=0;const r=e.renderable.getLightsByReference();for(let a=0;a<r.length;++a)r[a].getSwitch()>0&&n++;return n||(ES("No lights are on, creating one."),e.renderable.createLight()),n},t.updateUBO=()=>{var r;const n=e.UBO.getSendTime();if(e._parent.getMTime()>n||t.getMTime()>n||e.camera.getMTime()>n||e.renderable.getMTime()>n){const a=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",a.wcvc),e.UBO.setArray("SCPCMatrix",a.scpc),e.UBO.setArray("PCSCMatrix",a.pcsc),e.UBO.setArray("SCVCMatrix",a.scvc),e.UBO.setArray("VCPCMatrix",a.vcpc),e.UBO.setArray("WCVCNormals",a.normalMatrix),e.UBO.setValue("LightCount",e.renderable.getLights().length),e.UBO.setValue("MaxEnvironmentMipLevel",(r=e.renderable.getEnvironmentTexture())==null?void 0:r.getMipLevel()),e.UBO.setValue("BackgroundDiffuseStrength",e.renderable.getEnvironmentTextureDiffuseStrength()),e.UBO.setValue("BackgroundSpecularStrength",e.renderable.getEnvironmentTextureSpecularStrength());const s=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[s.usize,s.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());const i=e._parent.getDevice();e.UBO.sendIfNeeded(i)}},t.updateSSBO=()=>{const n=e.renderable.getLights(),r=e.webgpuCamera.getKeyMatrices(t);let a=`${e.renderable.getMTime()}`;for(let s=0;s<n.length;s++)a+=n[s].getMTime();if(a!==e.lightTimeString){const s=new Float32Array(n.length*4),i=new Float32Array(n.length*4),o=new Float32Array(n.length*4),c=new Float32Array(n.length*4);for(let g=0;g<n.length;g++){const f=g*4,l=n[g].getPosition();q(l,l,r.wcvc),s[f]=l[0],s[f+1]=l[1],s[f+2]=l[2],s[f+3]=0,i[f]=-n[g].getDirection()[0],i[f+1]=-n[g].getDirection()[1],i[f+2]=-n[g].getDirection()[2],i[f+3]=0,o[f]=n[g].getColor()[0],o[f+1]=n[g].getColor()[1],o[f+2]=n[g].getColor()[2],o[f+3]=n[g].getIntensity()*5,c[f]=RS(n[g]),c[f+1]=Math.cos(ie(n[g].getConeAngle())),c[f+2]=Math.cos(ie(n[g].getConeAngle()+n[g].getConeFalloff())),c[f+3]=0}e.SSBO.clearData(),e.SSBO.setNumberOfInstances(n.length),e.SSBO.addEntry("LightPos","vec4<f32>"),e.SSBO.addEntry("LightDir","vec4<f32>"),e.SSBO.addEntry("LightColor","vec4<f32>"),e.SSBO.addEntry("LightData","vec4<f32>"),e.SSBO.setAllInstancesFromArray("LightPos",s),e.SSBO.setAllInstancesFromArray("LightDir",i),e.SSBO.setAllInstancesFromArray("LightColor",o),e.SSBO.setAllInstancesFromArray("LightData",c);const u=e._parent.getDevice();e.SSBO.send(u)}e.lightTimeString=a},t.scissorAndViewport=n=>{const r=t.getYInvertedTiledSizeAndOrigin();n.getHandle().setViewport(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize,0,1),n.getHandle().setScissorRect(r.lowerLeftU,r.lowerLeftV,r.usize,r.vsize)},t.bindUBO=n=>{n.activateBindGroup(e.bindGroup)},t.opaquePass=n=>{n?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO(),t.updateSSBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=()=>{var s;if(e.renderable.getTransparent()||e.suppressClear)return;const n=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=rn.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(Jo);const i=Wt.newInstance({label:"mapperUBO"});i.addEntry("FSQMatrix","mat4x4<f32>"),i.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(i),e.backgroundTex=e.renderable.getEnvironmentTexture()}if(e.clearFSQ.getPipelineHash()!=="clearfsqwithtexture"&&e.renderable.getUseEnvironmentTextureAsBackground()&&((s=e.backgroundTex)!=null&&s.getImageLoaded())){e.clearFSQ.setFragmentShaderTemplate(OS);const i=Wt.newInstance({label:"mapperUBO"});i.addEntry("FSQMatrix","mat4x4<f32>"),i.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(i);const o=n.getTextureManager().getTextureForVTKTexture(e.backgroundTex);if(o.getReady()){const c=o.createView("EnvironmentTexture");e.clearFSQ.setTextureViews([c]),e.backgroundTexLoaded=!0;const u=e.backgroundTex.getInterpolate()?"linear":"nearest";c.addSampler(n,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:u,magFilter:u,mipmapFilter:"linear"})}e.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if(e.clearFSQ.getPipelineHash()==="clearfsqwithtexture"&&!e.renderable.getUseEnvironmentTextureAsBackground()){e.clearFSQ=rn.newInstance(),e.clearFSQ.setDevice(n),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(Jo);const i=Wt.newInstance({label:"mapperUBO"});i.addEntry("FSQMatrix","mat4x4<f32>"),i.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(i)}const r=e.webgpuCamera.getKeyMatrices(t),a=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",a),te(ec,r.normalMatrix),us(fr,r.scvc,r.pcsc),us(fr,ec,fr),e.clearFSQ.getUBO().setArray("FSQMatrix",fr),e.clearFSQ.getUBO().sendIfNeeded(n),e.clearFSQ.prepareAndDraw(e.renderEncoder)},t.translucentPass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=n=>{n?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=()=>{const n=e._parent.getSizeByReference(),r=e.renderable.getViewportByReference();return n[0]*(r[2]-r[0])/((r[3]-r[1])*n[1])},t.convertToOpenGLDepth=n=>e.webgpuCamera.convertToOpenGLDepth(n),t.getYInvertedTiledSizeAndOrigin=()=>{const n=t.getTiledSizeAndOrigin(),r=e._parent.getSizeByReference();return n.lowerLeftV=r[1]-n.vsize-n.lowerLeftV,n},t.getTiledSizeAndOrigin=()=>{const n=e.renderable.getViewportByReference(),r=[0,0,1,1],a=n[0]-r[0],s=n[1]-r[1],i=e._parent.normalizedDisplayToDisplay(a,s),o=Math.round(i[0]),c=Math.round(i[1]),u=n[2]-r[0],g=n[3]-r[1],f=e._parent.normalizedDisplayToDisplay(u,g);let l=Math.round(f[0])-o,p=Math.round(f[1])-c;return l<0&&(l=0),p<0&&(p=0),{usize:l,vsize:p,lowerLeftU:o,lowerLeftV:c}},t.getPropFromID=n=>{for(let r=0;r<e.children.length;r++)if((e.children[r].getPropID?e.children[r].getPropID():-1)===n)return e.children[r];return null},t.getStabilizedTime=()=>e.stabilizedTime.getMTime(),t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources()}}const MS={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function LS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,MS,n),ae.extend(t,e,n),e.UBO=Wt.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("LightCount","i32"),e.UBO.addEntry("MaxEnvironmentMipLevel","f32"),e.UBO.addEntry("BackgroundDiffuseStrength","f32"),e.UBO.addEntry("BackgroundSpecularStrength","f32"),e.UBO.addEntry("cameraParallel","u32"),e.SSBO=_s.newInstance({label:"rendererLightSSBO"}),e.lightTimeString="",e.bindGroup=dg.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO,e.SSBO]),e.tmpMat4=A(new Float64Array(16)),e.stabilizedTime={},ye(e.stabilizedTime,{mtime:0}),Re(t,e,["bindGroup","stabilizedTime"]),hn(t,e,["stabilizedCenter"]),le(t,e,["renderEncoder","selector","suppressClear","UBO"]),DS(t,e)}const VS=Z(LS,"vtkWebGPURenderer");et("vtkRenderer",VS);const{CoordinateSystem:tc}=zn;function _S(t,e){e.classHierarchy.push("vtkWebGPUActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const r=e.renderable.getMatrix();e.bufferShift[0]=r[3],e.bufferShift[1]=r[7],e.bufferShift[2]=r[11];const a=n.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===tc.WORLD&&(e.bufferShift[0]-=a[0],e.bufferShift[1]-=a[1],e.bufferShift[2]-=a[2]),te(e.keyMatrices.bcwc,r),e.renderable.getIsIdentity()?A(e.keyMatrices.normalMatrix):(de(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Oe(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),te(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),oe(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===tc.WORLD?oe(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-a[0],-a[1],-a[2]]):de(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const BS={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function FS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BS,n),ae.extend(t,e,n),e.keyMatricesTime={},E.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},E.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],_S(t,e)}const mS=E.newInstance(FS);et("vtkActor",mS);const{CoordinateSystem:nc}=zn;function US(t,e){e.classHierarchy.push("vtkWebGPUActor2D"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.traverseTranslucentPass=n=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(n,!0),e.children[0]&&e.children[0].traverse(n),t.apply(n,!1))},t.queryPass=(n,r)=>{if(n){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?r.incrementOpaqueActorCount():r.incrementTranslucentActorCount()}},t.getBufferShift=n=>(t.getKeyMatrices(n),e.bufferShift),t.getKeyMatrices=n=>{if(Math.max(e.renderable.getMTime(),n.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.bufferShift[0]=0,e.bufferShift[1]=0,e.bufferShift[2]=0;const r=n.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===nc.WORLD&&(e.bufferShift[0]-=r[0],e.bufferShift[1]-=r[1],e.bufferShift[2]-=r[2]),A(e.keyMatrices.bcwc),A(e.keyMatrices.normalMatrix),oe(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===nc.WORLD?oe(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-r[0],-r[1],-r[2]]):de(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const kS={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function NS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,kS,n),ae.extend(t,e,n),e.keyMatricesTime={},E.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},E.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],US(t,e)}const GS=E.newInstance(NS);et("vtkActor2D",GS);function bS(t,e){e.classHierarchy.push("vtkWebGPUCubeAxesActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const a=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,s=e.WebGPURenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([s.usize,s.vsize],a,e.WebGPURenderWindow.getRenderable())}}}const $S={};function zS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$S,n),ae.extend(t,e,n),e.CubeAxesActorHelper=Yu.newCubeAxesActorHelper(),bS(t,e)}const WS=Z(zS,"vtkWebGPUCubeAxesActor");et("vtkCubeAxesActor",WS);const{DisplayLocation:Bs}=fg;function HS(t,e){e.classHierarchy.push("vtkProperty2D"),t.setDisplayLocationToBackground=()=>t.setDisplayLocation(Bs.BACKGROUND),t.setDisplayLocationToForeground=()=>t.setDisplayLocation(Bs.FOREGROUND),t.setRepresentationToWireframe=()=>t.setRepresentation(Ve.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(Ve.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(Ve.POINTS),t.getRepresentationAsString=()=>E.enumToString(Ve,e.representation)}const AS={color:[1,1,1],opacity:1,pointSize:1,lineWidth:1,representation:Ve.SURFACE,displayLocation:Bs.FOREGROUND};function jS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,AS,n),E.obj(t,e),E.setGet(t,e,["opacity","lineWidth","pointSize","displayLocation","representation"]),E.setGetArray(t,e,["color"],3),HS(t,e)}E.newInstance(jS,"vtkProperty2D");var KS={...fg};const{BufferUsage:pe,PrimitiveTypes:xe}=Rt,{Representation:ur}=vn,{ScalarMode:gr}=Ze,{CoordinateSystem:PS}=zn,{DisplayLocation:XS}=KS,YS=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,qS=`
struct PBRData {
  diffuse: vec3<f32>,
  specular: vec3<f32>,
}

// Dot product with the max already in it
fn mdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  return max(0.0, dot(a, b));
}
// Dot product with a max in it that does not allow for negative values
// Physically based rendering is accurate as long as normals are accurate,
// however this is pretty often not the case. In order to prevent negative
// values from ruining light calculations and creating zones of zero light,
// this remapping is used, which smoothly clamps the dot product between
// zero and one while still maintaining a good amount of accuracy.
fn cdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  var d: f32 = max(0.0, dot(a, b));
  d = pow((d + 1.0) / 2.0, 2.6);
  return d;
}

// Lambertian diffuse model
fn lambertDiffuse(base: vec3<f32>, N: vec3<f32>, L: vec3<f32>) -> vec3<f32> {
  var pi: f32 = 3.14159265359; 
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5);
  return (base/pi)*NdotL;
}

// Yasuhiro Fujii improvement on the Oren-Nayar model
// https://mimosa-pudica.net/improved-oren-nayar.html
// p is surface color, o is roughness
fn fujiiOrenNayar(p: vec3<f32>, o: f32, N: vec3<f32>, L: vec3<f32>, V: vec3<f32>) -> vec3<f32> {
  var invpi: f32 = 0.31830988618; // 1/pi

  var o2 = o*o;
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5); // Less physically accurate, but hides the "seams" between lights better

  var NdotV: f32 = mdot(N, V);
  var LdotV: f32 = mdot(L, V);

  var s: f32 = LdotV - NdotL*NdotV;
  var t: f32 = mix(1.0, max(NdotL, NdotV), step(0.0, s)); // Mix with step is the equivalent of an if statement
  var A: vec3<f32> = 0.5*(o2 / (o2 + 0.33)) + 0.17*p*(o2 / (o2 + 0.13));
  A = invpi*(1 - A);
  var B: f32 = 0.45*(o2 / (o2 + 0.09));
  B = invpi*B;

  return p*NdotL*(A + B*(s/t));
}

// Fresnel portion of BRDF (IOR only, simplified)
fn schlickFresnelIOR(V: vec3<f32>, N: vec3<f32>, ior: f32, k: f32) -> f32 {
  var NdotV: f32 = mdot(V, N);
  var F0: f32 = (pow((ior - 1.0), 2.0) + k*k) / (pow((ior + 1.0), 2.0) + k*k); // This takes into account the roughness, which the other one does not
  return F0 + (1.0 - F0) * pow((1.0-NdotV), 5.0);
}

// Fresnel portion of BRDF (Color ior, better)
fn schlickFresnelRGB(V: vec3<f32>, N: vec3<f32>, F0: vec3<f32>) -> vec3<f32> {
  var NdotV: f32 = mdot(V, N);
  return F0 + (1.0 - F0) * pow((1-NdotV), 5.0);
}

// Normal portion of BRDF
// https://learnopengl.com/PBR/Theory
// Trowbridge-Reitz GGX functions: normal, halfway, roughness^2
fn trGGX(N: vec3<f32>, H: vec3<f32>, a: f32) -> f32 {
  var pi: f32 = 3.14159265359; 

  var a2: f32 = a*a;
  var NdotH = mdot(N, H);
  var NdotH2 = NdotH*NdotH;
  
  var denom: f32 = NdotH2 * (a2 - 1.0) + 1.0;

  return a2 / max((pi*denom*denom), 0.000001);
}

// A VERY bad approximation of anisotropy. Real anisotropic calculations require tangent and bitangent
fn anisotrophicTrGGX(N: vec3<f32>, H: vec3<f32>, O: vec3<f32>, s: f32, a: f32) -> f32 {
  var Op: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(O) * s, 0.)).xyz;

  var ggx1: f32 = trGGX(N + Op*s, H, a);
  var ggx2: f32 = trGGX(N - Op*s, H, a);
  return (0.5 * ggx1 + 0.5 * ggx2);
}

// Geometry portion of BRDF
fn schlickGGX(N: vec3<f32>, X: vec3<f32>, k: f32) -> f32 {
  var NdotX = cdot(N, X);
  return NdotX / max(0.000001, (NdotX*(1.0-k) + k));
}

fn smithSurfaceRoughness(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, k: f32) -> f32 {
  var ggx1: f32 = min(1.0, schlickGGX(N, V, k));
  var ggx2: f32 = min(1.0, schlickGGX(N, L, k));
  return ggx1*ggx2;
}

// BRDF Combination
fn cookTorrance(D: f32, F: f32, G: f32, N: vec3<f32>, V: vec3<f32>, L: vec3<f32>) -> f32 {
  var num: f32 = D*F*G;
  var denom: f32 = 4*cdot(V, N)*cdot(L, N);

  return num / max(denom, 0.000001);
}

// Different lighting calculations for different light sources
fn calcDirectionalLight(N: vec3<f32>, V: vec3<f32>, ior: f32, roughness: f32, metallic: f32, direction: vec3<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {  
  var L: vec3<f32> = normalize(direction); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2;

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L); // Fresnel term is replaced with 1 because it is added later
  var incoming: vec3<f32> = color;
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5);

  var specular: vec3<f32> = brdf*incoming*angle;
  // Oren-Nayar gives a clay-like effect when fully rough which some people may not want, so it might be better to give a separate
  // control property for the diffuse vs specular roughness
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V); 
  // Stores the specular and diffuse separately to allow for finer post processing
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// TODO: find some way to reduce the number of arguments going in here
fn calcPointLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, ior: f32, roughness: f32, metallic: f32, position: vec3<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {
  var L: vec3<f32> = normalize(position - fragPos); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(position, fragPos);

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  var incoming: vec3<f32> = color * (1.0 / (dist*dist));
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" bewteen light sources

  var specular: vec3<f32> = brdf*incoming*angle;
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// For a reason unknown to me, spheres dont seem to behave propperly with head-on spot lights
fn calcSpotLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, ior: f32, roughness: f32, metallic: f32, position: vec3<f32>, direction: vec3<f32>, cones: vec2<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {
  var L: vec3<f32> = normalize(position - fragPos);
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(position, fragPos);

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  
  // Cones.x is the inner phi and cones.y is the outer phi
  var theta: f32 = mdot(normalize(direction), L);
  var epsilon: f32 = cones.x - cones.y;
  var intensity: f32 = (theta - cones.y) / epsilon;
  intensity = clamp(intensity, 0.0, 1.0);
  intensity /= dist*dist;

  var incoming: vec3<f32> = color * intensity;

  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" bewteen light sources

  var specular: vec3<f32> = brdf*incoming*angle;
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// Environment mapping stuff
// Takes in a vector and converts it to an equivalent coordinate in a rectilinear texture. Should be replaced with cubemaps at some point
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::TCoord::Dec

// optional surface normal declaration
//VTK::Normal::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  // Temporary ambient, diffuse, and opacity
  var ambientColor: vec4<f32> = mapperUBO.AmbientColor;
  var diffuseColor: vec4<f32> = mapperUBO.DiffuseColor;
  var opacity: f32 = mapperUBO.Opacity;

  // This should be declared somewhere else
  var _diffuseMap: vec4<f32> = vec4<f32>(1.0);
  var _roughnessMap: vec4<f32> = vec4<f32>(1.0);
  var _metallicMap: vec4<f32> = vec4<f32>(1.0);
  var _normalMap: vec4<f32> = vec4<f32>(0.0, 0.0, 1.0, 0.0); // normal map was setting off the normal vector detection in fragment
  var _ambientOcclusionMap: vec4<f32> = vec4<f32>(1.);
  var _emissionMap: vec4<f32> = vec4<f32>(0.);

  //VTK::Color::Impl

  //VTK::TCoord::Impl

  //VTK::Normal::Impl

  var computedColor: vec4<f32> = vec4<f32>(diffuseColor.rgb, 1.0);

  //VTK::Light::Impl

  //VTK::Select::Impl

  if (computedColor.a == 0.0) { discard; };

  //VTK::Position::Impl

  //VTK::RenderEncoder::Impl

  return output;
}
`;function rc(t){return t.indexOf("edge")>=0}function IS(t,e){e.classHierarchy.push("vtkWebGPUCellArrayMapper"),t.buildPass=n=>{n&&(e.is2D?(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.forceZValue=!0):(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.forceZValue=!1),e.coordinateSystem=e.WebGPUActor.getRenderable().getCoordinateSystem(),e.useRendererMatrix=e.coordinateSystem!==PS.DISPLAY,e.WebGPURenderer=e.WebGPUActor.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice())},t.translucentPass=n=>{n&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.opaquePass=n=>{n&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.updateUBO=()=>{var s;const r=e.WebGPUActor.getRenderable().getProperty(),a=e.UBO.getSendTime();if(t.getMTime()>a||r.getMTime()>a||e.renderable.getMTime()>a){const i=e.WebGPUActor.getKeyMatrices(e.WebGPURenderer);if(e.UBO.setArray("BCWCMatrix",i.bcwc),e.UBO.setArray("BCSCMatrix",i.bcsc),e.UBO.setArray("MCWCNormals",i.normalMatrix),e.is2D){e.UBO.setValue("ZValue",e.WebGPUActor.getRenderable().getProperty().getDisplayLocation()===XS.FOREGROUND?1:0);const u=r.getColorByReference();e.UBO.setValue("AmbientIntensity",1),e.UBO.setArray("DiffuseColor",[u[0],u[1],u[2],1]),e.UBO.setValue("DiffuseIntensity",0),e.UBO.setValue("SpecularIntensity",0)}else{let u=r.getAmbientColorByReference();e.UBO.setValue("AmbientIntensity",r.getAmbient()),e.UBO.setArray("AmbientColor",[u[0],u[1],u[2],1]),e.UBO.setValue("DiffuseIntensity",r.getDiffuse()),u=r.getDiffuseColorByReference(),e.UBO.setArray("DiffuseColor",[u[0],u[1],u[2],1]),e.UBO.setValue("Roughness",r.getRoughness()),e.UBO.setValue("BaseIOR",r.getBaseIOR()),e.UBO.setValue("Metallic",r.getMetallic()),e.UBO.setValue("NormalStrength",r.getNormalStrength()),e.UBO.setValue("Emission",r.getEmission()),e.UBO.setValue("SpecularIntensity",r.getSpecular()),u=r.getSpecularColorByReference(),e.UBO.setArray("SpecularColor",[u[0],u[1],u[2],1])}const o=(s=r.getEdgeColorByReference)==null?void 0:s.call(r);o&&e.UBO.setArray("EdgeColor",[o[0],o[1],o[2],1]),e.UBO.setValue("LineWidth",r.getLineWidth()),e.UBO.setValue("Opacity",r.getOpacity()),e.UBO.setValue("PropID",e.WebGPUActor.getPropID());const c=e.WebGPURenderWindow.getDevice();e.UBO.sendIfNeeded(c)}},t.haveWideLines=()=>{const n=e.WebGPUActor.getRenderable(),r=n.getProperty().getRepresentation();return n.getProperty().getLineWidth()<=1||e.primitiveType===xe.Verts?!1:e.primitiveType===xe.Triangles||e.primitiveType===xe.TriangleStrips?r===ur.WIREFRAME:!0},t.replaceShaderPosition=(n,r,a)=>{const s=r.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),s.hasOutput("vertexVC")||s.addOutput("vec4<f32>","vertexVC");let i=s.getCode();e.useRendererMatrix?(i=H.substitute(i,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = rendererUBO.SCPCMatrix*mapperUBO.BCSCMatrix*vertexBC;","    output.vertexVC = rendererUBO.SCVCMatrix * mapperUBO.BCSCMatrix * vec4<f32>(vertexBC.xyz, 1.0);","//VTK::Position::Impl"]).result,e.forceZValue&&(i=H.substitute(i,"//VTK::Position::Impl",["pCoord = vec4<f32>(pCoord.xyz/pCoord.w, 1.0);","pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)):(i=H.substitute(i,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = mapperUBO.BCSCMatrix*vertexBC;","    pCoord.x = 2.0* pCoord.x / rendererUBO.viewportSize.x - 1.0;","    pCoord.y = 2.0* pCoord.y / rendererUBO.viewportSize.y - 1.0;","    pCoord.z = 0.5 - 0.5 * pCoord.z;","//VTK::Position::Impl"]).result,e.forceZValue&&(i=H.substitute(i,"//VTK::Position::Impl",["    pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)),t.haveWideLines()&&(s.addBuiltinInput("u32","@builtin(instance_index) instanceIndex"),i=H.substitute(i,"//VTK::Position::Impl",["    var tmpPos: vec4<f32> = pCoord;","    var numSteps: f32 = ceil(mapperUBO.LineWidth - 1.0);","    var offset: f32 = (mapperUBO.LineWidth - 1.0) * (f32(input.instanceIndex / 2u) - numSteps/2.0) / numSteps;","    var tmpPos2: vec3<f32> = tmpPos.xyz / tmpPos.w;","    tmpPos2.x = tmpPos2.x + 2.0 * (f32(input.instanceIndex) % 2.0) * offset / rendererUBO.viewportSize.x;","    tmpPos2.y = tmpPos2.y + 2.0 * (f32(input.instanceIndex + 1u) % 2.0) * offset / rendererUBO.viewportSize.y;","    tmpPos2.z = min(1.0, tmpPos2.z + 0.00001);","    pCoord = vec4<f32>(tmpPos2.xyz * tmpPos.w, tmpPos.w);","//VTK::Position::Impl"]).result),i=H.substitute(i,"//VTK::Position::Impl",["    output.Position = pCoord;"]).result,s.setCode(i)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderNormal=(n,r,a)=>{const s=a.getBuffer("normalMC"),i=e.WebGPUActor.getRenderable();if(s){const o=r.getShaderDescription("vertex");o.hasOutput("normalVC")||o.addOutput("vec3<f32>","normalVC",s.getArrayInformation()[0].interpolation),o.hasOutput("tangentVC")||o.addOutput("vec3<f32>","tangentVC",s.getArrayInformation()[0].interpolation),o.hasOutput("bitangentVC")||o.addOutput("vec3<f32>","bitangentVC",s.getArrayInformation()[0].interpolation);let c=o.getCode();c=H.substitute(c,"//VTK::Normal::Impl",["  output.normalVC = normalize((rendererUBO.WCVCNormals * mapperUBO.MCWCNormals * normalMC).xyz);","  var c1: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 0, 1));","  var c2: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 1, 0));","  var tangent: vec3<f32> = mix(c1, c2, distance(c1, c2));","  output.tangentVC = normalize(tangent);","  output.bitangentVC = normalize(cross(output.normalVC, tangent));"]).result,o.setCode(c);const u=r.getShaderDescription("fragment");c=u.getCode(),i.getProperty().getNormalTexture()?c=H.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  var tangent: vec3<f32> = input.tangentVC;","  var bitangent: vec3<f32> = input.bitangentVC;","  var TCVCMatrix: mat3x3<f32> = mat3x3<f32>(","    tangent.x, bitangent.x, normal.x,","    tangent.y, bitangent.y, normal.y,","    tangent.z, bitangent.z, normal.z,","  );","  var mappedNormal: vec3<f32> = TCVCMatrix * (_normalMap.xyz * 2 - 1);","  normal = mix(normal, mappedNormal, mapperUBO.NormalStrength);","  normal = normalize(normal);"]).result:c=H.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  normal = normalize(normal);"]).result,u.setCode(c)}},e.shaderReplacements.set("replaceShaderNormal",t.replaceShaderNormal),t.replaceShaderLight=(n,r,a)=>{var u;if(n.includes("sel"))return;const s=r.getShaderDescription("vertex");s.hasOutput("vertexVC")||s.addOutput("vec4<f32>","vertexVC");const i=e.WebGPURenderer.getRenderable(),o=r.getShaderDescription("fragment");let c=o.getCode();if(c.includes("var normal:")&&e.useRendererMatrix&&!rc(n)&&!e.is2D&&!n.includes("sel")){const g=["  var pi: f32 = 3.14159265359;","  var fragPos: vec3<f32> = vec3<f32>(input.vertexVC.xyz);","  var V: vec3<f32> = mix(normalize(-fragPos), vec3<f32>(0, 0, 1), f32(rendererUBO.cameraParallel)); // View Vector","  var baseColor: vec3<f32> = _diffuseMap.rgb * diffuseColor.rgb;","  var roughness: f32 = max(0.000001, mapperUBO.Roughness * _roughnessMap.r);","  var metallic: f32 = mapperUBO.Metallic * _metallicMap.r;","  var alpha: f32 = roughness*roughness;","  var ior: f32 = mapperUBO.BaseIOR;","  var k: f32 = alpha*alpha / 2;","  var diffuse: vec3<f32> = vec3<f32>(0.);","  var specular: vec3<f32> = vec3<f32>(0.);","  var emission: vec3<f32> = _emissionMap.rgb * mapperUBO.Emission;","  {","    var i: i32 = 0;","    loop {","      if !(i < rendererUBO.LightCount) { break; }","      switch (i32(rendererLightSSBO.values[i].LightData.x)) {","         // Point Light","         case 0 {","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var pos: vec3<f32> = (rendererLightSSBO.values[i].LightPos).xyz;","           var calculated: PBRData = calcPointLight(normal, V, fragPos, ior, roughness, metallic, pos, color, baseColor);","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","          }","         // Directional light","         case 1 {","           var dir: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz;","           dir = normalize(dir);","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var calculated: PBRData = calcDirectionalLight(normal, V, ior, roughness, metallic, dir, color, baseColor); // diffuseColor.rgb needs to be fixed with a more dynamic diffuse color","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","         }","         // Spot Light","         case 2 {","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var pos: vec3<f32> = (rendererLightSSBO.values[i].LightPos).xyz;","           var dir: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz;","           dir = normalize(dir);","           var cones: vec2<f32> = vec2<f32>(rendererLightSSBO.values[i].LightData.y, rendererLightSSBO.values[i].LightData.z);","           var calculated: PBRData = calcSpotLight(normal, V, fragPos, ior, roughness, metallic, pos, dir, cones, color, baseColor);","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","         }","         default { continue; }","       }","      continuing { i++; }","    }","  }","  var fresnel: f32 = schlickFresnelIOR(V, normal, ior, k); // Fresnel","  fresnel = min(1.0, fresnel);","  // This could be controlled with its own variable (that isnt base color) for better artistic control","  var fresnelMetallic: vec3<f32> = schlickFresnelRGB(V, normal, baseColor); // Fresnel for metal, takes color into account","  var kS: vec3<f32> = mix(vec3<f32>(fresnel), fresnelMetallic, metallic);","  kS = min(vec3<f32>(1.0), kS);","  var kD: vec3<f32> = (1.0 - kS) * (1.0 - metallic);","  var PBR: vec3<f32> = mapperUBO.DiffuseIntensity*kD*diffuse + kS*specular;","  PBR += emission;","  computedColor = vec4<f32>(PBR, mapperUBO.Opacity);"];(u=i.getEnvironmentTexture())!=null&&u.getImageLoaded()&&g.push("  // To get diffuse IBL, the texture is sampled with normals in worldspace","  var diffuseIBLCoords: vec3<f32> = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(normal, 1.)).xyz;","  var diffuseCoords: vec2<f32> = vecToRectCoord(diffuseIBLCoords);","  // To get specular IBL, the texture is sampled as the worldspace reflection between the normal and view vectors","  // Reflections are first calculated in viewspace, then converted to worldspace to sample the environment","  var VreflN: vec3<f32> = normalize(reflect(-V, normal));","  var reflectionIBLCoords = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(VreflN, 1.)).xyz;","  var specularCoords: vec2<f32> = vecToRectCoord(reflectionIBLCoords);","  var diffuseIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, diffuseCoords, rendererUBO.MaxEnvironmentMipLevel);","  var level = roughness * rendererUBO.MaxEnvironmentMipLevel;","  var specularIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, specularCoords, level);","  var specularIBLContribution: vec3<f32> = specularIBL.rgb*rendererUBO.BackgroundSpecularStrength;","  computedColor += vec4<f32>(specularIBLContribution*kS, 0);","  var diffuseIBLContribution: vec3<f32> = diffuseIBL.rgb*rendererUBO.BackgroundDiffuseStrength;","  diffuseIBLContribution *= baseColor * _ambientOcclusionMap.rgb;","  computedColor += vec4<f32>(diffuseIBLContribution*kD, 0);"),c=H.substitute(c,"//VTK::Light::Impl",g).result,o.setCode(c)}else c=H.substitute(c,"//VTK::Light::Impl",["  var diffuse: vec3<f32> = diffuseColor.rgb;","  var specular: vec3<f32> = mapperUBO.SpecularColor.rgb * mapperUBO.SpecularColor.a;","  computedColor = vec4<f32>(diffuse * _diffuseMap.rgb, mapperUBO.Opacity);"]).result,o.setCode(c)},e.shaderReplacements.set("replaceShaderLight",t.replaceShaderLight),t.replaceShaderColor=(n,r,a)=>{if(rc(n)){const u=r.getShaderDescription("fragment");let g=u.getCode();g=H.substitute(g,"//VTK::Color::Impl",["ambientColor = mapperUBO.EdgeColor;","diffuseColor = mapperUBO.EdgeColor;"]).result,u.setCode(g);return}const s=a.getBuffer("colorVI");if(!s)return;const i=r.getShaderDescription("vertex");i.addOutput("vec4<f32>","color",s.getArrayInformation()[0].interpolation);let o=i.getCode();o=H.substitute(o,"//VTK::Color::Impl",["  output.color = colorVI;"]).result,i.setCode(o);const c=r.getShaderDescription("fragment");o=c.getCode(),o=H.substitute(o,"//VTK::Color::Impl",["ambientColor = input.color;","diffuseColor = input.color;","opacity = mapperUBO.Opacity * input.color.a;"]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderColor",t.replaceShaderColor),t.replaceShaderTCoord=(n,r,a)=>{var p,y,h,v,x,S,d,T,w,C,O,R,L,D,M,V,B,_,k,G;if(!a.hasAttribute("tcoord"))return;const s=r.getShaderDescription("vertex"),i=a.getBuffer("tcoord"),o=he.getNumberOfComponentsFromBufferFormat(i.getArrayInformation()[0].format);let c=s.getCode();s.addOutput(`vec${o}<f32>`,"tcoordVS"),c=H.substitute(c,"//VTK::TCoord::Impl",["  output.tcoordVS = tcoord;"]).result,s.setCode(c);const u=r.getShaderDescription("fragment");c=u.getCode();const g=e.WebGPUActor.getRenderable(),f=b=>b?b.getDimensionality()===o:!1,l=[];((h=(y=(p=g.getProperty()).getDiffuseTexture)==null?void 0:y.call(p))!=null&&h.getImageLoaded()||g.getTextures()[0]||e.colorTexture)&&(f((x=(v=g.getProperty()).getDiffuseTexture)==null?void 0:x.call(v))||f(g.getTextures()[0])||f(e.colorTexture))&&l.push("_diffuseMap = textureSample(DiffuseTexture, DiffuseTextureSampler, input.tcoordVS);"),(T=(d=(S=g.getProperty()).getRoughnessTexture)==null?void 0:d.call(S))!=null&&T.getImageLoaded()&&f(g.getProperty().getRoughnessTexture())&&l.push("_roughnessMap = textureSample(RoughnessTexture, RoughnessTextureSampler, input.tcoordVS);"),(O=(C=(w=g.getProperty()).getMetallicTexture)==null?void 0:C.call(w))!=null&&O.getImageLoaded()&&f(g.getProperty().getMetallicTexture())&&l.push("_metallicMap = textureSample(MetallicTexture, MetallicTextureSampler, input.tcoordVS);"),(D=(L=(R=g.getProperty()).getNormalTexture)==null?void 0:L.call(R))!=null&&D.getImageLoaded()&&f(g.getProperty().getNormalTexture())&&l.push("_normalMap = textureSample(NormalTexture, NormalTextureSampler, input.tcoordVS);"),(B=(V=(M=g.getProperty()).getAmbientOcclusionTexture)==null?void 0:V.call(M))!=null&&B.getImageLoaded()&&f(g.getProperty().getAmbientOcclusionTexture())&&l.push("_ambientOcclusionMap = textureSample(AmbientOcclusionTexture, AmbientOcclusionTextureSampler, input.tcoordVS);"),(G=(k=(_=g.getProperty()).getEmissionTexture)==null?void 0:k.call(_))!=null&&G.getImageLoaded()&&f(g.getProperty().getEmissionTexture())&&l.push("_emissionMap = textureSample(EmissionTexture, EmissionTextureSampler, input.tcoordVS);"),c=H.substitute(c,"//VTK::TCoord::Impl",l).result,u.setCode(c)},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderSelect=(n,r,a)=>{if(n.includes("sel")){const s=r.getShaderDescription("fragment");let i=s.getCode();i=H.substitute(i,"//VTK::Select::Impl",["  var compositeID: u32 = 0u;"]).result,s.setCode(i)}},e.shaderReplacements.set("replaceShaderSelect",t.replaceShaderSelect),t.getUsage=(n,r)=>n===ur.POINTS||r===xe.Points?pe.Verts:r===xe.Lines?pe.Lines:n===ur.WIREFRAME?r===xe.Triangles?pe.LinesFromTriangles:pe.LinesFromStrips:r===xe.Triangles?pe.Triangles:r===xe.TriangleStrips?pe.Strips:r===xe.TriangleEdges?pe.LinesFromTriangles:pe.LinesFromStrips,t.getHashFromUsage=n=>`pt${n}`,t.getTopologyFromUsage=n=>{switch(n){case pe.Triangles:return"triangle-list";case pe.Verts:return"point-list";case pe.Lines:default:return"line-list"}},t.buildVertexInput=()=>{var h,v;const n=e.currentInput,r=e.cellArray,a=e.primitiveType;let i=e.WebGPUActor.getRenderable().getProperty().getRepresentation();const o=e.WebGPURenderWindow.getDevice();let c=!1;a===xe.TriangleEdges&&(c=!0,i=ur.WIREFRAME);const u=e.vertexInput,g=n.getPoints();let f;if(r){const x={hash:`R${i}P${a}${r.getMTime()}`,usage:pe.Index,cells:r,numberOfPoints:g.getNumberOfPoints(),primitiveType:a,representation:i};f=o.getBufferManager().getBuffer(x),u.setIndexBuffer(f)}else u.setIndexBuffer(null);if(g){const x=e.WebGPUActor.getBufferShift(e.WebGPURenderer),S={hash:`${g.getMTime()}I${f.getMTime()}${x.join()}float32x4`,usage:pe.PointArray,format:"float32x4",dataArray:g,indexBuffer:f,shift:x,packExtra:!0},d=o.getBufferManager().getBuffer(S);u.addBuffer(d,["vertexBC"])}else u.removeBufferIfPresent("vertexBC");const l=t.getUsage(i,a);if(e._usesCellNormals=!1,!e.is2D&&(l===pe.Triangles||l===pe.Strips)){const x=n.getPointData().getNormals(),S={format:"snorm8x4",indexBuffer:f,packExtra:!0,shift:0,scale:127};if(x){S.hash=`${x.getMTime()}I${f.getMTime()}snorm8x4`,S.dataArray=x,S.usage=pe.PointArray;const d=o.getBufferManager().getBuffer(S);u.addBuffer(d,["normalMC"])}else if(a===xe.Triangles){e._usesCellNormals=!0,S.hash=`PFN${g.getMTime()}I${f.getMTime()}snorm8x4`,S.dataArray=g,S.cells=r,S.usage=pe.NormalsFromPoints;const d=o.getBufferManager().getBuffer(S);u.addBuffer(d,["normalMC"])}else u.removeBufferIfPresent("normalMC")}else u.removeBufferIfPresent("normalMC");let p=!1;if(e.renderable.getScalarVisibility()){const x=e.renderable.getColorMapColors();if(x&&!c){const S=e.renderable.getScalarMode();let d=!1;(S===gr.USE_CELL_DATA||S===gr.USE_CELL_FIELD_DATA||S===gr.USE_FIELD_DATA||!n.getPointData().getScalars())&&S!==gr.USE_POINT_FIELD_DATA&&x&&(d=!0);const T={usage:pe.PointArray,format:"unorm8x4",hash:`${d}${x.getMTime()}I${f.getMTime()}unorm8x4`,dataArray:x,indexBuffer:f,cellData:d,cellOffset:0},w=o.getBufferManager().getBuffer(T);u.addBuffer(w,["colorVI"]),p=!0}}p||u.removeBufferIfPresent("colorVI");let y=null;if((v=(h=e.renderable).getInterpolateScalarsBeforeMapping)!=null&&v.call(h)&&e.renderable.getColorCoordinates()?y=e.renderable.getColorCoordinates():y=n.getPointData().getTCoords(),y&&!c){const x=o.getBufferManager().getBufferForPointArray(y,u.getIndexBuffer());u.addBuffer(x,["tcoord"])}else u.removeBufferIfPresent("tcoord")},t.updateTextures=()=>{var c,u,g,f,l,p,y,h,v,x,S,d,T,w,C;const n=[],r=[],a=(u=(c=e.renderable).getColorTextureMap)==null?void 0:u.call(c);a&&(e.colorTexture||(e.colorTexture=ca.newInstance({label:"polyDataColor"})),e.colorTexture.setInputData(a),r.push(["Diffuse",e.colorTexture]));const s=e.WebGPUActor.getRenderable(),i=e.WebGPURenderer.getRenderable(),o=[];if((f=(g=s.getProperty()).getDiffuseTexture)!=null&&f.call(g)){const O=["Diffuse",s.getProperty().getDiffuseTexture()];o.push(O)}if(s.getTextures()[0]){const O=["Diffuse",s.getTextures()[0]];o.push(O)}if(e.colorTexture){const O=["Diffuse",e.colorTexture];o.push(O)}if((p=(l=s.getProperty()).getRoughnessTexture)!=null&&p.call(l)){const O=["Roughness",s.getProperty().getRoughnessTexture()];o.push(O)}if((h=(y=s.getProperty()).getMetallicTexture)!=null&&h.call(y)){const O=["Metallic",s.getProperty().getMetallicTexture()];o.push(O)}if((x=(v=s.getProperty()).getNormalTexture)!=null&&x.call(v)){const O=["Normal",s.getProperty().getNormalTexture()];o.push(O)}if((d=(S=s.getProperty()).getAmbientOcclusionTexture)!=null&&d.call(S)){const O=["AmbientOcclusion",s.getProperty().getAmbientOcclusionTexture()];o.push(O)}if((w=(T=s.getProperty()).getEmissionTexture)!=null&&w.call(T)){const O=["Emission",s.getProperty().getEmissionTexture()];o.push(O)}if((C=i.getEnvironmentTexture)!=null&&C.call(i)){const O=["Environment",i.getEnvironmentTexture()];o.push(O)}for(let O=0;O<o.length;O++)(o[O][1].getInputData()||o[O][1].getJsImageData()||o[O][1].getCanvas())&&r.push(o[O]),o[O][1].getImage()&&o[O][1].getImageLoaded()&&r.push(o[O]);for(let O=0;O<r.length;O++){const R=r[O][1],L=r[O][0],D=e.device.getTextureManager().getTextureForVTKTexture(R);if(D.getReady()){let M=!1;for(let V=0;V<e.textures.length;V++)e.textures[V]===D&&(M=!0,n[V]=!0);if(!M){n[e.textures.length]=!0;const V=D.createView(`${L}Texture`);e.textures.push(D),e.textureViews.push(V);const B=R.getInterpolate()?"linear":"nearest";let _=null;!_&&R.getEdgeClamp()&&R.getRepeat()&&(_="mirror-repeat"),!_&&R.getEdgeClamp()&&(_="clamp-to-edge"),!_&&R.getRepeat()&&(_="repeat"),L!=="Environment"?V.addSampler(e.device,{addressModeU:_,addressModeV:_,addressModeW:_,minFilter:B,magFilter:B}):V.addSampler(e.device,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:B,magFilter:B,mipmapFilter:"linear"})}}}for(let O=e.textures.length-1;O>=0;O--)n[O]||(e.textures.splice(O,1),e.textureViews.splice(O,1))},t.computePipelineHash=()=>{let n=`pd${e.useRendererMatrix?"r":""}${e.forceZValue?"z":""}`;if(e.primitiveType===xe.TriangleEdges||e.primitiveType===xe.TriangleStripEdges)n+="edge";else{if(e.vertexInput.hasAttribute("normalMC")&&(n+="n"),e.vertexInput.hasAttribute("colorVI")&&(n+="c"),e.vertexInput.hasAttribute("tcoord")){const a=e.vertexInput.getBuffer("tcoord"),s=he.getNumberOfComponentsFromBufferFormat(a.getArrayInformation()[0].format);n+=`t${s}`}e.textures.length&&(n+=`tx${e.textures.length}`)}e._usesCellNormals&&(n+="cn"),e.SSBO&&(n+="ssbo");const r=t.getHashFromUsage(e.usage);n+=r,n+=e.renderEncoder.getPipelineHash(),e.pipelineHash=n},t.updateBuffers=()=>{e.primitiveType!==xe.TriangleEdges&&e.primitiveType!==xe.TriangleStripEdges&&t.updateTextures();const n=e.WebGPUActor.getRenderable(),r=n.getProperty().getRepresentation();e.usage=t.getUsage(r,e.primitiveType),t.buildVertexInput();const a=e.vertexInput.getBuffer("vertexBC");if(t.setNumberOfVertices(a.getSizeInBytes()/a.getStrideInBytes()),t.setTopology(t.getTopologyFromUsage(e.usage)),t.updateUBO(),t.haveWideLines()){const s=n.getProperty();t.setNumberOfInstances(Math.ceil(s.getLineWidth()*2))}else t.setNumberOfInstances(1)}}const QS={is2D:!1,cellArray:null,currentInput:null,cellOffset:0,primitiveType:0,colorTexture:null,renderEncoder:null,textures:null};function _g(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QS,n),hi.extend(t,e,n),e.fragmentShaderTemplate=qS,e.vertexShaderTemplate=YS,e._tmpMat3=jt(new Float64Array(9)),e._tmpMat4=A(new Float64Array(16)),e.UBO=Wt.newInstance({label:"mapperUBO"}),e.UBO.addEntry("BCWCMatrix","mat4x4<f32>"),e.UBO.addEntry("BCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("MCWCNormals","mat4x4<f32>"),e.UBO.addEntry("AmbientColor","vec4<f32>"),e.UBO.addEntry("DiffuseColor","vec4<f32>"),e.UBO.addEntry("EdgeColor","vec4<f32>"),e.UBO.addEntry("SpecularColor","vec4<f32>"),e.UBO.addEntry("AmbientIntensity","f32"),e.UBO.addEntry("DiffuseIntensity","f32"),e.UBO.addEntry("Roughness","f32"),e.UBO.addEntry("Metallic","f32"),e.UBO.addEntry("Ambient","f32"),e.UBO.addEntry("Normal","f32"),e.UBO.addEntry("Emission","f32"),e.UBO.addEntry("NormalStrength","f32"),e.UBO.addEntry("BaseIOR","f32"),e.UBO.addEntry("SpecularIntensity","f32"),e.UBO.addEntry("LineWidth","f32"),e.UBO.addEntry("Opacity","f32"),e.UBO.addEntry("ZValue","f32"),e.UBO.addEntry("PropID","u32"),e.UBO.addEntry("ClipNear","f32"),e.UBO.addEntry("ClipFar","f32"),e.UBO.addEntry("Time","u32"),le(t,e,["cellArray","currentInput","cellOffset","is2D","primitiveType","renderEncoder"]),e.textures=[],IS(t,e)}const ZS=Z(_g,"vtkWebGPUCellArrayMapper");var Bg={newInstance:ZS,extend:_g};const{PrimitiveTypes:lr}=Rt;function JS(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper"),t.createCellArrayMapper=()=>Bg.newInstance(),t.buildPass=n=>{if(n){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.renderable.getStatic()||e.renderable.update();const r=e.renderable.getInputData();e.renderable.mapScalars(r,1),t.updateCellArrayMappers(r)}},t.updateCellArrayMappers=n=>{const r=[n.getVerts(),n.getLines(),n.getPolys(),n.getStrips()],a=[];let s=0;for(let i=lr.Points;i<=lr.Triangles;i++)if(r[i].getNumberOfValues()>0){e.primitives[i]||(e.primitives[i]=t.createCellArrayMapper());const o=e.primitives[i];o.setCellArray(r[i]),o.setCurrentInput(n),o.setCellOffset(s),o.setPrimitiveType(i),o.setRenderable(e.renderable),s+=r[i].getNumberOfCells(),a.push(o)}else e.primitives[i]=null;if(e.WebGPUActor.getRenderable().getProperty().getEdgeVisibility())for(let i=lr.TriangleEdges;i<=lr.TriangleStripEdges;i++)if(r[i-2].getNumberOfValues()>0){e.primitives[i]||(e.primitives[i]=t.createCellArrayMapper());const o=e.primitives[i];o.setCellArray(r[i-2]),o.setCurrentInput(n),o.setCellOffset(e.primitives[i-2].getCellOffset()),o.setPrimitiveType(i),o.setRenderable(e.renderable),a.push(o)}else e.primitives[i]=null;t.prepareNodes(),t.addMissingChildren(a),t.removeUnusedNodes()}}const e2={primitives:null};function t2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,e2,n),ae.extend(t,e,n),e.primitives=[],JS(t,e)}const n2=Z(t2,"vtkWebGPUPolyDataMapper");et("vtkMapper",n2);const{PrimitiveTypes:ac}=Rt;function r2(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper2D"),t.createCellArrayMapper=()=>Bg.newInstance(),t.buildPass=n=>{if(n){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.renderable.getStatic()||e.renderable.update();const r=e.renderable.getInputData();e.renderable.mapScalars(r,1),t.updateCellArrayMappers(r)}},t.updateCellArrayMappers=n=>{const r=[n.getVerts(),n.getLines(),n.getPolys(),n.getStrips()],a=[];let s=0;for(let i=ac.Points;i<=ac.Triangles;i++)if(r[i].getNumberOfValues()>0){e.primitives[i]||(e.primitives[i]=t.createCellArrayMapper());const o=e.primitives[i];o.setCellArray(r[i]),o.setCurrentInput(n),o.setCellOffset(s),o.setPrimitiveType(i),o.setRenderable(e.renderable),o.setIs2D(!0),s+=r[i].getNumberOfCells(),a.push(o)}else e.primitives[i]=null;t.prepareNodes(),t.addMissingChildren(a),t.removeUnusedNodes()}}function a2(t){return{primitives:[],...t}}function s2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,a2(n)),ae.extend(t,e,n),e.primitives=[],r2(t,e)}const i2=Z(s2,"vtkWebGPUPolyDataMapper2D");et("vtkMapper2D",i2);function o2(t,e){e.classHierarchy.push("vtkWebGPUScalarBarActor"),t.buildPass=n=>{n&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(n,r)=>{if(n){const a=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,s=e.WebGPURenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([s.usize,s.vsize],a,e.WebGPURenderWindow.getRenderable())}}}const c2={};function f2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,c2,n),ae.extend(t,e,n),e.scalarBarActorHelper=pg.newScalarBarActorHelper(),o2(t,e)}const u2=Z(f2,"vtkWebGPUScalarBarActor");et("vtkScalarBarActor",u2);function g2(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=n,e.options.addressModeU=r.addressModeU?r.addressModeU:"clamp-to-edge",e.options.addressModeV=r.addressModeV?r.addressModeV:"clamp-to-edge",e.options.addressModeW=r.addressModeW?r.addressModeW:"clamp-to-edge",e.options.magFilter=r.magFilter?r.magFilter:"nearest",e.options.minFilter=r.minFilter?r.minFilter:"nearest",e.options.mipmapFilter=r.mipmapFilter?r.mipmapFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=(n,r)=>`@binding(${n}) @group(${r}) var ${e.label}: sampler;`,t.getBindGroupEntry=()=>({resource:e.handle})}const l2={device:null,handle:null,label:null,options:null};function Fg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,l2,n),E.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),E.get(t,e,["bindGroupTime","handle","options"]),E.setGet(t,e,["bindGroupLayoutEntry","device","label"]),g2(t,e)}const p2=E.newInstance(Fg);var vi={newInstance:p2,extend:Fg};function h2(t,e){e.classHierarchy.push("vtkWebGPUTextureView"),t.create=(n,r)=>{e.texture=n,e.options=r,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=n.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const a=he.getDetailsFromTextureFormat(e.texture.getFormat());e.bindGroupLayoutEntry.texture.sampleType=a.sampleType},t.createFromTextureHandle=(n,r)=>{e.texture=null,e.options=r,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=n,e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const a=he.getDetailsFromTextureFormat(r.format);e.bindGroupLayoutEntry.texture.sampleType=a.sampleType,e.bindGroupTime.modified()},t.getBindGroupEntry=()=>({resource:t.getHandle()}),t.getShaderCode=(n,r)=>{let a="f32";e.bindGroupLayoutEntry.texture.sampleType==="sint"?a="i32":e.bindGroupLayoutEntry.texture.sampleType==="uint"&&(a="u32");let s=`@binding(${n}) @group(${r}) var ${e.label}: texture_${e.options.dimension}<${a}>;`;return e.bindGroupLayoutEntry.texture.sampleType==="depth"&&(s=`@binding(${n}) @group(${r}) var ${e.label}: texture_depth_${e.options.dimension};`),s},t.addSampler=(n,r)=>{const a=vi.newInstance({label:`${e.label}Sampler`});a.create(n,r),t.setSampler(a)},t.getBindGroupTime=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.bindGroupTime),t.getHandle=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.handle)}const v2={texture:null,handle:null,sampler:null,label:null};function mg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,v2,n),E.obj(t,e),e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),E.get(t,e,["bindGroupTime","texture"]),E.setGet(t,e,["bindGroupLayoutEntry","label","sampler"]),h2(t,e)}const y2=E.newInstance(mg);var Ug={newInstance:y2,extend:mg};const{BufferUsage:sc}=Rt;function d2(t,e){e.classHierarchy.push("vtkWebGPUTexture"),t.create=(n,r)=>{e.device=n,e.width=r.width,e.height=r.height,e.depth=r.depth?r.depth:1;const a=e.depth===1?"2d":"3d";e.format=r.format?r.format:"rgba8unorm",e.mipLevel=r.mipLevel?r.mipLevel:0,e.usage=r.usage?r.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label,dimension:a,mipLevelCount:e.mipLevel+1})},t.assignFromHandle=(n,r,a)=>{e.device=n,e.handle=r,e.width=a.width,e.height=a.height,e.depth=a.depth?a.depth:1,e.format=a.format?a.format:"rgba8unorm",e.usage=a.usage?a.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST},t.writeImageData=n=>{let r=[];if(n.canvas){e.device.getHandle().queue.copyExternalImageToTexture({source:n.canvas,flipY:n.flip},{texture:e.handle,premultipliedAlpha:!0},[e.width,e.height,e.depth]),e.ready=!0;return}n.jsImageData&&!n.nativeArray&&(n.width=n.jsImageData.width,n.height=n.jsImageData.height,n.depth=1,n.format="rgba8unorm",n.flip=!0,n.nativeArray=n.jsImageData.data);const a=he.getDetailsFromTextureFormat(e.format);let s=e.width*a.stride;const i=(c,u,g)=>{const f=c.length/(u*g)*c.BYTES_PER_ELEMENT,l=a.elementSize===2&&a.sampleType==="float";if(l||f%256){const p=c,y=f/p.BYTES_PER_ELEMENT,h=a.elementSize,v=256*Math.floor((y*h+255)/256),x=v/h,S=E.newTypedArray(l?"Uint16Array":p.constructor.name,x*u*g);for(let d=0;d<u*g;d++)if(l)for(let T=0;T<y;T++)S[d*x+T]=ze.toHalf(p[d*y+T]);else S.set(p.subarray(d*y,(d+1)*y),d*x);return[S,v]}return[c,f]};if(n.nativeArray&&(r=n.nativeArray),n.image){const c=document.createElement("canvas");c.width=n.image.width,c.height=n.image.height;const u=c.getContext("2d");u.translate(0,c.height),u.scale(1,-1),u.drawImage(n.image,0,0,n.image.width,n.image.height,0,0,c.width,c.height),r=u.getImageData(0,0,n.image.width,n.image.height).data}const o=e.device.createCommandEncoder();if(t.getDimensionality()!==3){const c=ca.generateMipmaps(r,e.width,e.height,e.mipLevel);let u=e.width,g=e.height;for(let f=0;f<=e.mipLevel;f++){const l=i(c[f],g,1);s=l[1];const p={dataArray:n.dataArray?n.dataArray:null,nativeArray:l[0],usage:sc.Texture},y=e.device.getBufferManager().getBuffer(p);o.copyBufferToTexture({buffer:y.getHandle(),offset:0,bytesPerRow:s,rowsPerImage:g},{texture:e.handle,mipLevel:f},[u,g,1]),u/=2,g/=2}e.device.submitCommandEncoder(o),e.ready=!0}else{const c=i(r,e.height,e.depth);s=c[1];const u={dataArray:n.dataArray?n.dataArray:null,usage:sc.Texture};u.nativeArray=c[0];const g=e.device.getBufferManager().getBuffer(u);o.copyBufferToTexture({buffer:g.getHandle(),offset:0,bytesPerRow:s,rowsPerImage:e.height},{texture:e.handle},[e.width,e.height,e.depth]),e.device.submitCommandEncoder(o),e.ready=!0}},t.getScale=()=>{const n=he.getDetailsFromTextureFormat(e.format);return n.elementSize===2&&n.sampleType==="float"?1:255},t.getNumberOfComponents=()=>he.getDetailsFromTextureFormat(e.format).numComponents,t.getDimensionality=()=>{let n=0;return e.width>1&&n++,e.height>1&&n++,e.depth>1&&n++,n},t.resizeToMatch=n=>{(n.getWidth()!==e.width||n.getHeight()!==e.height||n.getDepth()!==e.depth)&&(e.width=n.getWidth(),e.height=n.getHeight(),e.depth=n.getDepth(),e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.resize=function(n,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;(n!==e.width||r!==e.height||a!==e.depth)&&(e.width=n,e.height=r,e.depth=a,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.createView=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};r.dimension||(r.dimension=e.depth===1?"2d":"3d");const a=Ug.newInstance({label:n});return a.create(t,r),a}}const T2={device:null,handle:null,buffer:null,ready:!1,label:null};function kg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,T2,n),E.obj(t,e),E.get(t,e,["handle","ready","width","height","depth","format","usage"]),E.setGet(t,e,["device","label"]),d2(t,e)}const x2=E.newInstance(kg);var Ie={newInstance:x2,extend:kg};function S2(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=(n,r)=>{e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();const a=e.WebGPURenderer.getAspectRatio(),s=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,i=e.WebGPURenderer.getTiledSizeAndOrigin(),o=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),s,a,i,o)}}const C2={};function w2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,C2,n),ae.extend(t,e,n),S2(t,e)}const E2=E.newInstance(w2,"vtkWebGPUPixelSpaceCallbackMapper");et("vtkPixelSpaceCallbackMapper",E2);function Ng(t){return new TextDecoder("latin1").decode(t)}function O2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const r=Ng(t),a=e.exec(r);if(!a)return{text:r};const s=a.index+a[0].length,i=r.substring(0,s);let o=null;const c=n?n.exec(r):null;if(c){const u=r.substr(c.index);o={text:i+u,binaryBuffer:t.slice(s,c.index)}}else o={text:i,binaryBuffer:t.slice(s)};return o}var ic={arrayBufferToString:Ng,extractBinary:O2};const yi={};function Gg(t){return!!yi[t]}function R2(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return yi[t](e)}function bg(t,e){yi[t]=e}var D2={get:R2,has:Gg,registerType:bg};function $g(){const t=new ArrayBuffer(4),e=new Uint8Array(t),n=new Uint32Array(t);return e[0]=161,e[1]=178,e[2]=195,e[3]=212,n[0]===3569595041?"LittleEndian":n[0]===2712847316?"BigEndian":null}const M2=$g();function L2(t,e){if(e<2)return;const n=new Int8Array(t),r=n.length,a=[];for(let s=0;s<r;s+=e){for(let i=0;i<e;i++)a.push(n[s+i]);for(let i=0;i<e;i++)n[s+i]=a.pop()}}var qa={ENDIANNESS:M2,getEndianness:$g,swapBytes:L2};const{vtkErrorMacro:zg,vtkDebugMacro:V2}=E,di=()=>(zg("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead."),Promise.reject(new Error("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead.")));let sn=0;function fa(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=new XMLHttpRequest;return r.open(t,e,!0),n.headers&&Object.entries(n.headers).forEach(a=>{let[s,i]=a;return r.setRequestHeader(s,i)}),n.progressCallback&&r.addEventListener("progress",n.progressCallback),r}function _2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((n,r)=>{const a=fa("GET",t,e);a.onreadystatechange=s=>{a.readyState===4&&(a.status===200||a.status===0?n(a.response):r({xhr:a,e:s}))},a.responseType="arraybuffer",a.send()})}function B2(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return r&&r.compression?di():n.ref&&!n.ref.pending?new Promise((a,s)=>{const i=[e,n.ref.basepath,n.ref.id].join("/"),o=fa("GET",i,r);o.onreadystatechange=c=>{o.readyState===1&&(n.ref.pending=!0,++sn===1&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!0)),o.readyState===4&&(n.ref.pending=!1,o.status===200||o.status===0?(n.buffer=o.response,n.ref.encode==="JSON"?n.values=JSON.parse(n.buffer):(qa.ENDIANNESS!==n.ref.encode&&qa.ENDIANNESS&&(V2(`Swap bytes of ${n.name}`),qa.swapBytes(n.buffer,pu[n.dataType])),n.values=E.newTypedArray(n.dataType,n.buffer)),n.values.length!==n.size&&zg(`Error in FetchArray: ${n.name}, does not have the proper array size. Got ${n.values.length}, instead of ${n.size}`),delete n.ref,--sn===0&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!1),t!=null&&t.modified&&t.modified(),a(n)):s({xhr:o,e:c}))},o.responseType=n.dataType!=="string"?"arraybuffer":"text",o.send()}):Promise.resolve(n)}function F2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return n&&n.compression?di():new Promise((r,a)=>{const s=fa("GET",e,n);s.onreadystatechange=i=>{s.readyState===1&&++sn===1&&t!=null&&t.invokeBusy&&t.invokeBusy(!0),s.readyState===4&&(--sn===0&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!1),s.status===200||s.status===0?r(JSON.parse(s.responseText)):a({xhr:s,e:i}))},s.responseType="text",s.send()})}function m2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return n&&n.compression?di():new Promise((r,a)=>{const s=fa("GET",e,n);s.onreadystatechange=i=>{s.readyState===1&&++sn===1&&t!=null&&t.invokeBusy&&t.invokeBusy(!0),s.readyState===4&&(--sn===0&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!1),s.status===200||s.status===0?r(s.responseText):a({xhr:s,e:i}))},s.responseType="text",s.send()})}function U2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return new Promise((r,a)=>{const s=new Image;n.crossOrigin&&(s.crossOrigin=n.crossOrigin),s.onload=()=>r(s),s.onerror=a,s.src=e})}const k2={fetchArray:B2,fetchJSON:F2,fetchText:m2,fetchBinary:_2,fetchImage:U2};Gg("http")||bg("http",t=>k2);const Ia={ASCII:"ascii",BINARY_LITTLE_ENDIAN:"binary_little_endian"},oc={diffuse_red:"red",diffuse_green:"green",diffuse_blue:"blue"},Wg={patternHeader:/ply([\s\S]*)end_header\r?\n/,patternBody:/end_header\s([\s\S]*)$/};function cc(t){let e="",n=0;const r=Wg.patternHeader.exec(t);r!==null&&(e=r[1],n=r[0].length);const a={comments:[],elements:[],headerLength:n},s=e.split(`
`);let i,o,c;for(let u=0;u<s.length;u++){let g=s[u];if(g=g.trim(),g!==""){let f;switch(c=g.split(/\s+/),o=c.shift(),g=c.join(" "),o){case"format":a.format=c[0],a.version=c[1];break;case"comment":a.comments.push(g);break;case"element":i!==void 0&&a.elements.push(i),i={},i.name=c[0],i.count=parseInt(c[1],10),i.properties=[];break;case"property":f={type:c[0]},f.type==="list"?(f.name=c[3],f.countType=c[1],f.itemType=c[2]):f.name=c[1],f.name in oc&&(f.name=oc[f.name]),i.properties.push(f);break;case"obj_info":a.objInfo=g;break;default:console.warn("unhandled",o,c);break}}}return i!==void 0&&a.elements.push(i),a}function fc(t,e){const n=e.find(h=>h.name==="vertex"),r=e.find(h=>h.name==="face");let a=0,s=0;n&&(a=n.count),r&&(s=r.count);const i=new Float32Array(a*3),o=new Uint8Array(a*3),c=new Float32Array(a*2),u=new Float32Array(a*3),g=t.colors.length>0,f=t.uvs.length>0,l=t.normals.length>0,p=t.faceVertexUvs.length>0;for(let h=0;h<a;h++){let v=h*3+0,x=h*3+1;const S=h*3+2;i[v]=t.vertices[v],i[x]=t.vertices[x],i[S]=t.vertices[S],g&&(o[v]=t.colors[v],o[x]=t.colors[x],o[S]=t.colors[S]),f&&(v=h*2+0,x=h*2+1,c[v]=t.uvs[v],c[x]=t.uvs[x]),l&&(u[v]=t.normals[v],u[x]=t.normals[x],u[S]=t.normals[S])}if(!f&&p){let h=0,v=0;for(let x=0;x<s;++x){const S=t.indices[h++],d=t.faceVertexUvs[v++];if(d&&S*2===d.length)for(let T=0;T<S;++T){const w=t.indices[h++];c[w*2+0]=d[T*2+0],c[w*2+1]=d[T*2+1]}else h+=S}}const y=Be.newInstance();if(y.getPoints().setData(i,3),g&&y.getPointData().setScalars(Y.newInstance({numberOfComponents:3,values:o,name:"Scalars"})),f||p){const h=Y.newInstance({numberOfComponents:2,values:c,name:"TextureCoordinates"}),v=y.getPointData();v.addArray(h),v.setActiveTCoords(h.getName())}return l&&y.getPointData().setNormals(Y.newInstance({numberOfComponents:3,name:"Normals",values:u})),y.getPolys().setData(Uint32Array.from(t.indices)),y}function Qa(t,e){let n;switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":n=parseInt(t,10);break;case"float":case"double":case"float32":case"float64":n=parseFloat(t);break;default:console.log("Unsupported type");break}return n}function N2(t,e){const n=e.split(/\s+/),r={};for(let a=0;a<t.length;a++)if(t[a].type==="list"){const s=[],i=Qa(n.shift(),t[a].countType);for(let o=0;o<i;o++)s.push(Qa(n.shift(),t[a].itemType));r[t[a].name]=s}else r[t[a].name]=Qa(n.shift(),t[a].type);return r}function uc(t,e,n){if(e==="vertex")t.vertices.push(n.x,n.y,n.z),"nx"in n&&"ny"in n&&"nz"in n&&t.normals.push(n.nx,n.ny,n.nz),"s"in n&&"t"in n?t.uvs.push(n.s,n.t):"u"in n&&"v"in n?t.uvs.push(n.u,n.v):"texture_u"in n&&"texture_v"in n&&t.uvs.push(n.texture_u,n.texture_v),"red"in n&&"green"in n&&"blue"in n&&t.colors.push(n.red,n.green,n.blue);else if(e==="face"){const r=n.vertex_indices||n.vertex_index,a=n.texcoord;r&&r.length>0&&(t.indices.push(r.length),r.forEach((s,i)=>{t.indices.push(s)})),t.faceVertexUvs.push(a)}}function Za(t,e,n,r){let a;switch(n){case"int8":case"char":a=[t.getInt8(e),1];break;case"uint8":case"uchar":a=[t.getUint8(e),1];break;case"int16":case"short":a=[t.getInt16(e,r),2];break;case"uint16":case"ushort":a=[t.getUint16(e,r),2];break;case"int32":case"int":a=[t.getInt32(e,r),4];break;case"uint32":case"uint":a=[t.getUint32(e,r),4];break;case"float32":case"float":a=[t.getFloat32(e,r),4];break;case"float64":case"double":a=[t.getFloat64(e,r),8];break;default:console.log("Unsupported type");break}return a}function G2(t,e,n,r){const a={};let s,i=0;for(let o=0;o<n.length;o++)if(n[o].type==="list"){const c=[];s=Za(t,e+i,n[o].countType,r);const u=s[0];i+=s[1];for(let g=0;g<u;g++)s=Za(t,e+i,n[o].itemType,r),c.push(s[0]),i+=s[1];a[n[o].name]=c}else s=Za(t,e+i,n[o].type,r),a[n[o].name]=s[0],i+=s[1];return[a,i]}function b2(t,e){e.classHierarchy.push("vtkPLYReader"),e.dataAccessHelper||(e.dataAccessHelper=D2.get("http"));function n(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{compression:s,progressCallback:i}=e;return a.binary?e.dataAccessHelper.fetchBinary(r,{compression:s,progressCallback:i}):e.dataAccessHelper.fetchText(t,r,{compression:s,progressCallback:i})}t.setUrl=function(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{binary:!0};e.url=r;const s=r.split("/");return s.pop(),e.baseURL=s.join("/"),e.compression=a.compression,t.loadData({progressCallback:a.progressCallback,binary:!!a.binary})},t.loadData=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=n(e.url,r);return a.then(t.parse),a},t.parse=r=>{typeof r=="string"?t.parseAsText(r):t.parseAsArrayBuffer(r)},t.parseAsArrayBuffer=r=>{if(!r)return;if(r!==e.parseData)t.modified();else return;const a=ic.arrayBufferToString(r),s=cc(a);if(!(s.format!==Ia.ASCII)){t.parseAsText(r);return}e.parseData=r;const o={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},c=s.format===Ia.BINARY_LITTLE_ENDIAN,u=r instanceof ArrayBuffer?r:r.buffer,g=new DataView(u,s.headerLength);let f,l=0;for(let y=0;y<s.elements.length;y++)for(let h=0;h<s.elements[y].count;h++){f=G2(g,l,s.elements[y].properties,c),l+=f[1];const v=f[0];uc(o,s.elements[y].name,v)}const p=fc(o,s.elements);e.output[0]=p},t.parseAsText=r=>{if(!r)return;if(r!==e.parseData)t.modified();else return;e.parseData=r;const a=ic.arrayBufferToString(r),s=cc(a);if(s.format!==Ia.ASCII){t.parseAsArrayBuffer(r);return}const o={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},c=Wg.patternBody.exec(a);let u="";c!==null&&(u=c[1]);const g=u.split(`
`);let f=0,l=0;for(let y=0;y<g.length;y++){let h=g[y];if(h=h.trim(),h!==""){l>=s.elements[f].count&&(f++,l=0);const v=N2(s.elements[f].properties,h);uc(o,s.elements[f].name,v),l++}}const p=fc(o,s.elements);e.output[0]=p},t.requestData=(r,a)=>{t.parse(e.parseData)}}const $2={};function Hg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$2,n),E.obj(t,e),E.get(t,e,["url","baseURL"]),E.setGet(t,e,["dataAccessHelper"]),E.algo(t,e,0,1),b2(t,e),e.compression||(e.compression=null),e.progressCallback||(e.progressCallback=null)}const z2=E.newInstance(Hg,"vtkPLYReader");var Ag={extend:Hg,newInstance:z2};const{vtkDebugMacro:pr}=E;function W2(t,e){e.classHierarchy.push("vtkCamera");const n=new Float64Array(3),r=new Float64Array([0,0,-1]),a=new Float64Array([0,1,0]),s=A(new Float64Array(16)),i=A(new Float64Array(16)),o=new Float64Array(3),c=new Float64Array(3),u=new Float64Array(3),g=A(new Float64Array(16)),f=A(new Float64Array(16)),l=new Float64Array(3),p=new Float64Array(3);function y(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=()=>{const h=t.getViewMatrix();e.viewUp[0]=h[4],e.viewUp[1]=h[5],e.viewUp[2]=h[6],t.modified()},t.setPosition=(h,v,x)=>{h===e.position[0]&&v===e.position[1]&&x===e.position[2]||(e.position[0]=h,e.position[1]=v,e.position[2]=x,t.computeDistance(),t.modified())},t.setFocalPoint=(h,v,x)=>{h===e.focalPoint[0]&&v===e.focalPoint[1]&&x===e.focalPoint[2]||(e.focalPoint[0]=h,e.focalPoint[1]=v,e.focalPoint[2]=x,t.computeDistance(),t.modified())},t.setDistance=h=>{if(e.distance===h)return;e.distance=h,e.distance<1e-20&&(e.distance=1e-20,pr("Distance is set to minimum."));const v=e.directionOfProjection;e.focalPoint[0]=e.position[0]+v[0]*e.distance,e.focalPoint[1]=e.position[1]+v[1]*e.distance,e.focalPoint[2]=e.position[2]+v[2]*e.distance,t.modified()},t.computeDistance=()=>{const h=e.focalPoint[0]-e.position[0],v=e.focalPoint[1]-e.position[1],x=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(h*h+v*v+x*x),e.distance<1e-20){e.distance=1e-20,pr("Distance is set to minimum.");const S=e.directionOfProjection;e.focalPoint[0]=e.position[0]+S[0]*e.distance,e.focalPoint[1]=e.position[1]+S[1]*e.distance,e.focalPoint[2]=e.position[2]+S[2]*e.distance}e.directionOfProjection[0]=h/e.distance,e.directionOfProjection[1]=v/e.distance,e.directionOfProjection[2]=x/e.distance,y()},t.dolly=h=>{if(h<=0)return;const v=e.distance/h;t.setPosition(e.focalPoint[0]-v*e.directionOfProjection[0],e.focalPoint[1]-v*e.directionOfProjection[1],e.focalPoint[2]-v*e.directionOfProjection[2])},t.roll=h=>{const v=e.position,x=e.focalPoint,S=e.viewUp,d=new Float64Array([S[0],S[1],S[2],0]);A(g);const T=new Float64Array([x[0]-v[0],x[1]-v[1],x[2]-v[2]]);Ue(g,g,ie(h),T),Kn(d,d,g),e.viewUp[0]=d[0],e.viewUp[1]=d[1],e.viewUp[2]=d[2],t.modified()},t.azimuth=h=>{const v=e.focalPoint;A(f),oe(f,f,v),Ue(f,f,ie(h),e.viewUp),oe(f,f,[-v[0],-v[1],-v[2]]),q(l,e.position,f),t.setPosition(l[0],l[1],l[2])},t.yaw=h=>{const v=e.position;A(f),oe(f,f,v),Ue(f,f,ie(h),e.viewUp),oe(f,f,[-v[0],-v[1],-v[2]]),q(p,e.focalPoint,f),t.setFocalPoint(p[0],p[1],p[2])},t.elevation=h=>{const v=e.focalPoint,x=t.getViewMatrix(),S=[-x[0],-x[1],-x[2]];A(f),oe(f,f,v),Ue(f,f,ie(h),S),oe(f,f,[-v[0],-v[1],-v[2]]),q(l,e.position,f),t.setPosition(l[0],l[1],l[2])},t.pitch=h=>{const v=e.position,x=t.getViewMatrix(),S=[x[0],x[1],x[2]];A(f),oe(f,f,v),Ue(f,f,ie(h),S),oe(f,f,[-v[0],-v[1],-v[2]]),q(p,e.focalPoint,f),t.setFocalPoint(...p)},t.zoom=h=>{h<=0||(e.parallelProjection?e.parallelScale/=h:e.viewAngle/=h,t.modified())},t.translate=(h,v,x)=>{const S=[h,v,x];Ss(e.position,S,e.position),Ss(e.focalPoint,S,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=h=>{const v=[...e.viewUp,1],x=[],S=[],d=[];v[0]+=e.position[0],v[1]+=e.position[1],v[2]+=e.position[2],Kn(x,[...e.position,1],h),Kn(S,[...e.focalPoint,1],h),Kn(d,v,h),d[0]-=x[0],d[1]-=x[1],d[2]-=x[2],t.setPosition(...x.slice(0,3)),t.setFocalPoint(...S.slice(0,3)),t.setViewUp(...d.slice(0,3))},t.getThickness=()=>e.clippingRange[1]-e.clippingRange[0],t.setThickness=h=>{let v=h;v<1e-20&&(v=1e-20,pr("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+v)},t.setThicknessFromFocalPoint=h=>{let v=h;v<1e-20&&(v=1e-20,pr("Thickness is set to minimum.")),t.setClippingRange(e.distance-v/2,e.distance+v/2)},t.setRoll=h=>{},t.getRoll=()=>{},t.setObliqueAngles=(h,v)=>{},t.getOrientation=()=>{},t.getOrientationWXYZ=()=>{},t.getFrustumPlanes=h=>{},t.getCameraLightTransformMatrix=h=>(de(h,e.cameraLightTransform),h),t.computeCameraLightTransform=()=>{de(s,t.getViewMatrix()),Oe(s,s),_c(i,[e.distance,e.distance,e.distance]),ge(s,s,i),A(e.cameraLightTransform),oe(e.cameraLightTransform,s,[0,0,-1])},t.deepCopy=h=>{},t.physicalOrientationToWorldDirection=h=>{const v=Vi(h[0],h[1],h[2],h[3]),x=At(),S=Vi(0,0,1,0);return I0(x,v),Li(S,v,S),Li(S,S,x),[S[0],S[1],S[2]]},t.getPhysicalToWorldMatrix=h=>{t.getWorldToPhysicalMatrix(h),Oe(h,h)},t.getWorldToPhysicalMatrix=h=>{A(h);const v=[3];kn(e.physicalViewNorth,e.physicalViewUp,v),h[0]=v[0],h[1]=v[1],h[2]=v[2],h[4]=e.physicalViewUp[0],h[5]=e.physicalViewUp[1],h[6]=e.physicalViewUp[2],h[8]=-e.physicalViewNorth[0],h[9]=-e.physicalViewNorth[1],h[10]=-e.physicalViewNorth[2],te(h,h),Ye(o,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),Ht(h,h,o),oe(h,h,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=h=>{Oe(s,h),q(o,n,s),t.computeDistance();const v=e.distance;t.setPosition(o[0],o[1],o[2]),q(c,r,s),xt(c,c,o),Ct(c,c),t.setDirectionOfProjection(c[0],c[1],c[2]),q(u,a,s),xt(u,u,o),Ct(u,u),t.setViewUp(u[0],u[1],u[2]),t.setDistance(v)},t.computeViewParametersFromPhysicalMatrix=h=>{t.getWorldToPhysicalMatrix(s),ge(s,h,s),t.computeViewParametersFromViewMatrix(s)},t.setViewMatrix=h=>{e.viewMatrix=h,e.viewMatrix&&(de(s,e.viewMatrix),t.computeViewParametersFromViewMatrix(s),te(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=()=>{if(e.viewMatrix)return e.viewMatrix;bc(s,e.position,e.focalPoint,e.viewUp),te(s,s);const h=new Float64Array(16);return de(h,s),h},t.setProjectionMatrix=h=>{e.projectionMatrix=h},t.getProjectionMatrix=(h,v,x)=>{const S=new Float64Array(16);if(A(S),e.projectionMatrix){const w=1/e.physicalScale;return Ye(o,w,w,w),de(S,e.projectionMatrix),Ht(S,S,o),te(S,S),S}A(s);const d=e.clippingRange[1]-e.clippingRange[0],T=[e.clippingRange[0]+(v+1)*d/2,e.clippingRange[0]+(x+1)*d/2];if(e.parallelProjection){const w=e.parallelScale*h,C=e.parallelScale,O=(e.windowCenter[0]-1)*w,R=(e.windowCenter[0]+1)*w,L=(e.windowCenter[1]-1)*C,D=(e.windowCenter[1]+1)*C;Gc(s,O,R,L,D,T[0],T[1]),te(s,s)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const w=Math.tan(ie(e.viewAngle)/2);let C,O;e.useHorizontalViewAngle===!0?(C=e.clippingRange[0]*w,O=e.clippingRange[0]*w/h):(C=e.clippingRange[0]*w*h,O=e.clippingRange[0]*w);const R=(e.windowCenter[0]-1)*C,L=(e.windowCenter[0]+1)*C,D=(e.windowCenter[1]-1)*O,M=(e.windowCenter[1]+1)*O,V=T[0],B=T[1];s[0]=2*V/(L-R),s[5]=2*V/(M-D),s[2]=(R+L)/(L-R),s[6]=(D+M)/(M-D),s[10]=-(V+B)/(B-V),s[14]=-1,s[11]=-2*V*B/(B-V),s[15]=0}}return de(S,s),S},t.getCompositeProjectionMatrix=(h,v,x)=>{const S=t.getViewMatrix(),d=t.getProjectionMatrix(h,v,x);return ge(d,S,d),d},t.setDirectionOfProjection=(h,v,x)=>{if(e.directionOfProjection[0]===h&&e.directionOfProjection[1]===v&&e.directionOfProjection[2]===x)return;e.directionOfProjection[0]=h,e.directionOfProjection[1]=v,e.directionOfProjection[2]=x;const S=e.directionOfProjection;e.focalPoint[0]=e.position[0]+S[0]*e.distance,e.focalPoint[1]=e.position[1]+S[1]*e.distance,e.focalPoint[2]=e.position[2]+S[2]*e.distance,y()},t.setDeviceAngles=(h,v,x,S)=>{const d=[3];kn(e.physicalViewNorth,e.physicalViewUp,d);const T=A(new Float64Array(16));Ue(T,T,ie(h),e.physicalViewUp),Ue(T,T,ie(v),d),Ue(T,T,ie(x),e.physicalViewNorth),Ue(T,T,ie(-S),e.physicalViewUp);const w=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),C=new Float64Array(e.physicalViewNorth);q(w,w,T),q(C,C,T),t.setDirectionOfProjection(w[0],w[1],w[2]),t.setViewUp(C[0],C[1],C[2]),t.modified()},t.setOrientationWXYZ=(h,v,x,S)=>{const d=A(new Float64Array(16));if(h!==0&&(v!==0||x!==0||S!==0)){const C=ie(h),O=At();zs(O,[v,x,S],C),mr(d,O)}const T=new Float64Array(3);q(T,[0,0,-1],d);const w=new Float64Array(3);q(w,[0,1,0],d),t.setDirectionOfProjection(...T),t.setViewUp(...w),t.modified()},t.computeClippingRange=h=>{let v=null,x=null;v=e.viewPlaneNormal,x=e.position;const S=-v[0],d=-v[1],T=-v[2],w=-(S*x[0]+d*x[1]+T*x[2]),C=[S*h[0]+d*h[2]+T*h[4]+w,1e-18];for(let O=0;O<2;O++)for(let R=0;R<2;R++)for(let L=0;L<2;L++){const D=S*h[L]+d*h[2+R]+T*h[4+O]+w;C[0]=D<C[0]?D:C[0],C[1]=D>C[1]?D:C[1]}return C}}const H2={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,cameraLightTransform:ks(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function jg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,H2,n),E.obj(t,e),E.get(t,e,["distance"]),E.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),E.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),E.setGetArray(t,e,["clippingRange","windowCenter"],2),E.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),W2(t,e)}const A2=E.newInstance(jg,"vtkCamera");var j2={newInstance:A2,extend:jg};function K2(t,e){e.classHierarchy.push("vtkLight");const n=new Float64Array(3);t.getTransformedPosition=()=>(e.transformMatrix?q(n,e.position,e.transformMatrix):Ye(n,e.position[0],e.position[1],e.position[2]),n),t.getTransformedFocalPoint=()=>(e.transformMatrix?q(n,e.focalPoint,e.transformMatrix):Ye(n,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),n),t.getDirection=()=>(e.directionMTime<e.mtime&&(ps(e.direction,e.focalPoint,e.position),Nn(e.direction),e.directionMTime=e.mtime),e.direction),t.setDirection=r=>{const a=new Float64Array(3);ps(a,e.position,r),e.focalPoint=a},t.setDirectionAngle=(r,a)=>{const s=ie(r),i=ie(a);t.setPosition(Math.cos(s)*Math.sin(i),Math.sin(s),Math.cos(s)*Math.cos(i)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=()=>{t.setLightType("HeadLight")},t.setLightTypeToCameraLight=()=>{t.setLightType("CameraLight")},t.setLightTypeToSceneLight=()=>{t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=()=>e.lightType==="HeadLight",t.lightTypeIsSceneLight=()=>e.lightType==="SceneLight",t.lightTypeIsCameraLight=()=>e.lightType==="CameraLight"}const P2={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function X2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,P2,n),E.obj(t,e),E.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),E.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),K2(t,e)}const Y2=E.newInstance(X2,"vtkLight");var q2={newInstance:Y2};const{vtkErrorMacro:Fr}=E;function I2(t){return()=>Fr(`vtkViewport::${t} - NOT IMPLEMENTED`)}function Q2(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=()=>e.props,t.hasViewProp=r=>e.props.includes(r),t.addViewProp=r=>{r&&!t.hasViewProp(r)&&e.props.push(r)},t.removeViewProp=r=>{const a=e.props.filter(s=>s!==r);e.props.length!==a.length&&(e.props=a)},t.removeAllViewProps=()=>{e.props=[]};function n(r){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];a.push(r);const s=r.getNestedProps();if(s&&s.length)for(let i=0;i<s.length;i++)n(s[i],a);return a}t.getViewPropsWithNestedProps=()=>{const r=[];for(let a=0;a<e.props.length;a++)n(e.props[a],r);return r},t.addActor2D=t.addViewProp,t.removeActor2D=r=>{t.removeViewProp(r)},t.getActors2D=()=>(e.actors2D=[],e.props.forEach(r=>{e.actors2D=e.actors2D.concat(r.getActors2D())}),e.actors2D),t.displayToView=()=>Fr("call displayToView on your view instead"),t.viewToDisplay=()=>Fr("callviewtodisplay on your view instead"),t.getSize=()=>Fr("call getSize on your View instead"),t.normalizedDisplayToProjection=(r,a,s)=>{const i=t.normalizedDisplayToNormalizedViewport(r,a,s);return t.normalizedViewportToProjection(i[0],i[1],i[2])},t.normalizedDisplayToNormalizedViewport=(r,a,s)=>{const i=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(r-e.viewport[0])/i[0],(a-e.viewport[1])/i[1],s]},t.normalizedViewportToProjection=(r,a,s)=>[r*2-1,a*2-1,s*2-1],t.projectionToNormalizedDisplay=(r,a,s)=>{const i=t.projectionToNormalizedViewport(r,a,s);return t.normalizedViewportToNormalizedDisplay(i[0],i[1],i[2])},t.normalizedViewportToNormalizedDisplay=(r,a,s)=>{const i=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[r*i[0]+e.viewport[0],a*i[1]+e.viewport[1],s]},t.projectionToNormalizedViewport=(r,a,s)=>[(r+1)*.5,(a+1)*.5,(s+1)*.5],t.PickPropFrom=I2("PickPropFrom")}const Z2={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function Kg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Z2,n),E.obj(t,e),E.event(t,e,"event"),E.setGetArray(t,e,["viewport"],4),E.setGetArray(t,e,["background","background2"],3),Q2(t,e)}const J2=E.newInstance(Kg,"vtkViewport");var eC={newInstance:J2,extend:Kg};const{vtkDebugMacro:wn,vtkErrorMacro:yt,vtkWarningMacro:tC}=Je;function gc(t){return()=>yt(`vtkRenderer::${t} - NOT IMPLEMENTED`)}function nC(t,e){e.classHierarchy.push("vtkRenderer");const n={type:"ComputeVisiblePropBoundsEvent",renderer:t},r={type:"ResetCameraClippingRangeEvent",renderer:t},a={type:"ResetCameraEvent",renderer:t};t.updateCamera=()=>(e.activeCamera||(wn("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0),t.updateLightsGeometryToFollowCamera=()=>{const s=t.getActiveCameraAndResetIfCreated();e.lights.forEach(i=>{i.lightTypeIsSceneLight()||(i.lightTypeIsHeadLight()?(i.setPositionFrom(s.getPositionByReference()),i.setFocalPointFrom(s.getFocalPointByReference()),i.modified(s.getMTime())):i.lightTypeIsCameraLight()?i.setTransformMatrix(s.getCameraLightTransformMatrix(ks())):yt("light has unknown light type",i.get()))})},t.updateLightGeometry=()=>e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0,t.allocateTime=gc("allocateTime"),t.updateGeometry=gc("updateGeometry"),t.getVTKWindow=()=>e._renderWindow,t.setLayer=s=>{wn(t.getClassName(),t,"setting Layer to ",s),e.layer!==s&&(e.layer=s,t.modified()),t.setPreserveColorBuffer(!!s)},t.setActiveCamera=s=>e.activeCamera===s?!1:(e.activeCamera=s,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:s}),!0),t.makeCamera=()=>{const s=j2.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:s}),s},t.getActiveCamera=()=>(e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera),t.getActiveCameraAndResetIfCreated=()=>(e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera),t.getActors=()=>(e.actors=[],e.props.forEach(s=>{e.actors=e.actors.concat(s.getActors())}),e.actors),t.addActor=t.addViewProp,t.removeActor=s=>{e.actors=e.actors.filter(i=>i!==s),t.removeViewProp(s),t.modified()},t.removeAllActors=()=>{t.getActors().forEach(i=>{t.removeViewProp(i)}),e.actors=[],t.modified()},t.getVolumes=()=>(e.volumes=[],e.props.forEach(s=>{e.volumes=e.volumes.concat(s.getVolumes())}),e.volumes),t.addVolume=t.addViewProp,t.removeVolume=s=>{e.volumes=e.volumes.filter(i=>i!==s),t.removeViewProp(s),t.modified()},t.removeAllVolumes=()=>{t.getVolumes().forEach(i=>{t.removeViewProp(i)}),e.volumes=[],t.modified()},t.hasLight=s=>e.lights.includes(s),t.addLight=s=>{s&&!t.hasLight(s)&&(e.lights.push(s),t.modified())},t.removeLight=s=>{e.lights=e.lights.filter(i=>i!==s),t.modified()},t.removeAllLights=()=>{e.lights=[],t.modified()},t.setLightCollection=s=>{e.lights=s,t.modified()},t.makeLight=q2.newInstance,t.createLight=()=>{e.automaticLightCreation&&(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=(s,i,o,c)=>{let u=t.normalizedDisplayToProjection(s,i,o);return u=t.projectionToView(u[0],u[1],u[2],c),t.viewToWorld(u[0],u[1],u[2])},t.worldToNormalizedDisplay=(s,i,o,c)=>{let u=t.worldToView(s,i,o);return u=t.viewToProjection(u[0],u[1],u[2],c),t.projectionToNormalizedDisplay(u[0],u[1],u[2])},t.viewToWorld=(s,i,o)=>{if(e.activeCamera===null)return yt("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();Oe(c,c),te(c,c);const u=new Float64Array([s,i,o]);return q(u,u,c),u},t.projectionToView=(s,i,o,c)=>{if(e.activeCamera===null)return yt("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];const u=e.activeCamera.getProjectionMatrix(c,-1,1);Oe(u,u),te(u,u);const g=new Float64Array([s,i,o]);return q(g,g,u),g},t.worldToView=(s,i,o)=>{if(e.activeCamera===null)return yt("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();te(c,c);const u=new Float64Array([s,i,o]);return q(u,u,c),u},t.viewToProjection=(s,i,o,c)=>{if(e.activeCamera===null)return yt("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];const u=e.activeCamera.getProjectionMatrix(c,-1,1);te(u,u);const g=new Float64Array([s,i,o]);return q(g,g,u),g},t.computeVisiblePropBounds=()=>{e.allBounds[0]=ee.INIT_BOUNDS[0],e.allBounds[1]=ee.INIT_BOUNDS[1],e.allBounds[2]=ee.INIT_BOUNDS[2],e.allBounds[3]=ee.INIT_BOUNDS[3],e.allBounds[4]=ee.INIT_BOUNDS[4],e.allBounds[5]=ee.INIT_BOUNDS[5];let s=!0;t.invokeEvent(n);for(let i=0;i<e.props.length;++i){const o=e.props[i];if(o.getVisibility()&&o.getUseBounds()){const c=o.getBounds();c&&ma(c)&&(s=!1,c[0]<e.allBounds[0]&&(e.allBounds[0]=c[0]),c[1]>e.allBounds[1]&&(e.allBounds[1]=c[1]),c[2]<e.allBounds[2]&&(e.allBounds[2]=c[2]),c[3]>e.allBounds[3]&&(e.allBounds[3]=c[3]),c[4]<e.allBounds[4]&&(e.allBounds[4]=c[4]),c[5]>e.allBounds[5]&&(e.allBounds[5]=c[5]))}}return s&&(ei(e.allBounds),wn("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){const i=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds(),o=[0,0,0];if(!ma(i))return wn("Cannot reset camera!"),!1;let c=null;if(t.getActiveCamera())c=e.activeCamera.getViewPlaneNormal();else return yt("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),o[0]=(i[0]+i[1])/2,o[1]=(i[2]+i[3])/2,o[2]=(i[4]+i[5])/2;let u=i[1]-i[0],g=i[3]-i[2],f=i[5]-i[4];u*=u,g*=g,f*=f;let l=u+g+f;l=l===0?1:l,l=Math.sqrt(l)*.5;const p=ie(e.activeCamera.getViewAngle()),y=l,h=l/Math.sin(p*.5),v=e.activeCamera.getViewUp();return Math.abs(K(v,c))>.999&&(tC("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-v[2],v[0],v[1])),e.activeCamera.setFocalPoint(o[0],o[1],o[2]),e.activeCamera.setPosition(o[0]+h*c[0],o[1]+h*c[1],o[2]+h*c[2]),t.resetCameraClippingRange(i),e.activeCamera.setParallelScale(y),e.activeCamera.setPhysicalScale(l),e.activeCamera.setPhysicalTranslation(-o[0],-o[1],-o[2]),t.invokeEvent(a),!0},t.resetCameraClippingRange=function(){const i=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds();if(!ma(i))return wn("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return yt("Trying to reset clipping range of non-existent camera"),!1;const o=e.activeCamera.computeClippingRange(i);let c=0;if(e.activeCamera.getParallelProjection())c=.2*e.activeCamera.getParallelScale();else{const u=ie(e.activeCamera.getViewAngle());c=.2*Math.tan(u/2)*o[1]}return o[1]-o[0]<c&&(c=c-o[1]+o[0],o[1]+=c/2,o[0]-=c/2),o[0]<0&&(o[0]=0),o[0]=.99*o[0]-(o[1]-o[0])*e.clippingRangeExpansion,o[1]=1.01*o[1]+(o[1]-o[0])*e.clippingRangeExpansion,o[0]=o[0]>=o[1]?.01*o[1]:o[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),o[0]<e.nearClippingPlaneTolerance*o[1]&&(o[0]=e.nearClippingPlaneTolerance*o[1]),e.activeCamera.setClippingRange(o[0],o[1]),t.invokeEvent(r),!1},t.setRenderWindow=s=>{s!==e._renderWindow&&(e._vtkWindow=s,e._renderWindow=s)},t.visibleActorCount=()=>e.props.filter(s=>s.getVisibility()).length,t.visibleVolumeCount=t.visibleActorCount,t.getMTime=()=>{let s=e.mtime;const i=e.activeCamera?e.activeCamera.getMTime():0;i>s&&(s=i);const o=e._createdLight?e._createdLight.getMTime():0;return o>s&&(s=o),s},t.getTransparent=()=>!!e.preserveColorBuffer,t.isActiveCameraCreated=()=>!!e.activeCamera}const rC={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:ti(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function Pg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,rC,n),eC.extend(t,e,n),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),Re(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),le(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),hn(t,e,["actors","volumes","lights"]),Ks(t,e,["background"],4,1),bn(t,e,["renderWindow"]),nC(t,e)}const aC=Z(Pg,"vtkRenderer");var Xg={newInstance:aC,extend:Pg};const sC="WebGL",Zr=Object.create(null);function Ti(t,e){Zr[t]=e}function iC(){return Object.keys(Zr)}function Yg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Zr[t]&&Zr[t](e)}function oC(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=n=>{t.hasRenderer(n)||(n.setRenderWindow(t),e.renderers.push(n),t.modified())},t.removeRenderer=n=>{e.renderers=e.renderers.filter(r=>r!==n),t.modified()},t.hasRenderer=n=>e.renderers.indexOf(n)!==-1,t.newAPISpecificView=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Yg(n||e.defaultViewAPI,r)},t.addView=n=>{t.hasView(n)||(n.setRenderable(t),e._views.push(n),t.modified())},t.removeView=n=>{e._views=e._views.filter(r=>r!==n),t.modified()},t.hasView=n=>e._views.indexOf(n)!==-1,t.preRender=()=>{e.renderers.forEach(n=>{n.isActiveCameraCreated()||n.resetCamera()})},t.render=()=>{t.preRender(),e.interactor?e.interactor.render():e._views.forEach(n=>n.traverseAllPasses())},t.getStatistics=()=>{const n={propCount:0,invisiblePropCount:0,gpuMemoryMB:0};return e._views.forEach(r=>{r.getGraphicsMemoryInfo&&(n.gpuMemoryMB+=r.getGraphicsMemoryInfo()/1e6)}),e.renderers.forEach(r=>{const a=r.getViewProps(),s=e._views[0].getViewNodeFor(r);a.forEach(i=>{if(i.getVisibility()){n.propCount+=1;const o=i.getMapper&&i.getMapper();if(o&&o.getPrimitiveCount){const c=s.getViewNodeFor(o);if(c){c.getAllocatedGPUMemoryInBytes&&(n.gpuMemoryMB+=c.getAllocatedGPUMemoryInBytes()/1e6);const u=o.getPrimitiveCount();Object.keys(u).forEach(g=>{n[g]||(n[g]=0),n[g]+=u[g]})}}}else n.invisiblePropCount+=1})}),n.str=Object.keys(n).map(r=>`${r}: ${n[r]}`).join(`
`),n},t.captureImages=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return E.setImmediate(t.render),e._views.map(a=>a.captureNextImage?a.captureNextImage(n,r):void 0).filter(a=>!!a)},t.addRenderWindow=n=>e.childRenderWindows.includes(n)?!1:(e.childRenderWindows.push(n),t.modified(),!0),t.removeRenderWindow=n=>{const r=e.childRenderWindows.findIndex(a=>a===n);return r<0?!1:(e.childRenderWindows.splice(r,1),t.modified(),!0)}}const cC={defaultViewAPI:sC,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1,childRenderWindows:[]};function qg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cC,n),E.obj(t,e),E.setGet(t,e,["interactor","numberOfLayers","_views","defaultViewAPI"]),E.get(t,e,["neverRendered"]),E.getArray(t,e,["renderers","childRenderWindows"]),E.moveToProtected(t,e,["views"]),E.event(t,e,"completion"),oC(t,e)}const fC=E.newInstance(qg,"vtkRenderWindow");var uC={newInstance:fC,extend:qg,registerViewConstructor:Ti,listViewAPIs:iC,newAPISpecificView:Yg};const Fs={Unknown:0,LeftController:1,RightController:2},Mn={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},gC={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4};var Ig={Device:Fs,Input:Mn,Axis:gC};const{Device:hr,Input:Ut}=Ig,{vtkWarningMacro:vr,vtkErrorMacro:yr,normalizeWheel:lC,vtkOnceErrorMacro:pC}=E,qt={ctrlKey:!1,altKey:!1,shiftKey:!1},Ja={"xr-standard":[Ut.Trigger,Ut.Grip,Ut.TrackPad,Ut.Thumbstick,Ut.A,Ut.B]},xi=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function En(t){t.cancelable&&t.preventDefault()}function dr(t){const e=Object.create(null);return t.forEach(n=>{let{pointerId:r,position:a}=n;e[r]=a}),e}function hC(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");const n={...t},r=new Set,a=new Map;let s=1;t.start=()=>{!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=h=>{yr("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=h=>{e.interactorStyle!==h&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=h,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=()=>{e.initialized=!0,t.enable(),t.render()},t.enable=()=>t.setEnabled(!0),t.disable=()=>t.setEnabled(!1),t.startEventLoop=()=>vr("empty event loop");function i(h,v){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(h,v))}t.getCurrentRenderer=()=>(e.currentRenderer||i(0,0),e.currentRenderer);function o(h){const v=e._view.getCanvas(),x=v.getBoundingClientRect(),S=v.width/x.width,d=v.height/x.height,T={x:S*(h.clientX-x.left),y:d*(x.height-h.clientY+x.top),z:0};return(a.size<=1||!e.currentRenderer)&&i(T.x,T.y),T}const c=e._getScreenEventPositionFor||o;function u(h){return{controlKey:h.ctrlKey,altKey:h.altKey,shiftKey:h.shiftKey}}function g(h){const v=u(h);return{key:h.key,keyCode:h.charCode,...v}}function f(h){return h.pointerType||""}const l=()=>{if(e.container===null)return;const{container:h}=e;h.addEventListener("contextmenu",En),h.addEventListener("wheel",t.handleWheel),h.addEventListener("DOMMouseScroll",t.handleWheel),h.addEventListener("pointerenter",t.handlePointerEnter),h.addEventListener("pointerleave",t.handlePointerLeave),h.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),h.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),h.addEventListener("pointerup",t.handlePointerUp),h.addEventListener("pointercancel",t.handlePointerCancel),document.addEventListener("keypress",t.handleKeyPress),document.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),h.style.touchAction="none",h.style.userSelect="none",h.style.webkitTapHighlightColor="rgba(0,0,0,0)"};t.bindEvents=h=>{if(h===null)return;n.setContainer(h)&&l()};const p=()=>{clearTimeout(e.moveTimeoutID),clearTimeout(e.wheelTimeoutID),e.moveTimeoutID=0,e.wheelTimeoutID=0,s=1;const{container:h}=e;h&&(h.removeEventListener("contextmenu",En),h.removeEventListener("wheel",t.handleWheel),h.removeEventListener("DOMMouseScroll",t.handleWheel),h.removeEventListener("pointerenter",t.handlePointerEnter),h.removeEventListener("pointerleave",t.handlePointerLeave),h.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),h.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),h.removeEventListener("pointerup",t.handlePointerUp),h.removeEventListener("pointercancel",t.handlePointerCancel)),document.removeEventListener("keypress",t.handleKeyPress),document.removeEventListener("keydown",t.handleKeyDown),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),a.clear()};t.unbindEvents=()=>{p(),n.setContainer(null)},t.handleKeyPress=h=>{const v=g(h);t.keyPressEvent(v)},t.handleKeyDown=h=>{const v=g(h);t.keyDownEvent(v)},t.handleKeyUp=h=>{const v=g(h);t.keyUpEvent(v)},t.handlePointerEnter=h=>{const v={...u(h),position:c(h),deviceType:f(h)};t.pointerEnterEvent(v),v.deviceType==="mouse"&&t.mouseEnterEvent(v)},t.handlePointerLeave=h=>{const v={...u(h),position:c(h),deviceType:f(h)};t.pointerLeaveEvent(v),v.deviceType==="mouse"&&t.mouseLeaveEvent(v)},t.handlePointerDown=h=>{if(!(h.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&En(h),h.target.hasPointerCapture(h.pointerId)&&h.target.releasePointerCapture(h.pointerId),e.container.setPointerCapture(h.pointerId),a.has(h.pointerId)&&vr("[RenderWindowInteractor] duplicate pointerId detected"),a.set(h.pointerId,{pointerId:h.pointerId,position:c(h)}),h.pointerType){case"pen":case"touch":t.handleTouchStart(h);break;case"mouse":default:t.handleMouseDown(h);break}},t.handlePointerUp=h=>{if(a.has(h.pointerId))switch(e.preventDefaultOnPointerUp&&En(h),a.delete(h.pointerId),e.container.releasePointerCapture(h.pointerId),h.pointerType){case"pen":case"touch":t.handleTouchEnd(h);break;case"mouse":default:t.handleMouseUp(h);break}},t.handlePointerCancel=h=>{if(a.has(h.pointerId))switch(a.delete(h.pointerId),h.pointerType){case"pen":case"touch":t.handleTouchEnd(h);break;case"mouse":default:t.handleMouseUp(h);break}},t.handlePointerMove=h=>{if(a.has(h.pointerId)){const v=a.get(h.pointerId);v.position=c(h)}switch(h.pointerType){case"pen":case"touch":t.handleTouchMove(h);break;case"mouse":default:t.handleMouseMove(h);break}},t.handleMouseDown=h=>{const v={...u(h),position:c(h),deviceType:f(h)};switch(h.button){case 0:t.leftButtonPressEvent(v);break;case 1:t.middleButtonPressEvent(v);break;case 2:t.rightButtonPressEvent(v);break;default:yr(`Unknown mouse button pressed: ${h.button}`);break}},t.requestPointerLock=()=>{e.container&&e.container.requestPointerLock()},t.exitPointerLock=()=>{var h;return(h=document.exitPointerLock)==null?void 0:h.call(document)},t.isPointerLocked=()=>!!e.container&&document.pointerLockElement===e.container,t.handlePointerLockChange=()=>{t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function y(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=h=>{if(h===void 0){yr("undefined requester, can not start animating");return}if(r.has(h)){vr("requester is already registered for animating");return}r.add(h),!e.animationRequest&&r.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=h=>{const v=Date.now()+h;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,v),!e.animationRequest&&r.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=()=>e.xrAnimation||e.animationRequest!==null,t.cancelAnimation=function(h){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!r.has(h)){if(!v){const x=h&&h.getClassName?h.getClassName():h;vr(`${x} did not request an animation`)}return}r.delete(h),e.animationRequest&&r.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=()=>{e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=()=>{e.xrAnimation=!1,r.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=(h,v,x)=>{h.inputSources.forEach(S=>{const d=S.gripSpace==null?null:v.getPose(S.gripSpace,x),T=S.gripSpace==null?null:v.getPose(S.targetRaySpace,x),w=S.gamepad,C=S.handedness;if(w){w.index in e.lastGamepadValues||(e.lastGamepadValues[w.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(let O=0;O<w.buttons.length;++O)O in e.lastGamepadValues[w.index][C].buttons||(e.lastGamepadValues[w.index][C].buttons[O]=!1),e.lastGamepadValues[w.index][C].buttons[O]!==w.buttons[O].pressed&&d!=null&&(t.button3DEvent({gamepad:w,position:d.transform.position,orientation:d.transform.orientation,targetPosition:T.transform.position,targetOrientation:T.transform.orientation,pressed:w.buttons[O].pressed,device:S.handedness==="left"?hr.LeftController:hr.RightController,input:Ja[w.mapping]&&Ja[w.mapping][O]?Ja[w.mapping][O]:Ut.Trigger}),e.lastGamepadValues[w.index][C].buttons[O]=w.buttons[O].pressed),e.lastGamepadValues[w.index][C].buttons[O]&&d!=null&&t.move3DEvent({gamepad:w,position:d.transform.position,orientation:d.transform.orientation,targetPosition:T.transform.position,targetOrientation:T.transform.orientation,device:S.handedness==="left"?hr.LeftController:hr.RightController})}})},t.handleMouseMove=h=>{const v={...u(h),position:c(h),deviceType:f(h)};e.moveTimeoutID===0?t.startMouseMoveEvent(v):(t.mouseMoveEvent(v),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(()=>{t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=()=>{const h=Date.now();e._animationFrameCount++,h-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(h-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=h,e._animationFrameCount=1),t.animationEvent(),y(),r.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=h=>{En(h);const v={...lC(h),...u(h),position:c(h),deviceType:f(h)};e.wheelTimeoutID===0&&(Math.abs(v.spinY)>=.3?s=Math.abs(v.spinY):s=1),v.spinY/=s,e.wheelTimeoutID===0?(t.startMouseWheelEvent(v),t.mouseWheelEvent(v)):(t.mouseWheelEvent(v),clearTimeout(e.wheelTimeoutID)),e.mouseScrollDebounceByPass?(t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0):e.wheelTimeoutID=setTimeout(()=>{t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=h=>{const v={...u(h),position:c(h),deviceType:f(h)};switch(h.button){case 0:t.leftButtonReleaseEvent(v);break;case 1:t.middleButtonReleaseEvent(v);break;case 2:t.rightButtonReleaseEvent(v);break;default:yr(`Unknown mouse button released: ${h.button}`);break}},t.handleTouchStart=h=>{const v=[...a.values()];if(e.recognizeGestures&&v.length>1){const x=dr(a);if(v.length===2){const S={...u(qt),position:v[0].position,deviceType:f(h)};t.leftButtonReleaseEvent(S)}t.recognizeGesture("TouchStart",x)}else if(v.length===1){const x={...u(qt),position:c(h),deviceType:f(h)};t.leftButtonPressEvent(x)}},t.handleTouchMove=h=>{const v=[...a.values()];if(e.recognizeGestures&&v.length>1){const x=dr(a);t.recognizeGesture("TouchMove",x)}else if(v.length===1){const x={...u(qt),position:v[0].position,deviceType:f(h)};t.mouseMoveEvent(x)}},t.handleTouchEnd=h=>{const v=[...a.values()];if(e.recognizeGestures)if(v.length===0){const x={...u(qt),position:c(h),deviceType:f(h)};t.leftButtonReleaseEvent(x)}else if(v.length===1){const x=dr(a);t.recognizeGesture("TouchEnd",x);const S={...u(qt),position:v[0].position,deviceType:f(h)};t.leftButtonPressEvent(S)}else{const x=dr(a);t.recognizeGesture("TouchMove",x)}else if(v.length===1){const x={...u(qt),position:v[0].position,deviceType:f(h)};t.leftButtonReleaseEvent(x)}},t.setView=h=>{e._view!==h&&(e._view=h,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=()=>{var h,v,x;return(x=(v=(h=e._view)==null?void 0:h.getRenderable())==null?void 0:v.getRenderersByReference())==null?void 0:x[0]},t.findPokedRenderer=function(){var C,O;let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;const x=(O=(C=e._view)==null?void 0:C.getRenderable())==null?void 0:O.getRenderers();if(!x||x.length===0)return null;x.sort((R,L)=>R.getLayer()-L.getLayer());let S=null,d=null,T=null,w=x.length;for(;w--;){const R=x[w];if(e._view.isInViewport(h,v,R)&&R.getInteractive()){T=R;break}S===null&&R.getInteractive()&&(S=R),d===null&&e._view.isInViewport(h,v,R)&&(d=R)}return T===null&&(T=S),T===null&&(T=d),T==null&&(T=x[0]),T},t.render=()=>{!t.isAnimating()&&!e.inRender&&y()},xi.forEach(h=>{const v=h.charAt(0).toLowerCase()+h.slice(1);t[`${v}Event`]=x=>{if(!e.enabled)return;if(!t.getCurrentRenderer()){pC(`
          Can not forward events without a current renderer on the interactor.
        `);return}const d={type:h,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer(),...x};t[`invoke${h}`](d)}}),t.recognizeGesture=(h,v)=>{if(Object.keys(v).length>2)return;if(e.startingEventPositions||(e.startingEventPositions={}),h==="TouchStart"){Object.keys(v).forEach(D=>{e.startingEventPositions[D]=v[D]}),e.currentGesture="Start";return}if(h==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}let x=0;const S=[],d=[];Object.keys(v).forEach(D=>{S[x]=v[D],d[x]=e.startingEventPositions[D],x++});const T=Math.sqrt((d[0].x-d[1].x)*(d[0].x-d[1].x)+(d[0].y-d[1].y)*(d[0].y-d[1].y)),w=Math.sqrt((S[0].x-S[1].x)*(S[0].x-S[1].x)+(S[0].y-S[1].y)*(S[0].y-S[1].y));let C=Un(Math.atan2(d[1].y-d[0].y,d[1].x-d[0].x)),O=Un(Math.atan2(S[1].y-S[0].y,S[1].x-S[0].x)),R=O-C;O=O+180>=360?O-180:O+180,C=C+180>=360?C-180:C+180,Math.abs(O-C)<Math.abs(R)&&(R=O-C);const L=[];if(L[0]=(S[0].x-d[0].x+S[1].x-d[1].x)/2,L[1]=(S[0].y-d[0].y+S[1].y-d[1].y)/2,h==="TouchMove")if(e.currentGesture==="Start"){let D=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);D<15&&(D=15);const M=Math.abs(w-T),V=w*3.1415926*Math.abs(R)/360,B=Math.sqrt(L[0]*L[0]+L[1]*L[1]);if(M>D&&M>V&&M>B){e.currentGesture="Pinch";const _={scale:1,touches:v};t.startPinchEvent(_)}else if(V>D&&V>B){e.currentGesture="Rotate";const _={rotation:0,touches:v};t.startRotateEvent(_)}else if(B>D){e.currentGesture="Pan";const _={translation:[0,0],touches:v};t.startPanEvent(_)}}else{if(e.currentGesture==="Rotate"){const D={rotation:R,touches:v};t.rotateEvent(D)}if(e.currentGesture==="Pinch"){const D={scale:w/T,touches:v};t.pinchEvent(D)}if(e.currentGesture==="Pan"){const D={translation:L,touches:v};t.panEvent(D)}}},t.handleVisibilityChange=()=>{e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=h=>{e._forcedRenderer=!!h,e.currentRenderer=h},t.setContainer=h=>{p();const v=n.setContainer(h??null);return v&&l(),v},t.delete=()=>{for(;r.size;)t.cancelAnimation(r.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),e.container&&t.setContainer(null),n.delete()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}const vC={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function Qg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vC,n),E.obj(t,e),e._animationExtendedEnd=0,E.event(t,e,"RenderEvent"),xi.forEach(r=>E.event(t,e,r)),E.get(t,e,["initialized","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),E.setGet(t,e,["container","lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),E.moveToProtected(t,e,["view"]),hC(t,e)}const yC=E.newInstance(Qg,"vtkRenderWindowInteractor");var Zg={newInstance:yC,extend:Qg,handledEvents:xi,...Ig};const{vtkErrorMacro:dC,VOID:TC}=E;function xC(t,e,n,r){return t.getRenderWindow().getViews()[0].worldToDisplay(e,n,r,t)}function SC(t,e,n,r){return t.getRenderWindow().getViews()[0].displayToWorld(e,n,r,t)}const CC={computeWorldToDisplay:xC,computeDisplayToWorld:SC};function wC(t,e){e.classHierarchy.push("vtkInteractorObserver");const n={...t};function r(){for(;e.subscribedEvents.length;)e.subscribedEvents.pop().unsubscribe()}function a(){Zg.handledEvents.forEach(s=>{t[`handle${s}`]&&e.subscribedEvents.push(e._interactor[`on${s}`](i=>e.processEvents?t[`handle${s}`](i):TC,e.priority))})}t.setInteractor=s=>{s!==e._interactor&&(r(),e._interactor=s,s&&e.enabled&&a(),t.modified())},t.setEnabled=s=>{s!==e.enabled&&(r(),s&&(e._interactor?a():dC(`
          The interactor must be set before subscribing to events
        `)),e.enabled=s,t.modified())},t.computeDisplayToWorld=(s,i,o,c)=>s?e._interactor.getView().displayToWorld(i,o,c,s):null,t.computeWorldToDisplay=(s,i,o,c)=>s?e._interactor.getView().worldToDisplay(i,o,c,s):null,t.setPriority=s=>{n.setPriority(s)&&e._interactor&&(r(),a())}}const EC={enabled:!0,priority:0,processEvents:!0,subscribedEvents:[]};function Jg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,EC,n),E.obj(t,e),E.event(t,e,"InteractionEvent"),E.event(t,e,"StartInteractionEvent"),E.event(t,e,"EndInteractionEvent"),E.get(t,e,["_interactor","enabled"]),E.setGet(t,e,["priority","processEvents"]),E.moveToProtected(t,e,["interactor"]),wC(t,e)}const OC=E.newInstance(Jg,"vtkInteractorObserver");var RC={newInstance:OC,extend:Jg,...CC};const DC={IS_START:0,IS_NONE:0,IS_ROTATE:1,IS_PAN:2,IS_SPIN:3,IS_DOLLY:4,IS_CAMERA_POSE:11,IS_WINDOW_LEVEL:1024,IS_SLICE:1025};var Si={States:DC};const{States:Xe}=Si,es={Rotate:Xe.IS_ROTATE,Pan:Xe.IS_PAN,Spin:Xe.IS_SPIN,Dolly:Xe.IS_DOLLY,CameraPose:Xe.IS_CAMERA_POSE,WindowLevel:Xe.IS_WINDOW_LEVEL,Slice:Xe.IS_SLICE};function MC(t,e){e.classHierarchy.push("vtkInteractorStyle"),Object.keys(es).forEach(n=>{E.event(t,e,`Start${n}Event`),t[`start${n}`]=()=>{e.state===Xe.IS_NONE&&(e.state=es[n],e._interactor.requestAnimation(t),t.invokeStartInteractionEvent({type:"StartInteractionEvent"}),t[`invokeStart${n}Event`]({type:`Start${n}Event`}))},E.event(t,e,`End${n}Event`),t[`end${n}`]=()=>{e.state===es[n]&&(e.state=Xe.IS_NONE,e._interactor.cancelAnimation(t),t.invokeEndInteractionEvent({type:"EndInteractionEvent"}),t[`invokeEnd${n}Event`]({type:`End${n}Event`}),e._interactor.render())}}),e.getRenderer=n=>e.focusedRenderer||n.pokedRenderer,t.handleKeyPress=n=>{const r=e._interactor;let a=null;switch(n.key){case"r":case"R":e.getRenderer(n).resetCamera(),r.render();break;case"w":case"W":a=e.getRenderer(n).getActors(),a.forEach(s=>{const i=s.getProperty();i.setRepresentationToWireframe&&i.setRepresentationToWireframe()}),r.render();break;case"s":case"S":a=e.getRenderer(n).getActors(),a.forEach(s=>{const i=s.getProperty();i.setRepresentationToSurface&&i.setRepresentationToSurface()}),r.render();break;case"v":case"V":a=e.getRenderer(n).getActors(),a.forEach(s=>{const i=s.getProperty();i.setRepresentationToPoints&&i.setRepresentationToPoints()}),r.render();break}}}const LC={state:Xe.IS_NONE,handleObservers:1,autoAdjustCameraClippingRange:1};function el(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LC,n),RC.extend(t,e,n),E.setGet(t,e,["focusedRenderer"]),MC(t,e)}const VC=E.newInstance(el,"vtkInteractorStyle");var _C={newInstance:VC,extend:el,...Si};const{States:je}=Si;function BC(t,e){e.classHierarchy.push("vtkInteractorStyleTrackballCamera"),t.handleMouseMove=n=>{const r=n.position,a=e.getRenderer(n);switch(e.state){case je.IS_ROTATE:t.handleMouseRotate(a,r),t.invokeInteractionEvent({type:"InteractionEvent"});break;case je.IS_PAN:t.handleMousePan(a,r),t.invokeInteractionEvent({type:"InteractionEvent"});break;case je.IS_DOLLY:t.handleMouseDolly(a,r),t.invokeInteractionEvent({type:"InteractionEvent"});break;case je.IS_SPIN:t.handleMouseSpin(a,r),t.invokeInteractionEvent({type:"InteractionEvent"});break}e.previousPosition=r},t.handleButton3D=n=>{if(n&&n.pressed&&n.device===Fs.RightController&&(n.input===Mn.Trigger||n.input===Mn.TrackPad)){t.startCameraPose();return}n&&!n.pressed&&n.device===Fs.RightController&&(n.input===Mn.Trigger||n.input===Mn.TrackPad)&&e.state===je.IS_CAMERA_POSE&&t.endCameraPose()},t.handleMove3D=n=>{switch(e.state){case je.IS_CAMERA_POSE:t.updateCameraPose(n);break}},t.updateCameraPose=n=>{const r=e.getRenderer(n).getActiveCamera(),a=r.getPhysicalTranslation(),i=.5*.05*r.getPhysicalScale(),o=r.physicalOrientationToWorldDirection([n.orientation.x,n.orientation.y,n.orientation.z,n.orientation.w]);r.setPhysicalTranslation(a[0]+o[0]*i,a[1]+o[1]*i,a[2]+o[2]*i)},t.handleLeftButtonPress=n=>{const r=n.position;e.previousPosition=r,n.shiftKey?n.controlKey||n.altKey?t.startDolly():t.startPan():n.controlKey||n.altKey?t.startSpin():t.startRotate()},t.handleLeftButtonRelease=()=>{switch(e.state){case je.IS_DOLLY:t.endDolly();break;case je.IS_PAN:t.endPan();break;case je.IS_SPIN:t.endSpin();break;case je.IS_ROTATE:t.endRotate();break}},t.handleStartMouseWheel=()=>{t.startDolly()},t.handleEndMouseWheel=()=>{t.endDolly()},t.handleStartPinch=n=>{e.previousScale=n.scale,t.startDolly()},t.handleEndPinch=()=>{t.endDolly()},t.handleStartRotate=n=>{e.previousRotation=n.rotation,t.startRotate()},t.handleEndRotate=()=>{t.endRotate()},t.handleStartPan=n=>{e.previousTranslation=n.translation,t.startPan()},t.handleEndPan=()=>{t.endPan()},t.handlePinch=n=>{t.dollyByFactor(e.getRenderer(n),n.scale/e.previousScale),e.previousScale=n.scale},t.handlePan=n=>{const r=e.getRenderer(n).getActiveCamera();let a=r.getFocalPoint();a=t.computeWorldToDisplay(e.getRenderer(n),a[0],a[1],a[2]);const s=a[2],i=n.translation,o=e.previousTranslation,c=t.computeDisplayToWorld(e.getRenderer(n),a[0]+i[0]-o[0],a[1]+i[1]-o[1],s),u=t.computeDisplayToWorld(e.getRenderer(n),a[0],a[1],s),g=[];g[0]=u[0]-c[0],g[1]=u[1]-c[1],g[2]=u[2]-c[2],a=r.getFocalPoint();const f=r.getPosition();r.setFocalPoint(g[0]+a[0],g[1]+a[1],g[2]+a[2]),r.setPosition(g[0]+f[0],g[1]+f[1],g[2]+f[2]),e._interactor.getLightFollowCamera()&&e.getRenderer(n).updateLightsGeometryToFollowCamera(),r.orthogonalizeViewUp(),e.previousTranslation=n.translation},t.handleRotate=n=>{const r=e.getRenderer(n).getActiveCamera();r.roll(n.rotation-e.previousRotation),r.orthogonalizeViewUp(),e.previousRotation=n.rotation},t.handleMouseRotate=(n,r)=>{if(!e.previousPosition)return;const a=e._interactor,s=r.x-e.previousPosition.x,i=r.y-e.previousPosition.y,o=a.getView().getViewportSize(n);let c=-.1,u=-.1;o[0]&&o[1]&&(c=-20/o[1],u=-20/o[0]);const g=s*u*e.motionFactor,f=i*c*e.motionFactor,l=n.getActiveCamera();!Number.isNaN(g)&&!Number.isNaN(f)&&(l.azimuth(g),l.elevation(f),l.orthogonalizeViewUp()),e.autoAdjustCameraClippingRange&&n.resetCameraClippingRange(),a.getLightFollowCamera()&&n.updateLightsGeometryToFollowCamera()},t.handleMouseSpin=(n,r)=>{if(!e.previousPosition)return;const a=e._interactor,s=n.getActiveCamera(),i=a.getView().getViewportCenter(n),o=Un(Math.atan2(e.previousPosition.y-i[1],e.previousPosition.x-i[0])),c=Un(Math.atan2(r.y-i[1],r.x-i[0]))-o;Number.isNaN(c)||(s.roll(c),s.orthogonalizeViewUp())},t.handleMousePan=(n,r)=>{if(!e.previousPosition)return;const a=n.getActiveCamera();let s=a.getFocalPoint();s=t.computeWorldToDisplay(n,s[0],s[1],s[2]);const i=s[2],o=t.computeDisplayToWorld(n,r.x,r.y,i),c=t.computeDisplayToWorld(n,e.previousPosition.x,e.previousPosition.y,i),u=[];u[0]=c[0]-o[0],u[1]=c[1]-o[1],u[2]=c[2]-o[2],s=a.getFocalPoint();const g=a.getPosition();a.setFocalPoint(u[0]+s[0],u[1]+s[1],u[2]+s[2]),a.setPosition(u[0]+g[0],u[1]+g[1],u[2]+g[2]),e._interactor.getLightFollowCamera()&&n.updateLightsGeometryToFollowCamera()},t.handleMouseDolly=(n,r)=>{if(!e.previousPosition)return;const a=r.y-e.previousPosition.y,i=e._interactor.getView().getViewportCenter(n),o=e.motionFactor*a/i[1];t.dollyByFactor(n,1.1**o)},t.handleMouseWheel=n=>{const r=1-n.spinY/e.zoomFactor;t.dollyByFactor(e.getRenderer(n),r)},t.dollyByFactor=(n,r)=>{if(Number.isNaN(r))return;const a=n.getActiveCamera();a.getParallelProjection()?a.setParallelScale(a.getParallelScale()/r):(a.dolly(r),e.autoAdjustCameraClippingRange&&n.resetCameraClippingRange()),e._interactor.getLightFollowCamera()&&n.updateLightsGeometryToFollowCamera()}}const FC={motionFactor:10,zoomFactor:10};function tl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FC,n),_C.extend(t,e,n),E.setGet(t,e,["motionFactor","zoomFactor"]),BC(t,e)}const mC=E.newInstance(tl,"vtkInteractorStyleTrackballCamera");var UC={newInstance:mC,extend:tl};function kC(t){return t}function Ci(t){if(t===null||t==="null")return null;if(t==="true")return!0;if(t==="false")return!1;if(!(t===void 0||t==="undefined"))return t[0]==="["&&t[t.length-1]==="]"?t.substring(1,t.length-1).split(",").map(e=>Ci(e.trim())):t===""||Number.isNaN(Number(t))?t:Number(t)}function NC(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:window.location.search;const n={},r=t?Ci:kC;return new URLSearchParams(e).forEach((s,i)=>{i&&(n[i]=s?r(s):!0)}),n}var GC={toNativeType:Ci,extractURLParameters:NC};function bC(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=()=>e.context.FRAMEBUFFER,t.saveCurrentBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.saveCurrentBindings(r),t.saveCurrentBuffers(r)},t.saveCurrentBindings=n=>{if(!e.context){j("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}const r=e.context;e.previousDrawBinding=r.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=n=>{},t.restorePreviousBindingsAndBuffers=n=>{const r=typeof n<"u"?n:t.getBothMode();t.restorePreviousBindings(r),t.restorePreviousBuffers(r)},t.restorePreviousBindings=n=>{if(!e.context){j("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}const r=e.context;r.bindFramebuffer(r.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=n=>{},t.bind=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;r===null&&(r=e.context.FRAMEBUFFER),e.context.bindFramebuffer(r,e.glFramebuffer);for(let a=0;a<e.colorBuffers.length;a++)e.colorBuffers[a].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=(n,r)=>{if(!e.context){j("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=n,e.glFramebuffer.height=r},t.setColorBuffer=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const a=e.context;if(!a){j("you must set the OpenGLRenderWindow before calling setColorBuffer");return}let s=a.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())s+=r;else{j("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[r]=n,a.framebufferTexture2D(a.FRAMEBUFFER,s,a.TEXTURE_2D,n.getHandle(),0)},t.removeColorBuffer=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const r=e.context;if(!r){j("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}let a=r.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())a+=n;else{j("Using multiple framebuffer attachments requires WebGL 2");return}r.framebufferTexture2D(r.FRAMEBUFFER,a,r.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(n,1)},t.setDepthBuffer=n=>{if(!e.context){j("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,n.getHandle(),0)}else j("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=()=>{if(!e.context){j("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,null,0)}else j("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=()=>e.glFramebuffer,t.setOpenGLRenderWindow=n=>{e._openGLRenderWindow!==n&&(t.releaseGraphicsResources(),e._openGLRenderWindow=n,e.context=null,n&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=()=>{e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=()=>e.glFramebuffer==null?null:[e.glFramebuffer.width,e.glFramebuffer.height],t.populateFramebuffer=()=>{if(!e.context){j("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();const n=e.context,r=zt.newInstance();r.setOpenGLRenderWindow(e._openGLRenderWindow),r.setMinificationFilter(Vs.LINEAR),r.setMagnificationFilter(Vs.LINEAR),r.create2DFromRaw(e.glFramebuffer.width,e.glFramebuffer.height,4,ce.UNSIGNED_CHAR,null),t.setColorBuffer(r),e.depthTexture=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,e.depthTexture),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e.depthTexture)},t.getColorTexture=()=>e.colorBuffers[0]}const $C={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function nl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$C,n),ye(t,e),e.colorBuffers&&j("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],hn(t,e,["colorBuffers"]),bC(t,e)}const zC=Z(nl,"vtkFramebuffer");var wi={newInstance:zC,extend:nl};function WC(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=()=>e.currentOperation,t.setCurrentOperation=n=>{e.currentOperation=n,e.currentTraverseOperation=`traverse${E.capitalize(e.currentOperation)}`},t.getTraverseOperation=()=>e.currentTraverseOperation,t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e._currentParent=r,e.preDelegateOperations.forEach(a=>{t.setCurrentOperation(a),n.traverse(t)}),e.delegates.forEach(a=>{a.traverse(n,t)}),e.postDelegateOperations.forEach(a=>{t.setCurrentOperation(a),n.traverse(t)}))}}const HC={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function rl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HC,n),E.obj(t,e),E.get(t,e,["currentOperation"]),E.setGet(t,e,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),E.moveToProtected(t,e,["currentParent"]),WC(t,e)}const AC=E.newInstance(rl,"vtkRenderPass");var ct={newInstance:AC,extend:rl};const{Representation:jC}=vn,{vtkErrorMacro:lc}=E;function KC(t){const e=F.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}const PC=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function XC(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=()=>{const n=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),r=new Float32Array([0,0,1,0,0,1,1,1]),a=new Uint16Array([4,0,1,3,2]),s=Y.newInstance({numberOfComponents:3,values:n});s.setName("points");const i=Y.newInstance({numberOfComponents:2,values:r});i.setName("tcoords");const o=Y.newInstance({numberOfComponents:1,values:a});e.tris.getCABO().createVBO(o,"polys",jC.SURFACE,{points:s,tcoords:i,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=n=>{const r=n.getSize(),a=n.getContext();e.framebuffer=wi.newInstance(),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.create(...r),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=zt.newInstance(),e.translucentRGBATexture.setInternalFormat(a.RGBA16F),e.translucentRGBATexture.setFormat(a.RGBA),e.translucentRGBATexture.setOpenGLDataType(a.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(n),e.translucentRGBATexture.create2DFromRaw(r[0],r[1],4,"Float32Array",null),e.translucentRTexture=zt.newInstance(),e.translucentRTexture.setInternalFormat(a.R16F),e.translucentRTexture.setFormat(a.RED),e.translucentRTexture.setOpenGLDataType(a.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(n),e.translucentRTexture.create2DFromRaw(r[0],r[1],1,"Float32Array",null),e.translucentZTexture=zt.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(n),e.translucentZTexture.createDepthFromRaw(r[0],r[1],"Float32Array",null),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=n=>{e.copyShader=n.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),PC,"")},t.createVBO=n=>{const r=n.getContext();e.tris.setOpenGLRenderWindow(n),t.createVertexBuffer();const a=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),r.FLOAT,3,r.FALSE)||lc("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),r.FLOAT,2,r.FALSE)||lc("Error setting vertexDC in copy shader VAO.")},t.traverse=(n,r,a)=>{if(e.deleted)return;const s=n.getSize(),i=n.getContext();if(e._supported=!1,r.getSelector()||!i||!n.getWebgl2()||!i.getExtension("EXT_color_buffer_half_float")&&!i.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),r.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(n);else{const c=e.framebuffer.getSize();c===null||c[0]!==s[0]||c[1]!==s[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRTexture.releaseGraphicsResources(n),e.translucentZTexture.releaseGraphicsResources(n),t.createFramebuffer(n)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}i.drawBuffers([i.COLOR_ATTACHMENT0]),i.clearBufferfv(i.COLOR,0,[0,0,0,0]),i.clearBufferfv(i.DEPTH,0,[1]),i.colorMask(!1,!1,!1,!1),a.getOpaqueActorCount()>0&&(a.setCurrentOperation("opaqueZBufferPass"),r.traverse(a)),i.colorMask(!0,!0,!0,!0),i.drawBuffers([i.COLOR_ATTACHMENT0,i.COLOR_ATTACHMENT1]),i.viewport(0,0,s[0],s[1]),i.scissor(0,0,s[0],s[1]),i.clearBufferfv(i.COLOR,0,[0,0,0,1]),i.clearBufferfv(i.COLOR,1,[0,0,0,0]),i.enable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendFuncSeparate(i.ONE,i.ONE,i.ZERO,i.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),r.traverse(t),i.drawBuffers([i.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(n):n.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=ng.newInstance(),e.copyVAO.setOpenGLRenderWindow(n)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(n),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA),i.depthMask(!1),i.depthFunc(i.ALWAYS),i.viewport(0,0,s[0],s[1]),i.scissor(0,0,s[0],s[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),i.drawArrays(i.TRIANGLES,0,e.tris.getCABO().getElementCount()),i.depthMask(!0),i.depthFunc(i.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate();const o=r.getTiledSizeAndOrigin();i.scissor(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),i.viewport(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize)},t.getShaderReplacement=()=>e._supported?KC:null,t.releaseGraphicsResources=n=>{e.framebuffer&&(e.framebuffer.releaseGraphicsResources(n),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(n),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(n),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(n),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(n),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(n),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(n),e.tris=null),t.modified()}}const YC={framebuffer:null,copyShader:null,tris:null};function al(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YC,n),ct.extend(t,e,n),e.VBOBuildTime={},E.obj(e.VBOBuildTime,{mtime:0}),e.tris=yn.newInstance(),E.get(t,e,["framebuffer"]),XC(t,e)}const qC=E.newInstance(al,"vtkOpenGLOrderIndependentTranslucentPass");var IC={newInstance:qC,extend:al};function QC(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=r,t.setCurrentOperation("buildPass"),n.traverse(t);const a=n.getRenderable().getNumberOfLayers(),s=n.getRenderable().getRenderersByReference();for(let i=0;i<a;i++)for(let o=0;o<s.length;o++){const c=s[o],u=n.getViewNodeFor(c);if(c.getDraw()&&c.getLayer()===i){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),u.traverse(t),(e.opaqueActorCount>0||e.translucentActorCount>0)&&e.volumeCount>0||e.depthRequested){const g=n.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=wi.newInstance()),e.framebuffer.setOpenGLRenderWindow(n),e.framebuffer.saveCurrentBindingsAndBuffers();const f=e.framebuffer.getSize();(f===null||f[0]!==g[0]||f[1]!==g[1])&&(e.framebuffer.create(g[0],g[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("zBufferPass"),u.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),u.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),u.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=IC.newInstance()),e.translucentPass.traverse(n,u,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),u.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),u.traverse(t))}}},t.getZBufferTexture=()=>e.framebuffer?e.framebuffer.getColorTexture():null,t.requestDepth=()=>{e.depthRequested=!0},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.incrementVolumeCount=()=>e.volumeCount++,t.incrementOverlayActorCount=()=>e.overlayActorCount++}const ZC={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function sl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ZC,n),ct.extend(t,e,n),E.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),QC(t,e)}const JC=E.newInstance(sl,"vtkForwardPass");var ew={newInstance:JC,extend:sl};const{FieldAssociations:tw}=Kt;function nw(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=async(n,r,a,s,i)=>{},t.selectAsync=async(n,r,a,s,i)=>{const o=await t.getSourceDataAsync(n,r,a,s,i);return o?o.generateSelection(r,a,s,i):[]}}const rw={fieldAssociation:tw.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function il(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rw,n),E.obj(t,e),E.setGet(t,e,["fieldAssociation","captureZValues"]),nw(t,e)}const aw=E.newInstance(il,"vtkHardwareSelector");var ol={newInstance:aw,extend:il};const sw={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},iw={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5};var ow={SelectionContent:sw,SelectionField:iw};function cw(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=()=>e.points.getBounds()}const fw={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function cl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fw,n),E.obj(t,e),e.properties={},E.setGet(t,e,["contentType","fieldType","properties","selectionList"]),cw(t,e)}const uw=E.newInstance(cl,"vtkSelectionNode");var ua={newInstance:uw,extend:cl,...ow};const{PassTypes:se}=_u,{SelectionContent:gw,SelectionField:pc}=ua,{FieldAssociations:_n}=Kt,{vtkErrorMacro:fl}=E,Tt=1;function ul(t){return`${t.propID} ${t.compositeID}`}function gl(t,e,n,r){if(!n)return 0;const a=(e*(r[2]-r[0]+1)+t)*4;return n[a+3]}function at(t,e,n,r){if(!n)return 0;const a=(e*(r[2]-r[0]+1)+t)*4,s=n[a],i=n[a+1];return(n[a+2]*256+i)*256+s}function ll(t,e){let n=e;return n<<=24,n|=t,n}function lw(t,e,n,r){{if(r[0]=e[0],r[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;const a=[e[0]-t.area[0],e[1]-t.area[1]],s=at(a[0],a[1],t.pixBuffer[se.ACTOR_PASS],t.area);if(s<=0||s-Tt>=t.props.length)return null;const i={};i.valid=!0,i.propID=s-Tt,i.prop=t.props[i.propID];let o=at(a[0],a[1],t.pixBuffer[se.COMPOSITE_INDEX_PASS],t.area);if((o<0||o>16777215)&&(o=0),i.compositeID=o-Tt,t.captureZValues){const g=(a[1]*(t.area[2]-t.area[0]+1)+a[0])*4;i.zValue=(256*t.zBuffer[g]+t.zBuffer[g+1])/65535,i.displayPosition=e}if(t.pixBuffer[se.ID_LOW24]&&gl(a[0],a[1],t.pixBuffer[se.ID_LOW24],t.area)===0)return i;const c=at(a[0],a[1],t.pixBuffer[se.ID_LOW24],t.area),u=at(a[0],a[1],t.pixBuffer[se.ID_HIGH24],t.area);return i.attributeID=ll(c,u),i}}function pl(t,e,n,r,a){const s=[];let i=0;return e.forEach((o,c)=>{const u=ua.newInstance();switch(u.setContentType(gw.INDICES),t){case _n.FIELD_ASSOCIATION_CELLS:u.setFieldType(pc.CELL);break;case _n.FIELD_ASSOCIATION_POINTS:u.setFieldType(pc.POINT);break;default:fl("Unknown field association")}u.getProperties().propID=o.info.propID,u.getProperties().prop=o.info.prop,u.getProperties().compositeID=o.info.compositeID,u.getProperties().attributeID=o.info.attributeID,u.getProperties().pixelCount=o.pixelCount,n&&(u.getProperties().displayPosition=[o.info.displayPosition[0],o.info.displayPosition[1],o.info.zValue],u.getProperties().worldPosition=a.displayToWorld(o.info.displayPosition[0],o.info.displayPosition[1],o.info.zValue,r)),u.setSelectionList(o.attributeIDs),s[i]=u,i++}),s}function pw(t,e,n,r,a){const s=Math.floor(e),i=Math.floor(n),o=Math.floor(r),c=Math.floor(a),u=new Map,g=[0,0];for(let f=i;f<=c;f++)for(let l=s;l<=o;l++){const y=lw(t,[l,f],0,g);if(y&&y.valid){const h=ul(y);if(!u.has(h))u.set(h,{info:y,pixelCount:1,attributeIDs:[y.attributeID]});else{const v=u.get(h);v.pixelCount++,t.captureZValues&&y.zValue<v.info.zValue&&(v.info=y),v.attributeIDs.indexOf(y.attributeID)===-1&&v.attributeIDs.push(y.attributeID)}}}return pl(t.fieldAssociation,u,t.captureZValues,t.renderer,t.openGLRenderWindow)}function hw(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=()=>{e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=()=>{e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;const r=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=wi.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();const a=e.framebuffer.getSize();!a||a[0]!==r[0]||a[1]!==r[1]?(e.framebuffer.create(r[0],r[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===_n.FIELD_ASSOCIATION_POINTS){const a=e._openGLRenderWindow.getContext(),s=a.isEnabled(a.BLEND);a.disable(a.BLEND),e._openGLRenderWindow.traverseAllPasses(),s&&a.enable(a.BLEND)}},t.endSelection=()=>{e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers()},t.preCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending=r.isEnabled(r.BLEND),r.disable(r.BLEND)},t.postCapturePass=()=>{const r=e._openGLRenderWindow.getContext();e.originalBlending&&r.enable(r.BLEND)},t.select=()=>{let r=null;return t.captureBuffers()&&(r=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),r},t.getSourceDataAsync=async(r,a,s,i,o)=>{if(e._renderer=r,a===void 0){const u=e._openGLRenderWindow.getSize();t.setArea(0,0,u[0]-1,u[1]-1)}else t.setArea(a,s,i,o);if(!t.captureBuffers())return!1;const c={area:[...e.area],pixBuffer:[...e.pixBuffer],captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:[...e.props],fieldAssociation:e.fieldAssociation,renderer:r,openGLRenderWindow:e._openGLRenderWindow};return c.generateSelection=function(){for(var u=arguments.length,g=new Array(u),f=0;f<u;f++)g[f]=arguments[f];return pw(c,...g)},c},t.captureBuffers=()=>{if(!e._renderer||!e._openGLRenderWindow)return fl("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);const r=e._openGLRenderWindow.getRenderPasses();t.beginSelection();const a=[];for(e.currentPass=se.MIN_KNOWN_PASS;e.currentPass<=se.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===se.ACTOR_PASS&&typeof r[0].requestDepth=="function"&&typeof r[0].getFramebuffer=="function"&&r[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),a.push(e.currentPass));return a.forEach(s=>{e.currentPass=s,t.processPixelBuffers()}),e.currentPass=se.MAX_KNOWN_PASS,t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=()=>{e.props.forEach((r,a)=>{t.isPropHit(a)&&r.processSelectorPixelBuffers(t,e.propPixels[a])})},t.passRequired=r=>{if(r===se.ID_HIGH24){if(e.fieldAssociation===_n.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===_n.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=r=>{if(e.pixBuffer[r]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[r]){const a=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[r]=new Uint8Array(a),e.rawPixBuffer[r].set(e.pixBuffer[r])}if(r===se.ACTOR_PASS){if(e.captureZValues){const a=e._openGLRenderWindow.getRenderPasses();if(typeof a[0].requestDepth=="function"&&typeof a[0].getFramebuffer=="function"){const s=a[0].getFramebuffer();s.saveCurrentBindingsAndBuffers(),s.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),s.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[r])}},t.buildPropHitList=r=>{let a=0;for(let s=0;s<=e.area[3]-e.area[1];s++)for(let i=0;i<=e.area[2]-e.area[0];i++){let o=at(i,s,r,e.area);o>0&&(o--,o in e.hitProps||(e.hitProps[o]=!0,e.propPixels[o]=[]),e.propPixels[o].push(a*4)),++a}},t.renderProp=r=>{e.currentPass===se.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+Tt),e.props.push(r))},t.renderCompositeIndex=r=>{e.currentPass===se.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(r+Tt)},t.renderAttributeId=r=>{r<0||(e.maxAttributeId=r>e.maxAttributeId?r:e.maxAttributeId)},t.passTypeToString=r=>E.enumToString(se,r),t.isPropHit=r=>!!e.hitProps[r],t.setPropColorValueFromInt=r=>{e.propColorValue[0]=r%256/255,e.propColorValue[1]=Math.floor(r/256)%256/255,e.propColorValue[2]=Math.floor(r/65536)%256/255},t.getPixelInformation=(r,a,s)=>{const i=a<0?0:a;if(i===0){if(s[0]=r[0],s[1]=r[1],r[0]<e.area[0]||r[0]>e.area[2]||r[1]<e.area[1]||r[1]>e.area[3])return null;const g=[r[0]-e.area[0],r[1]-e.area[1]],f=at(g[0],g[1],e.pixBuffer[se.ACTOR_PASS],e.area);if(f<=0||f-Tt>=e.props.length)return null;const l={};l.valid=!0,l.propID=f-Tt,l.prop=e.props[l.propID];let p=at(g[0],g[1],e.pixBuffer[se.COMPOSITE_INDEX_PASS],e.area);if((p<0||p>16777215)&&(p=0),l.compositeID=p-Tt,e.captureZValues){const v=(g[1]*(e.area[2]-e.area[0]+1)+g[0])*4;l.zValue=(256*e.zBuffer[v]+e.zBuffer[v+1])/65535,l.displayPosition=r}if(e.pixBuffer[se.ID_LOW24]&&gl(g[0],g[1],e.pixBuffer[se.ID_LOW24],e.area)===0)return l;const y=at(g[0],g[1],e.pixBuffer[se.ID_LOW24],e.area),h=at(g[0],g[1],e.pixBuffer[se.ID_HIGH24],e.area);return l.attributeID=ll(y,h),l}const o=[r[0],r[1]],c=[0,0];let u=t.getPixelInformation(r,0,s);if(u&&u.valid)return u;for(let g=1;g<i;++g){for(let f=o[1]>g?o[1]-g:0;f<=o[1]+g;++f)if(c[1]=f,o[0]>=g&&(c[0]=o[0]-g,u=t.getPixelInformation(c,0,s),u&&u.valid)||(c[0]=o[0]+g,u=t.getPixelInformation(c,0,s),u&&u.valid))return u;for(let f=o[0]>=g?o[0]-(g-1):0;f<=o[0]+(g-1);++f)if(c[0]=f,o[1]>=g&&(c[1]=o[1]-g,u=t.getPixelInformation(c,0,s),u&&u.valid)||(c[1]=o[1]+g,u=t.getPixelInformation(c,0,s),u&&u.valid))return u}return s[0]=r[0],s[1]=r[1],null},t.generateSelection=(r,a,s,i)=>{const o=Math.floor(r),c=Math.floor(a),u=Math.floor(s),g=Math.floor(i),f=new Map,l=[0,0];for(let p=c;p<=g;p++)for(let y=o;y<=u;y++){const h=[y,p],v=t.getPixelInformation(h,0,l);if(v&&v.valid){const x=ul(v);if(!f.has(x))f.set(x,{info:v,pixelCount:1,attributeIDs:[v.attributeID]});else{const S=f.get(x);S.pixelCount++,e.captureZValues&&v.zValue<S.info.zValue&&(S.info=v),S.attributeIDs.indexOf(v.attributeID)===-1&&S.attributeIDs.push(v.attributeID)}}}return pl(e.fieldAssociation,f,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=r=>e.rawPixBuffer[r],t.getPixelBuffer=r=>e.pixBuffer[r],t.attach=(r,a)=>{e._openGLRenderWindow=r,e._renderer=a};const n=t.setArea;t.setArea=function(){return n(...arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}const vw={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function hl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vw,n),ol.extend(t,e,n),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),E.setGetArray(t,e,["area"],4),E.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),E.setGetArray(t,e,["propColorValue"],3),E.moveToProtected(t,e,["renderer","openGLRenderWindow"]),E.event(t,e,"event"),hw(t,e)}const yw=E.newInstance(hl,"vtkOpenGLHardwareSelector");var vl={newInstance:yw,extend:hl,..._u},ts={exports:{}},hc;function dw(){return hc||(hc=1,function(t,e){(function(n){t.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function a(x,S){var d=x[0],T=x[1],w=x[2],C=x[3];d+=(T&w|~T&C)+S[0]-680876936|0,d=(d<<7|d>>>25)+T|0,C+=(d&T|~d&w)+S[1]-389564586|0,C=(C<<12|C>>>20)+d|0,w+=(C&d|~C&T)+S[2]+606105819|0,w=(w<<17|w>>>15)+C|0,T+=(w&C|~w&d)+S[3]-1044525330|0,T=(T<<22|T>>>10)+w|0,d+=(T&w|~T&C)+S[4]-176418897|0,d=(d<<7|d>>>25)+T|0,C+=(d&T|~d&w)+S[5]+1200080426|0,C=(C<<12|C>>>20)+d|0,w+=(C&d|~C&T)+S[6]-1473231341|0,w=(w<<17|w>>>15)+C|0,T+=(w&C|~w&d)+S[7]-45705983|0,T=(T<<22|T>>>10)+w|0,d+=(T&w|~T&C)+S[8]+1770035416|0,d=(d<<7|d>>>25)+T|0,C+=(d&T|~d&w)+S[9]-1958414417|0,C=(C<<12|C>>>20)+d|0,w+=(C&d|~C&T)+S[10]-42063|0,w=(w<<17|w>>>15)+C|0,T+=(w&C|~w&d)+S[11]-1990404162|0,T=(T<<22|T>>>10)+w|0,d+=(T&w|~T&C)+S[12]+1804603682|0,d=(d<<7|d>>>25)+T|0,C+=(d&T|~d&w)+S[13]-40341101|0,C=(C<<12|C>>>20)+d|0,w+=(C&d|~C&T)+S[14]-1502002290|0,w=(w<<17|w>>>15)+C|0,T+=(w&C|~w&d)+S[15]+1236535329|0,T=(T<<22|T>>>10)+w|0,d+=(T&C|w&~C)+S[1]-165796510|0,d=(d<<5|d>>>27)+T|0,C+=(d&w|T&~w)+S[6]-1069501632|0,C=(C<<9|C>>>23)+d|0,w+=(C&T|d&~T)+S[11]+643717713|0,w=(w<<14|w>>>18)+C|0,T+=(w&d|C&~d)+S[0]-373897302|0,T=(T<<20|T>>>12)+w|0,d+=(T&C|w&~C)+S[5]-701558691|0,d=(d<<5|d>>>27)+T|0,C+=(d&w|T&~w)+S[10]+38016083|0,C=(C<<9|C>>>23)+d|0,w+=(C&T|d&~T)+S[15]-660478335|0,w=(w<<14|w>>>18)+C|0,T+=(w&d|C&~d)+S[4]-405537848|0,T=(T<<20|T>>>12)+w|0,d+=(T&C|w&~C)+S[9]+568446438|0,d=(d<<5|d>>>27)+T|0,C+=(d&w|T&~w)+S[14]-1019803690|0,C=(C<<9|C>>>23)+d|0,w+=(C&T|d&~T)+S[3]-187363961|0,w=(w<<14|w>>>18)+C|0,T+=(w&d|C&~d)+S[8]+1163531501|0,T=(T<<20|T>>>12)+w|0,d+=(T&C|w&~C)+S[13]-1444681467|0,d=(d<<5|d>>>27)+T|0,C+=(d&w|T&~w)+S[2]-51403784|0,C=(C<<9|C>>>23)+d|0,w+=(C&T|d&~T)+S[7]+1735328473|0,w=(w<<14|w>>>18)+C|0,T+=(w&d|C&~d)+S[12]-1926607734|0,T=(T<<20|T>>>12)+w|0,d+=(T^w^C)+S[5]-378558|0,d=(d<<4|d>>>28)+T|0,C+=(d^T^w)+S[8]-2022574463|0,C=(C<<11|C>>>21)+d|0,w+=(C^d^T)+S[11]+1839030562|0,w=(w<<16|w>>>16)+C|0,T+=(w^C^d)+S[14]-35309556|0,T=(T<<23|T>>>9)+w|0,d+=(T^w^C)+S[1]-1530992060|0,d=(d<<4|d>>>28)+T|0,C+=(d^T^w)+S[4]+1272893353|0,C=(C<<11|C>>>21)+d|0,w+=(C^d^T)+S[7]-155497632|0,w=(w<<16|w>>>16)+C|0,T+=(w^C^d)+S[10]-1094730640|0,T=(T<<23|T>>>9)+w|0,d+=(T^w^C)+S[13]+681279174|0,d=(d<<4|d>>>28)+T|0,C+=(d^T^w)+S[0]-358537222|0,C=(C<<11|C>>>21)+d|0,w+=(C^d^T)+S[3]-722521979|0,w=(w<<16|w>>>16)+C|0,T+=(w^C^d)+S[6]+76029189|0,T=(T<<23|T>>>9)+w|0,d+=(T^w^C)+S[9]-640364487|0,d=(d<<4|d>>>28)+T|0,C+=(d^T^w)+S[12]-421815835|0,C=(C<<11|C>>>21)+d|0,w+=(C^d^T)+S[15]+530742520|0,w=(w<<16|w>>>16)+C|0,T+=(w^C^d)+S[2]-995338651|0,T=(T<<23|T>>>9)+w|0,d+=(w^(T|~C))+S[0]-198630844|0,d=(d<<6|d>>>26)+T|0,C+=(T^(d|~w))+S[7]+1126891415|0,C=(C<<10|C>>>22)+d|0,w+=(d^(C|~T))+S[14]-1416354905|0,w=(w<<15|w>>>17)+C|0,T+=(C^(w|~d))+S[5]-57434055|0,T=(T<<21|T>>>11)+w|0,d+=(w^(T|~C))+S[12]+1700485571|0,d=(d<<6|d>>>26)+T|0,C+=(T^(d|~w))+S[3]-1894986606|0,C=(C<<10|C>>>22)+d|0,w+=(d^(C|~T))+S[10]-1051523|0,w=(w<<15|w>>>17)+C|0,T+=(C^(w|~d))+S[1]-2054922799|0,T=(T<<21|T>>>11)+w|0,d+=(w^(T|~C))+S[8]+1873313359|0,d=(d<<6|d>>>26)+T|0,C+=(T^(d|~w))+S[15]-30611744|0,C=(C<<10|C>>>22)+d|0,w+=(d^(C|~T))+S[6]-1560198380|0,w=(w<<15|w>>>17)+C|0,T+=(C^(w|~d))+S[13]+1309151649|0,T=(T<<21|T>>>11)+w|0,d+=(w^(T|~C))+S[4]-145523070|0,d=(d<<6|d>>>26)+T|0,C+=(T^(d|~w))+S[11]-1120210379|0,C=(C<<10|C>>>22)+d|0,w+=(d^(C|~T))+S[2]+718787259|0,w=(w<<15|w>>>17)+C|0,T+=(C^(w|~d))+S[9]-343485551|0,T=(T<<21|T>>>11)+w|0,x[0]=d+x[0]|0,x[1]=T+x[1]|0,x[2]=w+x[2]|0,x[3]=C+x[3]|0}function s(x){var S=[],d;for(d=0;d<64;d+=4)S[d>>2]=x.charCodeAt(d)+(x.charCodeAt(d+1)<<8)+(x.charCodeAt(d+2)<<16)+(x.charCodeAt(d+3)<<24);return S}function i(x){var S=[],d;for(d=0;d<64;d+=4)S[d>>2]=x[d]+(x[d+1]<<8)+(x[d+2]<<16)+(x[d+3]<<24);return S}function o(x){var S=x.length,d=[1732584193,-271733879,-1732584194,271733878],T,w,C,O,R,L;for(T=64;T<=S;T+=64)a(d,s(x.substring(T-64,T)));for(x=x.substring(T-64),w=x.length,C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],T=0;T<w;T+=1)C[T>>2]|=x.charCodeAt(T)<<(T%4<<3);if(C[T>>2]|=128<<(T%4<<3),T>55)for(a(d,C),T=0;T<16;T+=1)C[T]=0;return O=S*8,O=O.toString(16).match(/(.*?)(.{0,8})$/),R=parseInt(O[2],16),L=parseInt(O[1],16)||0,C[14]=R,C[15]=L,a(d,C),d}function c(x){var S=x.length,d=[1732584193,-271733879,-1732584194,271733878],T,w,C,O,R,L;for(T=64;T<=S;T+=64)a(d,i(x.subarray(T-64,T)));for(x=T-64<S?x.subarray(T-64):new Uint8Array(0),w=x.length,C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],T=0;T<w;T+=1)C[T>>2]|=x[T]<<(T%4<<3);if(C[T>>2]|=128<<(T%4<<3),T>55)for(a(d,C),T=0;T<16;T+=1)C[T]=0;return O=S*8,O=O.toString(16).match(/(.*?)(.{0,8})$/),R=parseInt(O[2],16),L=parseInt(O[1],16)||0,C[14]=R,C[15]=L,a(d,C),d}function u(x){var S="",d;for(d=0;d<4;d+=1)S+=r[x>>d*8+4&15]+r[x>>d*8&15];return S}function g(x){var S;for(S=0;S<x.length;S+=1)x[S]=u(x[S]);return x.join("")}g(o("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function x(S,d){return S=S|0||0,S<0?Math.max(S+d,0):Math.min(S,d)}ArrayBuffer.prototype.slice=function(S,d){var T=this.byteLength,w=x(S,T),C=T,O,R,L,D;return d!==n&&(C=x(d,T)),w>C?new ArrayBuffer(0):(O=C-w,R=new ArrayBuffer(O),L=new Uint8Array(R),D=new Uint8Array(this,w,O),L.set(D),R)}}();function f(x){return/[\u0080-\uFFFF]/.test(x)&&(x=unescape(encodeURIComponent(x))),x}function l(x,S){var d=x.length,T=new ArrayBuffer(d),w=new Uint8Array(T),C;for(C=0;C<d;C+=1)w[C]=x.charCodeAt(C);return S?w:T}function p(x){return String.fromCharCode.apply(null,new Uint8Array(x))}function y(x,S,d){var T=new Uint8Array(x.byteLength+S.byteLength);return T.set(new Uint8Array(x)),T.set(new Uint8Array(S),x.byteLength),T}function h(x){var S=[],d=x.length,T;for(T=0;T<d-1;T+=2)S.push(parseInt(x.substr(T,2),16));return String.fromCharCode.apply(String,S)}function v(){this.reset()}return v.prototype.append=function(x){return this.appendBinary(f(x)),this},v.prototype.appendBinary=function(x){this._buff+=x,this._length+=x.length;var S=this._buff.length,d;for(d=64;d<=S;d+=64)a(this._hash,s(this._buff.substring(d-64,d)));return this._buff=this._buff.substring(d-64),this},v.prototype.end=function(x){var S=this._buff,d=S.length,T,w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C;for(T=0;T<d;T+=1)w[T>>2]|=S.charCodeAt(T)<<(T%4<<3);return this._finish(w,d),C=g(this._hash),x&&(C=h(C)),this.reset(),C},v.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},v.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},v.prototype.setState=function(x){return this._buff=x.buff,this._length=x.length,this._hash=x.hash,this},v.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},v.prototype._finish=function(x,S){var d=S,T,w,C;if(x[d>>2]|=128<<(d%4<<3),d>55)for(a(this._hash,x),d=0;d<16;d+=1)x[d]=0;T=this._length*8,T=T.toString(16).match(/(.*?)(.{0,8})$/),w=parseInt(T[2],16),C=parseInt(T[1],16)||0,x[14]=w,x[15]=C,a(this._hash,x)},v.hash=function(x,S){return v.hashBinary(f(x),S)},v.hashBinary=function(x,S){var d=o(x),T=g(d);return S?h(T):T},v.ArrayBuffer=function(){this.reset()},v.ArrayBuffer.prototype.append=function(x){var S=y(this._buff.buffer,x),d=S.length,T;for(this._length+=x.byteLength,T=64;T<=d;T+=64)a(this._hash,i(S.subarray(T-64,T)));return this._buff=T-64<d?new Uint8Array(S.buffer.slice(T-64)):new Uint8Array(0),this},v.ArrayBuffer.prototype.end=function(x){var S=this._buff,d=S.length,T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w,C;for(w=0;w<d;w+=1)T[w>>2]|=S[w]<<(w%4<<3);return this._finish(T,d),C=g(this._hash),x&&(C=h(C)),this.reset(),C},v.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},v.ArrayBuffer.prototype.getState=function(){var x=v.prototype.getState.call(this);return x.buff=p(x.buff),x},v.ArrayBuffer.prototype.setState=function(x){return x.buff=l(x.buff,!0),v.prototype.setState.call(this,x)},v.ArrayBuffer.prototype.destroy=v.prototype.destroy,v.ArrayBuffer.prototype._finish=v.prototype._finish,v.ArrayBuffer.hash=function(x,S){var d=c(new Uint8Array(x)),T=g(d);return S?h(T):T},v})}(ts)),ts.exports}var Tw=dw();const xw=Ws(Tw),Sw=["lastShaderProgramBound","context","_openGLRenderWindow"];function Cw(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=(n,r,a)=>{let s=r;a.length>0&&(s=F.substitute(s,"VSOut","GSOut").result);const i=e._openGLRenderWindow.getWebgl2();let o=`
`,c=`#version 100
`;i?c=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(o=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(o+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),s=F.substitute(s,"//VTK::System::Dec",[`${c}
`,i?"":`#extension GL_OES_standard_derivatives : enable
`,o,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;let u=F.substitute(n,"//VTK::System::Dec",[`${c}
`,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(i){u=F.substitute(u,"varying","out").result,s=F.substitute(s,"varying","in").result;let f="",l=0;for(;s.includes(`gl_FragData[${l}]`);)s=F.substitute(s,`gl_FragData\\[${l}\\]`,`fragOutput${l}`).result,f+=`layout(location = ${l}) out vec4 fragOutput${l};
`,l++;s=F.substitute(s,"//VTK::Output::Dec",f).result}const g=F.substitute(a,"//VTK::System::Dec",c).result;return{VSSource:u,FSSource:s,GSSource:g}},t.readyShaderProgramArray=(n,r,a)=>{const s=t.replaceShaderValues(n,r,a),i=t.getShaderProgram(s.VSSource,s.FSSource,s.GSSource);return t.readyShaderProgram(i)},t.readyShaderProgram=n=>!n||!n.getCompiled()&&!n.compileShader()||!t.bindShaderProgram(n)?null:n,t.getShaderProgram=(n,r,a)=>{const s=`${n}${r}${a}`,i=xw.hash(s);if(!(i in e.shaderPrograms)){const o=F.newInstance();return o.setContext(e.context),o.getVertexShader().setSource(n),o.getFragmentShader().setSource(r),a&&o.getGeometryShader().setSource(a),o.setMd5Hash(i),e.shaderPrograms[i]=o,o}return e.shaderPrograms[i]},t.releaseGraphicsResources=n=>{t.releaseCurrentShaderProgram(),Object.keys(e.shaderPrograms).map(r=>e.shaderPrograms[r]).forEach(r=>r.cleanup()),e.shaderPrograms={}},t.releaseCurrentShaderProgram=()=>{e.lastShaderProgramBound&&(e.lastShaderProgramBound.cleanup(),e.lastShaderProgramBound=null)},t.bindShaderProgram=n=>(e.lastShaderProgramBound===n||(e.lastShaderProgramBound&&e.lastShaderProgramBound.release(),n.bind(),e.lastShaderProgramBound=n),1)}const ww={lastShaderProgramBound:null,shaderPrograms:null,context:null};function yl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ww,n),e.shaderPrograms={},E.obj(t,e),E.setGet(t,e,Sw),E.moveToProtected(t,e,["openGLRenderWindow"]),Cw(t,e)}const Ew=E.newInstance(yl,"vtkShaderCache");var Ow={newInstance:Ew,extend:yl};const{vtkErrorMacro:Rw}=E;function Dw(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]===!0&&Rw("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=n=>{if(e.context!==n){if(e.context!==0&&t.deleteTable(),e.context=n,e.context){e.numberOfTextureUnits=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]=!1}t.modified()}},t.allocate=()=>{for(let n=0;n<e.numberOfTextureUnits;n++)if(!t.isAllocated(n))return e.textureUnits[n]=!0,n;return-1},t.allocateUnit=n=>t.isAllocated(n)?-1:(e.textureUnits[n]=!0,n),t.isAllocated=n=>e.textureUnits[n],t.free=n=>{e.textureUnits[n]=!1},t.freeAll=()=>{for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]=!1}}const Mw={context:null,numberOfTextureUnits:0,textureUnits:0};function dl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Mw,n),E.obj(t,e),e.textureUnits=[],E.get(t,e,["numberOfTextureUnits"]),E.setGet(t,e,["context"]),Dw(t,e)}const Lw=E.newInstance(dl,"vtkOpenGLTextureUnitManager");var Vw={newInstance:Lw,extend:dl};function _w(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=()=>null,t.getAspectRatio=()=>e.size[0]/e.size[1],t.getAspectRatioForRenderer=n=>{const r=n.getViewportByReference();return e.size[0]*(r[2]-r[0])/((r[3]-r[1])*e.size[1])},t.isInViewport=(n,r,a)=>{const s=a.getViewportByReference(),i=t.getFramebufferSize();return s[0]*i[0]<=n&&s[2]*i[0]>=n&&s[1]*i[1]<=r&&s[3]*i[1]>=r},t.getViewportSize=n=>{const r=n.getViewportByReference(),a=t.getFramebufferSize();return[(r[2]-r[0])*a[0],(r[3]-r[1])*a[1]]},t.getViewportCenter=n=>{const r=t.getViewportSize(n);return[r[0]*.5,r[1]*.5]},t.displayToNormalizedDisplay=(n,r,a)=>{const s=t.getFramebufferSize();return[n/s[0],r/s[1],a]},t.normalizedDisplayToDisplay=(n,r,a)=>{const s=t.getFramebufferSize();return[n*s[0],r*s[1],a]},t.worldToView=(n,r,a,s)=>s.worldToView(n,r,a),t.viewToWorld=(n,r,a,s)=>s.viewToWorld(n,r,a),t.worldToDisplay=(n,r,a,s)=>{const i=s.worldToView(n,r,a),o=t.getViewportSize(s),c=s.viewToProjection(i[0],i[1],i[2],o[0]/o[1]),u=s.projectionToNormalizedDisplay(c[0],c[1],c[2]);return t.normalizedDisplayToDisplay(u[0],u[1],u[2])},t.displayToWorld=(n,r,a,s)=>{const i=t.displayToNormalizedDisplay(n,r,a),o=s.normalizedDisplayToProjection(i[0],i[1],i[2]),c=t.getViewportSize(s),u=s.projectionToView(o[0],o[1],o[2],c[0]/c[1]);return s.viewToWorld(u[0],u[1],u[2])},t.normalizedDisplayToViewport=(n,r,a,s)=>{let i=s.getViewportByReference();i=t.normalizedDisplayToDisplay(i[0],i[1],0);const o=t.normalizedDisplayToDisplay(n,r,a);return[o[0]-i[0]-.5,o[1]-i[1]-.5,a]},t.viewportToNormalizedViewport=(n,r,a,s)=>{const i=t.getViewportSize(s);return i&&i[0]!==0&&i[1]!==0?[n/(i[0]-1),r/(i[1]-1),a]:[n,r,a]},t.normalizedViewportToViewport=(n,r,a,s)=>{const i=t.getViewportSize(s);return[n*(i[0]-1),r*(i[1]-1),a]},t.displayToLocalDisplay=(n,r,a)=>{const s=t.getFramebufferSize();return[n,s[1]-r-1,a]},t.viewportToNormalizedDisplay=(n,r,a,s)=>{let i=s.getViewportByReference();i=t.normalizedDisplayToDisplay(i[0],i[1],0);const o=n+i[0]+.5,c=r+i[1]+.5;return t.displayToNormalizedDisplay(o,c,a)},t.getComputedDevicePixelRatio=()=>e.size[0]/t.getContainerSize()[0],t.getContainerSize=()=>{E.vtkErrorMacro("not implemented")},t.getPixelData=(n,r,a,s)=>{E.vtkErrorMacro("not implemented")},t.createSelector=()=>{E.vtkErrorMacro("not implemented")}}const Bw={size:void 0,selector:void 0};function Tl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Bw,n),e.size||(e.size=[300,300]),E.getArray(t,e,["size"],2),E.get(t,e,["selector"]),ae.extend(t,e,n),_w(t,e)}const Fw=E.newInstance(Tl,"vtkRenderWindowViewNode");var xl={newInstance:Fw,extend:Tl};const mw="__getUnderlyingContext";function Uw(){const t=new Map,e={apply(a,s,i){return t.has(i[0])?t.get(i[0]):a.apply(s,i)}};function n(a){return{apply(s,i,o){return t.set(a,o[0]),s.apply(i,o)}}}const r=Object.create(null);return r.getParameter=(a,s,i,o)=>new Proxy(o.bind(a),e),r.depthMask=(a,s,i,o)=>new Proxy(o.bind(a),n(a.DEPTH_WRITEMASK)),{get(a,s,i){if(s===mw)return()=>a;let o=Reflect.get(a,s,a);o instanceof Function&&(o=o.bind(a));const c=r[s];return c?c(a,s,i,o):o}}}const{vtkDebugMacro:vc,vtkErrorMacro:yc}=E,kw={position:"absolute",top:0,left:0,width:"100%",height:"100%"},Nw=["activateTexture","deactivateTexture","disableCullFace","enableCullFace","get3DContext","getActiveFramebuffer","getContext","getDefaultTextureByteSize","getDefaultTextureInternalFormat","getDefaultToWebgl2","getGLInformations","getGraphicsMemoryInfo","getGraphicsResourceForObject","getHardwareMaximumLineWidth","getPixelData","getShaderCache","getTextureUnitForTexture","getTextureUnitManager","getWebgl2","makeCurrent","releaseGraphicsResources","registerGraphicsResourceUser","unregisterGraphicsResourceUser","restoreContext","setActiveFramebuffer","setContext","setDefaultToWebgl2","setGraphicsResourceForObject"];function Se(t,e,n){const r=t.createFramebuffer(),a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,n,null),t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a,0);const s=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),s===t.FRAMEBUFFER_COMPLETE}let Jr=0;const Sl=[];function Gw(){Jr++,Sl.forEach(t=>t(Jr))}function bw(){Jr--,Sl.forEach(t=>t(Jr))}function dc(t){t.preventDefault()}function $w(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow");let n;function r(){return n||(n=Uw()),n}t.getViewNodeFactory=()=>e.myFactory,e.canvas.addEventListener("webglcontextlost",dc,!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);const a=[0,0];function s(){e.renderable&&(e.size[0]!==a[0]||e.size[1]!==a[1])&&(a[0]=e.size[0],a[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(s),t.buildPass=f=>{if(f){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.addMissingNodes(e.renderable.getChildRenderWindowsByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(l=>{var p;(p=l.setOpenGLRenderWindow)==null||p.call(l,t)})}},t.initialize=()=>{if(!e.initialized){if(e.rootOpenGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.rootOpenGLRenderWindow)e.context2D=t.get2DContext();else{e.context=t.get3DContext(),t.resizeFromChildRenderWindows(),e.context&&Gw(),e.textureUnitManager=Vw.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);const f=e.context;f.blendFuncSeparate(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA),f.depthFunc(f.LEQUAL),f.enable(f.BLEND)}e.initialized=!0}},t.makeCurrent=()=>{e.context.makeCurrent()},t.setContainer=f=>{e.el&&e.el!==f&&(e.canvas.parentNode!==e.el&&yc("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==f&&(e.el=f,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:f,height:l}=e.el.getBoundingClientRect();e.containerSize=[f,l]}return e.containerSize||e.size},t.getFramebufferSize=()=>{var l;return((l=e.activeFramebuffer)==null?void 0:l.getSize())||e.size},t.getPixelData=(f,l,p,y)=>{const h=new Uint8Array((p-f+1)*(y-l+1)*4);return e.context.readPixels(f,l,p-f+1,y-l+1,e.context.RGBA,e.context.UNSIGNED_BYTE,h),h},t.get3DContext=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},l=null;const p=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&p&&(l=e.canvas.getContext("webgl2",f),l&&(e.webgl2=!0,vc("using webgl2"))),l||(vc("using webgl1"),l=e.canvas.getContext("webgl",f)||e.canvas.getContext("experimental-webgl",f)),new Proxy(l,r())},t.get2DContext=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.canvas.getContext("2d",f)},t.restoreContext=()=>{const f=ct.newInstance();f.setCurrentOperation("Release"),f.traverse(t,null)},t.activateTexture=f=>{const l=e._textureResourceIds.get(f);if(l!==void 0){e.context.activeTexture(e.context.TEXTURE0+l);return}const p=t.getTextureUnitManager().allocate();if(p<0){yc("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(f,p),e.context.activeTexture(e.context.TEXTURE0+p)},t.deactivateTexture=f=>{const l=e._textureResourceIds.get(f);l!==void 0&&(t.getTextureUnitManager().free(l),e._textureResourceIds.delete(f))},t.getTextureUnitForTexture=f=>{const l=e._textureResourceIds.get(f);return l!==void 0?l:-1},t.getDefaultTextureByteSize=function(f){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e.webgl2)switch(f){case ce.CHAR:case ce.SIGNED_CHAR:case ce.UNSIGNED_CHAR:return 1;case l:case p:case ce.UNSIGNED_SHORT:case ce.SHORT:case ce.VOID:return 2;default:return 4}return 1},t.getDefaultTextureInternalFormat=function(f,l){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.webgl2)switch(f){case ce.UNSIGNED_CHAR:switch(l){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case(p&&!y&&ce.UNSIGNED_SHORT):switch(l){case 1:return p.R16_EXT;case 2:return p.RG16_EXT;case 3:return p.RGB16_EXT;case 4:default:return p.RGBA16_EXT}case(p&&!y&&ce.SHORT):switch(l){case 1:return p.R16_SNORM_EXT;case 2:return p.RG16_SNORM_EXT;case 3:return p.RGB16_SNORM_EXT;case 4:default:return p.RGBA16_SNORM_EXT}case ce.UNSIGNED_SHORT:case ce.SHORT:case ce.FLOAT:default:switch(l){case 1:return y?e.context.R16F:e.context.R32F;case 2:return y?e.context.RG16F:e.context.RG32F;case 3:return y?e.context.RGB16F:e.context.RGB32F;case 4:default:return y?e.context.RGBA16F:e.context.RGBA32F}}switch(l){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=f=>{e.bgImage.src=f.src},t.setUseBackgroundImage=f=>{e.useBackgroundImage=f,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function i(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const l=document.createElement("canvas"),p=l.getContext("2d");l.width=e.canvas.width,l.height=e.canvas.height,p.drawImage(e.canvas,0,0);const y=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(S=>{S.getViewProps().forEach(T=>{if(T.getContainer){const C=T.getContainer().getElementsByTagName("canvas");for(let O=0;O<C.length;O++){const R=C[O],L=R.getBoundingClientRect(),D=L.x-y.x,M=L.y-y.y;p.drawImage(R,D,M)}}})});const x=l.toDataURL(f);l.remove(),t.invokeImageReady(x)}t.captureNextImage=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:l=!1,size:p=null,scale:y=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=f;const h=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:p||y!==1?p||e.size.map(v=>v*y):null},new Promise((v,x)=>{const S=t.onImageReady(d=>{var T;if(e._screenshot.size===null)e.notifyStartCaptureImage=h,S.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(w=>{let{restoreParamsFn:C,arg:O}=w;return C(O)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),v(d);else{const w=document.createElement("img");if(w.style=kw,w.src=d,e._screenshot.placeHolder=e.el.appendChild(w),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,(T=e.rootOpenGLRenderWindow)==null||T.resizeFromChildRenderWindows(),e._screenshot.size=null,t.modified(),l){const C=l!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(O=>{const R=O.getActiveCamera(),L=R.get("focalPoint","position","parallelScale");return{resetCameraArgs:C?{renderer:O}:void 0,resetCameraFn:C?l:O.resetCamera,restoreParamsFn:R.set,arg:JSON.parse(JSON.stringify(L))}}),e._screenshot.cameras.forEach(O=>{let{resetCameraFn:R,resetCameraArgs:L}=O;return R(L)})}t.traverseAllPasses()}})})};let o;t.getHardwareMaximumLineWidth=()=>{if(o!=null)return o;const f=t.get3DContext(),l=f.getParameter(f.ALIASED_LINE_WIDTH_RANGE);return o=l[1],l[1]},t.getGLInformations=()=>{if(e._glInformation)return e._glInformation;const f=t.get3DContext(),l=f.getExtension("OES_texture_float"),p=f.getExtension("OES_texture_half_float"),y=f.getExtension("WEBGL_debug_renderer_info"),h=f.getExtension("WEBGL_draw_buffers"),v=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),x=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",f.getParameter(f.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",f.getParameter(f.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",f.getParameter(f.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",f.getParameter(f.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",f.getParameter(f.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",f.getParameter(f.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",f.getParameter(f.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",f.getParameter(f.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",f.getParameter(f.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",v&&f.getParameter(v.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",f.getParameter(f.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",f.getParameter(f.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",f.getParameter(f.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",f.getParameter(f.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",f.getParameter(f.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",f.getParameter(f.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",f.getParameter(f.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",f.getParameter(f.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",f.getParameter(f.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",f.getParameter(f.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",f.getParameter(f.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",f.getParameter(f.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",f.getParameter(f.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[l&&Se(f,f.RGBA,f.UNSIGNED_BYTE)?"RGBA":"",l&&Se(f,f.RGB,f.UNSIGNED_BYTE)?"RGB":"",l&&Se(f,f.LUMINANCE,f.UNSIGNED_BYTE)?"LUMINANCE":"",l&&Se(f,f.ALPHA,f.UNSIGNED_BYTE)?"ALPHA":"",l&&Se(f,f.LUMINANCE_ALPHA,f.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[p&&Se(f,f.RGBA,p.HALF_FLOAT_OES)?"RGBA":"",p&&Se(f,f.RGB,p.HALF_FLOAT_OES)?"RGB":"",p&&Se(f,f.LUMINANCE,p.HALF_FLOAT_OES)?"LUMINANCE":"",p&&Se(f,f.ALPHA,p.HALF_FLOAT_OES)?"ALPHA":"",p&&Se(f,f.LUMINANCE_ALPHA,p.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[l&&Se(f,f.RGBA,f.FLOAT)?"RGBA":"",l&&Se(f,f.RGB,f.FLOAT)?"RGB":"",l&&Se(f,f.LUMINANCE,f.FLOAT)?"LUMINANCE":"",l&&Se(f,f.ALPHA,f.FLOAT)?"ALPHA":"",l&&Se(f,f.LUMINANCE_ALPHA,f.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",h?f.getParameter(h.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",f.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",f.getParameter(f.RENDERER)],["WebGL Vendor","VENDOR",f.getParameter(f.VENDOR)],["WebGL Version","VERSION",f.getParameter(f.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",f.getParameter(f.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",y&&f.getParameter(y.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",y&&f.getParameter(y.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],S={};for(;x.length;){const[d,T,w]=x.pop();T&&(S[T]={label:d,value:w})}return e._glInformation=S,S},t.traverseAllPasses=()=>{var l;if(e.renderPasses)for(let p=0;p<e.renderPasses.length;++p)e.renderPasses[p].traverse(t,null);t.copyParentContent(),e.notifyStartCaptureImage&&i();const f=e.renderable.getChildRenderWindowsByReference();for(let p=0;p<f.length;++p)(l=t.getViewNodeFor(f[p]))==null||l.traverseAllPasses()},t.copyParentContent=()=>{const f=e.rootOpenGLRenderWindow;if(!f||!e.context2D||e.children.some(y=>{var h;return!!((h=y.getSelector)!=null&&h.call(y))}))return;const l=f.getCanvas(),p=e.canvas;e.context2D.drawImage(l,0,l.height-p.height,p.width,p.height,0,0,p.width,p.height)},t.resizeFromChildRenderWindows=()=>{var l;const f=e.renderable.getChildRenderWindowsByReference();if(f.length>0){const p=[0,0];for(let y=0;y<f.length;++y){const h=(l=t.getViewNodeFor(f[y]))==null?void 0:l.getSize();h&&(p[0]=h[0]>p[0]?h[0]:p[0],p[1]=h[1]>p[1]?h[1]:p[1])}t.setSize(...p)}},t.disableCullFace=()=>{e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=()=>{e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=f=>{if(e.viewStream===f)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=f,e.viewStream){const l=e.renderable.getRenderers()[0];l.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(p=>t.setBackgroundImage(p.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=()=>{const f=vl.newInstance();return f.setOpenGLRenderWindow(t),f};function c(){e.canvas.removeEventListener("webglcontextlost",dc),e.canvas.removeEventListener("webglcontextrestored",t.restoreContext)}t.delete=E.chain(()=>{e.context&&bw(),t.setContainer(),t.setViewStream()},c,t.delete),t.setActiveFramebuffer=f=>{e.activeFramebuffer=f};const u=t.setSize;t.setSize=(f,l)=>{const p=u(f,l);return p&&t.invokeWindowResizeEvent({width:f,height:l}),p},t.registerGraphicsResourceUser=(f,l)=>{e._graphicsResources.has(f)||t.setGraphicsResourceForObject(f,null,null);const p=e._graphicsResources.get(f);p==null||p.users.add(l)},t.unregisterGraphicsResourceUser=(f,l)=>{var y;const p=e._graphicsResources.get(f);p&&(p.users.delete(l),p.users.size||((y=p.oglObject)==null||y.releaseGraphicsResources(t),e._graphicsResources.delete(f)))},t.getGraphicsResourceForObject=f=>e._graphicsResources.get(f),t.setGraphicsResourceForObject=(f,l,p)=>{var h;if(!f)return;const y=e._graphicsResources.get(f);(h=y==null?void 0:y.oglObject)==null||h.releaseGraphicsResources(t),e._graphicsResources.set(f,{coreObject:f,oglObject:l,hash:p,users:(y==null?void 0:y.users)??new Set})},t.getGraphicsMemoryInfo=()=>{let f=0;return e._graphicsResources.forEach(l=>{let{oglObject:p}=l;f+=p.getAllocatedGPUMemoryInBytes()}),f},t.releaseGraphicsResources=()=>{e.shaderCache!==null&&e.shaderCache.releaseGraphicsResources(t),e._graphicsResources.forEach(f=>{let{oglObject:l}=f;l.releaseGraphicsResources(t)}),e._graphicsResources.clear(),e.textureUnitManager!==null&&e.textureUnitManager.freeAll(),e.renderable.getRenderersByReference().forEach(f=>{const l=t.getViewNodeFor(f);l==null||l.releaseGraphicsResources()})};const g={...t};Nw.forEach(f=>{t[f]=function(){return e.rootOpenGLRenderWindow?e.rootOpenGLRenderWindow[f](...arguments):g[f](...arguments)}})}const zw={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,context2D:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function Ww(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zw,n),xl.extend(t,e,n),e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.style.width="100%"),e.selector||(e.selector=vl.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e._graphicsResources=new Map,e._glInformation=null,e.myFactory=mp.newInstance(),e.shaderCache=Ow.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=ew.newInstance(),E.get(t,e,["shaderCache","textureUnitManager","webgl2","useBackgroundImage","activeFramebuffer","rootOpenGLRenderWindow"]),E.setGet(t,e,["initialized","context","context2D","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),E.setGetArray(t,e,["size"],2),E.event(t,e,"imageReady"),E.event(t,e,"windowResizeEvent"),$w(t,e)}const Cl=E.newInstance(Ww,"vtkOpenGLRenderWindow");Ti("WebGL",Cl);Fe("vtkRenderWindow",Cl);const ns=["setBindGroup","setIndexBuffer","setVertexBuffer","draw","drawIndexed"];function Hw(t,e){e.classHierarchy.push("vtkWebGPURenderEncoder"),t.begin=n=>{e.drawCallbacks=[],e.handle=n.beginRenderPass(e.description),e.label&&e.handle.pushDebugGroup(e.label)},t.end=()=>{for(let n=0;n<e.drawCallbacks.length;n++){const r=e.drawCallbacks[n],a=r.pipeline;t.setPipeline(a);for(let s=0;s<r.callbacks.length;s++)r.callbacks[s](t)}e.label&&e.handle.popDebugGroup(),e.handle.end(),e.boundPipeline=null},t.setPipeline=n=>{var a,s;if(e.boundPipeline===n)return;e.handle.setPipeline(n.getHandle());const r=n.getPipelineDescription();if(e.colorTextureViews.length!==r.fragment.targets.length)console.log(`mismatched attachment counts on pipeline ${r.fragment.targets.length} while encoder has ${e.colorTextureViews.length}`),console.trace();else for(let i=0;i<e.colorTextureViews.length;i++){const o=(a=e.colorTextureViews[i].getTexture())==null?void 0:a.getFormat();o&&o!==r.fragment.targets[i].format&&(console.log(`mismatched attachments for attachment ${i} on pipeline ${r.fragment.targets[i].format} while encoder has ${o}`),console.trace())}if(!e.depthTextureView!=!("depthStencil"in r))console.log("mismatched depth attachments"),console.trace();else if(e.depthTextureView){const i=(s=e.depthTextureView.getTexture())==null?void 0:s.getFormat();i&&i!==r.depthStencil.format&&(console.log(`mismatched depth attachments on pipeline ${r.depthStencil.format} while encoder has ${i}`),console.trace())}e.boundPipeline=n},t.replaceShaderCode=n=>{e.replaceShaderCodeFunction(n)},t.setColorTextureView=(n,r)=>{e.colorTextureViews[n]!==r&&(e.colorTextureViews[n]=r)},t.activateBindGroup=n=>{const r=e.boundPipeline.getDevice(),a=e.boundPipeline.getBindGroupLayoutCount(n.getLabel());e.handle.setBindGroup(a,n.getBindGroup(r));const s=r.getBindGroupLayoutDescription(n.getBindGroupLayout(r)),i=r.getBindGroupLayoutDescription(e.boundPipeline.getBindGroupLayout(a));s!==i&&(console.log(`renderEncoder ${e.pipelineHash} mismatched bind group layouts bind group has
${s}
 versus pipeline
${i}
`),console.trace())},t.attachTextureViews=()=>{for(let n=0;n<e.colorTextureViews.length;n++)e.description.colorAttachments[n]?e.description.colorAttachments[n].view=e.colorTextureViews[n].getHandle():e.description.colorAttachments[n]={view:e.colorTextureViews[n].getHandle()};e.depthTextureView&&(e.description.depthStencilAttachment.view=e.depthTextureView.getHandle())},t.registerDrawCallback=(n,r)=>{for(let a=0;a<e.drawCallbacks.length;a++)if(e.drawCallbacks[a].pipeline===n){e.drawCallbacks[a].callbacks.push(r);return}e.drawCallbacks.push({pipeline:n,callbacks:[r]})};for(let n=0;n<ns.length;n++)t[ns[n]]=function(){return e.handle[ns[n]](...arguments)}}const Aw={description:null,handle:null,boundPipeline:null,pipelineHash:null,pipelineSettings:null,replaceShaderCodeFunction:null,depthTextureView:null,label:null};function wl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Aw,n),ye(t,e),e.description={colorAttachments:[{view:void 0,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:void 0,depthLoadOp:"clear",depthClearValue:0,depthStoreOp:"store"}},e.replaceShaderCodeFunction=r=>{const a=r.getShaderDescription("fragment");a.addOutput("vec4<f32>","outColor");let s=a.getCode();s=H.substitute(s,"//VTK::RenderEncoder::Impl",["output.outColor = computedColor;"]).result,a.setCode(s)},e.pipelineSettings={primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!0,depthCompare:"greater-equal",format:"depth32float"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcfactor:"one",dstFactor:"one-minus-src-alpha"}}}]}},e.colorTextureViews=[],Re(t,e,["boundPipeline","colorTextureViews"]),le(t,e,["depthTextureView","description","handle","label","pipelineHash","pipelineSettings","replaceShaderCodeFunction"]),Hw(t,e)}const jw=Z(wl,"vtkWebGPURenderEncoder");var it={newInstance:jw,extend:wl};function Kw(t,e){e.classHierarchy.push("vtkWebGPUOpaquePass"),t.traverse=(n,r)=>{if(e.deleted)return;e._currentParent=r;const a=r.getDevice();if(e.renderEncoder)e.colorTexture.resize(r.getCanvas().width,r.getCanvas().height),e.depthTexture.resize(r.getCanvas().width,r.getCanvas().height);else{t.createRenderEncoder(),e.colorTexture=Ie.newInstance({label:"opaquePassColor"}),e.colorTexture.create(a,{width:r.getCanvas().width,height:r.getCanvas().height,format:"rgba16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC});const s=e.colorTexture.createView("opaquePassColorTexture");e.renderEncoder.setColorTextureView(0,s),e.depthFormat="depth32float",e.depthTexture=Ie.newInstance({label:"opaquePassDepth"}),e.depthTexture.create(a,{width:r.getCanvas().width,height:r.getCanvas().height,format:e.depthFormat,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC});const i=e.depthTexture.createView("opaquePassDepthTexture");e.renderEncoder.setDepthTextureView(i)}e.renderEncoder.attachTextureViews(),t.setCurrentOperation("opaquePass"),n.setRenderEncoder(e.renderEncoder),n.traverse(t)},t.getColorTextureView=()=>e.renderEncoder.getColorTextureViews()[0],t.getDepthTextureView=()=>e.renderEncoder.getDepthTextureView(),t.createRenderEncoder=()=>{e.renderEncoder=it.newInstance({label:"OpaquePass"}),e.renderEncoder.setPipelineHash("op")}}const Pw={renderEncoder:null,colorTexture:null,depthTexture:null};function El(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Pw,n),ct.extend(t,e,n),E.get(t,e,["colorTexture","depthTexture"]),Kw(t,e)}const Xw=E.newInstance(El,"vtkWebGPUOpaquePass");var Yw={newInstance:Xw,extend:El};const qw=`
//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec2<i32> = vec2<i32>(i32(input.fragPos.x), i32(input.fragPos.y));
  var reveal: f32 = textureLoad(oitpAccumTexture, tcoord, 0).r;
  if (reveal == 1.0) { discard; }
  var tcolor: vec4<f32> = textureLoad(oitpColorTexture, tcoord, 0);
  var total: f32 = max(tcolor.a, 0.01);
  var computedColor: vec4<f32> = vec4<f32>(tcolor.r/total, tcolor.g/total, tcolor.b/total, 1.0 - reveal);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function Iw(t,e){e.classHierarchy.push("vtkWebGPUOrderIndependentTranslucentPass"),t.traverse=(n,r)=>{if(e.deleted)return;e._currentParent=r;const a=r.getDevice();if(e.translucentRenderEncoder)e.translucentColorTexture.resizeToMatch(e.colorTextureView.getTexture()),e.translucentAccumulateTexture.resizeToMatch(e.colorTextureView.getTexture());else{t.createRenderEncoder(),t.createFinalEncoder(),e.translucentColorTexture=Ie.newInstance({label:"translucentPassColor"}),e.translucentColorTexture.create(a,{width:r.getCanvas().width,height:r.getCanvas().height,format:"rgba16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const s=e.translucentColorTexture.createView("oitpColorTexture");e.translucentRenderEncoder.setColorTextureView(0,s),e.translucentAccumulateTexture=Ie.newInstance({label:"translucentPassAccumulate"}),e.translucentAccumulateTexture.create(a,{width:r.getCanvas().width,height:r.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const i=e.translucentAccumulateTexture.createView("oitpAccumTexture");e.translucentRenderEncoder.setColorTextureView(1,i),e.fullScreenQuad=rn.newInstance(),e.fullScreenQuad.setDevice(r.getDevice()),e.fullScreenQuad.setPipelineHash("oitpfsq"),e.fullScreenQuad.setTextureViews(e.translucentRenderEncoder.getColorTextureViews()),e.fullScreenQuad.setFragmentShaderTemplate(qw)}e.translucentRenderEncoder.setDepthTextureView(e.depthTextureView),e.translucentRenderEncoder.attachTextureViews(),t.setCurrentOperation("translucentPass"),n.setRenderEncoder(e.translucentRenderEncoder),n.traverse(t),t.finalPass(r,n)},t.finalPass=(n,r)=>{e.translucentFinalEncoder.setColorTextureView(0,e.colorTextureView),e.translucentFinalEncoder.attachTextureViews(),e.translucentFinalEncoder.begin(n.getCommandEncoder()),r.scissorAndViewport(e.translucentFinalEncoder),e.fullScreenQuad.prepareAndDraw(e.translucentFinalEncoder),e.translucentFinalEncoder.end()},t.getTextures=()=>[e.translucentColorTexture,e.translucentAccumulateTexture],t.createRenderEncoder=()=>{e.translucentRenderEncoder=it.newInstance({label:"translucentRender"});const n=e.translucentRenderEncoder.getDescription();n.colorAttachments=[{view:void 0,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"},{view:void 0,clearValue:[1,0,0,0],loadOp:"clear",storeOp:"store"}],n.depthStencilAttachment={view:void 0,depthLoadOp:"load",depthStoreOp:"store"},e.translucentRenderEncoder.setReplaceShaderCodeFunction(r=>{const a=r.getShaderDescription("fragment");a.addOutput("vec4<f32>","outColor"),a.addOutput("f32","outAccum"),a.addBuiltinInput("vec4<f32>","@builtin(position) fragPos");let s=a.getCode();s=H.substitute(s,"//VTK::RenderEncoder::Impl",["var w: f32 = computedColor.a * pow(0.1 + input.fragPos.z, 2.0);","output.outColor = vec4<f32>(computedColor.rgb*w, w);","output.outAccum = computedColor.a;"]).result,a.setCode(s)}),e.translucentRenderEncoder.setPipelineHash("oitpr"),e.translucentRenderEncoder.setPipelineSettings({primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!1,depthCompare:"greater",format:"depth32float"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"one",dstFactor:"one"},alpha:{srcfactor:"one",dstFactor:"one"}}},{format:"r16float",blend:{color:{srcFactor:"zero",dstFactor:"one-minus-src"},alpha:{srcfactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createFinalEncoder=()=>{e.translucentFinalEncoder=it.newInstance({label:"translucentFinal"}),e.translucentFinalEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e.translucentFinalEncoder.setReplaceShaderCodeFunction(n=>{const r=n.getShaderDescription("fragment");r.addOutput("vec4<f32>","outColor"),r.addBuiltinInput("vec4<f32>","@builtin(position) fragPos");let a=r.getCode();a=H.substitute(a,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<f32>(computedColor.rgb, computedColor.a);"]).result,r.setCode(a)}),e.translucentFinalEncoder.setPipelineHash("oitpf"),e.translucentFinalEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcfactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})}}const Qw={colorTextureView:null,depthTextureView:null};function Ol(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Qw,n),ct.extend(t,e,n),E.setGet(t,e,["colorTextureView","depthTextureView"]),Iw(t,e)}const Zw=E.newInstance(Ol,"vtkWebGPUOrderIndependentTranslucentPass");var Jw={newInstance:Zw,extend:Ol};const It={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4},eE=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Volume::TraverseDec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

fn getTextureValue(vTex: texture_3d<f32>, tpos: vec4<f32>) -> f32
{
  // todo multicomponent support
  return textureSampleLevel(vTex, clampSampler, tpos.xyz, 0.0).r;
}

fn getGradient(vTex: texture_3d<f32>, tpos: vec4<f32>, vNum: i32, scalar: f32) -> vec4<f32>
{
  var result: vec4<f32>;

  var tstep: vec4<f32> = volumeSSBO.values[vNum].tstep;
  result.x = getTextureValue(vTex, tpos + vec4<f32>(tstep.x, 0.0, 0.0, 1.0)) - scalar;
  result.y = getTextureValue(vTex, tpos + vec4<f32>(0.0, tstep.y, 0.0, 1.0)) - scalar;
  result.z = getTextureValue(vTex, tpos + vec4<f32>(0.0, 0.0, tstep.z, 1.0)) - scalar;
  result.w = 0.0;

  // divide by spacing as that is our delta
  result = result / volumeSSBO.values[vNum].spacing;
  // now we have a gradient in unit tcoords

  var grad: f32 = length(result.xyz);
  if (grad > 0.0)
  {
    // rotate to View Coords, needed for lighting and shading
    var nMat: mat4x4<f32> = rendererUBO.SCVCMatrix * volumeSSBO.values[vNum].planeNormals;
    result = nMat * result;
    result = result / length(result);
  }

  // store gradient magnitude in .w
  result.w = grad;

  return result;
}

fn processVolume(vTex: texture_3d<f32>, vNum: i32, cNum: i32, posSC: vec4<f32>, tfunRows: f32) -> vec4<f32>
{
  var outColor: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);

  // convert to tcoords and reject if outside the volume
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*posSC;
  if (tpos.x < 0.0 || tpos.y < 0.0 || tpos.z < 0.0 ||
      tpos.x > 1.0 || tpos.y > 1.0 || tpos.z > 1.0) { return outColor; }

  var scalar: f32 = getTextureValue(vTex, tpos);

  var coord: vec2<f32> =
    vec2<f32>(scalar * componentSSBO.values[cNum].cScale + componentSSBO.values[cNum].cShift,
      (0.5 + 2.0 * f32(vNum)) / tfunRows);
  var color: vec4<f32> = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);

  var gofactor: f32 = 1.0;
  var normal: vec4<f32> = vec4<f32>(0.0,0.0,0.0,0.0);
  if (componentSSBO.values[cNum].gomin <  1.0 || volumeSSBO.values[vNum].shade[0] > 0.0)
  {
    normal = getGradient(vTex, tpos, vNum, scalar);
    if (componentSSBO.values[cNum].gomin <  1.0)
    {
      gofactor = clamp(normal.a*componentSSBO.values[cNum].goScale + componentSSBO.values[cNum].goShift,
      componentSSBO.values[cNum].gomin, componentSSBO.values[cNum].gomax);
    }
  }

  coord.x = (scalar * componentSSBO.values[cNum].oScale + componentSSBO.values[cNum].oShift);
  var opacity: f32 = textureSampleLevel(ofunTexture, clampSampler, coord, 0.0).r;

  if (volumeSSBO.values[vNum].shade[0] > 0.0)
  {
    color = color*abs(normal.z);
  }

  outColor = vec4<f32>(color.rgb, gofactor * opacity);

  return outColor;
}

// adjust the start and end point of a raycast such that it intersects the unit cube.
// This function is used to take a raycast starting point and step vector
// and numSteps and return the startijng and ending steps for intersecting the
// unit cube. Recall for a 3D texture, the unit cube is the range of texture coordsinates
// that have valid values. So this funtion can be used to take a ray in texture coordinates
// and bound it to intersecting the texture.
//
fn adjustBounds(tpos: vec4<f32>, tstep: vec4<f32>, numSteps: f32) -> vec2<f32>
{
  var result: vec2<f32> = vec2<f32>(0.0, numSteps);
  var tpos2: vec4<f32> = tpos + tstep*numSteps;

  // move tpos to the start of the volume
  var adjust: f32 =
    min(
      max(tpos.x/tstep.x, (tpos.x - 1.0)/tstep.x),
      min(
        max((tpos.y - 1.0)/tstep.y, tpos.y/tstep.y),
        max((tpos.z - 1.0)/tstep.z, tpos.z/tstep.z)));
  if (adjust < 0.0)
  {
    result.x = result.x - adjust;
  }

  // adjust length to the end
  adjust =
    max(
      min(tpos2.x/tstep.x, (tpos2.x - 1.0)/tstep.x),
      max(
        min((tpos2.y - 1.0)/tstep.y, tpos2.y/tstep.y),
        min((tpos2.z - 1.0)/tstep.z, tpos2.z/tstep.z)));
  if (adjust > 0.0)
  {
    result.y = result.y - adjust;
  }

  return result;
}

fn getSimpleColor(scalar: f32, vNum: i32, cNum: i32) -> vec4<f32>
{
  // how many rows (tfuns) do we have in our tfunTexture
  var tfunRows: f32 = f32(textureDimensions(tfunTexture).y);

  var coord: vec2<f32> =
    vec2<f32>(scalar * componentSSBO.values[cNum].cScale + componentSSBO.values[cNum].cShift,
      (0.5 + 2.0 * f32(vNum)) / tfunRows);
  var color: vec4<f32> = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);
  coord.x = (scalar * componentSSBO.values[cNum].oScale + componentSSBO.values[cNum].oShift);
  var opacity: f32 = textureSampleLevel(ofunTexture, clampSampler, coord, 0.0).r;
  return vec4<f32>(color.rgb, opacity);
}

fn traverseMax(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var maxVal: f32 = -1.0e37;
  loop
  {
    var scalar: f32 = getTextureValue(vTex, tpos);
    if (scalar > maxVal)
    {
      maxVal = scalar;
    }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(maxVal, vNum, cNum);
}

fn traverseMin(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var minVal: f32 = 1.0e37;
  loop
  {
    var scalar: f32 = getTextureValue(vTex, tpos);
    if (scalar < minVal)
    {
      minVal = scalar;
    }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(minVal, vNum, cNum);
}

fn traverseAverage(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  let ipRange: vec4<f32> = volumeSSBO.values[vNum].ipScalarRange;
  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var avgVal: f32 = 0.0;
  var sampleCount: f32 = 0.0;
  loop
  {
    var sample: f32 = getTextureValue(vTex, tpos);
    // right now leave filtering off until WebGL changes get merged
    // if (ipRange.z == 0.0 || sample >= ipRange.x && sample <= ipRange.y)
    // {
      avgVal = avgVal + sample;
      sampleCount = sampleCount + 1.0;
    // }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  if (sampleCount <= 0.0)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(avgVal/sampleCount, vNum, cNum);
}

fn traverseAdditive(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  let ipRange: vec4<f32> = volumeSSBO.values[vNum].ipScalarRange;
  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var sumVal: f32 = 0.0;
  loop
  {
    var sample: f32 = getTextureValue(vTex, tpos);
    // right now leave filtering off until WebGL changes get merged
    // if (ipRange.z == 0.0 || sample >= ipRange.x && sample <= ipRange.y)
    // {
      sumVal = sumVal + sample;
    // }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(sumVal, vNum, cNum);
}

fn composite(rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>) -> vec4<f32>
{
  // initial ray position is at the beginning
  var rayPosSC: vec4<f32> = minPosSC;

  // how many rows (tfuns) do we have in our tfunTexture
  var tfunRows: f32 = f32(textureDimensions(tfunTexture).y);

  var curDist: f32 = 0.0;
  var computedColor: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);
  var sampleColor: vec4<f32>;
//VTK::Volume::TraverseCalls

  loop
  {
    // for each volume, sample and accumulate color
//VTK::Volume::CompositeCalls

    // increment position
    curDist = curDist + mapperUBO.SampleDistance;
    rayPosSC = rayPosSC + rayStepSC;

    // check if we have reached a terminating condition
    if (curDist > rayLengthSC) { break; }
    if (computedColor.a > 0.98) { break; }
  }
  return computedColor;
}

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var rayMax: f32 = textureSampleLevel(maxTexture, clampSampler, input.tcoordVS, 0.0).r;
  var rayMin: f32 = textureSampleLevel(minTexture, clampSampler, input.tcoordVS, 0.0).r;

  // discard empty rays
  if (rayMax <= rayMin) { discard; }
  else
  {
    // compute start and end ray positions in view coordinates
    var minPosSC: vec4<f32> = rendererUBO.PCSCMatrix*vec4<f32>(2.0 * input.tcoordVS.x - 1.0, 1.0 - 2.0 * input.tcoordVS.y, rayMax, 1.0);
    minPosSC = minPosSC * (1.0 / minPosSC.w);
    var maxPosSC: vec4<f32> = rendererUBO.PCSCMatrix*vec4<f32>(2.0 * input.tcoordVS.x - 1.0, 1.0 - 2.0 * input.tcoordVS.y, rayMin, 1.0);
    maxPosSC = maxPosSC * (1.0 / maxPosSC.w);

    var rayLengthSC: f32 = distance(minPosSC.xyz, maxPosSC.xyz);
    var rayStepSC: vec4<f32> = (maxPosSC - minPosSC)*(mapperUBO.SampleDistance/rayLengthSC);
    rayStepSC.w = 0.0;

    var computedColor: vec4<f32>;

//VTK::Volume::Loop

//VTK::RenderEncoder::Impl
  }

  return output;
}
`,Ce=new Float64Array(16),pt=new Float64Array(16);function tE(t,e){e.classHierarchy.push("vtkWebGPUVolumePassFSQ"),t.replaceShaderPosition=(a,s,i)=>{const o=s.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let c=o.getCode();c=H.substitute(c,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);"]).result,o.setCode(c),s.getShaderDescription("fragment").addBuiltinInput("vec4<f32>","@builtin(position) fragPos")},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderVolume=(a,s,i)=>{const o=s.getShaderDescription("fragment");let c=o.getCode();const u=[],g=[];for(let l=0;l<e.volumes.length;l++)e.volumes[l].getRenderable().getMapper().getBlendMode()===It.COMPOSITE_BLEND?(u.push(`    sampleColor = processVolume(volTexture${l}, ${l}, ${e.rowStarts[l]}, rayPosSC, tfunRows);`),u.push(`    computedColor = vec4<f32>(
          sampleColor.a * sampleColor.rgb * (1.0 - computedColor.a) + computedColor.rgb,
          (1.0 - computedColor.a)*sampleColor.a + computedColor.a);`)):(g.push(`  sampleColor = traverseVals[${l}];`),g.push(`  computedColor = vec4<f32>(
          sampleColor.a * sampleColor.rgb * (1.0 - computedColor.a) + computedColor.rgb,
          (1.0 - computedColor.a)*sampleColor.a + computedColor.a);`));c=H.substitute(c,"//VTK::Volume::CompositeCalls",u).result,c=H.substitute(c,"//VTK::Volume::TraverseCalls",g).result,c=H.substitute(c,"//VTK::Volume::TraverseDec",[`var<private> traverseVals: array<vec4<f32>,${e.volumes.length}>;`]).result;let f=!1;for(let l=0;l<e.volumes.length;l++){const p=e.volumes[l].getRenderable().getMapper().getBlendMode();p===It.COMPOSITE_BLEND?f=!0:p===It.MAXIMUM_INTENSITY_BLEND?c=H.substitute(c,"//VTK::Volume::Loop",[`    traverseMax(volTexture${l}, ${l}, ${l}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${l}];`,"//VTK::Volume::Loop"]).result:p===It.MINIMUM_INTENSITY_BLEND?c=H.substitute(c,"//VTK::Volume::Loop",[`    traverseMin(volTexture${l}, ${l}, ${l}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${l}];`,"//VTK::Volume::Loop"]).result:p===It.AVERAGE_INTENSITY_BLEND?c=H.substitute(c,"//VTK::Volume::Loop",[`    traverseAverage(volTexture${l}, ${l}, ${l}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${l}];`,"//VTK::Volume::Loop"]).result:p===It.ADDITIVE_INTENSITY_BLEND&&(c=H.substitute(c,"//VTK::Volume::Loop",[`    traverseAdditive(volTexture${l}, ${l}, ${l}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${l}];`,"//VTK::Volume::Loop"]).result)}f&&(c=H.substitute(c,"//VTK::Volume::Loop",["    computedColor = composite(rayLengthSC, minPosSC, rayStepSC);"]).result),o.setCode(c)},e.shaderReplacements.set("replaceShaderVolume",t.replaceShaderVolume),t.updateLUTImage=a=>{let s=t.getMTime();for(let f=0;f<e.volumes.length;f++){const l=e.volumes[f].getRenderable(),p=l.getMapper().getInputData();s=Math.max(s,l.getMTime(),p.getMTime())}if(s<e.lutBuildTime.getMTime())return;e.numRows=0,e.rowStarts=[];for(let f=0;f<e.volumes.length;f++){e.rowStarts.push(e.numRows);const p=e.volumes[f].getRenderable(),y=p.getMapper(),h=p.getProperty(),v=y.getInputData(),S=(v.getPointData()&&v.getPointData().getScalars()).getNumberOfComponents(),T=h.getIndependentComponents()?S:1;e.numRows+=T}const i=new Uint8ClampedArray(e.numRows*2*e.rowLength*4),o=new Float32Array(e.numRows*2*e.rowLength);let c=0;const u=new Float32Array(e.rowLength*3),g=e.rowLength;for(let f=0;f<e.volumes.length;f++){const p=e.volumes[f].getRenderable(),y=p.getMapper(),h=p.getProperty(),v=y.getInputData(),S=(v.getPointData()&&v.getPointData().getScalars()).getNumberOfComponents(),T=h.getIndependentComponents()?S:1;for(let w=0;w<T;++w){const C=h.getRGBTransferFunction(w),O=C.getRange();C.getTable(O[0],O[1],g,u,1);let R=c*g*4;for(let V=0;V<g;++V){i[R+V*4]=255*u[V*3],i[R+V*4+1]=255*u[V*3+1],i[R+V*4+2]=255*u[V*3+2],i[R+V*4+3]=255;for(let B=0;B<4;B++)i[R+(g+V)*4+B]=i[R+V*4+B]}const L=h.getScalarOpacity(w),D=e.sampleDist/h.getScalarOpacityUnitDistance(w),M=L.getRange();L.getTable(M[0],M[1],g,u,1),R=c*g;for(let V=0;V<g;++V)o[R+V]=1-(1-u[V])**D,o[R+V+g]=o[R+V];c+=2}}{const f={nativeArray:i,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},p=a.getTextureManager().getTexture(f).createView("tfunTexture");e.textureViews[2]=p}{const f={nativeArray:o,width:e.rowLength,height:e.numRows*2,depth:1,format:"r16float"},p=a.getTextureManager().getTexture(f).createView("ofunTexture");e.textureViews[3]=p}e.lutBuildTime.modified()},t.updateSSBO=a=>{let s=Math.max(t.getMTime(),e.WebGPURenderer.getStabilizedTime());for(let C=0;C<e.volumes.length;C++){const O=e.volumes[C].getRenderable(),R=O.getMapper(),L=R.getInputData();s=Math.max(s,O.getMTime(),L.getMTime(),R.getMTime())}if(s<e.SSBO.getSendTime())return;const i=e.WebGPURenderer.getStabilizedCenterByReference();e.SSBO.clearData(),e.SSBO.setNumberOfInstances(e.volumes.length);const o=new Float64Array(e.volumes.length*16),c=new Float64Array(e.volumes.length*16),u=new Float64Array(e.volumes.length*4),g=new Float64Array(e.volumes.length*4),f=new Float64Array(e.volumes.length*4),l=new Float64Array(e.volumes.length*4);for(let C=0;C<e.volumes.length;C++){const R=e.volumes[C].getRenderable(),L=R.getMapper(),D=L.getInputData();A(Ce),oe(Ce,Ce,i);const M=R.getMatrix();te(pt,M),Oe(pt,pt),ge(Ce,pt,Ce);const V=D.getWorldToIndex();ge(Ce,V,Ce);const B=D.getDimensions();A(pt),Ht(pt,pt,[1/B[0],1/B[1],1/B[2]]),ge(Ce,pt,Ce);for(let b=0;b<16;b++)o[C*16+b]=Ce[b];Oe(Ce,Ce);for(let b=0;b<4;b++)c[C*16+b*4]=Ce[b*4],c[C*16+b*4+1]=Ce[b*4+1],c[C*16+b*4+2]=Ce[b*4+2],c[C*16+b*4+3]=0;u[C*4]=1/B[0],u[C*4+1]=1/B[1],u[C*4+2]=1/B[2],u[C*4+3]=1,g[C*4]=R.getProperty().getShade()?1:0;const _=D.getSpacing();f[C*4]=_[0],f[C*4+1]=_[1],f[C*4+2]=_[2],f[C*4+3]=1;const k=e.textureViews[C+4].getTexture().getScale(),G=L.getIpScalarRange();l[C*4]=G[0]/k,l[C*4+1]=G[1]/k,l[C*4+2]=L.getFilterMode()}e.SSBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.SSBO.addEntry("planeNormals","mat4x4<f32>"),e.SSBO.addEntry("shade","vec4<f32>"),e.SSBO.addEntry("tstep","vec4<f32>"),e.SSBO.addEntry("spacing","vec4<f32>"),e.SSBO.addEntry("ipScalarRange","vec4<f32>"),e.SSBO.setAllInstancesFromArray("SCTCMatrix",o),e.SSBO.setAllInstancesFromArray("planeNormals",c),e.SSBO.setAllInstancesFromArray("shade",g),e.SSBO.setAllInstancesFromArray("tstep",u),e.SSBO.setAllInstancesFromArray("spacing",f),e.SSBO.setAllInstancesFromArray("ipScalarRange",l),e.SSBO.send(a),e.componentSSBO.clearData(),e.componentSSBO.setNumberOfInstances(e.numRows);const p=new Float64Array(e.numRows),y=new Float64Array(e.numRows),h=new Float64Array(e.numRows),v=new Float64Array(e.numRows),x=new Float64Array(e.numRows),S=new Float64Array(e.numRows),d=new Float64Array(e.numRows),T=new Float64Array(e.numRows);let w=0;for(let C=0;C<e.volumes.length;C++){const R=e.volumes[C].getRenderable(),L=R.getMapper(),D=R.getProperty(),M=L.getInputData(),B=(M.getPointData()&&M.getPointData().getScalars()).getNumberOfComponents(),_=D.getIndependentComponents(),k=e.textureViews[C+4].getTexture().getFormat(),G=he.getDetailsFromTextureFormat(k),b=G.elementSize===2&&G.sampleType==="float",I={scale:[255],offset:[0]};b&&(I.scale[0]=1);for(let m=0;m<B;m++){const U=_?m:0,$=I.scale[m],N=D.getScalarOpacity(U).getRange(),He=$/(N[1]-N[0]),ga=(I.offset[m]-N[0])/(N[1]-N[0]);v[w]=ga,h[w]=He;const me=D.getRGBTransferFunction(U).getRange();if(y[w]=(I.offset[m]-me[0])/(me[1]-me[0]),p[w]=$/(me[1]-me[0]),D.getUseGradientOpacity(U)){const jn=D.getGradientOpacityMinimumOpacity(U),la=D.getGradientOpacityMaximumOpacity(U);x[w]=jn,S[w]=la;const Tn=[D.getGradientOpacityMinimumValue(U),D.getGradientOpacityMaximumValue(U)];T[w]=$*(la-jn)/(Tn[1]-Tn[0]),d[w]=-Tn[0]*(la-jn)/(Tn[1]-Tn[0])+jn}else x[w]=1,S[w]=1,T[w]=0,d[w]=1;w++}}e.componentSSBO.addEntry("cScale","f32"),e.componentSSBO.addEntry("cShift","f32"),e.componentSSBO.addEntry("oScale","f32"),e.componentSSBO.addEntry("oShift","f32"),e.componentSSBO.addEntry("goShift","f32"),e.componentSSBO.addEntry("goScale","f32"),e.componentSSBO.addEntry("gomin","f32"),e.componentSSBO.addEntry("gomax","f32"),e.componentSSBO.setAllInstancesFromArray("cScale",p),e.componentSSBO.setAllInstancesFromArray("cShift",y),e.componentSSBO.setAllInstancesFromArray("oScale",h),e.componentSSBO.setAllInstancesFromArray("oShift",v),e.componentSSBO.setAllInstancesFromArray("goScale",T),e.componentSSBO.setAllInstancesFromArray("goShift",d),e.componentSSBO.setAllInstancesFromArray("gomin",x),e.componentSSBO.setAllInstancesFromArray("gomax",S),e.componentSSBO.send(a)};const n=t.updateBuffers;t.updateBuffers=()=>{n();let a=e.volumes[0].getRenderable().getMapper().getSampleDistance();for(let s=0;s<e.volumes.length;s++){const c=e.volumes[s].getRenderable().getMapper().getSampleDistance();c<a&&(a=c)}e.sampleDist!==a&&(e.sampleDist=a,e.UBO.setValue("SampleDistance",a),e.UBO.sendIfNeeded(e.device));for(let s=0;s<e.volumes.length;s++){const u=e.volumes[s].getRenderable().getMapper().getInputData(),g=e.device.getTextureManager().getTextureForImageData(u);if(!e.textureViews[s+4]||e.textureViews[s+4].getTexture()!==g){const f=g.createView(`volTexture${s}`);e.textureViews[s+4]=f}}if(e.volumes.length<e.lastVolumeLength)for(let s=e.volumes.length;s<e.lastVolumeLength;s++)e.textureViews.pop();e.lastVolumeLength=e.volumes.length,t.updateLUTImage(e.device),t.updateSSBO(e.device),e.clampSampler||(e.clampSampler=vi.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:"linear",magFilter:"linear"}))},t.computePipelineHash=()=>{e.pipelineHash="volfsq";for(let a=0;a<e.volumes.length;a++){const s=e.volumes[a].getRenderable().getMapper().getBlendMode();e.pipelineHash+=`${s}`}},t.setVolumes=a=>{if(!e.volumes||e.volumes.length!==a.length){e.volumes=[...a],t.modified();return}for(let s=0;s<a.length;s++)if(a[s]!==e.volumes[s]){e.volumes=[...a],t.modified();return}};const r=t.getBindables;t.getBindables=()=>{const a=r();return a.push(e.componentSSBO),a.push(e.clampSampler),a}}const nE={volumes:null,rowLength:1024,lastVolumeLength:0};function Rl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nE,n),rn.extend(t,e,n),e.fragmentShaderTemplate=eE,e.UBO=Wt.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SampleDistance","f32"),e.SSBO=_s.newInstance({label:"volumeSSBO"}),e.componentSSBO=_s.newInstance({label:"componentSSBO"}),e.lutBuildTime={},E.obj(e.lutBuildTime,{mtime:0}),tE(t,e)}const rE=E.newInstance(Rl,"vtkWebGPUVolumePassFSQ");var aE={newInstance:rE,extend:Rl};const{Representation:sE}=vn,{BufferUsage:Tc,PrimitiveTypes:iE}=Rt,rs=[[0,4,6],[0,6,2],[1,3,7],[1,7,5],[0,5,4],[0,1,5],[2,6,7],[2,7,3],[0,3,1],[0,2,3],[4,5,7],[4,7,6]],oE=`
//VTK::Renderer::Dec

//VTK::Select::Dec

//VTK::VolumePass::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Select::Impl

  //VTK::TCoord::Impl

  //VTK::VolumePass::Impl

  // use the maximum (closest) of the current value and the zbuffer
  // the blend func will then take the min to find the farthest stop value
  var stopval: f32 = max(input.fragPos.z, textureLoad(opaquePassDepthTexture, vec2<i32>(i32(input.fragPos.x), i32(input.fragPos.y)), 0));

  //VTK::RenderEncoder::Impl
  return output;
}
`,cE=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = textureSample(volumePassColorTexture,
    volumePassColorTextureSampler, mapperUBO.tscale*input.tcoordVS);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function fE(t,e){e.classHierarchy.push("vtkWebGPUVolumePass"),t.initialize=n=>{e._clearEncoder||t.createClearEncoder(n),e._mergeEncoder||t.createMergeEncoder(n),e._copyEncoder||t.createCopyEncoder(n),e._depthRangeEncoder||t.createDepthRangeEncoder(n),e.fullScreenQuad||(e.fullScreenQuad=aE.newInstance(),e.fullScreenQuad.setDevice(n.getDevice()),e.fullScreenQuad.setTextureViews([...e._depthRangeEncoder.getColorTextureViews()])),e._volumeCopyQuad||(e._volumeCopyQuad=rn.newInstance(),e._volumeCopyQuad.setPipelineHash("volpassfsq"),e._volumeCopyQuad.setDevice(n.getDevice()),e._volumeCopyQuad.setFragmentShaderTemplate(cE),e._copyUBO=Wt.newInstance({label:"mapperUBO"}),e._copyUBO.addEntry("tscale","vec2<f32>"),e._volumeCopyQuad.setUBO(e._copyUBO),e._volumeCopyQuad.setTextureViews([e._colorTextureView]))},t.traverse=(n,r)=>{if(e.deleted)return;e._currentParent=r,t.initialize(r),t.computeTiming(r),t.renderDepthBounds(n,r),e._firstGroup=!0;const a=r.getDevice(),s=a.getHandle().limits.maxSampledTexturesPerShaderStage-4;if(e.volumes.length>s){const i=n.getRenderable().getActiveCamera().getPosition(),o=[];for(let f=0;f<e.volumes.length;f++){const l=e.volumes[f].getRenderable().getBounds(),p=[.5*(l[1]+l[0]),.5*(l[3]+l[2]),.5*(l[5]+l[4])];o[f]=Pe(p,i)}const c=[...Array(e.volumes.length).keys()];c.sort((f,l)=>o[l]-o[f]);let u=[],g=c.length%s;for(let f=0;f<c.length;f++)u.push(e.volumes[c[f]]),u.length>=g&&(t.rayCastPass(r,n,u),u=[],g=s,e._firstGroup=!1)}else t.rayCastPass(r,n,e.volumes);if(e._volumeCopyQuad.setWebGPURenderer(n),e._useSmallViewport){const i=e._colorTextureView.getTexture().getWidth(),o=e._colorTextureView.getTexture().getHeight();e._copyUBO.setArray("tscale",[e._smallViewportWidth/i,e._smallViewportHeight/o])}else e._copyUBO.setArray("tscale",[1,1]);e._copyUBO.sendIfNeeded(a),e._copyEncoder.setColorTextureView(0,e.colorTextureView),e._copyEncoder.attachTextureViews(),e._copyEncoder.begin(r.getCommandEncoder()),n.scissorAndViewport(e._copyEncoder),e._volumeCopyQuad.prepareAndDraw(e._copyEncoder),e._copyEncoder.end()},t.delete=E.chain(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},t.delete),t.computeTiming=n=>{const r=n.getRenderable().getInteractor();if(e._lastScale==null){const a=e.volumes[0].getRenderable().getMapper();e._lastScale=a.getInitialInteractionScale()||1}e._useSmallViewport=!1,r.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._colorTexture.resize(n.getCanvas().width,n.getCanvas().height),e._animationRateSubscription||(e._animationRateSubscription=r.onAnimationFrameRateUpdate(()=>{const a=e.volumes[0].getRenderable().getMapper();if(a.getAutoAdjustSampleDistances()){const s=r.getRecentAnimationFrameRate(),i=e._lastScale*r.getDesiredUpdateRate()/s;e._lastScale=i,e._lastScale>400&&(e._lastScale=400)}else e._lastScale=a.getImageSampleDistance()*a.getImageSampleDistance();e._lastScale<1.5&&(e._lastScale=1.5)}))},t.rayCastPass=(n,r,a)=>{const s=e._firstGroup?e._clearEncoder:e._mergeEncoder;s.attachTextureViews(),s.begin(n.getCommandEncoder());let i=e._colorTextureView.getTexture().getWidth(),o=e._colorTextureView.getTexture().getHeight();if(e._useSmallViewport){const c=n.getCanvas(),u=1/Math.sqrt(e._lastScale);e._smallViewportWidth=Math.ceil(u*c.width),e._smallViewportHeight=Math.ceil(u*c.height),i=e._smallViewportWidth,o=e._smallViewportHeight}s.getHandle().setViewport(0,0,i,o,0,1),s.getHandle().setScissorRect(0,0,i,o),e.fullScreenQuad.setWebGPURenderer(r),e.fullScreenQuad.setVolumes(a),e.fullScreenQuad.prepareAndDraw(s),s.end()},t.renderDepthBounds=(n,r)=>{t.updateDepthPolyData(n);const a=e._boundsPoly,s=a.getPoints(),i=a.getPolys();let o={hash:`vp${i.getMTime()}`,usage:Tc.Index,cells:i,numberOfPoints:s.getNumberOfPoints(),primitiveType:iE.Triangles,representation:sE.SURFACE};const c=r.getDevice().getBufferManager().getBuffer(o);e._mapper.getVertexInput().setIndexBuffer(c),o={usage:Tc.PointArray,format:"float32x4",hash:`vp${s.getMTime()}${i.getMTime()}`,dataArray:s,indexBuffer:c,packExtra:!0};const u=r.getDevice().getBufferManager().getBuffer(o);e._mapper.getVertexInput().addBuffer(u,["vertexBC"]),e._mapper.setNumberOfVertices(u.getSizeInBytes()/u.getStrideInBytes()),t.drawDepthRange(n,r)},t.updateDepthPolyData=n=>{let r=!1;for(let g=0;g<e.volumes.length;g++){const f=e.volumes[g].getMTime();(!e._lastMTimes[g]||f!==e._lastMTimes[g])&&(r=!0,e._lastMTimes[g]=f)}const a=n.getStabilizedTime();if((e._lastMTimes.length<=e.volumes.length||a!==e._lastMTimes[e.volumes.length])&&(r=!0,e._lastMTimes[e.volumes.length]=a),!r)return;const s=n.getStabilizedCenterByReference(),i=e.volumes.length*8,o=new Float64Array(i*3),c=e.volumes.length*12,u=new Uint16Array(c*4);for(let g=0;g<e.volumes.length;g++){e.volumes[g].getBoundingCubePoints(o,g*24);let f=g*12*4;const l=g*8;for(let p=0;p<12;p++)u[f++]=3,u[f++]=l+rs[p][0],u[f++]=l+rs[p][1],u[f++]=l+rs[p][2]}for(let g=0;g<o.length;g+=3)o[g]-=s[0],o[g+1]-=s[1],o[g+2]-=s[2];e._boundsPoly.getPoints().setData(o,3),e._boundsPoly.getPoints().modified(),e._boundsPoly.getPolys().setData(u,1),e._boundsPoly.getPolys().modified(),e._boundsPoly.modified()},t.drawDepthRange=(n,r)=>{e._depthRangeTexture.resizeToMatch(e.colorTextureView.getTexture()),e._depthRangeTexture2.resizeToMatch(e.colorTextureView.getTexture()),e._depthRangeEncoder.attachTextureViews(),t.setCurrentOperation("volumeDepthRangePass"),n.setRenderEncoder(e._depthRangeEncoder),n.volumeDepthRangePass(!0),e._mapper.setWebGPURenderer(n),e._mapper.prepareToDraw(e._depthRangeEncoder),e._mapper.registerDrawCallback(e._depthRangeEncoder),n.volumeDepthRangePass(!1)},t.createDepthRangeEncoder=n=>{const r=n.getDevice();e._depthRangeEncoder=it.newInstance({label:"VolumePass DepthRange"}),e._depthRangeEncoder.setPipelineHash("volr"),e._depthRangeEncoder.setReplaceShaderCodeFunction(i=>{const o=i.getShaderDescription("fragment");o.addOutput("vec4<f32>","outColor1"),o.addOutput("vec4<f32>","outColor2");let c=o.getCode();c=H.substitute(c,"//VTK::RenderEncoder::Impl",["output.outColor1 = vec4<f32>(input.fragPos.z, 0.0, 0.0, 0.0);","output.outColor2 = vec4<f32>(stopval, 0.0, 0.0, 0.0);"]).result,o.setCode(c)}),e._depthRangeEncoder.setDescription({colorAttachments:[{view:null,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"},{view:null,clearValue:[1,1,1,1],loadOp:"clear",storeOp:"store"}]}),e._depthRangeEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"r16float",blend:{color:{srcFactor:"one",dstFactor:"one",operation:"max"},alpha:{srcfactor:"one",dstFactor:"one",operation:"max"}}},{format:"r16float",blend:{color:{srcFactor:"one",dstFactor:"one",operation:"min"},alpha:{srcfactor:"one",dstFactor:"one",operation:"min"}}}]}}),e._depthRangeTexture=Ie.newInstance({label:"volumePassMaxDepth"}),e._depthRangeTexture.create(r,{width:n.getCanvas().width,height:n.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const a=e._depthRangeTexture.createView("maxTexture");e._depthRangeEncoder.setColorTextureView(0,a),e._depthRangeTexture2=Ie.newInstance({label:"volumePassDepthMin"}),e._depthRangeTexture2.create(r,{width:n.getCanvas().width,height:n.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const s=e._depthRangeTexture2.createView("minTexture");e._depthRangeEncoder.setColorTextureView(1,s),e._mapper.setDevice(n.getDevice()),e._mapper.setTextureViews([e.depthTextureView])},t.createClearEncoder=n=>{e._colorTexture=Ie.newInstance({label:"volumePassColor"}),e._colorTexture.create(n.getDevice(),{width:n.getCanvas().width,height:n.getCanvas().height,format:"bgra8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC}),e._colorTextureView=e._colorTexture.createView("volumePassColorTexture"),e._colorTextureView.addSampler(n.getDevice(),{minFilter:"linear",magFilter:"linear"}),e._clearEncoder=it.newInstance({label:"VolumePass Clear"}),e._clearEncoder.setColorTextureView(0,e._colorTextureView),e._clearEncoder.setDescription({colorAttachments:[{view:null,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}]}),e._clearEncoder.setPipelineHash("volpf"),e._clearEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"bgra8unorm",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcfactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createCopyEncoder=n=>{e._copyEncoder=it.newInstance({label:"volumePassCopy"}),e._copyEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._copyEncoder.setPipelineHash("volcopypf"),e._copyEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha"},alpha:{srcfactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createMergeEncoder=n=>{e._mergeEncoder=it.newInstance({label:"volumePassMerge"}),e._mergeEncoder.setColorTextureView(0,e._colorTextureView),e._mergeEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._mergeEncoder.setReplaceShaderCodeFunction(r=>{const a=r.getShaderDescription("fragment");a.addOutput("vec4<f32>","outColor");let s=a.getCode();s=H.substitute(s,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<f32>(computedColor.rgb, computedColor.a);"]).result,a.setCode(s)}),e._mergeEncoder.setPipelineHash("volpf"),e._mergeEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"bgra8unorm",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcfactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.setVolumes=n=>{if(!e.volumes||e.volumes.length!==n.length){e.volumes=[...n],t.modified();return}for(let r=0;r<n.length;r++)if(n[r]!==e.volumes[r]){e.volumes=[...n],t.modified();return}}}const uE={colorTextureView:null,depthTextureView:null,volumes:null};function Dl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uE,n),ct.extend(t,e,n),e._mapper=hi.newInstance(),e._mapper.setFragmentShaderTemplate(oE),e._mapper.getShaderReplacements().set("replaceShaderVolumePass",(r,a,s)=>{a.getShaderDescription("fragment").addBuiltinInput("vec4<f32>","@builtin(position) fragPos")}),e._boundsPoly=Be.newInstance(),e._lastMTimes=[],E.setGet(t,e,["colorTextureView","depthTextureView"]),fE(t,e)}const gE=E.newInstance(Dl,"vtkWebGPUVolumePass");var lE={newInstance:gE,extend:Dl};const pE=`
//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = clamp(textureSampleLevel(opaquePassColorTexture, finalPassSampler, input.tcoordVS, 0.0),vec4<f32>(0.0),vec4<f32>(1.0));

  //VTK::RenderEncoder::Impl
  return output;
}
`;function hE(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=r,t.setCurrentOperation("buildPass"),n.traverse(t),e.opaquePass||(e.opaquePass=Yw.newInstance());const a=n.getRenderable().getNumberOfLayers(),s=n.getChildren();for(let i=0;i<a;i++)for(let o=0;o<s.length;o++){const c=s[o],u=n.getRenderable().getRenderers()[o];u.getDraw()&&u.getLayer()===i&&(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumes=[],t.setCurrentOperation("queryPass"),c.traverse(t),t.setCurrentOperation("cameraPass"),c.traverse(t),e.opaquePass.traverse(c,n),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=Jw.newInstance()),e.translucentPass.setColorTextureView(e.opaquePass.getColorTextureView()),e.translucentPass.setDepthTextureView(e.opaquePass.getDepthTextureView()),e.translucentPass.traverse(c,n)),e.volumes.length>0&&(e.volumePass||(e.volumePass=lE.newInstance()),e.volumePass.setColorTextureView(e.opaquePass.getColorTextureView()),e.volumePass.setDepthTextureView(e.opaquePass.getDepthTextureView()),e.volumePass.setVolumes(e.volumes),e.volumePass.traverse(c,n)),t.finalPass(n,c))}},t.finalPass=(n,r)=>{e._finalBlitEncoder||t.createFinalBlitEncoder(n),e._finalBlitOutputTextureView.createFromTextureHandle(n.getCurrentTexture(),{depth:1,format:n.getPresentationFormat()}),e._finalBlitEncoder.attachTextureViews(),e._finalBlitEncoder.begin(n.getCommandEncoder()),r.scissorAndViewport(e._finalBlitEncoder),e._fullScreenQuad.prepareAndDraw(e._finalBlitEncoder),e._finalBlitEncoder.end()},t.createFinalBlitEncoder=n=>{e._finalBlitEncoder=it.newInstance({label:"forwardPassBlit"}),e._finalBlitEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._finalBlitEncoder.setPipelineHash("fpf"),e._finalBlitEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:n.getPresentationFormat(),blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcfactor:"one",dstFactor:"one-minus-src-alpha"}}}]}}),e._fsqSampler=vi.newInstance({label:"finalPassSampler"}),e._fsqSampler.create(n.getDevice(),{minFilter:"linear",magFilter:"linear"}),e._fullScreenQuad=rn.newInstance(),e._fullScreenQuad.setDevice(n.getDevice()),e._fullScreenQuad.setPipelineHash("fpfsq"),e._fullScreenQuad.setTextureViews([e.opaquePass.getColorTextureView()]),e._fullScreenQuad.setAdditionalBindables([e._fsqSampler]),e._fullScreenQuad.setFragmentShaderTemplate(pE),e._finalBlitOutputTextureView=Ug.newInstance(),e._finalBlitEncoder.setColorTextureView(0,e._finalBlitOutputTextureView)},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.addVolume=n=>{e.volumes.push(n)}}const vE={opaqueActorCount:0,translucentActorCount:0,volumes:null,opaqueRenderEncoder:null,translucentPass:null,volumePass:null};function Ml(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vE,n),ct.extend(t,e,n),E.setGet(t,e,["opaquePass","translucentPass","volumePass"]),hE(t,e)}const yE=E.newInstance(Ml,"vtkForwardPass");var dE={newInstance:yE,extend:Ml};const{VtkDataTypes:mt}=Y;function TE(t,e){e.classHierarchy.push("vtkWebGPUTextureManager");function n(a){if(a.imageData){a.dataArray=a.imageData.getPointData().getScalars(),a.time=a.dataArray.getMTime(),a.nativeArray=a.dataArray.getData();const s=a.imageData.getDimensions();switch(a.width=s[0],a.height=s[1],a.depth=s[2],a.dataArray.getNumberOfComponents()){case 1:a.format="r";break;case 2:a.format="rg";break;case 3:case 4:default:a.format="rgba";break}switch(a.dataArray.getDataType()){case mt.UNSIGNED_CHAR:a.format+="8unorm";break;case mt.FLOAT:case mt.UNSIGNED_INT:case mt.INT:case mt.DOUBLE:case mt.UNSIGNED_SHORT:case mt.SHORT:default:a.format+="16float";break}}a.image&&(a.width=a.image.width,a.height=a.image.height,a.depth=1,a.format="rgba8unorm"),a.jsImageData&&(a.width=a.jsImageData.width,a.height=a.jsImageData.height,a.depth=1,a.format="rgba8unorm",a.flip=!0,a.nativeArray=a.jsImageData.data),a.canvas&&(a.width=a.canvas.width,a.height=a.canvas.height,a.depth=1,a.format="rgba8unorm",a.flip=!0,a.usage=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT)}function r(a){const s=Ie.newInstance();return s.create(e.device,{width:a.width,height:a.height,depth:a.depth,format:a.format,usage:a.usage,mipLevel:a.mipLevel}),(a.nativeArray||a.image||a.canvas)&&s.writeImageData(a),s}t.getTexture=a=>a.hash?e.device.getCachedObject(a.hash,r,a):r(a),t.getTextureForImageData=a=>{const s={time:a.getMTime()};return s.imageData=a,n(s),s.hash=s.time+s.format+s.mipLevel,e.device.getTextureManager().getTexture(s)},t.getTextureForVTKTexture=a=>{const s={time:a.getMTime()};return a.getInputData()?s.imageData=a.getInputData():a.getImage()?s.image=a.getImage():a.getJsImageData()?s.jsImageData=a.getJsImageData():a.getCanvas()&&(s.canvas=a.getCanvas()),n(s),s.mipLevel=a.getMipLevel(),s.hash=s.time+s.format+s.mipLevel,e.device.getTextureManager().getTexture(s)}}const xE={handle:null,device:null};function Ll(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xE,n),E.obj(t,e),E.setGet(t,e,["device"]),TE(t,e)}const SE=E.newInstance(Ll);var CE={newInstance:SE,extend:Ll};class wE extends Map{constructor(){super(),this.registry=new FinalizationRegistry(e=>{const n=super.get(e);n&&n.deref&&n.deref()===void 0&&super.delete(e)})}getValue(e){const n=super.get(e);if(n){const r=n.deref();if(r!==void 0)return r;super.delete(e)}}setValue(e,n){let r;return n&&typeof n=="object"&&(r=new WeakRef(n),this.registry.register(n,e),super.set(e,r)),r}}function EE(t,e){e.classHierarchy.push("vtkWebGPUDevice"),t.initialize=n=>{e.handle=n},t.createCommandEncoder=()=>e.handle.createCommandEncoder(),t.submitCommandEncoder=n=>{e.handle.queue.submit([n.finish()])},t.getShaderModule=n=>e.shaderCache.getShaderModule(n),t.getBindGroupLayout=n=>{if(!n.entries)return null;for(let s=0;s<n.entries.length;s++){const i=n.entries[s];i.binding=i.binding||0,i.visibility=i.visibility||GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT}const r=JSON.stringify(n);for(let s=0;s<e.bindGroupLayouts.length;s++)if(e.bindGroupLayouts[s].sval===r)return e.bindGroupLayouts[s].layout;const a=e.handle.createBindGroupLayout(n);return e.bindGroupLayouts.push({sval:r,layout:a}),a},t.getBindGroupLayoutDescription=n=>{for(let r=0;r<e.bindGroupLayouts.length;r++)if(e.bindGroupLayouts[r].layout===n)return e.bindGroupLayouts[r].sval;return vtkErrorMacro("layout not found"),console.trace(),null},t.getPipeline=n=>n in e.pipelines?e.pipelines[n]:null,t.createPipeline=(n,r)=>{r.initialize(t,n),e.pipelines[n]=r},t.onSubmittedWorkDone=()=>e.handle.queue.onSubmittedWorkDone(),t.hasCachedObject=n=>e.objectCache.getValue(n),t.getCachedObject=function(n,r){if(!n)return vtkErrorMacro("attempt to cache an object without a hash"),null;const a=e.objectCache.getValue(n);if(a)return a;for(var s=arguments.length,i=new Array(s>2?s-2:0),o=2;o<s;o++)i[o-2]=arguments[o];const c=r(...i);return e.objectCache.setValue(n,c),c}}const OE={handle:null,pipelines:null,shaderCache:null,bindGroupLayouts:null,bufferManager:null,textureManager:null};function Vl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,OE,n),ye(t,e),le(t,e,["handle"]),Re(t,e,["bufferManager","shaderCache","textureManager"]),e.objectCache=new wE,e.shaderCache=H.newInstance(),e.shaderCache.setDevice(t),e.bindGroupLayouts=[],e.bufferManager=Rt.newInstance(),e.bufferManager.setDevice(t),e.textureManager=CE.newInstance(),e.textureManager.setDevice(t),e.pipelines={},EE(t,e)}const RE=Z(Vl,"vtkWebGPUDevice");var DE={newInstance:RE,extend:Vl};function ME(t,e){e.classHierarchy.push("vtkWebGPUHardwareSelectionPass"),t.traverse=(n,r)=>{if(e.deleted)return;e._currentParent=null,t.setCurrentOperation("buildPass"),n.traverse(t);const a=n.getDevice();if(e.selectionRenderEncoder)e.colorTexture.resize(n.getCanvas().width,n.getCanvas().height),e.depthTexture.resizeToMatch(e.colorTexture);else{t.createRenderEncoder(),e.colorTexture=Ie.newInstance({label:"hardwareSelectorColor"}),e.colorTexture.create(a,{width:n.getCanvas().width,height:n.getCanvas().height,format:"rgba32uint",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC});const s=e.colorTexture.createView("hardwareSelectColorTexture");e.selectionRenderEncoder.setColorTextureView(0,s),e.depthTexture=Ie.newInstance({label:"hardwareSelectorDepth"}),e.depthTexture.create(a,{width:n.getCanvas().width,height:n.getCanvas().height,format:"depth32float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC});const i=e.depthTexture.createView("hardwareSelectDepthTexture");e.selectionRenderEncoder.setDepthTextureView(i)}e.selectionRenderEncoder.attachTextureViews(),r.setRenderEncoder(e.selectionRenderEncoder),t.setCurrentOperation("cameraPass"),r.traverse(t),t.setCurrentOperation("opaquePass"),r.traverse(t)},t.createRenderEncoder=()=>{e.selectionRenderEncoder=it.newInstance({label:"HardwareSelectionPass"}),e.selectionRenderEncoder.setPipelineHash("sel"),e.selectionRenderEncoder.setReplaceShaderCodeFunction(r=>{const a=r.getShaderDescription("fragment");a.addOutput("vec4<u32>","outColor");let s=a.getCode();s=H.substitute(s,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<u32>(mapperUBO.PropID, compositeID, 0u, 0u);"]).result,a.setCode(s)});const n=e.selectionRenderEncoder.getDescription();n.colorAttachments[0].clearValue=[0,0,0,0],e.selectionRenderEncoder.setPipelineSettings({primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!0,depthCompare:"greater",format:"depth32float"},fragment:{targets:[{format:"rgba32uint",blend:void 0}]}})}}const LE={selectionRenderEncoder:null,colorTexture:null,depthTexture:null};function _l(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,LE,n),ct.extend(t,e,n),E.get(t,e,["colorTexture","depthTexture"]),ME(t,e)}const VE=E.newInstance(_l,"vtkWebGPUHardwareSelectionPass");var _E={newInstance:VE,extend:_l};const{SelectionContent:BE,SelectionField:xc}=ua,{FieldAssociations:Sc}=Kt,{vtkErrorMacro:Bl}=E;function FE(t){return`${t.propID} ${t.compositeID}`}function Cc(t,e,n,r){const a=((n.height-e-1)*n.colorBufferWidth+t)*4+r;return n.colorValues[a]}function mE(t,e,n,r){{if(r[0]=e[0],r[1]=e[1],e[0]<0||e[0]>=t.width||e[1]<0||e[1]>=t.height)return null;const a=Cc(e[0],e[1],t,0);if(a<=0)return null;const s={};s.propID=a;let i=Cc(e[0],e[1],t,1);if((i<0||i>16777215)&&(i=0),s.compositeID=i,t.captureZValues){const o=(t.height-e[1]-1)*t.zbufferBufferWidth+e[0];s.zValue=t.depthValues[o],s.zValue=t.webGPURenderer.convertToOpenGLDepth(s.zValue),s.displayPosition=e}return s}}function UE(t,e,n){const r=[];let a=0;return e.forEach((s,i)=>{const o=ua.newInstance();switch(o.setContentType(BE.INDICES),t){case Sc.FIELD_ASSOCIATION_CELLS:o.setFieldType(xc.CELL);break;case Sc.FIELD_ASSOCIATION_POINTS:o.setFieldType(xc.POINT);break;default:Bl("Unknown field association")}o.getProperties().propID=s.info.propID;const c=n.webGPURenderer.getPropFromID(s.info.propID);o.getProperties().prop=c.getRenderable(),o.getProperties().compositeID=s.info.compositeID,o.getProperties().pixelCount=s.pixelCount,n.captureZValues&&(o.getProperties().displayPosition=[s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue],o.getProperties().worldPosition=n.webGPURenderWindow.displayToWorld(s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue,n.renderer)),o.setSelectionList(s.attributeIDs),r[a]=o,a++}),r}function kE(t,e,n,r,a){const s=Math.floor(e),i=Math.floor(n),o=Math.floor(r),c=Math.floor(a),u=new Map,g=[0,0];for(let f=i;f<=c;f++)for(let l=s;l<=o;l++){const y=mE(t,[l,f],0,g);if(y){const h=FE(y);if(!u.has(h))u.set(h,{info:y,pixelCount:1,attributeIDs:[y.attributeID]});else{const v=u.get(h);v.pixelCount++,t.captureZValues&&y.zValue<v.info.zValue&&(v.info=y),v.attributeIDs.indexOf(y.attributeID)===-1&&v.attributeIDs.push(y.attributeID)}}}return UE(t.fieldAssociation,u,t)}function NE(t,e){e.classHierarchy.push("vtkWebGPUHardwareSelector"),t.endSelection=()=>{e.WebGPURenderer.setSelector(null)},t.getSourceDataAsync=async n=>{if(!n||!e._WebGPURenderWindow)return Bl("Renderer and view must be set before calling Select."),!1;e._WebGPURenderWindow.getRenderable().preRender(),e._WebGPURenderWindow.getInitialized()||(e._WebGPURenderWindow.initialize(),await new Promise(p=>{e._WebGPURenderWindow.onInitialized(p)}));const r=e._WebGPURenderWindow.getViewNodeFor(n);if(!r)return!1;const a=r.getSuppressClear();r.setSuppressClear(!0),e._selectionPass.traverse(e._WebGPURenderWindow,r),r.setSuppressClear(a);const s=e._WebGPURenderWindow.getDevice(),i=e._selectionPass.getColorTexture(),o=e._selectionPass.getDepthTexture(),c={area:[0,0,i.getWidth()-1,i.getHeight()-1],captureZValues:e.captureZValues,fieldAssociation:e.fieldAssociation,renderer:n,webGPURenderer:r,webGPURenderWindow:e._WebGPURenderWindow,width:i.getWidth(),height:i.getHeight()};c.colorBufferWidth=16*Math.floor((c.width+15)/16),c.colorBufferSizeInBytes=c.colorBufferWidth*c.height*4*4;const u=an.newInstance({label:"hardwareSelectColorBuffer"});u.setDevice(s),u.create(c.colorBufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);const g=e._WebGPURenderWindow.getCommandEncoder();g.copyTextureToBuffer({texture:i.getHandle()},{buffer:u.getHandle(),bytesPerRow:16*c.colorBufferWidth,rowsPerImage:c.height},{width:c.width,height:c.height,depthOrArrayLayers:1});let f;e.captureZValues&&(c.zbufferBufferWidth=64*Math.floor((c.width+63)/64),f=an.newInstance({label:"hardwareSelectDepthBuffer"}),f.setDevice(s),c.zbufferSizeInBytes=c.height*c.zbufferBufferWidth*4,f.create(c.zbufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST),g.copyTextureToBuffer({texture:o.getHandle(),aspect:"depth-only"},{buffer:f.getHandle(),bytesPerRow:4*c.zbufferBufferWidth,rowsPerImage:c.height},{width:c.width,height:c.height,depthOrArrayLayers:1})),s.submitCommandEncoder(g);const l=u.mapAsync(GPUMapMode.READ);if(e.captureZValues){const p=f.mapAsync(GPUMapMode.READ);await Promise.all([l,p]),c.depthValues=new Float32Array(f.getMappedRange().slice()),f.unmap()}else await l;return c.colorValues=new Uint32Array(u.getMappedRange().slice()),u.unmap(),c.generateSelection=(p,y,h,v)=>kE(c,p,y,h,v),c}}const GE={};function Fl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,GE,n),ol.extend(t,e,n),e._selectionPass=_E.newInstance(),E.setGet(t,e,["_WebGPURenderWindow"]),E.moveToProtected(t,e,["WebGPURenderWindow"]),NE(t,e)}const bE=E.newInstance(Fl,"vtkWebGPUHardwareSelector");var ml={newInstance:bE,extend:Fl};const{vtkErrorMacro:wc}=E,$E={position:"absolute",top:0,left:0,width:"100%",height:"100%"};function zE(t,e){e.classHierarchy.push("vtkWebGPURenderWindow"),t.getViewNodeFactory=()=>e.myFactory;const n=[0,0];function r(){e.renderable&&(e.size[0]!==n[0]||e.size[1]!==n[1])&&(n[0]=e.size[0],n[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1]),t.recreateSwapChain()),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(r),t.recreateSwapChain=()=>{e.context&&(e.context.unconfigure(),e.presentationFormat=navigator.gpu.getPreferredCanvasFormat(e.adapter),e.context.configure({device:e.device.getHandle(),format:e.presentationFormat,alphaMode:"premultiplied",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST,width:e.size[0],height:e.size[1]}),e._configured=!0)},t.getCurrentTexture=()=>e.context.getCurrentTexture(),t.buildPass=i=>{if(i){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.removeUnusedNodes(),t.initialize()}else e.initialized&&(e._configured||t.recreateSwapChain(),e.commandEncoder=e.device.createCommandEncoder())},t.initialize=()=>{if(!e.initializing){if(e.initializing=!0,!navigator.gpu){wc("WebGPU is not enabled.");return}t.create3DContextAsync().then(()=>{e.initialized=!0,!e.deleted&&t.invokeInitialized()})}},t.setContainer=i=>{e.el&&e.el!==i&&(e.canvas.parentNode!==e.el&&wc("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==i&&(e.el=i,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:i,height:o}=e.el.getBoundingClientRect();e.containerSize=[i,o]}return e.containerSize||e.size},t.getFramebufferSize=()=>e.size,t.create3DContextAsync=async()=>{if(e.adapter=await navigator.gpu.requestAdapter({powerPreference:"high-performance"}),!e.deleted){if(e.device=DE.newInstance(),e.device.initialize(await e.adapter.requestDevice()),e.deleted){e.device=null;return}e.context=e.canvas.getContext("webgpu")}},t.releaseGraphicsResources=()=>{const i=ct.newInstance();i.setCurrentOperation("Release"),i.traverse(t,null),e.adapter=null,e.device=null,e.context=null,e.initialized=!1,e.initializing=!1},t.setBackgroundImage=i=>{e.bgImage.src=i.src},t.setUseBackgroundImage=i=>{e.useBackgroundImage=i,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};async function a(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const o=document.createElement("canvas"),c=o.getContext("2d");o.width=e.canvas.width,o.height=e.canvas.height;const u=await t.getPixelsAsync(),g=new ImageData(u.colorValues,u.width,u.height);c.putImageData(g,0,0);const f=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(h=>{h.getViewProps().forEach(x=>{if(x.getContainer){const d=x.getContainer().getElementsByTagName("canvas");for(let T=0;T<d.length;T++){const w=d[T],C=w.getBoundingClientRect(),O=C.x-f.x,R=C.y-f.y;c.drawImage(w,O,R)}}})});const y=o.toDataURL(i);o.remove(),t.invokeImageReady(y)}t.captureNextImage=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:o=!1,size:c=null,scale:u=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=i;const g=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:c||u!==1?c||e.size.map(f=>f*u):null},new Promise((f,l)=>{const p=t.onImageReady(y=>{if(e._screenshot.size===null)e.notifyStartCaptureImage=g,p.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(h=>{let{restoreParamsFn:v,arg:x}=h;return v(x)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),f(y);else{const h=document.createElement("img");if(h.style=$E,h.src=y,e._screenshot.placeHolder=e.el.appendChild(h),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e._screenshot.size=null,t.modified(),o){const v=o!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(x=>{const S=x.getActiveCamera(),d=S.get("focalPoint","position","parallelScale");return{resetCameraArgs:v?{renderer:x}:void 0,resetCameraFn:v?o:x.resetCamera,restoreParamsFn:S.set,arg:JSON.parse(JSON.stringify(d))}}),e._screenshot.cameras.forEach(x=>{let{resetCameraFn:S,resetCameraArgs:d}=x;return S(d)})}t.traverseAllPasses()}})})},t.traverseAllPasses=()=>{if(!e.deleted)if(e.initialized){if(e.renderPasses)for(let i=0;i<e.renderPasses.length;++i)e.renderPasses[i].traverse(t,null);e.commandEncoder&&(e.device.submitCommandEncoder(e.commandEncoder),e.commandEncoder=null,e.notifyStartCaptureImage&&e.device.onSubmittedWorkDone().then(()=>{a()}))}else{t.initialize();const i=t.onInitialized(()=>{i.unsubscribe(),t.traverseAllPasses()})}},t.setViewStream=i=>{if(e.viewStream===i)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=i,e.viewStream){const o=e.renderable.getRenderers()[0];o.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(c=>t.setBackgroundImage(c.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.getUniquePropID=()=>e.nextPropID++,t.getPropFromID=i=>{for(let o=0;o<e.children.length;o++){const c=e.children[o].getPropFromID(i);if(c!==null)return c}return null},t.getPixelsAsync=async()=>{const i=e.device,o=e.renderPasses[0].getOpaquePass().getColorTexture(),c={width:o.getWidth(),height:o.getHeight()};c.colorBufferWidth=32*Math.floor((c.width+31)/32),c.colorBufferSizeInBytes=c.colorBufferWidth*c.height*8;const u=an.newInstance();u.setDevice(i),u.create(c.colorBufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);const g=e.device.createCommandEncoder();g.copyTextureToBuffer({texture:o.getHandle()},{buffer:u.getHandle(),bytesPerRow:8*c.colorBufferWidth,rowsPerImage:c.height},{width:c.width,height:c.height,depthOrArrayLayers:1}),i.submitCommandEncoder(g),await u.mapAsync(GPUMapMode.READ),c.colorValues=new Uint16Array(u.getMappedRange().slice()),u.unmap();const l=new Uint8ClampedArray(c.height*c.width*4);for(let p=0;p<c.height;p++)for(let y=0;y<c.width;y++){const h=(p*c.width+y)*4,v=(p*c.colorBufferWidth+y)*4;l[h]=255*ze.fromHalf(c.colorValues[v]),l[h+1]=255*ze.fromHalf(c.colorValues[v+1]),l[h+2]=255*ze.fromHalf(c.colorValues[v+2]),l[h+3]=255*ze.fromHalf(c.colorValues[v+3])}return c.colorValues=l,c},t.createSelector=()=>{const i=ml.newInstance();return i.setWebGPURenderWindow(t),i};const s=t.setSize;t.setSize=(i,o)=>{const c=s(i,o);return c&&t.invokeWindowResizeEvent({width:i,height:o}),c},t.delete=E.chain(t.delete,t.setViewStream)}const WE={initialized:!1,context:null,adapter:null,device:null,canvas:null,cursorVisibility:!0,cursor:"pointer",containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1,nextPropID:1,xrSupported:!1,presentationFormat:null};function HE(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,WE,n),e.canvas=document.createElement("canvas"),e.canvas.style.width="100%",e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",xl.extend(t,e,n),e.myFactory=ax.newInstance(),e.renderPasses[0]=dE.newInstance(),e.selector||(e.selector=ml.newInstance(),e.selector.setWebGPURenderWindow(t)),E.event(t,e,"imageReady"),E.event(t,e,"initialized"),E.get(t,e,["commandEncoder","device","presentationFormat","useBackgroundImage","xrSupported"]),E.setGet(t,e,["initialized","context","canvas","device","renderPasses","notifyStartCaptureImage","cursor","useOffScreen"]),E.setGetArray(t,e,["size"],2),E.event(t,e,"windowResizeEvent"),zE(t,e)}const Ul=E.newInstance(HE,"vtkWebGPURenderWindow");Ti("WebGPU",Ul);et("vtkRenderWindow",Ul);const AE=GC.extractURLParameters(),jE={margin:"0",padding:"0",position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden"},KE={position:"absolute",left:"25px",top:"25px",backgroundColor:"white",borderRadius:"5px",listStyle:"none",padding:"5px 10px",margin:"0",display:"block",border:"solid 1px black",maxWidth:"calc(100% - 70px)",maxHeight:"calc(100% - 60px)",overflow:"auto"};function Ec(t,e){Object.keys(e).forEach(n=>{t.style[n]=e[n]})}function PE(t,e){e.classHierarchy.push("vtkFullScreenRenderWindow");const n=document.querySelector("body");e.rootContainer||(e.rootContainer=n),e.container||(e.container=document.createElement("div"),Ec(e.container,e.containerStyle||jE),e.rootContainer.appendChild(e.container)),e.rootContainer===n&&(document.documentElement.style.height="100%",n.style.height="100%",n.style.padding="0",n.style.margin="0"),e.renderWindow=uC.newInstance(),e.renderer=Xg.newInstance(),e.renderWindow.addRenderer(e.renderer),e.apiSpecificRenderWindow=e.renderWindow.newAPISpecificView(AE.viewAPI??e.defaultViewAPI),e.apiSpecificRenderWindow.setContainer(e.container),e.renderWindow.addView(e.apiSpecificRenderWindow),e.interactor=Zg.newInstance(),e.interactor.setInteractorStyle(UC.newInstance()),e.interactor.setView(e.apiSpecificRenderWindow),e.interactor.initialize(),e.interactor.bindEvents(e.container),t.setBackground=e.renderer.setBackground,t.removeController=()=>{const a=e.controlContainer;a&&a.parentNode.removeChild(a)},t.setControllerVisibility=a=>{e.controllerVisibility=a,e.controlContainer&&(a?e.controlContainer.style.display="block":e.controlContainer.style.display="none")},t.toggleControllerVisibility=()=>{t.setControllerVisibility(!e.controllerVisibility)};function r(a){String.fromCharCode(a.charCode)==="c"&&t.toggleControllerVisibility()}t.addController=a=>{e.controlContainer=document.createElement("div"),Ec(e.controlContainer,e.controlPanelStyle||KE),e.rootContainer.appendChild(e.controlContainer),e.controlContainer.innerHTML=a,t.setControllerVisibility(e.controllerVisibility),e.rootContainer.addEventListener("keypress",r)},t.setBackground(...e.background),t.addRepresentation=a=>{a.getActors().forEach(s=>{e.renderer.addActor(s)})},t.removeRepresentation=a=>{a.getActors().forEach(s=>e.renderer.removeActor(s))},t.delete=E.chain(t.setContainer,e.apiSpecificRenderWindow.delete,()=>{var a;(a=e.rootContainer)==null||a.removeEventListener("keypress",r),window.removeEventListener("resize",t.resize)},t.delete),t.resize=()=>{const a=e.container.getBoundingClientRect(),s=window.devicePixelRatio||1;e.apiSpecificRenderWindow.setSize(Math.floor(a.width*s),Math.floor(a.height*s)),e.resizeCallback&&e.resizeCallback(a),e.renderWindow.render()},t.setResizeCallback=a=>{e.resizeCallback=a,t.resize()},e.listenWindowResize&&window.addEventListener("resize",t.resize),t.resize()}const XE={background:[.32,.34,.43],containerStyle:null,controlPanelStyle:null,listenWindowResize:!0,resizeCallback:null,controllerVisibility:!0};function kl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XE,n),E.obj(t,e),E.get(t,e,["renderWindow","renderer","apiSpecificRenderWindow","interactor","rootContainer","container","controlContainer"]),PE(t,e)}const YE=E.newInstance(kl);var qE={newInstance:YE,extend:kl};const IE=t=>t,Oc=1e-6;class Nl{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;this.matrix=A(new Float64Array(16)),this.tmp=new Float64Array(3),this.angleConv=e?Xl:IE}rotateFromDirections(e,n){const r=new Float64Array(3),a=new Float64Array(3),s=new Float64Array(16);Ye(r,e[0],e[1],e[2]),Ye(a,n[0],n[1],n[2]),Ct(r,r),Ct(a,a);const i=$s(r,a);return i>=1?this:(Jt(this.tmp,r,a),ls(this.tmp)<Oc&&(Jt(this.tmp,[1,0,0],e),ls(this.tmp)<Oc&&Jt(this.tmp,[0,1,0],e)),Bc(s,Math.acos(i),this.tmp),ge(this.matrix,this.matrix,s),this)}rotate(e,n){return Ye(this.tmp,...n),Ct(this.tmp,this.tmp),Ue(this.matrix,this.matrix,this.angleConv(e),this.tmp),this}rotateX(e){return Ns(this.matrix,this.matrix,this.angleConv(e)),this}rotateY(e){return Gs(this.matrix,this.matrix,this.angleConv(e)),this}rotateZ(e){return bs(this.matrix,this.matrix,this.angleConv(e)),this}translate(e,n,r){return Ye(this.tmp,e,n,r),oe(this.matrix,this.matrix,this.tmp),this}scale(e,n,r){return Ye(this.tmp,e,n,r),Ht(this.matrix,this.matrix,this.tmp),this}multiply(e){return ge(this.matrix,this.matrix,e),this}multiply3x3(e){return ge(this.matrix,this.matrix,[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]),this}invert(){return Oe(this.matrix,this.matrix),this}identity(){return A(this.matrix),this}apply(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;if(Bf(d1,this.matrix))return this;const a=r===-1?e.length:n+r*3;for(let s=n;s<a;s+=3)Ye(this.tmp,e[s],e[s+1],e[s+2]),q(this.tmp,this.tmp,this.matrix),e[s]=this.tmp[0],e[s+1]=this.tmp[1],e[s+2]=this.tmp[2];return this}getMatrix(){return this.matrix}setMatrix(e){return e&&e.length===16&&de(this.matrix,e),this}}function QE(){return new Nl(!0)}function ZE(){return new Nl(!1)}var st={buildFromDegree:QE,buildFromRadian:ZE};const{vtkErrorMacro:JE}=E;function eO(t,e){let n=0;return t.map((r,a)=>a===n?(n+=r+1,r):r+e)}function Tr(t,e,n,r){t.set(eO(e,n),r)}function tO(t,e){e.classHierarchy.push("vtkAppendPolyData"),t.requestData=(n,r)=>{const a=t.getNumberOfInputPorts();if(!a){JE("No input specified.");return}if(a===1){r[0]=n[0];return}const s=Be.newInstance();let i=0,o=0,c=1,u=1,g=0,f=0,l=0,p=0,y=!0,h=!0,v=!0;for(let M=0;M<a;M++){const V=n[M];if(!V)continue;const B=V.getPoints().getNumberOfPoints();i+=B,g+=V.getVerts().getNumberOfValues(),f+=V.getLines().getNumberOfValues(),l+=V.getStrips().getNumberOfValues(),p+=V.getPolys().getNumberOfValues(),B&&(u&&(u=0,o=V.getPoints().getDataType()),c=V.getPoints().getDataType(),o=o>c?o:c);const _=V.getPointData();_?(y=y&&_.getNormals()!==null,h=h&&_.getTCoords()!==null,v=v&&_.getScalars()!==null):(y=!1,h=!1,v=!1)}e.outputPointsPrecision===Kr.SINGLE?o=ce.FLOAT:e.outputPointsPrecision===Kr.DOUBLE&&(o=ce.DOUBLE);const x=nn.newInstance({dataType:o});x.setNumberOfPoints(i);const S=x.getData(),d=new Uint32Array(g),T=new Uint32Array(f),w=new Uint32Array(l),C=new Uint32Array(p);let O=null,R=null,L=null;const D=n[a-1];if(y){const M=D.getPointData().getNormals();O=Y.newInstance({numberOfComponents:3,numberOfTuples:i,size:3*i,dataType:M.getDataType(),name:M.getName()})}if(h){const M=D.getPointData().getTCoords();R=Y.newInstance({numberOfComponents:2,numberOfTuples:i,size:2*i,dataType:M.getDataType(),name:M.getName()})}if(v){const M=D.getPointData().getScalars();L=Y.newInstance({numberOfComponents:M.getNumberOfComponents(),numberOfTuples:i,size:i*M.getNumberOfComponents(),dataType:M.getDataType(),name:M.getName()})}i=0,g=0,f=0,l=0,p=0;for(let M=0;M<a;M++){const V=n[M];S.set(V.getPoints().getData(),i*3),Tr(d,V.getVerts().getData(),i,g),g+=V.getVerts().getNumberOfValues(),Tr(T,V.getLines().getData(),i,f),f+=V.getLines().getNumberOfValues(),Tr(w,V.getStrips().getData(),i,l),l+=V.getStrips().getNumberOfValues(),Tr(C,V.getPolys().getData(),i,p),p+=V.getPolys().getNumberOfValues();const B=V.getPointData();if(y){const _=B.getNormals();O.getData().set(_.getData(),i*3)}if(h){const _=B.getTCoords();R.getData().set(_.getData(),i*2)}if(v){const _=B.getScalars();L.getData().set(_.getData(),i*L.getNumberOfComponents())}i+=V.getPoints().getNumberOfPoints()}s.setPoints(x),s.getVerts().setData(d),s.getLines().setData(T),s.getStrips().setData(w),s.getPolys().setData(C),O&&s.getPointData().setNormals(O),R&&s.getPointData().setTCoords(R),L&&s.getPointData().setScalars(L),r[0]=s}}const nO={outputPointsPrecision:Kr.DEFAULT};function Gl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nO,n),E.setGet(t,e,["outputPointsPrecision"]),E.obj(t,e),E.algo(t,e,1,1),tO(t,e)}const rO=E.newInstance(Gl,"vtkAppendPolyData");var bl={newInstance:rO,extend:Gl};function aO(t,e){e.classHierarchy.push("vtkConeSource");function n(r,a){if(e.deleted)return;let s=a[0];const i=2*Math.PI/e.resolution,o=-e.height/2,c=e.resolution+1,u=4*e.resolution+1+e.resolution;let g=0;const f=E.newTypedArray(e.pointType,c*3);let l=0;const p=new Uint32Array(u);f[0]=e.height/2,f[1]=0,f[2]=0,e.capping&&(p[l++]=e.resolution);for(let y=0;y<e.resolution;y++)g++,f[g*3+0]=o,f[g*3+1]=e.radius*Math.cos(y*i),f[g*3+2]=e.radius*Math.sin(y*i),e.capping&&(p[e.resolution-l+++1]=g);for(let y=0;y<e.resolution;y++)p[l++]=3,p[l++]=0,p[l++]=y+1,p[l++]=y+2>e.resolution?1:y+2;st.buildFromRadian().translate(...e.center).rotateFromDirections([1,0,0],e.direction).apply(f),s=Be.newInstance(),s.getPoints().setData(f,3),s.getPolys().setData(p,1),a[0]=s}t.requestData=n}const sO={height:1,radius:.5,resolution:6,center:[0,0,0],direction:[1,0,0],capping:!0,pointType:"Float64Array"};function $l(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,sO,n),E.obj(t,e),E.setGet(t,e,["height","radius","resolution","capping"]),E.setGetArray(t,e,["center","direction"],3),E.algo(t,e,0,1),aO(t,e)}const iO=E.newInstance($l,"vtkConeSource");var oO={newInstance:iO,extend:$l};function cO(t,e){e.classHierarchy.push("vtkCylinderSource");function n(r,a){if(e.deleted)return;let s=a[0];const i=2*Math.PI/e.resolution;let o=2*e.resolution,c=5*e.resolution;e.capping&&(o=4*e.resolution,c=7*e.resolution+2);const u=E.newTypedArray(e.pointType,o*3);let g=0;const f=new Uint32Array(c),l=new Float32Array(o*3),p=Y.newInstance({numberOfComponents:3,values:l,name:"Normals"}),y=new Float32Array(o*2),h=Y.newInstance({numberOfComponents:2,values:y,name:"TCoords"}),v=[0,0,0],x=[0,0,0],S=[0,0,0],d=[0,0,0],T=[0,0],w=[0,0],C=e.otherRadius==null?e.radius:e.otherRadius;for(let O=0;O<e.resolution;O++){v[0]=Math.cos(O*i+e.initAngle),x[0]=v[0],S[0]=e.radius*v[0]+e.center[0],d[0]=S[0],T[0]=Math.abs(2*O/e.resolution-1),w[0]=T[0],S[1]=.5*e.height+e.center[1],d[1]=-.5*e.height+e.center[1],T[1]=0,w[1]=1,v[2]=-Math.sin(O*i+e.initAngle),x[2]=v[2],S[2]=C*v[2]+e.center[2],d[2]=S[2];const R=2*O;for(let L=0;L<3;L++)l[R*3+L]=v[L],l[(R+1)*3+L]=x[L],u[R*3+L]=S[L],u[(R+1)*3+L]=d[L],L<2&&(y[R*2+L]=T[L],y[(R+1)*2+L]=w[L])}for(let O=0;O<e.resolution;O++){f[g++]=4,f[g++]=2*O,f[g++]=2*O+1;const R=(2*O+3)%(2*e.resolution);f[g++]=R,f[g++]=R-1}if(e.capping){for(let O=0;O<e.resolution;O++){S[0]=e.radius*Math.cos(O*i+e.initAngle),d[0]=S[0],T[0]=S[0],w[0]=S[0],S[0]+=e.center[0],d[0]+=e.center[0],v[1]=1,x[1]=-1,S[1]=.5*e.height+e.center[1],d[1]=-.5*e.height+e.center[1],S[2]=-C*Math.sin(O*i+e.initAngle),d[2]=S[2],T[1]=S[2],w[1]=S[2],S[2]+=e.center[2],d[2]+=e.center[2];const R=2*e.resolution+O,L=3*e.resolution+e.resolution-O-1;for(let D=0;D<3;D++)l[3*R+D]=v[D],l[3*L+D]=x[D],u[3*R+D]=S[D],u[3*L+D]=d[D],D<2&&(y[2*R+D]=T[D],y[2*L+D]=w[D])}f[g++]=e.resolution;for(let O=0;O<e.resolution;O++)f[g++]=2*e.resolution+O;f[g++]=e.resolution;for(let O=0;O<e.resolution;O++)f[g++]=3*e.resolution+O}st.buildFromRadian().translate(...e.center).rotateFromDirections([0,1,0],e.direction).translate(...e.center.map(O=>O*-1)).apply(u),s=Be.newInstance(),s.getPoints().setData(u,3),s.getPolys().setData(f,1),s.getPointData().setNormals(p),s.getPointData().setTCoords(h),a[0]=s}t.requestData=n}const fO={height:1,initAngle:0,radius:1,resolution:6,center:[0,0,0],direction:[0,1,0],capping:!0,pointType:"Float64Array"};function zl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fO,n),E.obj(t,e),E.setGet(t,e,["height","initAngle","otherRadius","radius","resolution","capping"]),E.setGetArray(t,e,["center","direction"],3),E.algo(t,e,0,1),cO(t,e)}const uO=E.newInstance(zl,"vtkCylinderSource");var gO={newInstance:uO,extend:zl};function lO(t,e){e.classHierarchy.push("vtkArrowSource");function n(r,a){if(e.deleted)return;const s=gO.newInstance({capping:!0});s.setResolution(e.shaftResolution),s.setRadius(e.shaftRadius),s.setHeight(1-e.tipLength),s.setCenter(0,(1-e.tipLength)*.5,0);const i=s.getOutputData(),o=i.getPoints().getData(),c=i.getPointData().getNormals().getData();st.buildFromDegree().rotateZ(-90).apply(o).apply(c);const u=oO.newInstance();u.setResolution(e.tipResolution),u.setHeight(e.tipLength),u.setRadius(e.tipRadius);const g=u.getOutputData(),f=g.getPoints().getData();st.buildFromRadian().translate(1-e.tipLength*.5,0,0).apply(f);const l=bl.newInstance();l.setInputData(i),l.addInputData(g);const p=l.getOutputData(),y=p.getPoints().getData();st.buildFromRadian().translate(-.5+e.tipLength*.5,0,0).apply(y),e.invert?(st.buildFromRadian().rotateFromDirections([1,0,0],e.direction).scale(-1,-1,-1).apply(y),a[0]=p):(st.buildFromRadian().rotateFromDirections([1,0,0],e.direction).scale(1,1,1).apply(y),a[0]=l.getOutputData())}t.requestData=n}const pO={tipResolution:6,tipRadius:.1,tipLength:.35,shaftResolution:6,shaftRadius:.03,invert:!1,direction:[1,0,0],pointType:"Float64Array"};function Wl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,pO,n),E.obj(t,e),E.setGet(t,e,["tipResolution","tipRadius","tipLength","shaftResolution","shaftRadius","invert"]),E.setGetArray(t,e,["direction"],3),E.algo(t,e,0,1),lO(t,e)}const hO=E.newInstance(Wl,"vtkArrowSource");var as={newInstance:hO,extend:Wl};function ss(t){const e=t.getPoints().getBounds(),n=[-(e[0]+e[1])*.5,-(e[2]+e[3])*.5,-(e[4]+e[5])*.5];st.buildFromDegree().translate(...n).apply(t.getPoints().getData())}function is(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const r=t.getPoints().getBounds(),a=[0,0,0];n?a[e]=-r[e*2+1]:a[e]=-r[e*2],st.buildFromDegree().translate(...a).apply(t.getPoints().getData())}function os(t,e,n,r){const a=t.getPoints().getData().length,s=new Uint8ClampedArray(a);let i=0;for(;i<a;)s[i++]=e,s[i++]=n,s[i++]=r;t.getPointData().setScalars(Y.newInstance({name:"color",numberOfComponents:3,values:s}))}function vO(t,e){e.classHierarchy.push("vtkAxesActor");const n=Ze.newInstance();t.setMapper(n),t.update=()=>{let a={...e.config,...e.xConfig};const s=as.newInstance({direction:[1,0,0],...a}).getOutputData();e.config.recenter?ss(s):is(s,0,a.invert),os(s,...a.color),a={...e.config,...e.yConfig};const i=as.newInstance({direction:[0,1,0],...a}).getOutputData();e.config.recenter?ss(i):is(i,1,a.invert),os(i,...a.color),a={...e.config,...e.zConfig};const o=as.newInstance({direction:[0,0,1],...a}).getOutputData();e.config.recenter?ss(o):is(o,2,a.invert),os(o,...a.color);const c=bl.newInstance();c.setInputData(s),c.addInputData(i),c.addInputData(o),n.setInputConnection(c.getOutputPort())},t.update();const r=E.debounce(t.update,0);t.setXAxisColor=a=>t.setXConfig({...t.getXConfig(),color:a}),t.setYAxisColor=a=>t.setYConfig({...t.getYConfig(),color:a}),t.setZAxisColor=a=>t.setZConfig({...t.getZConfig(),color:a}),t.getXAxisColor=()=>e.getXConfig().color,t.getYAxisColor=()=>e.getYConfig().color,t.getZAxisColor=()=>e.getZConfig().color,e._onConfigChanged=r,e._onXConfigChanged=r,e._onYConfigChanged=r,e._onZConfigChanged=r}function yO(t){return{config:{recenter:!0,tipResolution:60,tipRadius:.1,tipLength:.2,shaftResolution:60,shaftRadius:.03,invert:!1,...t==null?void 0:t.config},xConfig:{color:[255,0,0],invert:!1,...t==null?void 0:t.xConfig},yConfig:{color:[255,255,0],invert:!1,...t==null?void 0:t.yConfig},zConfig:{color:[0,128,0],invert:!1,...t==null?void 0:t.zConfig}}}function Hl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Qe.extend(t,e,yO(n)),E.setGet(t,e,["config","xConfig","yConfig","zConfig"]),vO(t,e)}const dO=E.newInstance(Hl,"vtkAxesActor");var TO={newInstance:dO,extend:Hl};const xO={TOP_LEFT:"TOP_LEFT",TOP_RIGHT:"TOP_RIGHT",BOTTOM_LEFT:"BOTTOM_LEFT",BOTTOM_RIGHT:"BOTTOM_RIGHT"};var Ei={Corners:xO};const{vtkErrorMacro:cs}=E,{Corners:xr}=Ei;function SO(t,e){e.classHierarchy.push("vtkOrientationMarkerWidget");const n={...t},r=[],a=Xg.newInstance(),s=new ResizeObserver(l=>{t.updateViewport()});let i=null,o=null,c=null,u=null,g=null;function f(){e._interactor.isAnimating()||t.updateMarkerOrientation()}e._onParentRendererChanged=()=>t.updateViewport(),t.computeViewport=()=>{const l=e.parentRenderer||e._interactor.getCurrentRenderer(),[p,y,h,v]=l.getViewport(),x=e._interactor.getView(),S=x.getSize(),[d,T]=x.getViewportSize(l),w=Math.min(d,T);let C=e.viewportSize*w;C=Math.max(Math.min(e.minPixelSize,w),Math.min(e.maxPixelSize,C));const O=C/S[0],R=C/S[1];switch(e.viewportCorner){case xr.TOP_LEFT:return[p,v-R,p+O,v];case xr.TOP_RIGHT:return[h-O,v-R,h,v];case xr.BOTTOM_LEFT:return[p,y,p+O,y+R];case xr.BOTTOM_RIGHT:return[h-O,y,h,y+R];default:return cs("Invalid widget corner"),null}},t.updateViewport=()=>{e.enabled&&(a.setViewport(...t.computeViewport()),e._interactor.render())},t.updateMarkerOrientation=()=>{const p=(e.parentRenderer||e._interactor.getCurrentRenderer()).getActiveCamera();if(!p)return;const y=p.getReferenceByName("position"),h=p.getReferenceByName("focalPoint"),v=p.getReferenceByName("viewUp");if(r[0]!==y[0]||r[1]!==y[1]||r[2]!==y[2]||r[3]!==h[0]||r[4]!==h[1]||r[5]!==h[2]||r[6]!==v[0]||r[7]!==v[1]||r[8]!==v[2]){r[0]=y[0],r[1]=y[1],r[2]=y[2],r[3]=h[0],r[4]=h[1],r[5]=h[2],r[6]=v[0],r[7]=v[1],r[8]=v[2];const x=a.getActiveCamera();x.setPosition(y[0],y[1],y[2]),x.setFocalPoint(h[0],h[1],h[2]),x.setViewUp(v[0],v[1],v[2]),a.resetCamera()}},t.setEnabled=l=>{var p,y;if(l){if(e.enabled)return;if(!e.actor){cs("Must set actor before enabling orientation marker.");return}if(!e._interactor){cs("Must set interactor before enabling orientation marker.");return}const h=e.parentRenderer||e._interactor.getCurrentRenderer(),v=h.getRenderWindow();v.addRenderer(a),v.getNumberOfLayers()<2&&v.setNumberOfLayers(2),a.setLayer(v.getNumberOfLayers()-1),a.setInteractive(e.interactiveRenderer),a.addViewProp(e.actor),e.actor.setVisibility(!0),i=h.onEvent(x=>{x.type==="ActiveCameraEvent"&&(o&&o.unsubscribe(),o=x.camera.onModified(f))}),o=h.getActiveCamera().onModified(f),c=e._interactor.onAnimation(t.updateMarkerOrientation),u=e._interactor.onEndAnimation(t.updateMarkerOrientation),s.observe(e._interactor.getView().getCanvas()),t.updateViewport(),t.updateMarkerOrientation(),e.enabled=!0}else{if(!e.enabled)return;e.enabled=!1,s.disconnect(),i.unsubscribe(),i=null,o.unsubscribe(),o=null,c.unsubscribe(),c=null,u.unsubscribe(),u=null,e.actor.setVisibility(!1),a.removeViewProp(e.actor);const h=(y=(p=e._interactor)==null?void 0:p.findPokedRenderer())==null?void 0:y.getRenderWindow();h&&h.removeRenderer(a)}t.modified()},t.setViewportCorner=l=>{l!==e.viewportCorner&&(e.viewportCorner=l,t.updateViewport())},t.setViewportSize=l=>{const p=Math.min(1,Math.max(0,l));p!==e.viewportSize&&(e.viewportSize=p,t.updateViewport())},t.setActor=l=>{const p=e.enabled;t.setEnabled(!1),e.actor=l,t.setEnabled(p)},t.getRenderer=()=>a,t.delete=()=>{n.delete(),g&&(g.unsubscribe(),g=null),i&&(i.unsubscribe(),i=null),o&&(o.unsubscribe(),o=null),c&&(c.unsubscribe(),c=null),u&&(u.unsubscribe(),u=null),s.disconnect()},g=t.onModified(t.updateViewport)}const CO={viewportCorner:Ei.Corners.BOTTOM_LEFT,viewportSize:.2,minPixelSize:50,maxPixelSize:200,parentRenderer:null,interactiveRenderer:!1};function Al(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CO,n),E.obj(t,e),E.get(t,e,["enabled","viewportCorner","viewportSize","interactiveRenderer"]),E.setGet(t,e,["_interactor","minPixelSize","maxPixelSize","parentRenderer"]),E.get(t,e,["actor"]),E.moveToProtected(t,e,["interactor"]),SO(t,e)}const wO=E.newInstance(Al,"vtkOrientationMarkerWidget");var jl={newInstance:wO,extend:Al,...Ei};const Oi=qE.newInstance({rootContainer:document.getElementById("viewer-container")}),St=Oi.getRenderer();St.setBackground(.2,.2,.2,1);const Ee=Oi.getRenderWindow(),EO=TO.newInstance(),Hn=jl.newInstance({actor:EO,interactor:Ee.getInteractor()});Hn.setEnabled(!0);Hn.setViewportCorner(jl.Corners.BOTTOM_LEFT);Hn.setViewportSize(.05);Hn.setMinPixelSize(50);Hn.setMaxPixelSize(200);function OO(t,e,n,r){const a=document.querySelector(".vtk-container table");if(!a)return;const s=document.createElement("tr"),i=document.createElement("td"),o=document.createElement("canvas");o.width=40,o.height=10,o.classList.add("legend-line"),RO(o,e[0].getProperty().getColor()),i.appendChild(o),s.appendChild(i);const c=document.createElement("td"),u=document.createElement("label");u.innerHTML=`<input type="checkbox" class="${n}" checked /> ${t}`,c.appendChild(u),s.appendChild(c);const g=document.createElement("td"),f=document.createElement("input");f.type="range",f.min="0",f.max="1",f.step="0.1",f.value="1.0",f.id=r,g.appendChild(f),s.appendChild(g),a.appendChild(s);const l=document.querySelector(`.${n}`);l.addEventListener("change",()=>{e.forEach(p=>p.setVisibility(l.checked)),Ee.render()}),f.addEventListener("input",p=>{e.forEach(y=>y.getProperty().setOpacity(parseFloat(p.target.value))),Ee.render()})}function RO(t,e){const n=t.getContext("2d"),r=`rgb(${e.map(s=>s*255).join(",")})`;n.clearRect(0,0,t.width,t.height),n.strokeStyle=r,n.lineWidth=2,n.beginPath(),n.moveTo(5,t.height/2),n.lineTo(t.width-5,t.height/2),n.stroke(),n.fillStyle=r,[5,20,35].forEach(s=>{n.beginPath(),n.arc(s,t.height/2,2,0,2*Math.PI),n.fill()})}const on=_e.newInstance();on.setNormal(1,0,0);on.setOrigin(-13,0,0);const cn=_e.newInstance();cn.setNormal(-1,0,0);cn.setOrigin(7.5,0,0);const fn=_e.newInstance();fn.setNormal(0,1,0);fn.setOrigin(0,-2,0);const un=_e.newInstance();un.setNormal(0,-1,0);un.setOrigin(0,7,0);const gn=_e.newInstance();gn.setNormal(0,0,-1);gn.setOrigin(0,0,7);const ln=_e.newInstance();ln.setNormal(0,0,1);ln.setOrigin(0,0,-1.7);function DO(){const t=document.createElement("div");t.id="clip-plane-panel",t.className="clip-plane-panel",t.innerHTML=`
        <b>Clipping Planes</b>
        <br>
        <br>
        <label>Vertical Clip (L->R):</label>
        <input type="range" id="vertical-clip-slider" min="-13" max="7.5" step="0.01" value="-13">
        <br>
        <label>Vertical Clip (R->L):</label>
        <input type="range" id="vertical-clip-slider-2" min="-13" max="7.5" step="0.01" value="7.5">
        <br>
        <label>Horizontal Clip (B->T):</label>
        <input type="range" id="horizontal-clip-slider" min="-2" max="7" step="0.01" value="-2">
        <br>
        <label>Horizontal Clip (T->B):</label>
        <input type="range" id="horizontal-clip-slider-2" min="-2" max="7" step="0.01" value="7">
        <br>
        <label>Depth clip (N->F):</label>
        <input type="range" id="z-axis-clip-slider" min="-1.7" max="7" step="0.1" value="7">
        <br>
        <label>Depth clip (F->N):</label>
        <input type="range" id="z-axis-clip-slider-2" min="-1.7" max="7" step="0.01" value="-1.7">

    `,document.body.appendChild(t),document.getElementById("vertical-clip-slider").addEventListener("input",e=>{const n=parseFloat(e.target.value);on.setOrigin(n,0,0),Ee.render()}),document.getElementById("vertical-clip-slider-2").addEventListener("input",e=>{const n=parseFloat(e.target.value);cn.setOrigin(n,0,0),Ee.render()}),document.getElementById("horizontal-clip-slider").addEventListener("input",e=>{const n=parseFloat(e.target.value);fn.setOrigin(0,n,0),Ee.render()}),document.getElementById("horizontal-clip-slider-2").addEventListener("input",e=>{const n=parseFloat(e.target.value);un.setOrigin(0,n,0),Ee.render()}),document.getElementById("z-axis-clip-slider").addEventListener("input",e=>{const n=parseFloat(e.target.value);gn.setOrigin(0,0,n),Ee.render()}),document.getElementById("z-axis-clip-slider-2").addEventListener("input",e=>{const n=parseFloat(e.target.value);ln.setOrigin(0,0,n),Ee.render()})}const MO=`
<div style="
    overflow: visible;
  " class="vtk-container">
    <table>
        <tr>
            <td></td>
            <td><b>Toggle layers</b></td>
            <td><b>Set opacity</b></td>
        </tr>
        <tr>
            <td><div class="circular-box pointcloud-color"></div></td>
            <td><label><input type="checkbox" class="togglePointCloud" checked /> Point Cloud</label></td>
            <td><input type="range" id="opacity-slider-pointcloud" min="0" max="1" step="0.1" value="1.0"></td>
        </tr>
        <tr>
            <td><div class="legend-box mesh-color"></div></td>
            <td><label><input type="checkbox" class="toggleMesh" /> Boundary voxels</label></td>
            <td><input type="range" id="opacity-slider-mesh-voxels" min="0" max="1" step="0.1" value="0.1"></td>
        </tr>
        <tr>
            <td><div class="quadrant-box scanned-color"></div></td>
            <td><label><input type="checkbox" class="toggleScanned" /> Occupied voxels</label></td>
            <td><input type="range" id="opacity-slider-scanned" min="0" max="1" step="0.1" value="0.9"></td>
        </tr>
        <tr>
            <td><div class="legend-box voidvoxels-color"></div></td>
            <td><label><input type="checkbox" class="toggleVoidVoxels" /> Void voxels</label></td>
            <td><input type="range" id="opacity-slider-void-voxels" min="0" max="1" step="0.1" value="0.4"></td>
        </tr>
        <tr>
            <td><div class="legend-box unknownvoxels-color"></div></td>
            <td><label><input type="checkbox" class="toggleUnknownVoxels" /> Unseen voxels</label></td>
            <td><input type="range" id="opacity-slider-unknown-voxels" min="0" max="1" step="0.1" value="0.4"></td>
        </tr>
        <tr>
            <td><div class="legend-box buildinghull-color"></div></td>
            <td><label><input type="checkbox" class="toggleHull" /> Building hull</label></td>
            <td><input type="range" id="opacity-slider-building-hull" min="0" max="1" step="0.1" value="0.4"></td>
        </tr>
    </table>
</div>
`;let ea=0;function Kl(){ea===0&&(document.getElementById("loading-screen").style.display="flex"),ea++}function ta(){ea--,ea<=0&&(document.getElementById("loading-screen").style.display="none")}function dn(t,e,n,r,a=2,s=1,i=!0){Kl();const o=Ag.newInstance(),u=`/unscanned_areas.github.io/models/${t}`;o.setUrl(u).then(()=>{const g=o.getOutputData(),f=g.getBounds();console.log(`Model Extents for ${t}:`,f);const l=Ze.newInstance();l.addInputData(g),l.addClippingPlane(on),l.addClippingPlane(cn),l.addClippingPlane(fn),l.addClippingPlane(un),l.addClippingPlane(gn),l.addClippingPlane(ln);const p=Qe.newInstance();p.setMapper(l),p.getProperty().setOpacity(e),p.getProperty().setRepresentation(a),a===1&&p.getProperty().setLineWidth(s),p.setVisibility(i),St.addActor(p),St.resetCamera(),Ee.render();const y=document.querySelector(`.${n}`),h=document.getElementById(r);y&&(y.checked=i,y.addEventListener("change",()=>{p.setVisibility(y.checked),Ee.render()})),h&&h.addEventListener("input",v=>{p.getProperty().setOpacity(parseFloat(v.target.value)),Ee.render()}),ta(),setTimeout(()=>{St.resetCamera(),Ee.render()},100)}).catch(g=>{console.error(`Error loading ${t}:`,g),ta(),document.getElementById("loading-screen").innerHTML="<p> Error loading model</p>"})}function LO(t,e=2,n=[1,1,1],r=5,a=[1,0,0],s=!0){Kl();const o=`/unscanned_areas.github.io/models/${t}`,c=Ag.newInstance();c.setUrl(o).then(()=>{const u=c.getOutputData(),g=nn.newInstance(),f=u.getPoints().getData();for(let O=0;O<f.length;O+=3)g.insertNextPoint(f[O],f[O+1],f[O+2]);const l=Yr.newInstance(),p=g.getNumberOfPoints(),y=new Uint16Array(p+1);y[0]=p;for(let O=0;O<p;O++)y[O+1]=O;l.setData(y);const h=Be.newInstance();h.setPoints(g),h.setLines(l);const v=Ze.newInstance();v.setInputData(h),v.addClippingPlane(on),v.addClippingPlane(cn),v.addClippingPlane(fn),v.addClippingPlane(un),v.addClippingPlane(gn),v.addClippingPlane(ln);const x=Qe.newInstance();x.setMapper(v),x.getProperty().setColor(...n),x.getProperty().setLineWidth(e),x.setVisibility(s);const S=Yr.newInstance(),d=new Uint16Array(p*2);for(let O=0;O<p;O++)d[O*2]=1,d[O*2+1]=O;S.setData(d);const T=Be.newInstance();T.setPoints(g),T.setVerts(S);const w=Ze.newInstance();w.setInputData(T),w.addClippingPlane(on),w.addClippingPlane(cn),w.addClippingPlane(fn),w.addClippingPlane(un),w.addClippingPlane(gn),w.addClippingPlane(ln);const C=Qe.newInstance();C.setMapper(w),C.getProperty().setColor(...a),C.getProperty().setRepresentation(0),C.getProperty().setPointSize(r),C.setVisibility(s),St.addActor(x),St.addActor(C),St.resetCamera(),Ee.render(),OO("Camera trajectory",[x,C],"toggleLinePoints","opacity-slider-linepoints"),ta(),setTimeout(()=>{St.resetCamera(),Ee.render()},100)}).catch(u=>{console.error("Error loading PLY file:",u),ta(),document.getElementById("loading-screen").innerHTML="<p> Error loading model</p>"})}Oi.addController(MO);setTimeout(()=>{const t=document.querySelectorAll("#viewer-container > div"),e=t[t.length-1];e&&(document.body.appendChild(e),e.classList.add("control-panel"),e.style.position="fixed",e.style.top="10%",e.style.left="0px",e.style.background="rgba(92, 92, 92, 0.29)",e.style.padding="1%",e.style.borderRadius="0 2% 2% 0",e.style.boxShadow="4px 4px 12px rgba(0, 0, 0, 0.5)",e.style.zIndex="900",e.style.width="16%",e.style.maxWidth="300px",e.style.color="white",e.style.fontSize="90%")},100);dn("pointcloud2.ply",1,"togglePointCloud","opacity-slider-pointcloud",0,0,!0);dn("Scanned.ply",.9,"toggleScanned","opacity-slider-scanned",2,0,!1);dn("mesh.ply",.1,"toggleMesh","opacity-slider-mesh-voxels",2,0,!1);dn("Seen.ply",.4,"toggleVoidVoxels","opacity-slider-void-voxels",2,0,!1);dn("Unknown.ply",.4,"toggleUnknownVoxels","opacity-slider-unknown-voxels",2,0,!1);dn("hull_new.ply",.4,"toggleHull","opacity-slider-building-hull",2,0,!1);LO("camera_line.ply",1,[1,1,1],3,[1,0,0]);DO();document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector(".collapsible-btn"),e=document.querySelector(".collapsible-container");t.addEventListener("click",()=>{e.classList.toggle("open")})});
