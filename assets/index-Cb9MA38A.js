(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=r(a);fetch(a.href,s)}})();var P=1e-6,he=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function ec(){var t=new he(9);return he!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function hs(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function ll(t){var e=new he(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function pl(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function hl(t,e,r,n,a,s,i,o,c){var u=new he(9);return u[0]=t,u[1]=e,u[2]=r,u[3]=n,u[4]=a,u[5]=s,u[6]=i,u[7]=o,u[8]=c,u}function vl(t,e,r,n,a,s,i,o,c,u){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=s,t[5]=i,t[6]=o,t[7]=c,t[8]=u,t}function Gt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function tc(t,e){if(t===e){var r=e[1],n=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function vs(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=e[4],o=e[5],c=e[6],u=e[7],g=e[8],f=g*i-o*u,l=-g*s+o*c,p=u*s-i*c,y=r*f+n*l+a*p;return y?(y=1/y,t[0]=f*y,t[1]=(-g*n+a*u)*y,t[2]=(o*n-a*i)*y,t[3]=l*y,t[4]=(g*r-a*c)*y,t[5]=(-o*r+a*s)*y,t[6]=p*y,t[7]=(-u*r+n*c)*y,t[8]=(i*r-n*s)*y,t):null}function yl(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=e[4],o=e[5],c=e[6],u=e[7],g=e[8];return t[0]=i*g-o*u,t[1]=a*u-n*g,t[2]=n*o-a*i,t[3]=o*c-s*g,t[4]=r*g-a*c,t[5]=a*s-r*o,t[6]=s*u-i*c,t[7]=n*c-r*u,t[8]=r*i-n*s,t}function dl(t){var e=t[0],r=t[1],n=t[2],a=t[3],s=t[4],i=t[5],o=t[6],c=t[7],u=t[8];return e*(u*s-i*c)+r*(-u*a+i*o)+n*(c*a-s*o)}function rc(t,e,r){var n=e[0],a=e[1],s=e[2],i=e[3],o=e[4],c=e[5],u=e[6],g=e[7],f=e[8],l=r[0],p=r[1],y=r[2],h=r[3],v=r[4],x=r[5],S=r[6],d=r[7],T=r[8];return t[0]=l*n+p*i+y*u,t[1]=l*a+p*o+y*g,t[2]=l*s+p*c+y*f,t[3]=h*n+v*i+x*u,t[4]=h*a+v*o+x*g,t[5]=h*s+v*c+x*f,t[6]=S*n+d*i+T*u,t[7]=S*a+d*o+T*g,t[8]=S*s+d*c+T*f,t}function Tl(t,e,r){var n=e[0],a=e[1],s=e[2],i=e[3],o=e[4],c=e[5],u=e[6],g=e[7],f=e[8],l=r[0],p=r[1];return t[0]=n,t[1]=a,t[2]=s,t[3]=i,t[4]=o,t[5]=c,t[6]=l*n+p*i+u,t[7]=l*a+p*o+g,t[8]=l*s+p*c+f,t}function xl(t,e,r){var n=e[0],a=e[1],s=e[2],i=e[3],o=e[4],c=e[5],u=e[6],g=e[7],f=e[8],l=Math.sin(r),p=Math.cos(r);return t[0]=p*n+l*i,t[1]=p*a+l*o,t[2]=p*s+l*c,t[3]=p*i-l*n,t[4]=p*o-l*a,t[5]=p*c-l*s,t[6]=u,t[7]=g,t[8]=f,t}function Sl(t,e,r){var n=r[0],a=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Cl(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function wl(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function El(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Ol(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Rl(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=r+r,o=n+n,c=a+a,u=r*i,g=n*i,f=n*o,l=a*i,p=a*o,y=a*c,h=s*i,v=s*o,x=s*c;return t[0]=1-f-y,t[3]=g-x,t[6]=l+v,t[1]=g+x,t[4]=1-u-y,t[7]=p-h,t[2]=l-v,t[5]=p+h,t[8]=1-u-f,t}function Ml(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=e[4],o=e[5],c=e[6],u=e[7],g=e[8],f=e[9],l=e[10],p=e[11],y=e[12],h=e[13],v=e[14],x=e[15],S=r*o-n*i,d=r*c-a*i,T=r*u-s*i,w=n*c-a*o,C=n*u-s*o,O=a*u-s*c,R=g*h-f*y,L=g*v-l*y,M=g*x-p*y,D=f*v-l*h,V=f*x-p*h,B=l*x-p*v,_=S*B-d*V+T*D+w*M-C*L+O*R;return _?(_=1/_,t[0]=(o*B-c*V+u*D)*_,t[1]=(c*M-i*B-u*L)*_,t[2]=(i*V-o*M+u*R)*_,t[3]=(a*V-n*B-s*D)*_,t[4]=(r*B-a*M+s*L)*_,t[5]=(n*M-r*V-s*R)*_,t[6]=(h*O-v*C+x*w)*_,t[7]=(v*T-y*O-x*d)*_,t[8]=(y*C-h*T+x*S)*_,t):null}function Dl(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Ll(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Vl(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function _l(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function nc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function Bl(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function Fl(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function Ul(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function ml(t,e){var r=t[0],n=t[1],a=t[2],s=t[3],i=t[4],o=t[5],c=t[6],u=t[7],g=t[8],f=e[0],l=e[1],p=e[2],y=e[3],h=e[4],v=e[5],x=e[6],S=e[7],d=e[8];return Math.abs(r-f)<=P*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-l)<=P*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-p)<=P*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-y)<=P*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(i-h)<=P*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-v)<=P*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(c-x)<=P*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(u-S)<=P*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(g-d)<=P*Math.max(1,Math.abs(g),Math.abs(d))}var kl=rc,Nl=nc;const Gl=Object.freeze(Object.defineProperty({__proto__:null,add:_l,adjoint:yl,clone:ll,copy:pl,create:ec,determinant:dl,equals:ml,exactEquals:Ul,frob:Vl,fromMat2d:Ol,fromMat4:hs,fromQuat:Rl,fromRotation:wl,fromScaling:El,fromTranslation:Cl,fromValues:hl,identity:Gt,invert:vs,mul:kl,multiply:rc,multiplyScalar:Bl,multiplyScalarAndAdd:Fl,normalFromMat4:Ml,projection:Dl,rotate:xl,scale:Sl,set:vl,str:Ll,sub:Nl,subtract:nc,translate:Tl,transpose:tc},Symbol.toStringTag,{value:"Module"}));function ys(){var t=new he(16);return he!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function bl(t){var e=new he(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ye(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function $l(t,e,r,n,a,s,i,o,c,u,g,f,l,p,y,h){var v=new he(16);return v[0]=t,v[1]=e,v[2]=r,v[3]=n,v[4]=a,v[5]=s,v[6]=i,v[7]=o,v[8]=c,v[9]=u,v[10]=g,v[11]=f,v[12]=l,v[13]=p,v[14]=y,v[15]=h,v}function Wl(t,e,r,n,a,s,i,o,c,u,g,f,l,p,y,h,v){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=s,t[5]=i,t[6]=o,t[7]=c,t[8]=u,t[9]=g,t[10]=f,t[11]=l,t[12]=p,t[13]=y,t[14]=h,t[15]=v,t}function j(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function te(t,e){if(t===e){var r=e[1],n=e[2],a=e[3],s=e[6],i=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=s,t[11]=e[14],t[12]=a,t[13]=i,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Re(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=e[4],o=e[5],c=e[6],u=e[7],g=e[8],f=e[9],l=e[10],p=e[11],y=e[12],h=e[13],v=e[14],x=e[15],S=r*o-n*i,d=r*c-a*i,T=r*u-s*i,w=n*c-a*o,C=n*u-s*o,O=a*u-s*c,R=g*h-f*y,L=g*v-l*y,M=g*x-p*y,D=f*v-l*h,V=f*x-p*h,B=l*x-p*v,_=S*B-d*V+T*D+w*M-C*L+O*R;return _?(_=1/_,t[0]=(o*B-c*V+u*D)*_,t[1]=(a*V-n*B-s*D)*_,t[2]=(h*O-v*C+x*w)*_,t[3]=(l*C-f*O-p*w)*_,t[4]=(c*M-i*B-u*L)*_,t[5]=(r*B-a*M+s*L)*_,t[6]=(v*T-y*O-x*d)*_,t[7]=(g*O-l*T+p*d)*_,t[8]=(i*V-o*M+u*R)*_,t[9]=(n*M-r*V-s*R)*_,t[10]=(y*C-h*T+x*S)*_,t[11]=(f*T-g*C-p*S)*_,t[12]=(o*L-i*D-c*R)*_,t[13]=(r*D-n*L+a*R)*_,t[14]=(h*d-y*w-v*S)*_,t[15]=(g*w-f*d+l*S)*_,t):null}function zl(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=e[4],o=e[5],c=e[6],u=e[7],g=e[8],f=e[9],l=e[10],p=e[11],y=e[12],h=e[13],v=e[14],x=e[15];return t[0]=o*(l*x-p*v)-f*(c*x-u*v)+h*(c*p-u*l),t[1]=-(n*(l*x-p*v)-f*(a*x-s*v)+h*(a*p-s*l)),t[2]=n*(c*x-u*v)-o*(a*x-s*v)+h*(a*u-s*c),t[3]=-(n*(c*p-u*l)-o*(a*p-s*l)+f*(a*u-s*c)),t[4]=-(i*(l*x-p*v)-g*(c*x-u*v)+y*(c*p-u*l)),t[5]=r*(l*x-p*v)-g*(a*x-s*v)+y*(a*p-s*l),t[6]=-(r*(c*x-u*v)-i*(a*x-s*v)+y*(a*u-s*c)),t[7]=r*(c*p-u*l)-i*(a*p-s*l)+g*(a*u-s*c),t[8]=i*(f*x-p*h)-g*(o*x-u*h)+y*(o*p-u*f),t[9]=-(r*(f*x-p*h)-g*(n*x-s*h)+y*(n*p-s*f)),t[10]=r*(o*x-u*h)-i*(n*x-s*h)+y*(n*u-s*o),t[11]=-(r*(o*p-u*f)-i*(n*p-s*f)+g*(n*u-s*o)),t[12]=-(i*(f*v-l*h)-g*(o*v-c*h)+y*(o*l-c*f)),t[13]=r*(f*v-l*h)-g*(n*v-a*h)+y*(n*l-a*f),t[14]=-(r*(o*v-c*h)-i*(n*v-a*h)+y*(n*c-a*o)),t[15]=r*(o*l-c*f)-i*(n*l-a*f)+g*(n*c-a*o),t}function Hl(t){var e=t[0],r=t[1],n=t[2],a=t[3],s=t[4],i=t[5],o=t[6],c=t[7],u=t[8],g=t[9],f=t[10],l=t[11],p=t[12],y=t[13],h=t[14],v=t[15],x=e*i-r*s,S=e*o-n*s,d=e*c-a*s,T=r*o-n*i,w=r*c-a*i,C=n*c-a*o,O=u*y-g*p,R=u*h-f*p,L=u*v-l*p,M=g*h-f*y,D=g*v-l*y,V=f*v-l*h;return x*V-S*D+d*M+T*L-w*R+C*O}function de(t,e,r){var n=e[0],a=e[1],s=e[2],i=e[3],o=e[4],c=e[5],u=e[6],g=e[7],f=e[8],l=e[9],p=e[10],y=e[11],h=e[12],v=e[13],x=e[14],S=e[15],d=r[0],T=r[1],w=r[2],C=r[3];return t[0]=d*n+T*o+w*f+C*h,t[1]=d*a+T*c+w*l+C*v,t[2]=d*s+T*u+w*p+C*x,t[3]=d*i+T*g+w*y+C*S,d=r[4],T=r[5],w=r[6],C=r[7],t[4]=d*n+T*o+w*f+C*h,t[5]=d*a+T*c+w*l+C*v,t[6]=d*s+T*u+w*p+C*x,t[7]=d*i+T*g+w*y+C*S,d=r[8],T=r[9],w=r[10],C=r[11],t[8]=d*n+T*o+w*f+C*h,t[9]=d*a+T*c+w*l+C*v,t[10]=d*s+T*u+w*p+C*x,t[11]=d*i+T*g+w*y+C*S,d=r[12],T=r[13],w=r[14],C=r[15],t[12]=d*n+T*o+w*f+C*h,t[13]=d*a+T*c+w*l+C*v,t[14]=d*s+T*u+w*p+C*x,t[15]=d*i+T*g+w*y+C*S,t}function oe(t,e,r){var n=r[0],a=r[1],s=r[2],i,o,c,u,g,f,l,p,y,h,v,x;return e===t?(t[12]=e[0]*n+e[4]*a+e[8]*s+e[12],t[13]=e[1]*n+e[5]*a+e[9]*s+e[13],t[14]=e[2]*n+e[6]*a+e[10]*s+e[14],t[15]=e[3]*n+e[7]*a+e[11]*s+e[15]):(i=e[0],o=e[1],c=e[2],u=e[3],g=e[4],f=e[5],l=e[6],p=e[7],y=e[8],h=e[9],v=e[10],x=e[11],t[0]=i,t[1]=o,t[2]=c,t[3]=u,t[4]=g,t[5]=f,t[6]=l,t[7]=p,t[8]=y,t[9]=h,t[10]=v,t[11]=x,t[12]=i*n+g*a+y*s+e[12],t[13]=o*n+f*a+h*s+e[13],t[14]=c*n+l*a+v*s+e[14],t[15]=u*n+p*a+x*s+e[15]),t}function qt(t,e,r){var n=r[0],a=r[1],s=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ze(t,e,r,n){var a=n[0],s=n[1],i=n[2],o=Math.hypot(a,s,i),c,u,g,f,l,p,y,h,v,x,S,d,T,w,C,O,R,L,M,D,V,B,_,k;return o<P?null:(o=1/o,a*=o,s*=o,i*=o,c=Math.sin(r),u=Math.cos(r),g=1-u,f=e[0],l=e[1],p=e[2],y=e[3],h=e[4],v=e[5],x=e[6],S=e[7],d=e[8],T=e[9],w=e[10],C=e[11],O=a*a*g+u,R=s*a*g+i*c,L=i*a*g-s*c,M=a*s*g-i*c,D=s*s*g+u,V=i*s*g+a*c,B=a*i*g+s*c,_=s*i*g-a*c,k=i*i*g+u,t[0]=f*O+h*R+d*L,t[1]=l*O+v*R+T*L,t[2]=p*O+x*R+w*L,t[3]=y*O+S*R+C*L,t[4]=f*M+h*D+d*V,t[5]=l*M+v*D+T*V,t[6]=p*M+x*D+w*V,t[7]=y*M+S*D+C*V,t[8]=f*B+h*_+d*k,t[9]=l*B+v*_+T*k,t[10]=p*B+x*_+w*k,t[11]=y*B+S*_+C*k,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ac(t,e,r){var n=Math.sin(r),a=Math.cos(r),s=e[4],i=e[5],o=e[6],c=e[7],u=e[8],g=e[9],f=e[10],l=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*a+u*n,t[5]=i*a+g*n,t[6]=o*a+f*n,t[7]=c*a+l*n,t[8]=u*a-s*n,t[9]=g*a-i*n,t[10]=f*a-o*n,t[11]=l*a-c*n,t}function sc(t,e,r){var n=Math.sin(r),a=Math.cos(r),s=e[0],i=e[1],o=e[2],c=e[3],u=e[8],g=e[9],f=e[10],l=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*a-u*n,t[1]=i*a-g*n,t[2]=o*a-f*n,t[3]=c*a-l*n,t[8]=s*n+u*a,t[9]=i*n+g*a,t[10]=o*n+f*a,t[11]=c*n+l*a,t}function ic(t,e,r){var n=Math.sin(r),a=Math.cos(r),s=e[0],i=e[1],o=e[2],c=e[3],u=e[4],g=e[5],f=e[6],l=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*a+u*n,t[1]=i*a+g*n,t[2]=o*a+f*n,t[3]=c*a+l*n,t[4]=u*a-s*n,t[5]=g*a-i*n,t[6]=f*a-o*n,t[7]=l*a-c*n,t}function oc(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function cc(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Al(t,e,r){var n=r[0],a=r[1],s=r[2],i=Math.hypot(n,a,s),o,c,u;return i<P?null:(i=1/i,n*=i,a*=i,s*=i,o=Math.sin(e),c=Math.cos(e),u=1-c,t[0]=n*n*u+c,t[1]=a*n*u+s*o,t[2]=s*n*u-a*o,t[3]=0,t[4]=n*a*u-s*o,t[5]=a*a*u+c,t[6]=s*a*u+n*o,t[7]=0,t[8]=n*s*u+a*o,t[9]=a*s*u-n*o,t[10]=s*s*u+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function jl(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Kl(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Xl(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fc(t,e,r){var n=e[0],a=e[1],s=e[2],i=e[3],o=n+n,c=a+a,u=s+s,g=n*o,f=n*c,l=n*u,p=a*c,y=a*u,h=s*u,v=i*o,x=i*c,S=i*u;return t[0]=1-(p+h),t[1]=f+S,t[2]=l-x,t[3]=0,t[4]=f-S,t[5]=1-(g+h),t[6]=y+v,t[7]=0,t[8]=l+x,t[9]=y-v,t[10]=1-(g+p),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Pl(t,e){var r=new he(3),n=-e[0],a=-e[1],s=-e[2],i=e[3],o=e[4],c=e[5],u=e[6],g=e[7],f=n*n+a*a+s*s+i*i;return f>0?(r[0]=(o*i+g*n+c*s-u*a)*2/f,r[1]=(c*i+g*a+u*n-o*s)*2/f,r[2]=(u*i+g*s+o*a-c*n)*2/f):(r[0]=(o*i+g*n+c*s-u*a)*2,r[1]=(c*i+g*a+u*n-o*s)*2,r[2]=(u*i+g*s+o*a-c*n)*2),fc(t,e,r),t}function Yl(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function uc(t,e){var r=e[0],n=e[1],a=e[2],s=e[4],i=e[5],o=e[6],c=e[8],u=e[9],g=e[10];return t[0]=Math.hypot(r,n,a),t[1]=Math.hypot(s,i,o),t[2]=Math.hypot(c,u,g),t}function Ka(t,e){var r=new he(3);uc(r,e);var n=1/r[0],a=1/r[1],s=1/r[2],i=e[0]*n,o=e[1]*a,c=e[2]*s,u=e[4]*n,g=e[5]*a,f=e[6]*s,l=e[8]*n,p=e[9]*a,y=e[10]*s,h=i+g+y,v=0;return h>0?(v=Math.sqrt(h+1)*2,t[3]=.25*v,t[0]=(f-p)/v,t[1]=(l-c)/v,t[2]=(o-u)/v):i>g&&i>y?(v=Math.sqrt(1+i-g-y)*2,t[3]=(f-p)/v,t[0]=.25*v,t[1]=(o+u)/v,t[2]=(l+c)/v):g>y?(v=Math.sqrt(1+g-i-y)*2,t[3]=(l-c)/v,t[0]=(o+u)/v,t[1]=.25*v,t[2]=(f+p)/v):(v=Math.sqrt(1+y-i-g)*2,t[3]=(o-u)/v,t[0]=(l+c)/v,t[1]=(f+p)/v,t[2]=.25*v),t}function gc(t,e,r,n){var a=e[0],s=e[1],i=e[2],o=e[3],c=a+a,u=s+s,g=i+i,f=a*c,l=a*u,p=a*g,y=s*u,h=s*g,v=i*g,x=o*c,S=o*u,d=o*g,T=n[0],w=n[1],C=n[2];return t[0]=(1-(y+v))*T,t[1]=(l+d)*T,t[2]=(p-S)*T,t[3]=0,t[4]=(l-d)*w,t[5]=(1-(f+v))*w,t[6]=(h+x)*w,t[7]=0,t[8]=(p+S)*C,t[9]=(h-x)*C,t[10]=(1-(f+y))*C,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function ql(t,e,r,n,a){var s=e[0],i=e[1],o=e[2],c=e[3],u=s+s,g=i+i,f=o+o,l=s*u,p=s*g,y=s*f,h=i*g,v=i*f,x=o*f,S=c*u,d=c*g,T=c*f,w=n[0],C=n[1],O=n[2],R=a[0],L=a[1],M=a[2],D=(1-(h+x))*w,V=(p+T)*w,B=(y-d)*w,_=(p-T)*C,k=(1-(l+x))*C,G=(v+S)*C,b=(y+d)*O,Y=(v-S)*O,U=(1-(l+h))*O;return t[0]=D,t[1]=V,t[2]=B,t[3]=0,t[4]=_,t[5]=k,t[6]=G,t[7]=0,t[8]=b,t[9]=Y,t[10]=U,t[11]=0,t[12]=r[0]+R-(D*R+_*L+b*M),t[13]=r[1]+L-(V*R+k*L+Y*M),t[14]=r[2]+M-(B*R+G*L+U*M),t[15]=1,t}function Cn(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=r+r,o=n+n,c=a+a,u=r*i,g=n*i,f=n*o,l=a*i,p=a*o,y=a*c,h=s*i,v=s*o,x=s*c;return t[0]=1-f-y,t[1]=g+x,t[2]=l-v,t[3]=0,t[4]=g-x,t[5]=1-u-y,t[6]=p+h,t[7]=0,t[8]=l+v,t[9]=p-h,t[10]=1-u-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Il(t,e,r,n,a,s,i){var o=1/(r-e),c=1/(a-n),u=1/(s-i);return t[0]=s*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*c,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(a+n)*c,t[10]=(i+s)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=i*s*2*u,t[15]=0,t}function lc(t,e,r,n,a){var s=1/Math.tan(e/2),i;return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(i=1/(n-a),t[10]=(a+n)*i,t[14]=2*a*n*i):(t[10]=-1,t[14]=-2*n),t}var Ql=lc;function Zl(t,e,r,n,a){var s=1/Math.tan(e/2),i;return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(i=1/(n-a),t[10]=a*i,t[14]=a*n*i):(t[10]=-1,t[14]=-n),t}function Jl(t,e,r,n){var a=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),i=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),c=2/(i+o),u=2/(a+s);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((i-o)*c*.5),t[9]=(a-s)*u*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function pc(t,e,r,n,a,s,i){var o=1/(e-r),c=1/(n-a),u=1/(s-i);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*o,t[13]=(a+n)*c,t[14]=(i+s)*u,t[15]=1,t}var hc=pc;function e0(t,e,r,n,a,s,i){var o=1/(e-r),c=1/(n-a),u=1/(s-i);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=u,t[11]=0,t[12]=(e+r)*o,t[13]=(a+n)*c,t[14]=s*u,t[15]=1,t}function vc(t,e,r,n){var a,s,i,o,c,u,g,f,l,p,y=e[0],h=e[1],v=e[2],x=n[0],S=n[1],d=n[2],T=r[0],w=r[1],C=r[2];return Math.abs(y-T)<P&&Math.abs(h-w)<P&&Math.abs(v-C)<P?j(t):(g=y-T,f=h-w,l=v-C,p=1/Math.hypot(g,f,l),g*=p,f*=p,l*=p,a=S*l-d*f,s=d*g-x*l,i=x*f-S*g,p=Math.hypot(a,s,i),p?(p=1/p,a*=p,s*=p,i*=p):(a=0,s=0,i=0),o=f*i-l*s,c=l*a-g*i,u=g*s-f*a,p=Math.hypot(o,c,u),p?(p=1/p,o*=p,c*=p,u*=p):(o=0,c=0,u=0),t[0]=a,t[1]=o,t[2]=g,t[3]=0,t[4]=s,t[5]=c,t[6]=f,t[7]=0,t[8]=i,t[9]=u,t[10]=l,t[11]=0,t[12]=-(a*y+s*h+i*v),t[13]=-(o*y+c*h+u*v),t[14]=-(g*y+f*h+l*v),t[15]=1,t)}function t0(t,e,r,n){var a=e[0],s=e[1],i=e[2],o=n[0],c=n[1],u=n[2],g=a-r[0],f=s-r[1],l=i-r[2],p=g*g+f*f+l*l;p>0&&(p=1/Math.sqrt(p),g*=p,f*=p,l*=p);var y=c*l-u*f,h=u*g-o*l,v=o*f-c*g;return p=y*y+h*h+v*v,p>0&&(p=1/Math.sqrt(p),y*=p,h*=p,v*=p),t[0]=y,t[1]=h,t[2]=v,t[3]=0,t[4]=f*v-l*h,t[5]=l*y-g*v,t[6]=g*h-f*y,t[7]=0,t[8]=g,t[9]=f,t[10]=l,t[11]=0,t[12]=a,t[13]=s,t[14]=i,t[15]=1,t}function r0(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function n0(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function a0(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function yc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function s0(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function i0(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function o0(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function c0(t,e){var r=t[0],n=t[1],a=t[2],s=t[3],i=t[4],o=t[5],c=t[6],u=t[7],g=t[8],f=t[9],l=t[10],p=t[11],y=t[12],h=t[13],v=t[14],x=t[15],S=e[0],d=e[1],T=e[2],w=e[3],C=e[4],O=e[5],R=e[6],L=e[7],M=e[8],D=e[9],V=e[10],B=e[11],_=e[12],k=e[13],G=e[14],b=e[15];return Math.abs(r-S)<=P*Math.max(1,Math.abs(r),Math.abs(S))&&Math.abs(n-d)<=P*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-T)<=P*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(s-w)<=P*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(i-C)<=P*Math.max(1,Math.abs(i),Math.abs(C))&&Math.abs(o-O)<=P*Math.max(1,Math.abs(o),Math.abs(O))&&Math.abs(c-R)<=P*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(u-L)<=P*Math.max(1,Math.abs(u),Math.abs(L))&&Math.abs(g-M)<=P*Math.max(1,Math.abs(g),Math.abs(M))&&Math.abs(f-D)<=P*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(l-V)<=P*Math.max(1,Math.abs(l),Math.abs(V))&&Math.abs(p-B)<=P*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(y-_)<=P*Math.max(1,Math.abs(y),Math.abs(_))&&Math.abs(h-k)<=P*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(v-G)<=P*Math.max(1,Math.abs(v),Math.abs(G))&&Math.abs(x-b)<=P*Math.max(1,Math.abs(x),Math.abs(b))}var Xa=de,f0=yc;const Pa=Object.freeze(Object.defineProperty({__proto__:null,add:a0,adjoint:zl,clone:bl,copy:ye,create:ys,determinant:Hl,equals:c0,exactEquals:o0,frob:n0,fromQuat:Cn,fromQuat2:Pl,fromRotation:Al,fromRotationTranslation:fc,fromRotationTranslationScale:gc,fromRotationTranslationScaleOrigin:ql,fromScaling:cc,fromTranslation:oc,fromValues:$l,fromXRotation:jl,fromYRotation:Kl,fromZRotation:Xl,frustum:Il,getRotation:Ka,getScaling:uc,getTranslation:Yl,identity:j,invert:Re,lookAt:vc,mul:Xa,multiply:de,multiplyScalar:s0,multiplyScalarAndAdd:i0,ortho:hc,orthoNO:pc,orthoZO:e0,perspective:Ql,perspectiveFromFieldOfView:Jl,perspectiveNO:lc,perspectiveZO:Zl,rotate:ze,rotateX:ac,rotateY:sc,rotateZ:ic,scale:qt,set:Wl,str:r0,sub:f0,subtract:yc,targetTo:t0,translate:oe,transpose:te},Symbol.toStringTag,{value:"Module"}));function dc(){var t=new he(3);return he!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function u0(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function ti(t,e,r){var n=new he(3);return n[0]=t,n[1]=e,n[2]=r,n}function wn(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function lr(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function vt(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function ut(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function g0(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function xr(t,e){var r=e[0],n=e[1],a=e[2],s=r*r+n*n+a*a;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function Tc(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Jn(t,e,r){var n=e[0],a=e[1],s=e[2],i=r[0],o=r[1],c=r[2];return t[0]=a*c-s*o,t[1]=s*i-n*c,t[2]=n*o-a*i,t}function I(t,e,r){var n=e[0],a=e[1],s=e[2],i=r[3]*n+r[7]*a+r[11]*s+r[15];return i=i||1,t[0]=(r[0]*n+r[4]*a+r[8]*s+r[12])/i,t[1]=(r[1]*n+r[5]*a+r[9]*s+r[13])/i,t[2]=(r[2]*n+r[6]*a+r[10]*s+r[14])/i,t}function ri(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function ni(t,e){var r=t[0],n=t[1],a=t[2],s=e[0],i=e[1],o=e[2];return Math.abs(r-s)<=P*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-i)<=P*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(a-o)<=P*Math.max(1,Math.abs(a),Math.abs(o))}var Ya=vt,xc=u0;(function(){var t=dc();return function(e,r,n,a,s,i){var o,c;for(r||(r=3),n||(n=0),a?c=Math.min(a*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],s(t,t,i),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();function l0(){var t=new he(4);return he!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function p0(t,e,r,n){var a=new he(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a}function h0(t,e){var r=e[0],n=e[1],a=e[2],s=e[3],i=r*r+n*n+a*a+s*s;return i>0&&(i=1/Math.sqrt(i)),t[0]=r*i,t[1]=n*i,t[2]=a*i,t[3]=s*i,t}function mr(t,e,r){var n=e[0],a=e[1],s=e[2],i=e[3];return t[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*i,t[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*i,t[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*i,t[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*i,t}(function(){var t=l0();return function(e,r,n,a,s,i){var o,c;for(r||(r=4),n||(n=0),a?c=Math.min(a*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],s(t,t,i),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}})();function Nt(){var t=new he(4);return he!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function ds(t,e,r){r=r*.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function v0(t,e){var r=Math.acos(e[3])*2,n=Math.sin(r/2);return n>P?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function ai(t,e,r){var n=e[0],a=e[1],s=e[2],i=e[3],o=r[0],c=r[1],u=r[2],g=r[3];return t[0]=n*g+i*o+a*u-s*c,t[1]=a*g+i*c+s*o-n*u,t[2]=s*g+i*u+n*c-a*o,t[3]=i*g-n*o-a*c-s*u,t}function cn(t,e,r,n){var a=e[0],s=e[1],i=e[2],o=e[3],c=r[0],u=r[1],g=r[2],f=r[3],l,p,y,h,v;return p=a*c+s*u+i*g+o*f,p<0&&(p=-p,c=-c,u=-u,g=-g,f=-f),1-p>P?(l=Math.acos(p),y=Math.sin(l),h=Math.sin((1-n)*l)/y,v=Math.sin(n*l)/y):(h=1-n,v=n),t[0]=h*a+v*c,t[1]=h*s+v*u,t[2]=h*i+v*g,t[3]=h*o+v*f,t}function y0(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function d0(t,e){var r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[a*3+a]&&(a=2);var s=(a+1)%3,i=(a+2)%3;n=Math.sqrt(e[a*3+a]-e[s*3+s]-e[i*3+i]+1),t[a]=.5*n,n=.5/n,t[3]=(e[s*3+i]-e[i*3+s])*n,t[s]=(e[s*3+a]+e[a*3+s])*n,t[i]=(e[i*3+a]+e[a*3+i])*n}return t}var si=p0,Sc=h0;(function(){var t=dc(),e=ti(1,0,0),r=ti(0,1,0);return function(n,a,s){var i=Tc(a,s);return i<-.999999?(Jn(t,e,a),xc(t)<1e-6&&Jn(t,r,a),xr(t,t),ds(n,t,Math.PI),n):i>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Jn(t,a,s),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+i,Sc(n,n))}})();(function(){var t=Nt(),e=Nt();return function(r,n,a,s,i,o){return cn(t,n,i,o),cn(e,a,s,o),cn(r,t,e,2*o*(1-o)),r}})();(function(){var t=ec();return function(e,r,n,a){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=a[0],t[4]=a[1],t[7]=a[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],Sc(e,d0(e,t))}})();var or=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ts(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function T0(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}),r}var ea,ii;function x0(){return ii||(ii=1,ea=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var n,a,s;if(Array.isArray(e)){if(n=e.length,n!=r.length)return!1;for(a=n;a--!==0;)if(!t(e[a],r[a]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(r).length)return!1;for(a=n;a--!==0;)if(!Object.prototype.hasOwnProperty.call(r,s[a]))return!1;for(a=n;a--!==0;){var i=s[a];if(!t(e[i],r[i]))return!1}return!0}return e!==e&&r!==r}),ea}var S0=x0();const C0=Ts(S0);var ta,oi;function Cc(){if(oi)return ta;oi=1;var t=Object.prototype.toString;return ta=function(r){var n=t.call(r),a=n==="[object Arguments]";return a||(a=n!=="[object Array]"&&r!==null&&typeof r=="object"&&typeof r.length=="number"&&r.length>=0&&t.call(r.callee)==="[object Function]"),a},ta}var ra,ci;function w0(){if(ci)return ra;ci=1;var t;if(!Object.keys){var e=Object.prototype.hasOwnProperty,r=Object.prototype.toString,n=Cc(),a=Object.prototype.propertyIsEnumerable,s=!a.call({toString:null},"toString"),i=a.call(function(){},"prototype"),o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(l){var p=l.constructor;return p&&p.prototype===l},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},g=function(){if(typeof window>"u")return!1;for(var l in window)try{if(!u["$"+l]&&e.call(window,l)&&window[l]!==null&&typeof window[l]=="object")try{c(window[l])}catch{return!0}}catch{return!0}return!1}(),f=function(l){if(typeof window>"u"||!g)return c(l);try{return c(l)}catch{return!1}};t=function(p){var y=p!==null&&typeof p=="object",h=r.call(p)==="[object Function]",v=n(p),x=y&&r.call(p)==="[object String]",S=[];if(!y&&!h&&!v)throw new TypeError("Object.keys called on a non-object");var d=i&&h;if(x&&p.length>0&&!e.call(p,0))for(var T=0;T<p.length;++T)S.push(String(T));if(v&&p.length>0)for(var w=0;w<p.length;++w)S.push(String(w));else for(var C in p)!(d&&C==="prototype")&&e.call(p,C)&&S.push(String(C));if(s)for(var O=f(p),R=0;R<o.length;++R)!(O&&o[R]==="constructor")&&e.call(p,o[R])&&S.push(o[R]);return S}}return ra=t,ra}var na,fi;function E0(){if(fi)return na;fi=1;var t=Array.prototype.slice,e=Cc(),r=Object.keys,n=r?function(i){return r(i)}:w0(),a=Object.keys;return n.shim=function(){if(Object.keys){var i=function(){var o=Object.keys(arguments);return o&&o.length===arguments.length}(1,2);i||(Object.keys=function(c){return e(c)?a(t.call(c)):a(c)})}else Object.keys=n;return Object.keys||n},na=n,na}var aa,ui;function wc(){if(ui)return aa;ui=1;var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return aa=t,aa}var sa,gi;function O0(){return gi||(gi=1,sa=SyntaxError),sa}var ia,li;function R0(){return li||(li=1,ia=TypeError),ia}var oa,pi;function M0(){return pi||(pi=1,oa=Object.getOwnPropertyDescriptor),oa}var ca,hi;function D0(){if(hi)return ca;hi=1;var t=M0();if(t)try{t([],"length")}catch{t=null}return ca=t,ca}var fa,vi;function L0(){if(vi)return fa;vi=1;var t=wc(),e=O0(),r=R0(),n=D0();return fa=function(s,i,o){if(!s||typeof s!="object"&&typeof s!="function")throw new r("`obj` must be an object or a function`");if(typeof i!="string"&&typeof i!="symbol")throw new r("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new r("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new r("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new r("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new r("`loose`, if provided, must be a boolean");var c=arguments.length>3?arguments[3]:null,u=arguments.length>4?arguments[4]:null,g=arguments.length>5?arguments[5]:null,f=arguments.length>6?arguments[6]:!1,l=!!n&&n(s,i);if(t)t(s,i,{configurable:g===null&&l?l.configurable:!g,enumerable:c===null&&l?l.enumerable:!c,value:o,writable:u===null&&l?l.writable:!u});else if(f||!c&&!u&&!g)s[i]=o;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},fa}var ua,yi;function V0(){if(yi)return ua;yi=1;var t=wc(),e=function(){return!!t};return e.hasArrayLengthDefineBug=function(){if(!t)return null;try{return t([],"length",{value:1}).length!==1}catch{return!0}},ua=e,ua}var ga,di;function Ec(){if(di)return ga;di=1;var t=E0(),e=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",r=Object.prototype.toString,n=Array.prototype.concat,a=L0(),s=function(u){return typeof u=="function"&&r.call(u)==="[object Function]"},i=V0()(),o=function(u,g,f,l){if(g in u){if(l===!0){if(u[g]===f)return}else if(!s(l)||!l())return}i?a(u,g,f,!0):a(u,g,f)},c=function(u,g){var f=arguments.length>2?arguments[2]:{},l=t(g);e&&(l=n.call(l,Object.getOwnPropertySymbols(g)));for(var p=0;p<l.length;p+=1)o(u,l[p],g[l[p]],f[l[p]])};return c.supportsDescriptors=!!i,ga=c,ga}var cr={exports:{}},Ti;function Oc(){return Ti||(Ti=1,typeof self<"u"?cr.exports=self:typeof window<"u"?cr.exports=window:cr.exports=Function("return this")()),cr.exports}var la,xi;function Rc(){if(xi)return la;xi=1;var t=Oc();return la=function(){return typeof or!="object"||!or||or.Math!==Math||or.Array!==Array?t:or},la}var pa,Si;function _0(){if(Si)return pa;Si=1;var t=Ec(),e=Rc();return pa=function(){var n=e();if(t.supportsDescriptors){var a=Object.getOwnPropertyDescriptor(n,"globalThis");(!a||a.configurable&&(a.enumerable||!a.writable||globalThis!==n))&&Object.defineProperty(n,"globalThis",{configurable:!0,enumerable:!1,value:n,writable:!0})}else(typeof globalThis!="object"||globalThis!==n)&&(n.globalThis=n);return n},pa}var ha,Ci;function B0(){if(Ci)return ha;Ci=1;var t=Ec(),e=Oc(),r=Rc(),n=_0(),a=r(),s=function(){return a};return t(s,{getPolyfill:r,implementation:e,shim:n}),ha=s,ha}var F0=B0();const U0=Ts(F0),Ue=U0(),Mc={vtkObject:()=>null};function Ge(t){if(t==null||t.isA)return t;if(!t.vtkClass)return Ue.console&&Ue.console.error&&Ue.console.error("Invalid VTK object"),null;const e=Mc[t.vtkClass];if(!e)return Ue.console&&Ue.console.error&&Ue.console.error(`No vtk class found for Object of type ${t.vtkClass}`),null;const r={...t};Object.keys(r).forEach(a=>{r[a]&&typeof r[a]=="object"&&r[a].vtkClass&&(r[a]=Ge(r[a]))});const n=e(r);return n&&n.modified&&n.modified(),n}function m0(t,e){Mc[t]=e}Ge.register=m0;class va extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}}let qa=0;const Dc=Symbol("void");function k0(){return qa}const Lc={};function Vt(){}const N0=["log","debug","info","warn","error","time","timeEnd","group","groupEnd"];N0.forEach(t=>{Lc[t]=Vt});Ue.console=console.hasOwnProperty("log")?console:Lc;const dt={debug:Vt,error:Ue.console.error||Vt,info:Ue.console.info||Vt,log:Ue.console.log||Vt,warn:Ue.console.warn||Vt};function Vc(t,e){dt[t]&&(dt[t]=e||Vt)}function _c(){dt.log(...arguments)}function Bc(){dt.info(...arguments)}function En(){dt.debug(...arguments)}function A(){dt.error(...arguments)}function Hn(){dt.warn(...arguments)}const wi={};function Fc(t){wi[t]||(dt.error(t),wi[t]=!0)}const Te=Object.create(null);Te.Float32Array=Float32Array;Te.Float64Array=Float64Array;Te.Uint8Array=Uint8Array;Te.Int8Array=Int8Array;Te.Uint16Array=Uint16Array;Te.Int16Array=Int16Array;Te.Uint32Array=Uint32Array;Te.Int32Array=Int32Array;Te.Uint8ClampedArray=Uint8ClampedArray;try{Te.BigInt64Array=BigInt64Array,Te.BigUint64Array=BigUint64Array}catch{}function tr(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return new(Te[t]||Float64Array)(...r)}function xs(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return(Te[t]||Float64Array).from(...r)}function An(t){return t.charAt(0).toUpperCase()+t.slice(1)}function ne(t){return An(t[0]==="_"?t.slice(1):t)}function Uc(t){return t.charAt(0).toLowerCase()+t.slice(1)}function mc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e3;const n=["TB","GB","MB","KB"];let a=Number(t),s="B";for(;a>r;)a/=r,s=n.pop();return`${a.toFixed(e)} ${s}`}function kc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:" ";const r=[];let n=t;for(;n>1e3;)r.push(`000${n%1e3}`.slice(-3)),n=Math.floor(n/1e3);return n>0&&r.push(n),r.reverse(),r.join(e)}function Nc(t){Object.keys(t).forEach(e=>{Array.isArray(t[e])&&(t[e]=[].concat(t[e]))})}function G0(t){return Object.values(Te).some(e=>t instanceof e)}function b0(t,e){if(t===e)return!0;if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}return!1}function $0(t,e){return Object.keys(t).find(r=>t[r]===e)}function Gc(t){return t&&t.isA?t.getState():t}function Ss(t){setTimeout(t,0)}function bc(t,e){const r=performance.now();t.finally(()=>{const n=performance.now()-r;e(n)})}function ve(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Nc(e);const r=[];if(Number.isInteger(e.mtime)||(e.mtime=++qa),!("classHierarchy"in e))e.classHierarchy=new va("vtkObject");else if(!(e.classHierarchy instanceof va)){const s=new va;for(let i=0;i<e.classHierarchy.length;i++)s.push(e.classHierarchy[i]);e.classHierarchy=s}function n(s){r[s]=null}function a(s){function i(){n(s)}return Object.freeze({unsubscribe:i})}return t.isDeleted=()=>!!e.deleted,t.modified=s=>{if(e.deleted){A("instance deleted - cannot call any method");return}s&&s<t.getMTime()||(e.mtime=++qa,r.forEach(i=>i&&i(t)))},t.onModified=s=>{if(e.deleted)return A("instance deleted - cannot call any method"),null;const i=r.length;return r.push(s),a(i)},t.getMTime=()=>e.mtime,t.isA=s=>{let i=e.classHierarchy.length;for(;i--;)if(e.classHierarchy[i]===s)return!0;return!1},t.getClassName=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.classHierarchy[e.classHierarchy.length-1-s]},t.set=function(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=!1;return Object.keys(s).forEach(u=>{const g=o?null:t[`set${An(u)}`];g&&Array.isArray(s[u])&&g.length>1?c=g(...s[u])||c:g?c=g(s[u])||c:(["mtime"].indexOf(u)===-1&&!i&&Hn(`Warning: Set value to model directly ${u}, ${s[u]}`),c=e[u]!==s[u]||c,e[u]=s[u])}),c},t.get=function(){for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];if(!i.length)return e;const c={};return i.forEach(u=>{c[u]=e[u]}),c},t.getReferenceByName=s=>e[s],t.delete=()=>{Object.keys(e).forEach(s=>delete e[s]),r.forEach((s,i)=>n(i)),e.deleted=!0},t.getState=()=>{if(e.deleted)return null;const s={...e,vtkClass:t.getClassName()};Object.keys(s).forEach(o=>{s[o]===null||s[o]===void 0||o[0]==="_"?delete s[o]:s[o].isA?s[o]=s[o].getState():Array.isArray(s[o])?s[o]=s[o].map(Gc):G0(s[o])&&(s[o]=Array.from(s[o]))});const i={};return Object.keys(s).sort().forEach(o=>{i[o]=s[o]}),i.mtime&&delete i.mtime,i},t.shallowCopy=function(s){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(s.getClassName()!==t.getClassName())throw new Error(`Cannot ShallowCopy ${s.getClassName()} into ${t.getClassName()}`);const o=s.get(),c=Object.keys(e).sort();Object.keys(o).sort().forEach(g=>{const f=c.indexOf(g);f===-1?i&&En(`add ${g} in shallowCopy`):c.splice(f,1),e[g]=o[g]}),c.length&&i&&En(`Untouched keys: ${c.join(", ")}`),t.modified()},t.toJSON=function(){return t.getState()},t}const W0={object(t,e,r){return function(){return{...e[r.name]}}}};function Ee(t,e,r){r.forEach(n=>{if(typeof n=="object"){const a=W0[n.type];a?t[`get${ne(n.name)}`]=a(t,e,n):t[`get${ne(n.name)}`]=()=>e[n.name]}else t[`get${ne(n)}`]=()=>e[n]})}const $c={enum(t,e,r){const n=`_on${ne(r.name)}Changed`;return a=>{var s;if(typeof a=="string"){if(r.enum[a]!==void 0)return e[r.name]!==r.enum[a]?(e[r.name]=r.enum[a],t.modified(),!0):!1;throw A(`Set Enum with invalid argument ${r}, ${a}`),new RangeError("Set Enum with invalid string argument")}if(typeof a=="number"){if(e[r.name]!==a){if(Object.keys(r.enum).map(i=>r.enum[i]).indexOf(a)!==-1){const i=e[r.name];return e[r.name]=a,(s=e[n])==null||s.call(e,t,e,a,i),t.modified(),!0}throw A(`Set Enum outside numeric range ${r}, ${a}`),new RangeError("Set Enum outside numeric range")}return!1}throw A(`Set Enum with invalid argument (String/Number) ${r}, ${a}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(t,e,r){var a;((a=r.params)==null?void 0:a.length)===1&&Hn('Setter of type "object" with a single "param" field is not supported');const n=`_on${ne(r.name)}Changed`;return function(){var u,g;for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];let c;if(i.length>1&&((u=r.params)!=null&&u.length)?c=r.params.reduce((f,l,p)=>Object.assign(f,{[l]:i[p]}),{}):c=i[0],!C0(e[r.name],c)){const f=e[r.name];return e[r.name]=c,(g=e[n])==null||g.call(e,t,e,c,f),t.modified(),!0}return!1}}};function Ei(t){if(typeof t=="object"){const e=$c[t.type];if(e)return(r,n)=>e(r,n,t);throw A(`No setter for field ${t}`),new TypeError("No setter for field")}return function(r,n){const a=`_on${ne(t)}Changed`;return function(i){var o;if(n.deleted)return A("instance deleted - cannot call any method"),!1;if(n[t]!==i){const c=n[t.name];return n[t]=i,(o=n[a])==null||o.call(n,r,n,i,c),r.modified(),!0}return!1}}}function Dr(t,e,r){r.forEach(n=>{typeof n=="object"?t[`set${ne(n.name)}`]=Ei(n)(t,e):t[`set${ne(n)}`]=Ei(n)(t,e)})}function ue(t,e,r){Ee(t,e,r),Dr(t,e,r)}function rr(t,e,r){r.forEach(n=>{t[`get${ne(n)}`]=()=>e[n]?Array.from(e[n]):e[n],t[`get${ne(n)}ByReference`]=()=>e[n]})}function Cs(t,e,r,n){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;r.forEach(s=>{if(e[s]&&n&&e[s].length!==n)throw new RangeError(`Invalid initial number of values for array (${s})`);const i=`_on${ne(s)}Changed`;t[`set${ne(s)}`]=function(){var p;if(e.deleted)return A("instance deleted - cannot call any method"),!1;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];let g=c,f,l=!1;if(g.length===1&&(g[0]==null||g[0].length>=0)&&(g=g[0],l=!0),g==null)f=e[s]!==g;else{if(n&&g.length!==n)if(g.length<n&&a!==void 0)for(g=Array.from(g),l=!1;g.length<n;)g.push(a);else throw new RangeError(`Invalid number of values for array setter (${s})`);f=e[s]==null||e[s].length!==g.length;for(let y=0;!f&&y<g.length;++y)f=e[s][y]!==g[y];f&&l&&(g=Array.from(g))}if(f){const y=e[s.name];e[s]=g,(p=e[i])==null||p.call(e,t,e,g,y),t.modified()}return f},t[`set${ne(s)}From`]=o=>{const c=e[s];o.forEach((u,g)=>{c[g]=u})}})}function ws(t,e,r,n){let a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:void 0;rr(t,e,r),Cs(t,e,r,n,a)}function Lr(t,e,r){for(let n=0;n<r.length;n++){const a=r[n];e[a]!==void 0&&(e[`_${a}`]=e[a],delete e[a])}}function Wc(t,e,r,n){e.inputData?e.inputData=e.inputData.map(Ge):e.inputData=[],e.inputConnection?e.inputConnection=e.inputConnection.map(Ge):e.inputConnection=[],e.output?e.output=e.output.map(Ge):e.output=[],e.inputArrayToProcess?e.inputArrayToProcess=e.inputArrayToProcess.map(Ge):e.inputArrayToProcess=[],e.numberOfInputs=r;function a(p){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){A("instance deleted - cannot call any method");return}if(y>=e.numberOfInputs){A(`algorithm ${t.getClassName()} only has ${e.numberOfInputs} input ports. To add more input ports, use addInputData()`);return}(e.inputData[y]!==p||e.inputConnection[y])&&(e.inputData[y]=p,e.inputConnection[y]=null,t.modified&&t.modified())}function s(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[p]&&(e.inputData[p]=e.inputConnection[p]()),e.inputData[p]}function i(p){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(e.deleted){A("instance deleted - cannot call any method");return}if(y>=e.numberOfInputs){let h=`algorithm ${t.getClassName()} only has `;h+=`${e.numberOfInputs}`,h+=" input ports. To add more input ports, use addInputConnection()",A(h);return}e.inputData[y]=null,e.inputConnection[y]=p}function o(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.inputConnection[p]}function c(){let p=e.numberOfInputs;for(;p&&!e.inputData[p-1]&&!e.inputConnection[p-1];)p--;return p===e.numberOfInputs&&e.numberOfInputs++,p}function u(p){if(e.deleted){A("instance deleted - cannot call any method");return}i(p,c())}function g(p){if(e.deleted){A("instance deleted - cannot call any method");return}a(p,c())}function f(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return e.deleted?(A("instance deleted - cannot call any method"),null):(t.shouldUpdate()&&t.update(),e.output[p])}t.shouldUpdate=()=>{var v,x;const p=t.getMTime();let y=1/0,h=n;for(;h--;){if(!e.output[h]||e.output[h].isDeleted())return!0;const S=e.output[h].getMTime();if(S<p)return!0;S<y&&(y=S)}for(h=e.numberOfInputs;h--;)if((v=e.inputConnection[h])!=null&&v.filter.shouldUpdate()||((x=t.getInputData(h))==null?void 0:x.getMTime())>y)return!0;return!1};function l(){let p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const y=()=>f(p);return y.filter=t,y}if(e.numberOfInputs){let p=e.numberOfInputs;for(;p--;)e.inputData.push(null),e.inputConnection.push(null);t.setInputData=a,t.setInputConnection=i,t.addInputData=g,t.addInputConnection=u,t.getInputData=s,t.getInputConnection=o}n&&(t.getOutputData=f,t.getOutputPort=l),t.update=()=>{const p=[];if(e.numberOfInputs){let y=0;for(;y<e.numberOfInputs;)p[y]=t.getInputData(y),y++}t.shouldUpdate()&&t.requestData&&t.requestData(p,e.output)},t.getNumberOfInputPorts=()=>e.numberOfInputs,t.getNumberOfOutputPorts=()=>n||e.output.length,t.getInputArrayToProcess=p=>{const y=e.inputArrayToProcess[p],h=e.inputData[p];return y&&h?h[`get${y.fieldAssociation}`]().getArray(y.arrayName):null},t.setInputArrayToProcess=function(p,y,h){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"Scalars";for(;e.inputArrayToProcess.length<p;)e.inputArrayToProcess.push(null);e.inputArrayToProcess[p]={arrayName:y,fieldAssociation:h,attributeType:v}}}const Es=Symbol("Event abort");function zc(t,e,r){const n=[],a=t.delete;let s=1;function i(u){for(let g=0;g<n.length;++g){const[f]=n[g];if(f===u){n.splice(g,1);return}}}function o(u){function g(){i(u)}return Object.freeze({unsubscribe:g})}function c(){if(e.deleted){A("instance deleted - cannot call any method");return}const u=n.slice();for(let g=0;g<u.length;++g){const[,f,l]=u[g];if(f){if(l<0)setTimeout(()=>f.apply(t,arguments),1-l);else if(f.apply(t,arguments)===Es)break}}}t[`invoke${ne(r)}`]=c,t[`on${ne(r)}`]=function(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!u.apply)return console.error(`Invalid callback for event ${r}`),null;if(e.deleted)return A("instance deleted - cannot call any method"),null;const f=s++;return n.push([f,u,g]),n.sort((l,p)=>p[2]-l[2]),o(f)},t.delete=()=>{a(),n.forEach(u=>{let[g]=u;return i(g)})}}function Z(t,e){const r=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a={},s={};return t(s,a,n),Object.freeze(s)};return e&&Ge.register(e,r),r}function Hc(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(){for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return e.filter(i=>!!i).map(i=>i(...a))}}function Os(t){return t&&t.isA&&t.isA("vtkObject")}function On(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[];if(Os(t)){if(n.indexOf(t)>=0)return r;n.push(t);const a=e(t);a!==void 0&&r.push(a);const s=t.get();Object.keys(s).forEach(i=>{const o=s[i];Array.isArray(o)?o.forEach(c=>{On(c,e,r,n)}):On(o,e,r,n)})}return r}function Ac(t,e,r){var n=this;let a;const s=function(){for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];const u=n,g=()=>{a=null,r||t.apply(u,o)},f=r&&!a;clearTimeout(a),a=setTimeout(g,e),f&&t.apply(u,o)};return s.cancel=()=>clearTimeout(a),s}function jc(t,e){let r=!1,n=null;function a(){r=!1,n!==null&&(s(...n),n=null)}function s(){for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];if(r){n=o;return}r=!0,t(...o),setTimeout(a,e)}return s}function Rs(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};e.keystore=Object.assign(e.keystore||{},r),t.setKey=(n,a)=>{e.keystore[n]=a},t.getKey=n=>e.keystore[n],t.getAllKeys=()=>Object.keys(e.keystore),t.deleteKey=n=>delete e.keystore[n],t.clearKeystore=()=>t.getAllKeys().forEach(n=>delete e.keystore[n])}let z0=1;const kr="__root__";function Kc(t,e){Rs(t,e);const r=t.delete;e.proxyId=`${z0++}`,e.ui=JSON.parse(JSON.stringify(e.ui||[])),Ee(t,e,["proxyId","proxyGroup","proxyName"]),ue(t,e,["proxyManager"]);const n={},a={};function s(u,g){a[g]||(a[g]=[]);const f=a[g];for(let l=0;l<u.length;l++)f.push(u[l].name),n[u[l].name]=u[l],u[l].children&&u[l].children.length&&s(u[l].children,u[l].name)}s(e.ui,kr),t.updateUI=u=>{e.ui=JSON.parse(JSON.stringify(u||[])),Object.keys(n).forEach(g=>delete n[g]),Object.keys(a).forEach(g=>delete a[g]),s(e.ui,kr),t.modified()};function i(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:kr;return a[u]}t.updateProxyProperty=(u,g)=>{const f=n[u];f?Object.assign(f,g):n[u]={...g}},t.activate=()=>{if(e.proxyManager){const u=`setActive${ne(t.getProxyGroup().slice(0,-1))}`;e.proxyManager[u]&&e.proxyManager[u](t)}},e.propertyLinkSubscribers={},t.registerPropertyLinkForGC=(u,g)=>{g in e.propertyLinkSubscribers||(e.propertyLinkSubscribers[g]=[]),e.propertyLinkSubscribers[g].push(u)},t.gcPropertyLinks=u=>{const g=e.propertyLinkSubscribers[u]||[];for(;g.length;)g.pop().unbind(t)},e.propertyLinkMap={},t.getPropertyLink=function(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.propertyLinkMap[u])return e.propertyLinkMap[u];let f=null;const l=[];let p=0,y=!1;function h(T){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(y)return null;const C=[];let O=null;for(p=l.length;p--;){const L=l[p];L.instance===T?O=L:C.push(L)}if(!O)return null;const R=O.instance[`get${ne(O.propertyName)}`]();if(!b0(R,f)||w){for(f=R,y=!0;C.length;){const L=C.pop();L.instance.set({[L.propertyName]:f})}y=!1}return e.propertyLinkMap[u].persistent&&(e.propertyLinkMap[u].value=R),R}function v(T,w){const C=[];for(p=l.length;p--;){const O=l[p];O.instance===T&&(O.propertyName===w||w===void 0)&&(O.subscription.unsubscribe(),C.push(p))}for(;C.length;)l.splice(C.pop(),1)}function x(T,w){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const O=T.onModified(h),R=l[0];return l.push({instance:T,propertyName:w,subscription:O}),C&&(e.propertyLinkMap[u].persistent&&e.propertyLinkMap[u].value!==void 0?T.set({[w]:e.propertyLinkMap[u].value}):R&&h(R.instance,!0)),{unsubscribe:()=>v(T,w)}}function S(){for(;l.length;)l.pop().subscription.unsubscribe()}const d={bind:x,unbind:v,unsubscribe:S,persistent:g};return e.propertyLinkMap[u]=d,d};function o(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:kr;const g=[],f=e.proxyId,l=i(u)||[];for(let p=0;p<l.length;p++){const y=l[p],h=t[`get${ne(y)}`],v=h?h():void 0,x={id:f,name:y,value:v},S=o(y);S.length&&(x.children=S),g.push(x)}return g}t.listPropertyNames=()=>o().map(u=>u.name),t.getPropertyByName=u=>o().find(g=>g.name===u),t.getPropertyDomainByName=u=>(n[u]||{}).domain,t.getProxySection=()=>({id:e.proxyId,name:e.proxyGroup,ui:e.ui,properties:o()}),t.delete=()=>{const u=Object.keys(e.propertyLinkMap);let g=u.length;for(;g--;)e.propertyLinkMap[u[g]].unsubscribe();Object.keys(e.propertyLinkSubscribers).forEach(t.gcPropertyLinks),r()},t.getState=()=>null;function c(){if(e.links)for(let u=0;u<e.links.length;u++){const{link:g,property:f,persistent:l,updateOnBind:p,type:y}=e.links[u];if(y==="application"){const h=e.proxyManager.getPropertyLink(g,l);t.registerPropertyLinkForGC(h,"application"),h.bind(t,f,p)}}}Ss(c)}function Xc(t,e,r){const n=t.delete,a=[],s=Object.keys(r);let i=s.length;for(;i--;){const o=s[i],{modelKey:c,property:u,modified:g=!0}=r[o],f=ne(u),l=ne(o);t[`get${l}`]=e[c][`get${f}`],t[`set${l}`]=e[c][`set${f}`],g&&a.push(e[c].onModified(t.modified))}t.delete=()=>{for(;a.length;)a.pop().unsubscribe();n()}}function Pc(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};e.this=t;function a(o){const c=Object.keys(o);let u=c.length;for(;u--;){const g=c[u];e[g].set(o[g])}}const s=Object.keys(n);let i=s.length;for(;i--;){const o=s[i];e[o]=n[o];const c=r[o];t[`set${ne(o)}`]=u=>{if(u!==e[o]){e[o]=u;const g=c[u];a(g),t.modified()}}}s.length&&Ee(t,e,s)}const Oi=10,Ri=40,Mi=800;function Yc(t){let e=0,r=0,n=0,a=0;return"detail"in t&&(r=t.detail),"wheelDelta"in t&&(r=-t.wheelDelta/120),"wheelDeltaY"in t&&(r=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=r,r=0),n=e*Oi,a=r*Oi,"deltaY"in t&&(a=t.deltaY),"deltaX"in t&&(n=t.deltaX),(n||a)&&t.deltaMode&&(t.deltaMode===1?(n*=Ri,a*=Ri):(n*=Mi,a*=Mi)),n&&!e&&(e=n<1?-1:1),a&&!r&&(r=a<1?-1:1),{spinX:e,spinY:r||e,pixelX:n,pixelY:a||n}}var E={algo:Wc,capitalize:An,chain:Hc,debounce:Ac,enumToString:$0,event:zc,EVENT_ABORT:Es,formatBytesToProperUnit:mc,formatNumbersWithThousandSeparator:kc,get:Ee,getArray:rr,getCurrentGlobalMTime:k0,getStateArrayMapFunc:Gc,isVtkObject:Os,keystore:Rs,measurePromiseExecution:bc,moveToProtected:Lr,newInstance:Z,newTypedArray:tr,newTypedArrayFrom:xs,normalizeWheel:Yc,obj:ve,proxy:Kc,proxyPropertyMapping:Xc,proxyPropertyState:Pc,safeArrays:Nc,set:Dr,setArray:Cs,setGet:ue,setGetArray:ws,setImmediate:Ss,setLoggerFunction:Vc,throttle:jc,traverseInstanceTree:On,TYPED_ARRAYS:Te,uncapitalize:Uc,VOID:Dc,vtkDebugMacro:En,vtkErrorMacro:A,vtkInfoMacro:Bc,vtkLogMacro:_c,vtkOnceErrorMacro:Fc,vtkWarningMacro:Hn,objectSetterMap:$c},Pe=Object.freeze({__proto__:null,VOID:Dc,setLoggerFunction:Vc,vtkLogMacro:_c,vtkInfoMacro:Bc,vtkDebugMacro:En,vtkErrorMacro:A,vtkWarningMacro:Hn,vtkOnceErrorMacro:Fc,TYPED_ARRAYS:Te,newTypedArray:tr,newTypedArrayFrom:xs,capitalize:An,_capitalize:ne,uncapitalize:Uc,formatBytesToProperUnit:mc,formatNumbersWithThousandSeparator:kc,setImmediateVTK:Ss,measurePromiseExecution:bc,obj:ve,get:Ee,set:Dr,setGet:ue,getArray:rr,setArray:Cs,setGetArray:ws,moveToProtected:Lr,algo:Wc,EVENT_ABORT:Es,event:zc,newInstance:Z,chain:Hc,isVtkObject:Os,traverseInstanceTree:On,debounce:Ac,throttle:jc,keystore:Rs,proxy:Kc,proxyPropertyMapping:Xc,proxyPropertyState:Pc,normalizeWheel:Yc,default:E});const{vtkErrorMacro:H0}=E,A0=["Build","Render"];function j0(t,e){e.classHierarchy.push("vtkViewNode"),t.build=n=>{},t.render=n=>{},t.traverse=n=>{const a=n.getTraverseOperation(),s=t[a];if(s){s(n);return}t.apply(n,!0);for(let i=0;i<e.children.length;i++)e.children[i].traverse(n);t.apply(n,!1)},t.apply=(n,a)=>{const s=t[n.getOperation()];s&&s(a,n)},t.getViewNodeFor=n=>{if(e.renderable===n)return t;for(let a=0;a<e.children.length;++a){const i=e.children[a].getViewNodeFor(n);if(i)return i}},t.getFirstAncestorOfType=n=>e._parent?e._parent.isA(n)?e._parent:e._parent.getFirstAncestorOfType(n):null,t.getLastAncestorOfType=n=>{if(!e._parent)return null;const a=e._parent.getLastAncestorOfType(n);return a||(e._parent.isA(n)?e._parent:null)},t.addMissingNode=n=>{if(!n)return;const a=e._renderableChildMap.get(n);if(a!==void 0)return a.setVisited(!0),a;const s=t.createViewNode(n);if(s)return s.setParent(t),s.setVisited(!0),e._renderableChildMap.set(n,s),e.children.push(s),s},t.addMissingNodes=n=>{if(!(!n||!n.length))for(let a=0;a<n.length;++a){const s=n[a];t.addMissingNode(s)}},t.addMissingChildren=n=>{if(!(!n||!n.length))for(let a=0;a<n.length;++a){const s=n[a];if(e.children.indexOf(s)===-1){s.setParent(t),e.children.push(s);const o=s.getRenderable();o&&e._renderableChildMap.set(o,s)}s.setVisited(!0)}},t.removeNode=n=>{const a=e.children.findIndex(i=>i===n);if(a<0)return!1;const s=n.getRenderable();return s&&e._renderableChildMap.delete(s),n.delete(),e.children.splice(a,1),!0},t.prepareNodes=()=>{for(let n=0;n<e.children.length;++n)e.children[n].setVisited(!1)},t.setVisited=n=>{e.visited=n},t.removeUnusedNodes=()=>{let n=0;for(let a=0;a<e.children.length;++a){const s=e.children[a];if(s.getVisited())e.children[n++]=s,s.setVisited(!1);else{const o=s.getRenderable();o&&e._renderableChildMap.delete(o),s.delete()}}e.children.length=n},t.createViewNode=n=>{if(!e.myFactory)return H0("Cannot create view nodes without my own factory"),null;const a=e.myFactory.createNode(n);return a&&a.setRenderable(n),a};const r=t.delete;t.delete=()=>{for(let n=0;n<e.children.length;n++)e.children[n].delete();r()}}const K0={renderable:null,myFactory:null,children:[],visited:!1};function qc(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,K0,r),E.obj(t,e),E.event(t,e,"event"),e._renderableChildMap=new Map,E.get(t,e,["visited"]),E.setGet(t,e,["_parent","renderable","myFactory"]),E.getArray(t,e,["children"]),E.moveToProtected(t,e,["parent"]),j0(t,e)}const X0=E.newInstance(qc,"vtkViewNode");var ae={newInstance:X0,extend:qc,PASS_TYPES:A0};function P0(t,e){e.overrides||(e.overrides={}),e.classHierarchy.push("vtkViewNodeFactory"),t.createNode=r=>{if(r.isDeleted())return null;let n=0,a=r.getClassName(n++),s=!1;const i=Object.keys(e.overrides);for(;a&&!s;)i.indexOf(a)!==-1?s=!0:a=r.getClassName(n++);if(!s)return null;const o=e.overrides[a]();return o.setMyFactory(t),o}}const Y0={};function Ic(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Y0,r),E.obj(t,e),P0(t,e)}const q0=E.newInstance(Ic,"vtkViewNodeFactory");var Qc={newInstance:q0,extend:Ic};const Zc=Object.create(null);function Ve(t,e){Zc[t]=e}function I0(t,e){e.classHierarchy.push("vtkOpenGLViewNodeFactory")}const Q0={};function Jc(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Q0,r),e.overrides=Zc,Qc.extend(t,e,r),I0(t,e)}const Z0=E.newInstance(Jc,"vtkOpenGLViewNodeFactory");var J0={newInstance:Z0,extend:Jc};function ep(t,e){e.classHierarchy.push("vtkOpenGLCamera"),t.buildPass=r=>{r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext())},t.opaquePass=r=>{if(r){const n=e._openGLRenderer.getTiledSizeAndOrigin();e.context.viewport(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize),e.context.scissor(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize)}},t.translucentPass=t.opaquePass,t.zBufferPass=t.opaquePass,t.opaqueZBufferPass=t.opaquePass,t.volumePass=t.opaquePass,t.getKeyMatrices=r=>{if(r!==e.lastRenderer||e._openGLRenderWindow.getMTime()>e.keyMatrixTime.getMTime()||t.getMTime()>e.keyMatrixTime.getMTime()||r.getMTime()>e.keyMatrixTime.getMTime()||e.renderable.getMTime()>e.keyMatrixTime.getMTime()){ye(e.keyMatrices.wcvc,e.renderable.getViewMatrix()),hs(e.keyMatrices.normalMatrix,e.keyMatrices.wcvc),vs(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),te(e.keyMatrices.wcvc,e.keyMatrices.wcvc);const n=e._openGLRenderer.getAspectRatio();ye(e.keyMatrices.vcpc,e.renderable.getProjectionMatrix(n,-1,1)),te(e.keyMatrices.vcpc,e.keyMatrices.vcpc),de(e.keyMatrices.wcpc,e.keyMatrices.vcpc,e.keyMatrices.wcvc),e.keyMatrixTime.modified(),e.lastRenderer=r}return e.keyMatrices}}const tp={context:null,lastRenderer:null,keyMatrixTime:null,keyMatrices:null};function rp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tp,r),ae.extend(t,e,r),e.keyMatrixTime={},ve(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(9),vcpc:new Float64Array(16),wcvc:new Float64Array(16),wcpc:new Float64Array(16)},ue(t,e,["context","keyMatrixTime"]),ep(t,e)}const np=Z(rp);Ve("vtkCamera",np);const{vtkDebugMacro:ap}=Pe;function sp(t,e){e.classHierarchy.push("vtkOpenGLRenderer"),t.buildPass=r=>{if(r){if(!e.renderable)return;t.updateLights(),t.prepareNodes(),t.addMissingNode(e.renderable.getActiveCamera()),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes()}},t.updateLights=()=>{let r=0;const n=e.renderable.getLightsByReference();for(let a=0;a<n.length;++a)n[a].getSwitch()>0&&r++;return r||(ap("No lights are on, creating one."),e.renderable.createLight()),r},t.zBufferPass=r=>{if(r){let n=0;const a=e.context;e.renderable.getTransparent()||(e.context.clearColor(1,0,0,1),n|=a.COLOR_BUFFER_BIT),e.renderable.getPreserveDepthBuffer()||(a.clearDepth(1),n|=a.DEPTH_BUFFER_BIT,e.context.depthMask(!0));const s=t.getTiledSizeAndOrigin();a.enable(a.SCISSOR_TEST),a.scissor(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),a.viewport(s.lowerLeftU,s.lowerLeftV,s.usize,s.vsize),a.colorMask(!0,!0,!0,!0),n&&a.clear(n),a.enable(a.DEPTH_TEST)}},t.opaqueZBufferPass=r=>t.zBufferPass(r),t.cameraPass=r=>{r&&t.clear()},t.getAspectRatio=()=>{const r=e._parent.getSizeByReference(),n=e.renderable.getViewportByReference();return r[0]*(n[2]-n[0])/((n[3]-n[1])*r[1])},t.getTiledSizeAndOrigin=()=>{const r=e.renderable.getViewportByReference(),n=[0,0,1,1],a=r[0]-n[0],s=r[1]-n[1],i=e._parent.normalizedDisplayToDisplay(a,s),o=Math.round(i[0]),c=Math.round(i[1]),u=r[2]-n[0],g=r[3]-n[1],f=e._parent.normalizedDisplayToDisplay(u,g);let l=Math.round(f[0])-o,p=Math.round(f[1])-c;return l<0&&(l=0),p<0&&(p=0),{usize:l,vsize:p,lowerLeftU:o,lowerLeftV:c}},t.clear=()=>{let r=0;const n=e.context;if(!e.renderable.getTransparent()){const s=e.renderable.getBackgroundByReference();n.clearColor(s[0],s[1],s[2],s[3]),r|=n.COLOR_BUFFER_BIT}e.renderable.getPreserveDepthBuffer()||(n.clearDepth(1),r|=n.DEPTH_BUFFER_BIT,n.depthMask(!0)),n.colorMask(!0,!0,!0,!0);const a=t.getTiledSizeAndOrigin();n.enable(n.SCISSOR_TEST),n.scissor(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),n.viewport(a.lowerLeftU,a.lowerLeftV,a.usize,a.vsize),r&&n.clear(r),n.enable(n.DEPTH_TEST)},t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources(),e.renderable&&e.renderable.getViewProps().forEach(r=>{r.modified()})},t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))}}const ip={context:null,_openGLRenderWindow:null,selector:null};function op(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ip,r),ae.extend(t,e,r),Ee(t,e,["shaderCache"]),ue(t,e,["selector"]),Lr(t,e,["openGLRenderWindow"]),sp(t,e)}const cp=Z(op,"vtkOpenGLRenderer");Ve("vtkRenderer",cp);function fp(t,e){e.classHierarchy.push("vtkOpenGLActor"),t.buildPass=r=>{if(r){e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let n=0;n<e.children.length;n++){const a=e.children[n];a.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(a)):e.oglmapper=a}}},t.traverseZBufferPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseOpaqueZBufferPass=r=>t.traverseOpaquePass(r),t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let r=0;r<e.ogltextures.length;r++){const n=e.ogltextures[r];n.render(),n.getHandle()&&e.activeTextures.push(n)}}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.zBufferPass=(r,n)=>t.opaquePass(r,n),t.opaqueZBufferPass=(r,n)=>t.opaquePass(r,n),t.opaquePass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.translucentPass=(r,n)=>{if(r)e.context.depthMask(e._openGLRenderer.getSelector()&&e.renderable.getNestedPickable()),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.getKeyMatrices=()=>(e.renderable.getMTime()>e.keyMatrixTime.getMTime()&&(e.renderable.computeMatrix(),ye(e.keyMatrices.mcwc,e.renderable.getMatrix()),te(e.keyMatrices.mcwc,e.keyMatrices.mcwc),e.renderable.getIsIdentity()?Gt(e.keyMatrices.normalMatrix):(hs(e.keyMatrices.normalMatrix,e.keyMatrices.mcwc),vs(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),tc(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),e.keyMatrixTime.modified()),e.keyMatrices)}const up={context:null,keyMatrixTime:null,keyMatrices:null,activeTextures:null};function gp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,up,r),ae.extend(t,e,r),e.keyMatrixTime={},ve(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:Gt(new Float64Array(9)),mcwc:j(new Float64Array(16))},ue(t,e,["context"]),Ee(t,e,["activeTextures"]),fp(t,e)}const lp=Z(gp);Ve("vtkActor",lp);function pp(t,e){e.classHierarchy.push("vtkOpenGLActor2D"),t.buildPass=r=>{if(r){if(!e.renderable)return;e._openGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e.context=e._openGLRenderWindow.getContext(),t.prepareNodes(),t.addMissingNodes(e.renderable.getTextures()),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes(),e.ogltextures=null,e.activeTextures=null;for(let n=0;n<e.children.length;n++){const a=e.children[n];a.isA("vtkOpenGLTexture")?(e.ogltextures||(e.ogltextures=[]),e.ogltextures.push(a)):e.oglmapper=a}}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementOverlayActorCount()}},t.traverseOpaquePass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.traverseOverlayPass=r=>{!e.oglmapper||!e.renderable||!e.renderable.getNestedVisibility()||e._openGLRenderer.getSelector()&&!e.renderable.getNestedPickable||(t.apply(r,!0),e.oglmapper.traverse(r),t.apply(r,!1))},t.activateTextures=()=>{if(e.ogltextures){e.activeTextures=[];for(let r=0;r<e.ogltextures.length;r++){const n=e.ogltextures[r];n.render(),n.getHandle()&&e.activeTextures.push(n)}}},t.opaquePass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.translucentPass=(r,n)=>{if(r)e.context.depthMask(!1),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()},t.overlayPass=(r,n)=>{if(r)e.context.depthMask(!0),t.activateTextures();else if(e.activeTextures)for(let a=0;a<e.activeTextures.length;a++)e.activeTextures[a].deactivate()}}const hp={context:null,activeTextures:null};function vp(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hp,r),ae.extend(t,e,r),ue(t,e,["context"]),Ee(t,e,["activeTextures"]),pp(t,e)}const yp=Z(vp);Ve("vtkActor2D",yp);function fn(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function dp(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function ef(t){let e,r,n;t.length!==2?(e=fn,r=(o,c)=>fn(t(o),c),n=(o,c)=>t(o)-c):(e=t===fn||t===dp?t:Tp,r=t,n=t);function a(o,c,u=0,g=o.length){if(u<g){if(e(c,c)!==0)return g;do{const f=u+g>>>1;r(o[f],c)<0?u=f+1:g=f}while(u<g)}return u}function s(o,c,u=0,g=o.length){if(u<g){if(e(c,c)!==0)return g;do{const f=u+g>>>1;r(o[f],c)<=0?u=f+1:g=f}while(u<g)}return u}function i(o,c,u=0,g=o.length){const f=a(o,c,u,g-1);return f>u&&n(o[f-1],c)>-n(o[f],c)?f-1:f}return{left:a,center:i,right:s}}function Tp(){return 0}function xp(t){return t===null?NaN:+t}const Sp=ef(fn),Cp=Sp.right;ef(xp).center;const wp=Math.sqrt(50),Ep=Math.sqrt(10),Op=Math.sqrt(2);function Rn(t,e,r){const n=(e-t)/Math.max(0,r),a=Math.floor(Math.log10(n)),s=n/Math.pow(10,a),i=s>=wp?10:s>=Ep?5:s>=Op?2:1;let o,c,u;return a<0?(u=Math.pow(10,-a)/i,o=Math.round(t*u),c=Math.round(e*u),o/u<t&&++o,c/u>e&&--c,u=-u):(u=Math.pow(10,a)*i,o=Math.round(t/u),c=Math.round(e/u),o*u<t&&++o,c*u>e&&--c),c<o&&.5<=r&&r<2?Rn(t,e,r*2):[o,c,u]}function Rp(t,e,r){if(e=+e,t=+t,r=+r,!(r>0))return[];if(t===e)return[t];const n=e<t,[a,s,i]=n?Rn(e,t,r):Rn(t,e,r);if(!(s>=a))return[];const o=s-a+1,c=new Array(o);if(n)if(i<0)for(let u=0;u<o;++u)c[u]=(s-u)/-i;else for(let u=0;u<o;++u)c[u]=(s-u)*i;else if(i<0)for(let u=0;u<o;++u)c[u]=(a+u)/-i;else for(let u=0;u<o;++u)c[u]=(a+u)*i;return c}function Ia(t,e,r){return e=+e,t=+t,r=+r,Rn(t,e,r)[2]}function Mp(t,e,r){e=+e,t=+t,r=+r;const n=e<t,a=n?Ia(e,t,r):Ia(t,e,r);return(n?-1:1)*(a<0?1/-a:a)}function Dp(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Ms(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function tf(t,e){var r=Object.create(t.prototype);for(var n in e)r[n]=e[n];return r}function Vr(){}var Sr=.7,Mn=1/Sr,Xt="\\s*([+-]?\\d+)\\s*",Cr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ke="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Lp=/^#([0-9a-f]{3,8})$/,Vp=new RegExp(`^rgb\\(${Xt},${Xt},${Xt}\\)$`),_p=new RegExp(`^rgb\\(${Ke},${Ke},${Ke}\\)$`),Bp=new RegExp(`^rgba\\(${Xt},${Xt},${Xt},${Cr}\\)$`),Fp=new RegExp(`^rgba\\(${Ke},${Ke},${Ke},${Cr}\\)$`),Up=new RegExp(`^hsl\\(${Cr},${Ke},${Ke}\\)$`),mp=new RegExp(`^hsla\\(${Cr},${Ke},${Ke},${Cr}\\)$`),Di={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ms(Vr,wr,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Li,formatHex:Li,formatHex8:kp,formatHsl:Np,formatRgb:Vi,toString:Vi});function Li(){return this.rgb().formatHex()}function kp(){return this.rgb().formatHex8()}function Np(){return rf(this).formatHsl()}function Vi(){return this.rgb().formatRgb()}function wr(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=Lp.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?_i(e):r===3?new Oe(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?Nr(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?Nr(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Vp.exec(t))?new Oe(e[1],e[2],e[3],1):(e=_p.exec(t))?new Oe(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Bp.exec(t))?Nr(e[1],e[2],e[3],e[4]):(e=Fp.exec(t))?Nr(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Up.exec(t))?Ui(e[1],e[2]/100,e[3]/100,1):(e=mp.exec(t))?Ui(e[1],e[2]/100,e[3]/100,e[4]):Di.hasOwnProperty(t)?_i(Di[t]):t==="transparent"?new Oe(NaN,NaN,NaN,0):null}function _i(t){return new Oe(t>>16&255,t>>8&255,t&255,1)}function Nr(t,e,r,n){return n<=0&&(t=e=r=NaN),new Oe(t,e,r,n)}function Gp(t){return t instanceof Vr||(t=wr(t)),t?(t=t.rgb(),new Oe(t.r,t.g,t.b,t.opacity)):new Oe}function Qa(t,e,r,n){return arguments.length===1?Gp(t):new Oe(t,e,r,n??1)}function Oe(t,e,r,n){this.r=+t,this.g=+e,this.b=+r,this.opacity=+n}Ms(Oe,Qa,tf(Vr,{brighter(t){return t=t==null?Mn:Math.pow(Mn,t),new Oe(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Sr:Math.pow(Sr,t),new Oe(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Oe(Ut(this.r),Ut(this.g),Ut(this.b),Dn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Bi,formatHex:Bi,formatHex8:bp,formatRgb:Fi,toString:Fi}));function Bi(){return`#${Ft(this.r)}${Ft(this.g)}${Ft(this.b)}`}function bp(){return`#${Ft(this.r)}${Ft(this.g)}${Ft(this.b)}${Ft((isNaN(this.opacity)?1:this.opacity)*255)}`}function Fi(){const t=Dn(this.opacity);return`${t===1?"rgb(":"rgba("}${Ut(this.r)}, ${Ut(this.g)}, ${Ut(this.b)}${t===1?")":`, ${t})`}`}function Dn(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Ut(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Ft(t){return t=Ut(t),(t<16?"0":"")+t.toString(16)}function Ui(t,e,r,n){return n<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new ke(t,e,r,n)}function rf(t){if(t instanceof ke)return new ke(t.h,t.s,t.l,t.opacity);if(t instanceof Vr||(t=wr(t)),!t)return new ke;if(t instanceof ke)return t;t=t.rgb();var e=t.r/255,r=t.g/255,n=t.b/255,a=Math.min(e,r,n),s=Math.max(e,r,n),i=NaN,o=s-a,c=(s+a)/2;return o?(e===s?i=(r-n)/o+(r<n)*6:r===s?i=(n-e)/o+2:i=(e-r)/o+4,o/=c<.5?s+a:2-s-a,i*=60):o=c>0&&c<1?0:i,new ke(i,o,c,t.opacity)}function $p(t,e,r,n){return arguments.length===1?rf(t):new ke(t,e,r,n??1)}function ke(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}Ms(ke,$p,tf(Vr,{brighter(t){return t=t==null?Mn:Math.pow(Mn,t),new ke(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Sr:Math.pow(Sr,t),new ke(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*e,a=2*r-n;return new Oe(ya(t>=240?t-240:t+120,a,n),ya(t,a,n),ya(t<120?t+240:t-120,a,n),this.opacity)},clamp(){return new ke(mi(this.h),Gr(this.s),Gr(this.l),Dn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Dn(this.opacity);return`${t===1?"hsl(":"hsla("}${mi(this.h)}, ${Gr(this.s)*100}%, ${Gr(this.l)*100}%${t===1?")":`, ${t})`}`}}));function mi(t){return t=(t||0)%360,t<0?t+360:t}function Gr(t){return Math.max(0,Math.min(1,t||0))}function ya(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}const Ds=t=>()=>t;function Wp(t,e){return function(r){return t+r*e}}function zp(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(n){return Math.pow(t+n*e,r)}}function Hp(t){return(t=+t)==1?nf:function(e,r){return r-e?zp(e,r,t):Ds(isNaN(e)?r:e)}}function nf(t,e){var r=e-t;return r?Wp(t,r):Ds(isNaN(t)?e:t)}const ki=function t(e){var r=Hp(e);function n(a,s){var i=r((a=Qa(a)).r,(s=Qa(s)).r),o=r(a.g,s.g),c=r(a.b,s.b),u=nf(a.opacity,s.opacity);return function(g){return a.r=i(g),a.g=o(g),a.b=c(g),a.opacity=u(g),a+""}}return n.gamma=t,n}(1);function Ap(t,e){e||(e=[]);var r=t?Math.min(e.length,t.length):0,n=e.slice(),a;return function(s){for(a=0;a<r;++a)n[a]=t[a]*(1-s)+e[a]*s;return n}}function jp(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Kp(t,e){var r=e?e.length:0,n=t?Math.min(r,t.length):0,a=new Array(n),s=new Array(r),i;for(i=0;i<n;++i)a[i]=Ls(t[i],e[i]);for(;i<r;++i)s[i]=e[i];return function(o){for(i=0;i<n;++i)s[i]=a[i](o);return s}}function Xp(t,e){var r=new Date;return t=+t,e=+e,function(n){return r.setTime(t*(1-n)+e*n),r}}function Ln(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function Pp(t,e){var r={},n={},a;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(a in e)a in t?r[a]=Ls(t[a],e[a]):n[a]=e[a];return function(s){for(a in r)n[a]=r[a](s);return n}}var Za=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,da=new RegExp(Za.source,"g");function Yp(t){return function(){return t}}function qp(t){return function(e){return t(e)+""}}function Ip(t,e){var r=Za.lastIndex=da.lastIndex=0,n,a,s,i=-1,o=[],c=[];for(t=t+"",e=e+"";(n=Za.exec(t))&&(a=da.exec(e));)(s=a.index)>r&&(s=e.slice(r,s),o[i]?o[i]+=s:o[++i]=s),(n=n[0])===(a=a[0])?o[i]?o[i]+=a:o[++i]=a:(o[++i]=null,c.push({i,x:Ln(n,a)})),r=da.lastIndex;return r<e.length&&(s=e.slice(r),o[i]?o[i]+=s:o[++i]=s),o.length<2?c[0]?qp(c[0].x):Yp(e):(e=c.length,function(u){for(var g=0,f;g<e;++g)o[(f=c[g]).i]=f.x(u);return o.join("")})}function Ls(t,e){var r=typeof e,n;return e==null||r==="boolean"?Ds(e):(r==="number"?Ln:r==="string"?(n=wr(e))?(e=n,ki):Ip:e instanceof wr?ki:e instanceof Date?Xp:jp(e)?Ap:Array.isArray(e)?Kp:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Pp:Ln)(t,e)}function Qp(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}function Zp(t){return function(){return t}}function Jp(t){return+t}var Ni=[0,1];function jt(t){return t}function Ja(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:Zp(isNaN(e)?NaN:.5)}function eh(t,e){var r;return t>e&&(r=t,t=e,e=r),function(n){return Math.max(t,Math.min(e,n))}}function th(t,e,r){var n=t[0],a=t[1],s=e[0],i=e[1];return a<n?(n=Ja(a,n),s=r(i,s)):(n=Ja(n,a),s=r(s,i)),function(o){return s(n(o))}}function rh(t,e,r){var n=Math.min(t.length,e.length)-1,a=new Array(n),s=new Array(n),i=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++i<n;)a[i]=Ja(t[i],t[i+1]),s[i]=r(e[i],e[i+1]);return function(o){var c=Cp(t,o,1,n)-1;return s[c](a[c](o))}}function nh(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function ah(){var t=Ni,e=Ni,r=Ls,n,a,s,i=jt,o,c,u;function g(){var l=Math.min(t.length,e.length);return i!==jt&&(i=eh(t[0],t[l-1])),o=l>2?rh:th,c=u=null,f}function f(l){return l==null||isNaN(l=+l)?s:(c||(c=o(t.map(n),e,r)))(n(i(l)))}return f.invert=function(l){return i(a((u||(u=o(e,t.map(n),Ln)))(l)))},f.domain=function(l){return arguments.length?(t=Array.from(l,Jp),g()):t.slice()},f.range=function(l){return arguments.length?(e=Array.from(l),g()):e.slice()},f.rangeRound=function(l){return e=Array.from(l),r=Qp,g()},f.clamp=function(l){return arguments.length?(i=l?!0:jt,g()):i!==jt},f.interpolate=function(l){return arguments.length?(r=l,g()):r},f.unknown=function(l){return arguments.length?(s=l,f):s},function(l,p){return n=l,a=p,g()}}function sh(){return ah()(jt,jt)}function ih(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Vn(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,n=t.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+t.slice(r+1)]}function It(t){return t=Vn(Math.abs(t)),t?t[1]:NaN}function oh(t,e){return function(r,n){for(var a=r.length,s=[],i=0,o=t[0],c=0;a>0&&o>0&&(c+o+1>n&&(o=Math.max(1,n-c)),s.push(r.substring(a-=o,a+o)),!((c+=o+1)>n));)o=t[i=(i+1)%t.length];return s.reverse().join(e)}}function ch(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var fh=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function _n(t){if(!(e=fh.exec(t)))throw new Error("invalid format: "+t);var e;return new Vs({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}_n.prototype=Vs.prototype;function Vs(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Vs.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function uh(t){e:for(var e=t.length,r=1,n=-1,a;r<e;++r)switch(t[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+t[r])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(a+1):t}var af;function gh(t,e){var r=Vn(t,e);if(!r)return t+"";var n=r[0],a=r[1],s=a-(af=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,i=n.length;return s===i?n:s>i?n+new Array(s-i+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+Vn(t,Math.max(0,e+s-1))[0]}function Gi(t,e){var r=Vn(t,e);if(!r)return t+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}const bi={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:ih,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Gi(t*100,e),r:Gi,s:gh,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function $i(t){return t}var Wi=Array.prototype.map,zi=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function lh(t){var e=t.grouping===void 0||t.thousands===void 0?$i:oh(Wi.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",a=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?$i:ch(Wi.call(t.numerals,String)),i=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function u(f){f=_n(f);var l=f.fill,p=f.align,y=f.sign,h=f.symbol,v=f.zero,x=f.width,S=f.comma,d=f.precision,T=f.trim,w=f.type;w==="n"?(S=!0,w="g"):bi[w]||(d===void 0&&(d=12),T=!0,w="g"),(v||l==="0"&&p==="=")&&(v=!0,l="0",p="=");var C=h==="$"?r:h==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",O=h==="$"?n:/[%p]/.test(w)?i:"",R=bi[w],L=/[defgprs%]/.test(w);d=d===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,d)):Math.max(0,Math.min(20,d));function M(D){var V=C,B=O,_,k,G;if(w==="c")B=R(D)+B,D="";else{D=+D;var b=D<0||1/D<0;if(D=isNaN(D)?c:R(Math.abs(D),d),T&&(D=uh(D)),b&&+D==0&&y!=="+"&&(b=!1),V=(b?y==="("?y:o:y==="-"||y==="("?"":y)+V,B=(w==="s"?zi[8+af/3]:"")+B+(b&&y==="("?")":""),L){for(_=-1,k=D.length;++_<k;)if(G=D.charCodeAt(_),48>G||G>57){B=(G===46?a+D.slice(_+1):D.slice(_))+B,D=D.slice(0,_);break}}}S&&!v&&(D=e(D,1/0));var Y=V.length+D.length+B.length,U=Y<x?new Array(x-Y+1).join(l):"";switch(S&&v&&(D=e(U+D,U.length?x-B.length:1/0),U=""),p){case"<":D=V+D+B+U;break;case"=":D=V+U+D+B;break;case"^":D=U.slice(0,Y=U.length>>1)+V+D+B+U.slice(Y);break;default:D=U+V+D+B;break}return s(D)}return M.toString=function(){return f+""},M}function g(f,l){var p=u((f=_n(f),f.type="f",f)),y=Math.max(-8,Math.min(8,Math.floor(It(l)/3)))*3,h=Math.pow(10,-y),v=zi[8+y/3];return function(x){return p(h*x)+v}}return{format:u,formatPrefix:g}}var br,sf,of;ph({thousands:",",grouping:[3],currency:["$",""]});function ph(t){return br=lh(t),sf=br.format,of=br.formatPrefix,br}function hh(t){return Math.max(0,-It(Math.abs(t)))}function vh(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(It(e)/3)))*3-It(Math.abs(t)))}function yh(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,It(e)-It(t))+1}function dh(t,e,r,n){var a=Mp(t,e,r),s;switch(n=_n(n??",f"),n.type){case"s":{var i=Math.max(Math.abs(t),Math.abs(e));return n.precision==null&&!isNaN(s=vh(a,i))&&(n.precision=s),of(n,i)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=yh(a,Math.max(Math.abs(t),Math.abs(e))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=hh(a))&&(n.precision=s-(n.type==="%")*2);break}}return sf(n)}function Th(t){var e=t.domain;return t.ticks=function(r){var n=e();return Rp(n[0],n[n.length-1],r??10)},t.tickFormat=function(r,n){var a=e();return dh(a[0],a[a.length-1],r??10,n)},t.nice=function(r){r==null&&(r=10);var n=e(),a=0,s=n.length-1,i=n[a],o=n[s],c,u,g=10;for(o<i&&(u=i,i=o,o=u,u=a,a=s,s=u);g-- >0;){if(u=Ia(i,o,r),u===c)return n[a]=i,n[s]=o,e(n);if(u>0)i=Math.floor(i/u)*u,o=Math.ceil(o/u)*u;else if(u<0)i=Math.ceil(i*u)/u,o=Math.floor(o*u)/u;else break;c=u}return t},t}function _s(){var t=sh();return t.copy=function(){return nh(t,_s())},Dp.apply(t,arguments),Th(t)}var un={exports:{}},xh=un.exports,Hi;function Sh(){return Hi||(Hi=1,function(t){(function(e,r,n){function a(c){var u=this,g=o();u.next=function(){var f=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=f-(u.c=f|0)},u.c=1,u.s0=g(" "),u.s1=g(" "),u.s2=g(" "),u.s0-=g(c),u.s0<0&&(u.s0+=1),u.s1-=g(c),u.s1<0&&(u.s1+=1),u.s2-=g(c),u.s2<0&&(u.s2+=1),g=null}function s(c,u){return u.c=c.c,u.s0=c.s0,u.s1=c.s1,u.s2=c.s2,u}function i(c,u){var g=new a(c),f=u&&u.state,l=g.next;return l.int32=function(){return g.next()*4294967296|0},l.double=function(){return l()+(l()*2097152|0)*11102230246251565e-32},l.quick=l,f&&(typeof f=="object"&&s(f,g),l.state=function(){return s(g,{})}),l}function o(){var c=4022871197,u=function(g){g=String(g);for(var f=0;f<g.length;f++){c+=g.charCodeAt(f);var l=.02519603282416938*c;c=l>>>0,l-=c,l*=c,c=l>>>0,l-=c,c+=l*4294967296}return(c>>>0)*23283064365386963e-26};return u}r&&r.exports?r.exports=i:this.alea=i})(xh,t)}(un)),un.exports}var gn={exports:{}},Ch=gn.exports,Ai;function wh(){return Ai||(Ai=1,function(t){(function(e,r,n){function a(o){var c=this,u="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var f=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^f^f>>>8},o===(o|0)?c.x=o:u+=o;for(var g=0;g<u.length+64;g++)c.x^=u.charCodeAt(g)|0,c.next()}function s(o,c){return c.x=o.x,c.y=o.y,c.z=o.z,c.w=o.w,c}function i(o,c){var u=new a(o),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,p=(u.next()>>>0)/4294967296,y=(l+p)/(1<<21);while(y===0);return y},f.int32=u.next,f.quick=f,g&&(typeof g=="object"&&s(g,u),f.state=function(){return s(u,{})}),f}r&&r.exports?r.exports=i:this.xor128=i})(Ch,t)}(gn)),gn.exports}var ln={exports:{}},Eh=ln.exports,ji;function Oh(){return ji||(ji=1,function(t){(function(e,r,n){function a(o){var c=this,u="";c.next=function(){var f=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(f^f<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,o===(o|0)?c.x=o:u+=o;for(var g=0;g<u.length+64;g++)c.x^=u.charCodeAt(g)|0,g==u.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function s(o,c){return c.x=o.x,c.y=o.y,c.z=o.z,c.w=o.w,c.v=o.v,c.d=o.d,c}function i(o,c){var u=new a(o),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,p=(u.next()>>>0)/4294967296,y=(l+p)/(1<<21);while(y===0);return y},f.int32=u.next,f.quick=f,g&&(typeof g=="object"&&s(g,u),f.state=function(){return s(u,{})}),f}r&&r.exports?r.exports=i:this.xorwow=i})(Eh,t)}(ln)),ln.exports}var pn={exports:{}},Rh=pn.exports,Ki;function Mh(){return Ki||(Ki=1,function(t){(function(e,r,n){function a(o){var c=this;c.next=function(){var g=c.x,f=c.i,l,p;return l=g[f],l^=l>>>7,p=l^l<<24,l=g[f+1&7],p^=l^l>>>10,l=g[f+3&7],p^=l^l>>>3,l=g[f+4&7],p^=l^l<<7,l=g[f+7&7],l=l^l<<13,p^=l^l<<9,g[f]=p,c.i=f+1&7,p};function u(g,f){var l,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,l=0;l<f.length;++l)p[l&7]=p[l&7]<<15^f.charCodeAt(l)+p[l+1&7]<<13;for(;p.length<8;)p.push(0);for(l=0;l<8&&p[l]===0;++l);for(l==8?p[7]=-1:p[l],g.x=p,g.i=0,l=256;l>0;--l)g.next()}u(c,o)}function s(o,c){return c.x=o.x.slice(),c.i=o.i,c}function i(o,c){o==null&&(o=+new Date);var u=new a(o),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,p=(u.next()>>>0)/4294967296,y=(l+p)/(1<<21);while(y===0);return y},f.int32=u.next,f.quick=f,g&&(g.x&&s(g,u),f.state=function(){return s(u,{})}),f}r&&r.exports?r.exports=i:this.xorshift7=i})(Rh,t)}(pn)),pn.exports}var hn={exports:{}},Dh=hn.exports,Xi;function Lh(){return Xi||(Xi=1,function(t){(function(e,r,n){function a(o){var c=this;c.next=function(){var g=c.w,f=c.X,l=c.i,p,y;return c.w=g=g+1640531527|0,y=f[l+34&127],p=f[l=l+1&127],y^=y<<13,p^=p<<17,y^=y>>>15,p^=p>>>12,y=f[l]=y^p,c.i=l,y+(g^g>>>16)|0};function u(g,f){var l,p,y,h,v,x=[],S=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,S=Math.max(S,f.length)),y=0,h=-32;h<S;++h)f&&(p^=f.charCodeAt((h+32)%f.length)),h===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,h>=0&&(v=v+1640531527|0,l=x[h&127]^=p+v,y=l==0?y+1:0);for(y>=128&&(x[(f&&f.length||0)&127]=-1),y=127,h=4*128;h>0;--h)p=x[y+34&127],l=x[y=y+1&127],p^=p<<13,l^=l<<17,p^=p>>>15,l^=l>>>12,x[y]=p^l;g.w=v,g.X=x,g.i=y}u(c,o)}function s(o,c){return c.i=o.i,c.w=o.w,c.X=o.X.slice(),c}function i(o,c){o==null&&(o=+new Date);var u=new a(o),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,p=(u.next()>>>0)/4294967296,y=(l+p)/(1<<21);while(y===0);return y},f.int32=u.next,f.quick=f,g&&(g.X&&s(g,u),f.state=function(){return s(u,{})}),f}r&&r.exports?r.exports=i:this.xor4096=i})(Dh,t)}(hn)),hn.exports}var vn={exports:{}},Vh=vn.exports,Pi;function _h(){return Pi||(Pi=1,function(t){(function(e,r,n){function a(o){var c=this,u="";c.next=function(){var f=c.b,l=c.c,p=c.d,y=c.a;return f=f<<25^f>>>7^l,l=l-p|0,p=p<<24^p>>>8^y,y=y-f|0,c.b=f=f<<20^f>>>12^l,c.c=l=l-p|0,c.d=p<<16^l>>>16^y,c.a=y-f|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,o===Math.floor(o)?(c.a=o/4294967296|0,c.b=o|0):u+=o;for(var g=0;g<u.length+20;g++)c.b^=u.charCodeAt(g)|0,c.next()}function s(o,c){return c.a=o.a,c.b=o.b,c.c=o.c,c.d=o.d,c}function i(o,c){var u=new a(o),g=c&&c.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var l=u.next()>>>11,p=(u.next()>>>0)/4294967296,y=(l+p)/(1<<21);while(y===0);return y},f.int32=u.next,f.quick=f,g&&(typeof g=="object"&&s(g,u),f.state=function(){return s(u,{})}),f}r&&r.exports?r.exports=i:this.tychei=i})(Vh,t)}(vn)),vn.exports}var yn={exports:{}};const Bh={},Fh=Object.freeze(Object.defineProperty({__proto__:null,default:Bh},Symbol.toStringTag,{value:"Module"})),Uh=T0(Fh);var mh=yn.exports,Yi;function kh(){return Yi||(Yi=1,function(t){(function(e,r,n){var a=256,s=6,i=52,o="random",c=n.pow(a,s),u=n.pow(2,i),g=u*2,f=a-1,l;function p(T,w,C){var O=[];w=w==!0?{entropy:!0}:w||{};var R=x(v(w.entropy?[T,d(r)]:T??S(),3),O),L=new y(O),M=function(){for(var D=L.g(s),V=c,B=0;D<u;)D=(D+B)*a,V*=a,B=L.g(1);for(;D>=g;)D/=2,V/=2,B>>>=1;return(D+B)/V};return M.int32=function(){return L.g(4)|0},M.quick=function(){return L.g(4)/4294967296},M.double=M,x(d(L.S),r),(w.pass||C||function(D,V,B,_){return _&&(_.S&&h(_,L),D.state=function(){return h(L,{})}),B?(n[o]=D,V):D})(M,R,"global"in w?w.global:this==n,w.state)}function y(T){var w,C=T.length,O=this,R=0,L=O.i=O.j=0,M=O.S=[];for(C||(T=[C++]);R<a;)M[R]=R++;for(R=0;R<a;R++)M[R]=M[L=f&L+T[R%C]+(w=M[R])],M[L]=w;(O.g=function(D){for(var V,B=0,_=O.i,k=O.j,G=O.S;D--;)V=G[_=f&_+1],B=B*a+G[f&(G[_]=G[k=f&k+V])+(G[k]=V)];return O.i=_,O.j=k,B})(a)}function h(T,w){return w.i=T.i,w.j=T.j,w.S=T.S.slice(),w}function v(T,w){var C=[],O=typeof T,R;if(w&&O=="object")for(R in T)try{C.push(v(T[R],w-1))}catch{}return C.length?C:O=="string"?T:T+"\0"}function x(T,w){for(var C=T+"",O,R=0;R<C.length;)w[f&R]=f&(O^=w[f&R]*19)+C.charCodeAt(R++);return d(w)}function S(){try{var T;return l&&(T=l.randomBytes)?T=T(a):(T=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(T)),d(T)}catch{var w=e.navigator,C=w&&w.plugins;return[+new Date,e,C,e.screen,d(r)]}}function d(T){return String.fromCharCode.apply(0,T)}if(x(n.random(),r),t.exports){t.exports=p;try{l=Uh}catch{}}else n["seed"+o]=p})(typeof self<"u"?self:mh,[],Math)}(yn)),yn.exports}var Ta,qi;function Nh(){if(qi)return Ta;qi=1;var t=Sh(),e=wh(),r=Oh(),n=Mh(),a=Lh(),s=_h(),i=kh();return i.alea=t,i.xor128=e,i.xorwow=r,i.xorshift7=n,i.xor4096=a,i.tychei=s,Ta=i,Ta}Nh();const Gh=1e-6,bh=1e-12,{vtkErrorMacro:EE,vtkWarningMacro:Ii}=E;function es(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3;const e=Array(t);for(let r=0;r<t;++r)e[r]=0;return e}function ie(t){return t/180*Math.PI}function Er(t){return t*180/Math.PI}const{round:$r}=Math;function me(t){let e=1;for(;e<t;)e*=2;return e}function Wr(t){return t===me(t)}function ts(t,e,r){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function yt(t,e,r){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function Qi(t,e,r,n){return n[0]=t[0]+e[0]*r,n[1]=t[1]+e[1]*r,n[2]=t[2]+e[2]*r,n}function K(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Or(t,e,r){const n=t[1]*e[2]-t[2]*e[1],a=t[2]*e[0]-t[0]*e[2],s=t[0]*e[1]-t[1]*e[0];return r[0]=n,r[1]=a,r[2]=s,r}function cf(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;switch(e){case 1:return Math.abs(t);case 2:return Math.sqrt(t[0]*t[0]+t[1]*t[1]);case 3:return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);default:{let r=0;for(let n=0;n<e;n++)r+=t[n]*t[n];return Math.sqrt(r)}}}function Rr(t){const e=cf(t);return e!==0&&(t[0]/=e,t[1]/=e,t[2]/=e),e}function Ae(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])+(t[2]-e[2])*(t[2]-e[2])}function $h(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Wh(t){const e=$h(t);return e!==0&&(t[0]/=e,t[1]/=e),e}function dn(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.length===2?e[0][0]*e[1][1]-e[1][0]*e[0][1]:e.length===4?e[0]*e[3]-e[1]*e[2]:Number.NaN}function zh(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Gh;if(t.length!==e.length)return!1;function n(a,s){return Math.abs(a-e[s])<=r}return t.every(n)}const Hh=zh;function xa(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!`${t}`.includes("e"))return+`${Math.round(`${t}e+${e}`)}e-${e}`;const r=`${t}`.split("e");let n="";return+r[1]+e>0&&(n="+"),+`${Math.round(`${+r[0]}e${n}${+r[1]+e}`)}e-${e}`}function Zi(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return e[0]=xa(t[0],r),e[1]=xa(t[1],r),e[2]=xa(t[2],r),e}function Ah(t,e,r){let n,a,s,i,o=0,c,u,g;const f=es(r);for(n=0;n<r;n++){for(i=0,a=0;a<r;a++)(g=Math.abs(t[n*r+a]))>i&&(i=g);if(i===0)return Ii("Unable to factor linear system"),0;f[n]=1/i}for(a=0;a<r;a++){for(n=0;n<a;n++){for(c=t[n*r+a],s=0;s<n;s++)c-=t[n*r+s]*t[s*r+a];t[n*r+a]=c}for(i=0,n=a;n<r;n++){for(c=t[n*r+a],s=0;s<a;s++)c-=t[n*r+s]*t[s*r+a];t[n*r+a]=c,(u=f[n]*Math.abs(c))>=i&&(i=u,o=n)}if(a!==o){for(s=0;s<r;s++)u=t[o*r+s],t[o*r+s]=t[a*r+s],t[a*r+s]=u;f[o]=f[a]}if(e[a]=o,Math.abs(t[a*r+a])<=bh)return Ii("Unable to factor linear system"),0;if(a!==r-1)for(u=1/t[a*r+a],n=a+1;n<r;n++)t[n*r+a]*=u}return 1}function jh(t,e,r,n){let a,s,i,o,c;for(i=-1,a=0;a<n;a++){if(o=e[a],c=r[o],r[o]=r[a],i>=0)for(s=i;s<=a-1;s++)c-=t[a*n+s]*r[s];else c!==0&&(i=a);r[a]=c}for(a=n-1;a>=0;a--){for(c=r[a],s=a+1;s<n;s++)c-=t[a*n+s]*r[s];r[a]=c/t[a*n+a]}}function Kh(t,e,r){if(r===2){const a=es(2),s=dn(t[0],t[1],t[2],t[3]);return s===0?0:(a[0]=(t[3]*e[0]-t[1]*e[1])/s,a[1]=(-(t[2]*e[0])+t[0]*e[1])/s,e[0]=a[0],e[1]=a[1],1)}if(r===1)return t[0]===0?0:(e[0]/=t[0],1);const n=es(r);return Ah(t,n,r)===0?0:(jh(t,n,e,r),1)}function Xh(t,e){const[r,n,a]=t,s=1/3,i=1/6,o=2/3,c=5/6;let u,g,f;r>i&&r<=s?(g=1,u=(s-r)/i,f=0):r>s&&r<=.5?(g=1,f=(r-s)/i,u=0):r>.5&&r<=o?(f=1,g=(o-r)/i,u=0):r>o&&r<=c?(f=1,u=(r-o)/i,g=0):r>c&&r<=1?(u=1,f=(1-r)/i,g=0):(u=1,g=r/i,f=0),u=n*u+(1-n),g=n*g+(1-n),f=n*f+(1-n),u*=a,g*=a,f*=a,e[0]=u,e[1]=g,e[2]=f}function Bs(t){return t[0]=1,t[1]=-1,t[2]=1,t[3]=-1,t[4]=1,t[5]=-1,t}function Sa(t){return!(t[1]-t[0]<0)}function Ca(t,e,r){return t<e?e:t>r?r:t}function Ji(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[0,0,0];return n[0]=Ca(t[0],e[0],r[0]),n[1]=Ca(t[1],e[1],r[1]),n[2]=Ca(t[2],e[2],r[2]),n}const{isNaN:Ph}=Number,ff=Ph;function Fs(){return[].concat([Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE])}function Yh(t,e){e.classHierarchy.push("vtkImplicitFunction"),t.functionValue=r=>{if(!e.transform)return t.evaluateFunction(r);const n=[];return e.transform.transformPoint(r,n),t.evaluateFunction(n)},t.evaluateFunction=r=>{E.vtkErrorMacro("not implemented")}}const qh={};function uf(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,qh,r),E.obj(t,e),E.setGet(t,e,["transform"]),Yh(t,e)}const Ih=E.newInstance(uf,"vtkImplicitFunction");var Qh={newInstance:Ih,extend:uf};const rs=1e-6,gf="coincide",lf="disjoint";function Zh(t,e,r){return t[0]*(r[0]-e[0])+t[1]*(r[1]-e[1])+t[2]*(r[2]-e[2])}function pf(t,e,r){const n=r[0]*(t[0]-e[0])+r[1]*(t[1]-e[1])+r[2]*(t[2]-e[2]);return Math.abs(n)}function hf(t,e,r,n){const a=[];yt(t,e,a);const s=K(r,a);n[0]=t[0]-s*r[0],n[1]=t[1]-s*r[1],n[2]=t[2]-s*r[2]}function vf(t,e,r){const n=K(t,e);let a=K(e,e);return a===0&&(a=1),r[0]=t[0]-n*e[0]/a,r[1]=t[1]-n*e[1]/a,r[2]=t[2]-n*e[2]/a,r}function yf(t,e,r,n){const a=[];yt(t,e,a);const s=K(r,a),i=K(r,r);i!==0?(n[0]=t[0]-s*r[0]/i,n[1]=t[1]-s*r[1]/i,n[2]=t[2]-s*r[2]/i):(n[0]=t[0],n[1]=t[1],n[2]=t[2])}function df(t,e,r,n){const a={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},s=[],i=[];yt(e,t,s),yt(r,t,i);const o=K(n,i),c=K(n,s);let u,g;return c<0?u=-c:u=c,o<0?g=-o*rs:g=o*rs,u<=g||(a.t=o/c,a.x[0]=t[0]+a.t*s[0],a.x[1]=t[1]+a.t*s[1],a.x[2]=t[2]+a.t*s[2],a.intersection=!0,a.betweenPoints=a.t>=0&&a.t<=1),a}function Tf(t,e,r,n){const a={intersection:!1,l0:[],l1:[],error:null},s=[];Or(e,n,s);const i=s.map(f=>Math.abs(f));if(i[0]+i[1]+i[2]<rs){const f=[];return yt(t,r,f),K(e,f)===0?a.error=gf:a.error=lf,a}let o;i[0]>i[1]&&i[0]>i[2]?o="x":i[1]>i[2]?o="y":o="z";const c=[],u=-K(e,t),g=-K(n,r);switch(o){case"x":c[0]=0,c[1]=(g*e[2]-u*n[2])/s[0],c[2]=(u*n[1]-g*e[1])/s[0];break;case"y":c[0]=(u*n[2]-g*e[2])/s[1],c[1]=0,c[2]=(g*e[0]-u*n[0])/s[1];break;case"z":c[0]=(g*e[1]-u*n[1])/s[2],c[1]=(u*n[0]-g*e[0])/s[2],c[2]=0;break}return a.l0=c,ts(c,s,a.l1),a.intersection=!0,a}const Jh={evaluate:Zh,distanceToPlane:pf,projectPoint:hf,projectVector:vf,generalizedProjectPoint:yf,intersectWithLine:df,intersectWithPlane:Tf,DISJOINT:lf,COINCIDE:gf};function e1(t,e){e.classHierarchy.push("vtkPlane"),t.distanceToPlane=r=>pf(r,e.origin,e.normal),t.projectPoint=(r,n)=>{hf(r,e.origin,e.normal,n)},t.projectVector=(r,n)=>vf(r,e.normal,n),t.push=r=>{if(r!==0)for(let n=0;n<3;n++)e.origin[n]+=r*e.normal[n]},t.generalizedProjectPoint=(r,n)=>{yf(r,e.origin,e.normal,n)},t.evaluateFunction=(r,n,a)=>Array.isArray(r)?e.normal[0]*(r[0]-e.origin[0])+e.normal[1]*(r[1]-e.origin[1])+e.normal[2]*(r[2]-e.origin[2]):e.normal[0]*(r-e.origin[0])+e.normal[1]*(n-e.origin[1])+e.normal[2]*(a-e.origin[2]),t.evaluateGradient=r=>[e.normal[0],e.normal[1],e.normal[2]],t.intersectWithLine=(r,n)=>df(r,n,e.origin,e.normal),t.intersectWithPlane=(r,n)=>Tf(r,n,e.origin,e.normal)}const t1={normal:[0,0,1],origin:[0,0,0]};function xf(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,t1,r),Qh.extend(t,e,r),E.setGetArray(t,e,["normal","origin"],3),e1(t,e)}const r1=E.newInstance(xf,"vtkPlane");var Qt={newInstance:r1,extend:xf,...Jh};const jn=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function Sf(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function et(t){return(t==null?void 0:t.length)>=6&&t[0]<=t[1]&&t[2]<=t[3]&&t[4]<=t[5]}function Us(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function ms(t){return Us(t,jn)}function Bn(t,e,r,n){const[a,s,i,o,c,u]=t;return t[0]=a<e?a:e,t[1]=s>e?s:e,t[2]=i<r?i:r,t[3]=o>r?o:r,t[4]=c<n?c:n,t[5]=u>n?u:n,t}function ks(t,e){if(e.length===0)return t;if(Array.isArray(e[0]))for(let r=0;r<e.length;++r)Bn(t,...e[r]);else for(let r=0;r<e.length;r+=3)Bn(t,...e.slice(r,r+3));return t}function Cf(t,e,r,n,a,s,i){const[o,c,u,g,f,l]=t;return i===void 0?(t[0]=Math.min(e[0],o),t[1]=Math.max(e[1],c),t[2]=Math.min(e[2],u),t[3]=Math.max(e[3],g),t[4]=Math.min(e[4],f),t[5]=Math.max(e[5],l)):(t[0]=Math.min(e,o),t[1]=Math.max(r,c),t[2]=Math.min(n,u),t[3]=Math.max(a,g),t[4]=Math.min(s,f),t[5]=Math.max(i,l)),t}function wf(t,e,r,n){const[a,s,i,o,c,u]=t;return t[0]=e,t[1]=e>s?e:s,t[2]=r,t[3]=r>o?r:o,t[4]=n,t[5]=n>u?n:u,a!==e||i!==r||c!==n}function Ef(t,e,r,n){const[a,s,i,o,c,u]=t;return t[0]=e<a?e:a,t[1]=e,t[2]=r<i?r:i,t[3]=r,t[4]=n<c?n:c,t[5]=n,s!==e||o!==r||u!==n}function Of(t,e){return t[0]-=e,t[1]+=e,t[2]-=e,t[3]+=e,t[4]-=e,t[5]+=e,t}function Ns(t,e,r,n){return et(t)?(e>=0?(t[0]*=e,t[1]*=e):(t[0]=e*t[1],t[1]=e*t[0]),r>=0?(t[2]*=r,t[3]*=r):(t[2]=r*t[3],t[3]=r*t[2]),n>=0?(t[4]*=n,t[5]*=n):(t[4]=n*t[5],t[5]=n*t[4]),!0):!1}function Gs(t){return[.5*(t[0]+t[1]),.5*(t[2]+t[3]),.5*(t[4]+t[5])]}function n1(t,e,r,n){if(!et(t))return!1;const a=Gs(t);return t[0]-=a[0],t[1]-=a[0],t[2]-=a[1],t[3]-=a[1],t[4]-=a[2],t[5]-=a[2],Ns(t,e,r,n),t[0]+=a[0],t[1]+=a[0],t[2]+=a[1],t[3]+=a[1],t[4]+=a[2],t[5]+=a[2],!0}function yr(t,e){return t[e*2+1]-t[e*2]}function Kn(t){return[yr(t,0),yr(t,1),yr(t,2)]}function Rf(t){return t.slice(0,2)}function Mf(t){return t.slice(2,4)}function Df(t){return t.slice(4,6)}function Lf(t){const e=Kn(t);return e[0]>e[1]?e[0]>e[2]?e[0]:e[2]:e[1]>e[2]?e[1]:e[2]}function Vf(t){if(et(t)){const e=Kn(t);return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}return null}function bs(t){return[t[0],t[2],t[4]]}function $s(t){return[t[1],t[3],t[5]]}function zr(t,e){return t<=0&&e>=0||t>=0&&e<=0}function Ws(t,e){let r=0;for(let n=0;n<2;n++)for(let a=2;a<4;a++)for(let s=4;s<6;s++)e[r++]=[t[n],t[a],t[s]];return e}function _f(t,e,r){return e[0]=t[0],e[1]=t[2],e[2]=t[4],r[0]=t[1],r[1]=t[3],r[2]=t[5],e}function Bf(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const n=Ws(t,[]);for(let a=0;a<n.length;++a)I(n[a],n[a],e);return ms(r),ks(r,n)}function Ff(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e[0]=.5*(t[1]-t[0]),e[1]=.5*(t[3]-t[2]),e[2]=.5*(t[5]-t[4]),e}function Uf(t,e,r,n){const a=[].concat(jn),s=t.getData();for(let i=0;i<s.length;i+=3){const o=[s[i],s[i+1],s[i+2]],c=K(o,e);a[0]=Math.min(c,a[0]),a[1]=Math.max(c,a[1]);const u=K(o,r);a[2]=Math.min(u,a[2]),a[3]=Math.max(u,a[3]);const g=K(o,n);a[4]=Math.min(g,a[4]),a[5]=Math.max(g,a[5])}return a}function mf(t,e,r,n,a){let s=!0;const i=[];let o=0;const c=[],u=[0,0,0],g=0,f=1,l=2;for(let p=0;p<3;p++)e[p]<t[2*p]?(i[p]=f,u[p]=t[2*p],s=!1):e[p]>t[2*p+1]?(i[p]=g,u[p]=t[2*p+1],s=!1):i[p]=l;if(s)return n[0]=e[0],n[1]=e[1],n[2]=e[2],a[0]=0,1;for(let p=0;p<3;p++)i[p]!==l&&r[p]!==0?c[p]=(u[p]-e[p])/r[p]:c[p]=-1;for(let p=0;p<3;p++)c[o]<c[p]&&(o=p);if(c[o]>1||c[o]<0)return 0;a[0]=c[o];for(let p=0;p<3;p++)if(o!==p){if(n[p]=e[p]+c[o]*r[p],n[p]<t[2*p]||n[p]>t[2*p+1])return 0}else n[p]=u[p];return 1}function kf(t,e,r){const n=[];let a=0,s=1,i=1;for(let o=4;o<=5;++o){n[2]=t[o];for(let c=2;c<=3;++c){n[1]=t[c];for(let u=0;u<=1;++u)if(n[0]=t[u],a=Qt.evaluate(r,e,n),i&&(s=a>=0?1:-1,i=0),a===0||s>0&&a<0||s<0&&a>0)return 1}}return 0}function Nf(t,e){if(!(et(t)&&et(e)))return!1;const r=[0,0,0,0,0,0];let n;for(let a=0;a<3;a++)if(n=!1,e[a*2]>=t[a*2]&&e[a*2]<=t[a*2+1]?(n=!0,r[a*2]=e[a*2]):t[a*2]>=e[a*2]&&t[a*2]<=e[a*2+1]&&(n=!0,r[a*2]=t[a*2]),e[a*2+1]>=t[a*2]&&e[a*2+1]<=t[a*2+1]?(n=!0,r[a*2+1]=e[2*a+1]):t[a*2+1]>=e[a*2]&&t[a*2+1]<=e[a*2+1]&&(n=!0,r[a*2+1]=t[a*2+1]),!n)return!1;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],!0}function Fn(t,e){if(!(et(t)&&et(e)))return!1;for(let r=0;r<3;r++)if(!(e[r*2]>=t[r*2]&&e[r*2]<=t[r*2+1])&&!(t[r*2]>=e[r*2]&&t[r*2]<=e[r*2+1])&&!(e[r*2+1]>=t[r*2]&&e[r*2+1]<=t[r*2+1])&&!(t[r*2+1]>=e[r*2]&&t[r*2+1]<=e[r*2+1]))return!1;return!0}function Un(t,e,r,n){return!(e<t[0]||e>t[1]||r<t[2]||r>t[3]||n<t[4]||n>t[5])}function a1(t,e){return!(!Fn(t,e)||!Un(t,...bs(e))||!Un(t,...$s(e)))}function Gf(t,e,r){const n=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],a=[0,0,0,0,0,0,0,0];let s=0;for(let f=0;f<2;f++)for(let l=2;l<4;l++)for(let p=4;p<6;p++){const y=[t[f],t[l],t[p]];a[s++]=Qt.evaluate(r,e,y)}let i=2;for(;i--&&!(zr(a[n[i][0]],a[n[i][4]])&&zr(a[n[i][1]],a[n[i][5]])&&zr(a[n[i][2]],a[n[i][6]])&&zr(a[n[i][3]],a[n[i][7]])););if(i<0)return!1;const o=Math.sign(r[i]),c=Math.abs((t[i*2+1]-t[i*2])*r[i]);let u=o>0?1:0;for(let f=0;f<4;f++){if(c===0)continue;const l=Math.abs(a[n[i][f]])/c;o>0&&l<u&&(u=l),o<0&&l>u&&(u=l)}const g=(1-u)*t[i*2]+u*t[i*2+1];return o>0?t[i*2]=g:t[i*2+1]=g,!0}class s1{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(jn))}getBounds(){return this.bounds}equals(e){return Sf(this.bounds,e)}isValid(){return et(this.bounds)}setBounds(e){return Us(this.bounds,e)}reset(){return ms(this.bounds)}addPoint(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Bn(this.bounds,...r)}addPoints(e){return ks(this.bounds,e)}addBounds(e,r,n,a,s,i){return Cf(this.bounds,e,r,n,a,s,i)}setMinPoint(e,r,n){return wf(this.bounds,e,r,n)}setMaxPoint(e,r,n){return Ef(this.bounds,e,r,n)}inflate(e){return Of(this.bounds,e)}scale(e,r,n){return Ns(this.bounds,e,r,n)}getCenter(){return Gs(this.bounds)}getLength(e){return yr(this.bounds,e)}getLengths(){return Kn(this.bounds)}getMaxLength(){return Lf(this.bounds)}getDiagonalLength(){return Vf(this.bounds)}getMinPoint(){return bs(this.bounds)}getMaxPoint(){return $s(this.bounds)}getXRange(){return Rf(this.bounds)}getYRange(){return Mf(this.bounds)}getZRange(){return Df(this.bounds)}getCorners(e){return Ws(this.bounds,e)}computeCornerPoints(e,r){return _f(this.bounds,e,r)}computeLocalBounds(e,r,n){return Uf(this.bounds,e,r,n)}transformBounds(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Bf(this.bounds,e,r)}computeScale3(e){return Ff(this.bounds,e)}cutWithPlane(e,r){return Gf(this.bounds,e,r)}intersectBox(e,r,n,a){return mf(this.bounds,e,r,n,a)}intersectPlane(e,r){return kf(this.bounds,e,r)}intersect(e){return Nf(this.bounds,e)}intersects(e){return Fn(this.bounds,e)}containsPoint(e,r,n){return Un(this.bounds,e,r,n)}contains(e){return Fn(this.bounds,e)}}function i1(t){const e=t&&t.bounds;return new s1(e)}const o1={equals:Sf,isValid:et,setBounds:Us,reset:ms,addPoint:Bn,addPoints:ks,addBounds:Cf,setMinPoint:wf,setMaxPoint:Ef,inflate:Of,scale:Ns,scaleAboutCenter:n1,getCenter:Gs,getLength:yr,getLengths:Kn,getMaxLength:Lf,getDiagonalLength:Vf,getMinPoint:bs,getMaxPoint:$s,getXRange:Rf,getYRange:Mf,getZRange:Df,getCorners:Ws,computeCornerPoints:_f,computeLocalBounds:Uf,transformBounds:Bf,computeScale3:Ff,cutWithPlane:Gf,intersectBox:mf,intersectPlane:kf,intersect:Nf,intersects:Fn,containsPoint:Un,contains:a1,INIT_BOUNDS:jn};var ee={newInstance:i1,...o1};const c1={DISPLAY:0,WORLD:1};var bf={CoordinateSystem:c1};const{CoordinateSystem:ns}=bf;function eo(t){return()=>E.vtkErrorMacro(`vtkProp::${t} - NOT IMPLEMENTED`)}function f1(t,e){e.classHierarchy.push("vtkProp"),t.getMTime=()=>{let r=e.mtime;for(let n=0;n<e.textures.length;++n){const a=e.textures[n].getMTime();a>r&&(r=a)}return r},t.processSelectorPixelBuffers=(r,n)=>{},t.getNestedProps=()=>null,t.getActors=()=>[],t.getActors2D=()=>[],t.getVolumes=()=>[],t.pick=eo("pick"),t.hasKey=eo("hasKey"),t.getNestedVisibility=()=>e.visibility&&(!e._parentProp||e._parentProp.getNestedVisibility()),t.getNestedPickable=()=>e.pickable&&(!e._parentProp||e._parentProp.getNestedPickable()),t.getNestedDragable=()=>e.dragable&&(!e._parentProp||e._parentProp.getNestedDragable()),t.getRedrawMTime=()=>e.mtime,t.setEstimatedRenderTime=r=>{e.estimatedRenderTime=r,e.savedEstimatedRenderTime=r},t.restoreEstimatedRenderTime=()=>{e.estimatedRenderTime=e.savedEstimatedRenderTime},t.addEstimatedRenderTime=r=>{e.estimatedRenderTime+=r},t.setAllocatedRenderTime=r=>{e.allocatedRenderTime=r,e.savedEstimatedRenderTime=e.estimatedRenderTime,e.estimatedRenderTime=0},t.getSupportsSelection=()=>!1,t.getTextures=()=>e.textures,t.hasTexture=r=>e.textures.indexOf(r)!==-1,t.addTexture=r=>{r&&!t.hasTexture(r)&&(e.textures=e.textures.concat(r),t.modified())},t.removeTexture=r=>{const n=e.textures.filter(a=>a!==r);e.textures.length!==n.length&&(e.textures=n,t.modified())},t.removeAllTextures=()=>{e.textures=[],t.modified()},t.setCoordinateSystemToWorld=()=>t.setCoordinateSystem(ns.WORLD),t.setCoordinateSystemToDisplay=()=>t.setCoordinateSystem(ns.DISPLAY)}const u1={allocatedRenderTime:10,coordinateSystem:ns.WORLD,dragable:!0,estimatedRenderTime:0,paths:null,pickable:!0,renderTimeMultiplier:1,savedEstimatedRenderTime:0,textures:[],useBounds:!0,visibility:!0};function $f(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,u1,r),E.obj(t,e),E.get(t,e,["estimatedRenderTime","allocatedRenderTime"]),E.setGet(t,e,["_parentProp","coordinateSystem","dragable","pickable","renderTimeMultiplier","useBounds","visibility"]),E.moveToProtected(t,e,["parentProp"]),f1(t,e)}const g1=E.newInstance($f,"vtkProp");var _r={newInstance:g1,extend:$f,...bf};const l1=1e-6;function p1(t,e){e.classHierarchy.push("vtkProp3D"),t.addPosition=n=>{e.position=e.position.map((a,s)=>a+n[s]),t.modified()},t.getOrientationWXYZ=()=>{const n=Nt();Ka(n,e.rotation);const a=new Float64Array(3),s=v0(a,n);return[Er(s),a[0],a[1],a[2]]},t.getOrientationQuaternion=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Ka(n,e.rotation)},t.rotateX=n=>{n!==0&&(ac(e.rotation,e.rotation,ie(n)),t.modified())},t.rotateY=n=>{n!==0&&(sc(e.rotation,e.rotation,ie(n)),t.modified())},t.rotateZ=n=>{n!==0&&(ic(e.rotation,e.rotation,ie(n)),t.modified())},t.rotateWXYZ=(n,a,s,i)=>{if(n===0||a===0&&s===0&&i===0)return;const o=ie(n),c=Nt();ds(c,[a,s,i],o);const u=new Float64Array(16);Cn(u,c),de(e.rotation,e.rotation,u),t.modified()},t.rotateQuaternion=n=>{if(Math.abs(n[3])>=1-l1)return;const a=Cn(new Float64Array(16),n);de(e.rotation,e.rotation,a),t.modified()},t.setOrientation=(n,a,s)=>n===e.orientation[0]&&a===e.orientation[1]&&s===e.orientation[2]?!1:(e.orientation=[n,a,s],j(e.rotation),t.rotateZ(s),t.rotateX(n),t.rotateY(a),t.modified(),!0),t.setUserMatrix=n=>Hh(e.userMatrix,n)?!1:(ye(e.userMatrix,n),t.modified(),!0),t.getMatrix=()=>(t.computeMatrix(),e.matrix),t.computeMatrix=()=>{if(t.getMTime()>e.matrixMTime.getMTime()){j(e.matrix),e.userMatrix&&de(e.matrix,e.matrix,e.userMatrix),oe(e.matrix,e.matrix,e.origin),oe(e.matrix,e.matrix,e.position),de(e.matrix,e.matrix,e.rotation),qt(e.matrix,e.matrix,e.scale),oe(e.matrix,e.matrix,[-e.origin[0],-e.origin[1],-e.origin[2]]),te(e.matrix,e.matrix),e.isIdentity=!0;for(let n=0;n<4;++n)for(let a=0;a<4;++a)(n===a?1:0)!==e.matrix[n+a*4]&&(e.isIdentity=!1);e.matrixMTime.modified()}},t.getCenter=()=>ee.getCenter(e.bounds),t.getLength=()=>ee.getLength(e.bounds),t.getXRange=()=>ee.getXRange(e.bounds),t.getYRange=()=>ee.getYRange(e.bounds),t.getZRange=()=>ee.getZRange(e.bounds),t.getUserMatrix=()=>e.userMatrix;function r(){t.computeMatrix()}t.onModified(r)}const h1={origin:[0,0,0],position:[0,0,0],orientation:[0,0,0],rotation:null,scale:[1,1,1],bounds:[1,-1,1,-1,1,-1],userMatrix:null,userMatrixMTime:null,cachedProp3D:null,isIdentity:!0,matrixMTime:null};function Wf(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,h1,r),_r.extend(t,e,r),e.matrixMTime={},E.obj(e.matrixMTime),E.get(t,e,["bounds","isIdentity"]),E.getArray(t,e,["orientation"]),E.setGetArray(t,e,["origin","position","scale"],3),e.matrix=j(new Float64Array(16)),e.rotation=j(new Float64Array(16)),e.userMatrix=j(new Float64Array(16)),e.transform=null,p1(t,e)}const v1=E.newInstance(Wf,"vtkProp3D");var y1={newInstance:v1,extend:Wf};const zf={FLAT:0,GOURAUD:1,PHONG:2},Le={POINTS:0,WIREFRAME:1,SURFACE:2},d1=zf;var Hf={Shading:zf,Representation:Le,Interpolation:d1};const{Representation:pr,Interpolation:hr}=Hf;function to(t){return()=>E.vtkErrorMacro(`vtkProperty::${t} - NOT IMPLEMENTED`)}function T1(t,e){e.classHierarchy.push("vtkProperty"),t.setColor=(r,n,a)=>{Array.isArray(r)?(e.color[0]!==r[0]||e.color[1]!==r[1]||e.color[2]!==r[2])&&(e.color[0]=r[0],e.color[1]=r[1],e.color[2]=r[2],t.modified()):(e.color[0]!==r||e.color[1]!==n||e.color[2]!==a)&&(e.color[0]=r,e.color[1]=n,e.color[2]=a,t.modified()),t.setDiffuseColor(e.color),t.setAmbientColor(e.color),t.setSpecularColor(e.color)},t.computeCompositeColor=to("ComputeCompositeColor"),t.getColor=()=>{let r=0;e.ambient+e.diffuse+e.specular>0&&(r=1/(e.ambient+e.diffuse+e.specular));for(let n=0;n<3;n++)e.color[n]=r*(e.ambient*e.ambientColor[n]+e.diffuse*e.diffuseColor[n]+e.specular*e.specularColor[n]);return[].concat(e.color)},t.setSpecularPower=r=>{const n=1/Math.max(1,r);(e.roughness!==n||e.specularPower!==r)&&(e.specularPower=r,e.roughness=n,t.modified())},t.addShaderVariable=to("AddShaderVariable"),t.setInterpolationToFlat=()=>t.setInterpolation(hr.FLAT),t.setInterpolationToGouraud=()=>t.setInterpolation(hr.GOURAUD),t.setInterpolationToPhong=()=>t.setInterpolation(hr.PHONG),t.getInterpolationAsString=()=>E.enumToString(hr,e.interpolation),t.setRepresentationToWireframe=()=>t.setRepresentation(pr.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(pr.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(pr.POINTS),t.getRepresentationAsString=()=>E.enumToString(pr,e.representation)}const x1={color:[1,1,1],ambientColor:[1,1,1],diffuseColor:[1,1,1],specularColor:[1,1,1],edgeColor:[0,0,0],ambient:0,diffuse:1,metallic:0,roughness:.6,normalStrength:1,emission:1,baseIOR:1.45,specular:0,specularPower:1,opacity:1,interpolation:hr.GOURAUD,representation:pr.SURFACE,edgeVisibility:!1,backfaceCulling:!1,frontfaceCulling:!1,pointSize:1,lineWidth:1,lighting:!0,shading:!1,materialName:null};function S1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,x1,r),E.obj(t,e),E.setGet(t,e,["lighting","interpolation","ambient","diffuse","metallic","roughness","normalStrength","emission","baseIOR","specular","specularPower","opacity","edgeVisibility","lineWidth","pointSize","backfaceCulling","frontfaceCulling","representation","diffuseTexture","metallicTexture","roughnessTexture","normalTexture","ambientOcclusionTexture","emissionTexture"]),E.setGetArray(t,e,["ambientColor","specularColor","diffuseColor","edgeColor"],3),T1(t,e)}const C1=E.newInstance(S1,"vtkProperty");var nr={newInstance:C1,...Hf};const{vtkDebugMacro:w1}=E;function E1(t,e){e.classHierarchy.push("vtkActor");const r={...t};t.getActors=()=>[t],t.getIsOpaque=()=>{if(e.forceOpaque)return!0;if(e.forceTranslucent)return!1;e.property||t.getProperty();let n=e.property.getOpacity()>=1;return n=n&&(!e.texture||!e.texture.isTranslucent()),n=n&&(!e.mapper||e.mapper.getIsOpaque()),n},t.hasTranslucentPolygonalGeometry=()=>e.mapper===null?!1:(e.property===null&&t.setProperty(t.makeProperty()),!t.getIsOpaque()),t.makeProperty=nr.newInstance,t.getProperty=()=>(e.property===null&&(e.property=t.makeProperty()),e.property),t.getBounds=()=>{if(e.mapper===null)return e.bounds;const n=e.mapper.getBounds();if(!n||n.length!==6)return n;if(n[0]>n[1])return e.mapperBounds=n.concat(),e.bounds=[1,-1,1,-1,1,-1],e.boundsMTime.modified(),n;if(!e.mapperBounds||n[0]!==e.mapperBounds[0]||n[1]!==e.mapperBounds[1]||n[2]!==e.mapperBounds[2]||n[3]!==e.mapperBounds[3]||n[4]!==e.mapperBounds[4]||n[5]!==e.mapperBounds[5]||t.getMTime()>e.boundsMTime.getMTime()){w1("Recomputing bounds..."),e.mapperBounds=n.concat();const a=[];ee.getCorners(n,a),t.computeMatrix();const s=new Float64Array(16);te(s,e.matrix),a.forEach(i=>I(i,i,s)),e.bounds[0]=e.bounds[2]=e.bounds[4]=Number.MAX_VALUE,e.bounds[1]=e.bounds[3]=e.bounds[5]=-Number.MAX_VALUE,e.bounds=e.bounds.map((i,o)=>o%2===0?a.reduce((c,u)=>c>u[o/2]?u[o/2]:c,i):a.reduce((c,u)=>c<u[(o-1)/2]?u[(o-1)/2]:c,i)),e.boundsMTime.modified()}return e.bounds},t.getMTime=()=>{let n=r.getMTime();if(e.property!==null){const a=e.property.getMTime();n=a>n?a:n}if(e.backfaceProperty!==null){const a=e.backfaceProperty.getMTime();n=a>n?a:n}return n},t.getRedrawMTime=()=>{let n=e.mtime;if(e.mapper!==null){let a=e.mapper.getMTime();n=a>n?a:n,e.mapper.getInput()!==null&&(e.mapper.getInputAlgorithm().update(),a=e.mapper.getInput().getMTime(),n=a>n?a:n)}return n},t.getSupportsSelection=()=>e.mapper?e.mapper.getSupportsSelection():!1,t.processSelectorPixelBuffers=(n,a)=>{e.mapper&&e.mapper.processSelectorPixelBuffers&&e.mapper.processSelectorPixelBuffers(n,a)}}const O1={mapper:null,property:null,backfaceProperty:null,forceOpaque:!1,forceTranslucent:!1,bounds:[1,-1,1,-1,1,-1]};function Af(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,O1,r),y1.extend(t,e,r),e.boundsMTime={},E.obj(e.boundsMTime),E.set(t,e,["property"]),E.setGet(t,e,["backfaceProperty","forceOpaque","forceTranslucent","mapper"]),E1(t,e)}const R1=E.newInstance(Af,"vtkActor");var tt={newInstance:R1,extend:Af};const jf={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},le={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",UNSIGNED_CHAR_CLAMPED:"Uint8ClampedArray",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"},M1=le.FLOAT;var Kf={DefaultDataType:M1,DataTypeByteSize:jf,VtkDataTypes:le};const{vtkErrorMacro:D1}=Pe,{DefaultDataType:L1}=Kf,V1=1e-6;function as(t,e,r){const n=t.length;let a=Number.MAX_VALUE,s=-Number.MAX_VALUE,i,o;for(o=e;o<n;o+=r)if(!Number.isNaN(t[o])){a=t[o],s=a;break}for(;o<n;o+=r)i=t[o],i<a?a=i:i>s&&(s=i);return{min:a,max:s}}function _1(){let t=Number.MAX_VALUE,e=-Number.MAX_VALUE,r=0,n=0;return{add(a){t>a&&(t=a),e<a&&(e=a),r++,n+=a},get(){return{min:t,max:e,count:r,sum:n,mean:n/r}},getRange(){return{min:t,max:e}}}}function Xf(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;if(e<0&&r>1){const a=t.length/r,s=new Float64Array(a);for(let i=0,o=0;i<a;++i){for(let c=o+r;o<c;++o)s[i]+=t[o]*t[o];s[i]**=.5}return as(s,0,1)}return as(t,e<0?0:e,r)}function ro(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const r=t||[];for(;r.length<=e;)r.push(null);return r}function zs(t){return Object.prototype.toString.call(t).slice(8,-1)}function B1(t){const e=t.getNumberOfComponents();let r=0;const n=new Array(e);for(let a=0;a<t.getNumberOfTuples();++a){t.getTuple(a,n);const s=cf(n,e);s>r&&(r=s)}return r}const F1={computeRange:Xf,createRangeHelper:_1,fastComputeRange:as,getDataType:zs,getMaxNorm:B1};function U1(t,e){e.classHierarchy.push("vtkDataArray");function r(n){if(n<0)return!1;const a=t.getNumberOfComponents(),s=e.values.length/(a>0?a:1);if(n===s)return!0;if(n>s){const i=e.values;return e.values=tr(e.dataType,(n+s)*a),e.values.set(i),!0}return e.size>n*a&&(e.size=n*a,t.dataChange()),!0}t.dataChange=()=>{e.ranges=null,t.modified()},t.resize=n=>{r(n);const a=n*t.getNumberOfComponents();return e.size!==a?(e.size=a,t.dataChange(),!0):!1},t.initialize=()=>{t.resize(0)},t.getElementComponentSize=()=>e.values.BYTES_PER_ELEMENT,t.getComponent=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.values[n*e.numberOfComponents+a]},t.setComponent=(n,a,s)=>{s!==e.values[n*e.numberOfComponents+a]&&(e.values[n*e.numberOfComponents+a]=s,t.dataChange())},t.getValue=n=>{const a=n/e.numberOfComponents,s=n%e.numberOfComponents;return t.getComponent(a,s)},t.setValue=(n,a)=>{const s=n/e.numberOfComponents,i=n%e.numberOfComponents;t.setComponent(s,i,a)},t.getData=()=>e.size===e.values.length?e.values:e.values.subarray(0,e.size),t.getRange=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1,a=n;a<0&&(a=e.numberOfComponents===1?0:e.numberOfComponents);let s=null;return e.ranges||(e.ranges=ro(e.ranges,e.numberOfComponents)),s=e.ranges[a],s?(e.rangeTuple[0]=s.min,e.rangeTuple[1]=s.max,e.rangeTuple):(s=Xf(t.getData(),n,e.numberOfComponents),e.ranges[a]=s,e.rangeTuple[0]=s.min,e.rangeTuple[1]=s.max,e.rangeTuple)},t.setRange=(n,a)=>{e.ranges||(e.ranges=ro(e.ranges,e.numberOfComponents));const s={min:n.min,max:n.max};return e.ranges[a]=s,e.rangeTuple[0]=s.min,e.rangeTuple[1]=s.max,e.rangeTuple},t.setTuple=(n,a)=>{const s=n*e.numberOfComponents;for(let i=0;i<e.numberOfComponents;i++)e.values[s+i]=a[i]},t.setTuples=(n,a)=>{let s=n*e.numberOfComponents;const i=Math.min(a.length,e.size-s);for(let o=0;o<i;)e.values[s++]=a[o++]},t.insertTuple=(n,a)=>(e.size<=n*e.numberOfComponents&&(e.size=(n+1)*e.numberOfComponents,r(n+1)),t.setTuple(n,a),n),t.insertTuples=(n,a)=>{const s=n+a.length/e.numberOfComponents;return e.size<s*e.numberOfComponents&&(e.size=s*e.numberOfComponents,r(s)),t.setTuples(n,a),s},t.insertNextTuple=n=>{const a=e.size/e.numberOfComponents;return t.insertTuple(a,n)},t.insertNextTuples=n=>{const a=e.size/e.numberOfComponents;return t.insertTuples(a,n)},t.findTuple=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:V1;for(let s=0;s<e.size;s+=e.numberOfComponents)if(Math.abs(n[0]-e.values[s])<=a){let i=!0;for(let o=1;o<e.numberOfComponents;++o)if(Math.abs(n[o]-e.values[s+o])>a){i=!1;break}if(i)return s/e.numberOfComponents}return-1},t.getTuple=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const s=e.numberOfComponents||1,i=n*s;switch(s){case 4:a[3]=e.values[i+3];case 3:a[2]=e.values[i+2];case 2:a[1]=e.values[i+1];case 1:a[0]=e.values[i];break;default:for(let o=s-1;o>=0;--o)a[o]=e.values[i+o]}return a},t.getTuples=(n,a)=>{const s=(n??0)*e.numberOfComponents,i=(a??t.getNumberOfTuples())*e.numberOfComponents,o=t.getData().subarray(s,i);return o.length>0?o:null},t.getTupleLocation=function(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:1)*e.numberOfComponents},t.getNumberOfComponents=()=>e.numberOfComponents,t.getNumberOfValues=()=>e.size,t.getNumberOfTuples=()=>e.size/e.numberOfComponents,t.getDataType=()=>e.dataType,t.newClone=()=>Yf({empty:!0,name:e.name,dataType:e.dataType,numberOfComponents:e.numberOfComponents}),t.getName=()=>(e.name||(t.modified(),e.name=`vtkDataArray${t.getMTime()}`),e.name),t.setData=(n,a)=>{e.values=n,e.size=n.length,e.dataType=zs(n),a&&(e.numberOfComponents=a),e.size%e.numberOfComponents!==0&&(e.numberOfComponents=1),t.dataChange()},t.getState=()=>{if(e.deleted)return null;const n={...e,vtkClass:t.getClassName()};n.values=Array.from(n.values),delete n.buffer,Object.keys(n).forEach(s=>{n[s]||delete n[s]});const a={};return Object.keys(n).sort().forEach(s=>{a[s]=n[s]}),a.mtime&&delete a.mtime,a},t.deepCopy=n=>{const a=t.getDataType(),s=e.values;t.shallowCopy(n),(s==null?void 0:s.length)>=n.getNumberOfValues()&&a===n.getDataType()?(s.set(n.getData()),e.values=s,t.dataChange()):t.setData(n.getData().slice())},t.interpolateTuple=(n,a,s,i,o,c)=>{const u=e.numberOfComponents||1;(u!==a.getNumberOfComponents()||u!==i.getNumberOfComponents())&&D1("numberOfComponents must match");const g=a.getTuple(s),f=i.getTuple(o),l=[];switch(l.length=u,u){case 4:l[3]=g[3]+(f[3]-g[3])*c;case 3:l[2]=g[2]+(f[2]-g[2])*c;case 2:l[1]=g[1]+(f[1]-g[1])*c;case 1:l[0]=g[0]+(f[0]-g[0])*c;break;default:for(let p=0;p<u;p++)l[p]=g[p]+(f[p]-g[p])*c}return t.insertTuple(n,l)}}const m1={name:"",numberOfComponents:1,dataType:L1,rangeTuple:[0,0]};function Pf(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Object.assign(e,m1,r),Array.isArray(r.values)&&r.dataType===void 0&&console.warn("vtkDataArray.newInstance: no dataType provided, converting to Float32Array"),!e.empty&&!e.values&&!e.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(e.values?Array.isArray(e.values)&&(e.values=xs(e.dataType,e.values)):e.values=tr(e.dataType,e.size),e.values&&(e.size=e.size??e.values.length,e.dataType=zs(e.values)),ve(t,e),Dr(t,e,["name","numberOfComponents"]),e.size%e.numberOfComponents!==0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");U1(t,e)}const Yf=Z(Pf,"vtkDataArray");var Q={newInstance:Yf,extend:Pf,...F1,...Kf};function k1(t,e){e.classHierarchy.push("vtkAbstractMapper"),t.update=()=>{t.getInputData()},t.addClippingPlane=r=>r.isA("vtkPlane")?e.clippingPlanes.includes(r)?!1:(e.clippingPlanes.push(r),t.modified(),!0):!1,t.getNumberOfClippingPlanes=()=>e.clippingPlanes.length,t.removeAllClippingPlanes=()=>e.clippingPlanes.length===0?!1:(e.clippingPlanes.length=0,t.modified(),!0),t.removeClippingPlane=r=>{const n=e.clippingPlanes.indexOf(r);return n===-1?!1:(e.clippingPlanes.splice(n,1),t.modified(),!0)},t.getClippingPlanes=()=>e.clippingPlanes,t.setClippingPlanes=r=>{if(r)if(!Array.isArray(r))t.addClippingPlane(r);else{const n=r.length;for(let a=0;a<n&&a<6;a++)t.addClippingPlane(r[a])}},t.getClippingPlaneInDataCoords=(r,n,a)=>{const s=e.clippingPlanes,i=r;if(s){const o=s.length;if(n>=0&&n<o){const c=s[n],u=c.getNormal(),g=c.getOrigin(),f=u[0],l=u[1],p=u[2],y=-(f*g[0]+l*g[1]+p*g[2]);a[0]=f*i[0]+l*i[4]+p*i[8]+y*i[12],a[1]=f*i[1]+l*i[5]+p*i[9]+y*i[13],a[2]=f*i[2]+l*i[6]+p*i[10]+y*i[14],a[3]=f*i[3]+l*i[7]+p*i[11]+y*i[15];return}}E.vtkErrorMacro(`Clipping plane index ${n} is out of range.`)}}const N1={clippingPlanes:[]};function G1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,N1,r),E.obj(t,e),E.algo(t,e,1,0),e.clippingPlanes||(e.clippingPlanes=[]),k1(t,e)}var qf={extend:G1};function b1(t,e){t.getBounds=()=>(E.vtkErrorMacro("vtkAbstractMapper3D.getBounds - NOT IMPLEMENTED"),Fs()),t.getCenter=()=>{var n;const r=t.getBounds();return e.center=ee.isValid(r)?ee.getCenter(r):null,(n=e.center)==null?void 0:n.slice()},t.getLength=()=>{const r=t.getBounds();return ee.getDiagonalLength(r)}}const $1=t=>({bounds:[...ee.INIT_BOUNDS],center:[0,0,0],viewSpecificProperties:{},...t});function W1(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$1(r)),qf.extend(t,e,r),E.setGet(t,e,["viewSpecificProperties"]),b1(t,e)}var z1={extend:W1};const{vtkErrorMacro:no,vtkWarningMacro:H1}=E;function A1(t,e){e.classHierarchy.push("vtkFieldData");const r=t.getState;e.arrays&&(e.arrays=e.arrays.map(n=>({data:Ge(n.data)}))),t.initialize=()=>{t.initializeFields(),t.copyAllOn(),t.clearFieldFlags()},t.initializeFields=()=>{e.arrays=[],e.copyFieldFlags={},t.modified()},t.copyStructure=n=>{t.initializeFields(),e.copyFieldFlags=n.getCopyFieldFlags().map(a=>a),e.arrays=n.arrays().map(a=>({array:a}))},t.getNumberOfArrays=()=>e.arrays.length,t.getNumberOfActiveArrays=()=>e.arrays.length,t.addArray=n=>{const a=n.getName(),{array:s,index:i}=t.getArrayWithIndex(a);return s!=null?(e.arrays[i]={data:n},i):(e.arrays=[].concat(e.arrays,{data:n}),e.arrays.length-1)},t.removeAllArrays=()=>{e.arrays=[]},t.removeArray=n=>{const a=e.arrays.findIndex(s=>s.data.getName()===n);return t.removeArrayByIndex(a)},t.removeArrayByIndex=n=>n!==-1&&n<e.arrays.length?(e.arrays.splice(n,1),!0):!1,t.getArrays=()=>e.arrays.map(n=>n.data),t.getArray=n=>typeof n=="number"?t.getArrayByIndex(n):t.getArrayByName(n),t.getArrayByName=n=>e.arrays.reduce((a,s,i)=>s.data.getName()===n?s.data:a,null),t.getArrayWithIndex=n=>{const a=e.arrays.findIndex(s=>s.data.getName()===n);return{array:a!==-1?e.arrays[a].data:null,index:a}},t.getArrayByIndex=n=>n>=0&&n<e.arrays.length?e.arrays[n].data:null,t.hasArray=n=>t.getArrayWithIndex(n).index>=0,t.getArrayName=n=>{const a=e.arrays[n];return a?a.data.getName():""},t.getCopyFieldFlags=()=>e.copyFieldFlags,t.getFlag=n=>e.copyFieldFlags[n],t.passData=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1;n.getArrays().forEach(i=>{const o=t.getFlag(i.getName());if(o!==!1&&!(e.doCopyAllOff&&o!==!0)&&i){let c=t.getArrayByName(i.getName());if(c)if(i.getNumberOfComponents()===c.getNumberOfComponents())if(a>-1&&a<i.getNumberOfTuples()){const u=s>-1?s:a;c.insertTuple(u,i.getTuple(a))}else c.insertTuples(0,i.getTuples());else no("Unhandled case in passData");else if(a<0||a>i.getNumberOfTuples())t.addArray(i),n.getAttributes(i).forEach(u=>{t.setAttribute(i,u)});else{const u=i.getNumberOfComponents();let g=i.getNumberOfValues();const f=s>-1?s:a;g<=f*u&&(g=(f+1)*u),c=Q.newInstance({name:i.getName(),dataType:i.getDataType(),numberOfComponents:u,values:E.newTypedArray(i.getDataType(),g),size:0}),c.insertTuple(f,i.getTuple(a)),t.addArray(c),n.getAttributes(i).forEach(l=>{t.setAttribute(c,l)})}}})},t.interpolateData=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:-1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5;n.getArrays().forEach(c=>{const u=t.getFlag(c.getName());if(u!==!1&&!(e.doCopyAllOff&&u!==!0)&&c){let g=t.getArrayByName(c.getName());if(g)if(c.getNumberOfComponents()===g.getNumberOfComponents())if(a>-1&&a<c.getNumberOfTuples()){const f=i>-1?i:a;g.interpolateTuple(f,c,a,c,s,o),H1("Unexpected case in interpolateData")}else g.insertTuples(c.getTuples());else no("Unhandled case in interpolateData");else if(a<0||s<0||a>c.getNumberOfTuples())t.addArray(c),n.getAttributes(c).forEach(f=>{t.setAttribute(c,f)});else{const f=c.getNumberOfComponents();let l=c.getNumberOfValues();const p=i>-1?i:a;l<=p*f&&(l=(p+1)*f),g=Q.newInstance({name:c.getName(),dataType:c.getDataType(),numberOfComponents:f,values:E.newTypedArray(c.getDataType(),l),size:0}),g.interpolateTuple(p,c,a,c,s,o),t.addArray(g),n.getAttributes(c).forEach(y=>{t.setAttribute(g,y)})}}})},t.copyFieldOn=n=>{e.copyFieldFlags[n]=!0},t.copyFieldOff=n=>{e.copyFieldFlags[n]=!1},t.copyAllOn=()=>{(!e.doCopyAllOn||e.doCopyAllOff)&&(e.doCopyAllOn=!0,e.doCopyAllOff=!1,t.modified())},t.copyAllOff=()=>{(e.doCopyAllOn||!e.doCopyAllOff)&&(e.doCopyAllOn=!1,e.doCopyAllOff=!0,t.modified())},t.clearFieldFlags=()=>{e.copyFieldFlags={}},t.deepCopy=n=>{e.arrays=n.getArrays().map(a=>{const s=a.newClone();return s.deepCopy(a),{data:s}})},t.copyFlags=n=>n.getCopyFieldFlags().map(a=>a),t.reset=()=>e.arrays.forEach(n=>n.data.reset()),t.getMTime=()=>e.arrays.reduce((n,a)=>a.data.getMTime()>n?a.data.getMTime():n,e.mtime),t.getNumberOfComponents=()=>e.arrays.reduce((n,a)=>n+a.data.getNumberOfComponents(),0),t.getNumberOfTuples=()=>e.arrays.length>0?e.arrays[0].getNumberOfTuples():0,t.getState=()=>{const n=r();return n&&(n.arrays=e.arrays.map(a=>({data:a.data.getState()}))),n}}const j1={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function If(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,j1,r),E.obj(t,e),A1(t,e)}const K1=E.newInstance(If,"vtkFieldData");var X1={newInstance:K1,extend:If};const P1={SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},Y1={MAX:0,EXACT:1,NOLIMIT:2},q1={DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},I1={DUPLICATEPOINT:1,HIDDENPOINT:2},Q1={COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},Z1="vtkGhostType",J1={DEFAULT:0,SINGLE:1,DOUBLE:2};var Qf={AttributeCopyOperations:Q1,AttributeLimitTypes:Y1,AttributeTypes:P1,CellGhostTypes:q1,DesiredOutputPrecision:J1,PointGhostTypes:I1,ghostArrayName:Z1};const{AttributeTypes:st,AttributeCopyOperations:St}=Qf,{vtkWarningMacro:Hr}=E;function ev(t,e){const r=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function n(i){let o=r.find(c=>st[c.toUpperCase()]===i||typeof i!="number"&&c.toLowerCase()===i.toLowerCase());return typeof o>"u"&&(o=null),o}e.classHierarchy.push("vtkDataSetAttributes");const a={...t};t.checkNumberOfComponents=i=>!0,t.setAttribute=(i,o)=>{const c=n(o);if(i&&c.toUpperCase()==="PEDIGREEIDS"&&!i.isA("vtkDataArray"))return Hr(`Cannot set attribute ${c}. The attribute must be a vtkDataArray.`),-1;if(i&&!t.checkNumberOfComponents(i,c))return Hr(`Cannot set attribute ${c}. Incorrect number of components.`),-1;let u=e[`active${c}`];if(u>=0&&u<e.arrays.length){if(e.arrays[u]===i)return u;t.removeArrayByIndex(u)}return i?(u=t.addArray(i),e[`active${c}`]=u):e[`active${c}`]=-1,t.modified(),e[`active${c}`]},t.getAttributes=i=>r.filter(o=>t[`get${o}`]()===i),t.setActiveAttributeByName=(i,o)=>t.setActiveAttributeByIndex(t.getArrayWithIndex(i).index,o),t.setActiveAttributeByIndex=(i,o)=>{const c=n(o);if(i>=0&&i<e.arrays.length){if(c.toUpperCase()!=="PEDIGREEIDS"){const u=t.getArrayByIndex(i);if(!u.isA("vtkDataArray"))return Hr(`Cannot set attribute ${c}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!t.checkNumberOfComponents(u,c))return Hr(`Cannot set attribute ${c}. Incorrect number of components.`),-1}return e[`active${c}`]=i,t.modified(),i}return i===-1&&(e[`active${c}`]=i,t.modified()),-1},t.getActiveAttribute=i=>{const o=n(i);return t[`get${o}`]()},t.removeAllArrays=()=>{r.forEach(i=>{e[`active${i}`]=-1}),a.removeAllArrays()},t.removeArrayByIndex=i=>(i!==-1&&r.forEach(o=>{i===e[`active${o}`]?e[`active${o}`]=-1:i<e[`active${o}`]&&(e[`active${o}`]-=1)}),a.removeArrayByIndex(i)),r.forEach(i=>{const o=`active${i}`;t[`get${i}`]=()=>t.getArrayByIndex(e[o]),t[`set${i}`]=c=>t.setAttribute(c,i),t[`setActive${i}`]=c=>t.setActiveAttributeByIndex(t.getArrayWithIndex(c).index,i),t[`copy${i}Off`]=()=>{const c=i.toUpperCase();e.copyAttributeFlags[St.PASSDATA][st[c]]=!1},t[`copy${i}On`]=()=>{const c=i.toUpperCase();e.copyAttributeFlags[St.PASSDATA][st[c]]=!0}}),t.initializeAttributeCopyFlags=()=>{e.copyAttributeFlags=[],Object.keys(St).filter(i=>i!=="ALLCOPY").forEach(i=>{e.copyAttributeFlags[St[i]]=Object.keys(st).filter(o=>o!=="NUM_ATTRIBUTES").reduce((o,c)=>(o[st[c]]=!0,o),[])}),e.copyAttributeFlags[St.COPYTUPLE][st.GLOBALIDS]=!1,e.copyAttributeFlags[St.INTERPOLATE][st.GLOBALIDS]=!1,e.copyAttributeFlags[St.COPYTUPLE][st.PEDIGREEIDS]=!1},t.initialize=E.chain(t.initialize,t.initializeAttributeCopyFlags),e.dataArrays&&Object.keys(e.dataArrays).length&&Object.keys(e.dataArrays).forEach(i=>{!e.dataArrays[i].ref&&e.dataArrays[i].type==="vtkDataArray"&&t.addArray(Q.newInstance(e.dataArrays[i]))});const s=t.shallowCopy;t.shallowCopy=(i,o)=>{s(i,o),e.arrays=i.getArrays().map(c=>{const u=c.newClone();return u.shallowCopy(c,o),{data:u}})},t.initializeAttributeCopyFlags()}const tv={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function Zf(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,tv,r),X1.extend(t,e,r),E.setGet(t,e,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),e.arrays||(e.arrays={}),ev(t,e)}const rv=E.newInstance(Zf,"vtkDataSetAttributes");var ao={newInstance:rv,extend:Zf,...Qf};const nv={UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},av={FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7};var sv={FieldDataTypes:nv,FieldAssociations:av};const ss=["pointData","cellData","fieldData"];function iv(t,e){e.classHierarchy.push("vtkDataSet"),ss.forEach(n=>{e[n]?e[n]=Ge(e[n]):e[n]=ao.newInstance()});const r=t.shallowCopy;t.shallowCopy=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(n,a),ss.forEach(s=>{e[s]=ao.newInstance(),e[s].shallowCopy(n.getReferenceByName(s))})}}const ov={};function Jf(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ov,r),E.obj(t,e),E.setGet(t,e,ss),iv(t,e)}const cv=E.newInstance(Jf,"vtkDataSet");var bt={newInstance:cv,extend:Jf,...sv};const Be={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9};var eu={StructuredType:Be};const{StructuredType:qe}=eu;function fv(t){let e=0;for(let r=0;r<3;++r)t[r*2]<t[r*2+1]&&e++;return t[0]>t[1]||t[2]>t[3]||t[4]>t[5]?qe.EMPTY:e===3?qe.XYZ_GRID:e===2?t[0]===t[1]?qe.YZ_PLANE:t[2]===t[3]?qe.XZ_PLANE:qe.XY_PLANE:e===1?t[0]<t[1]?qe.X_LINE:t[2]<t[3]?qe.Y_LINE:qe.Z_LINE:qe.SINGLE_POINT}var uv={getDataDescriptionFromExtent:fv,...eu};const{vtkErrorMacro:Ct}=E;function gv(t,e){e.classHierarchy.push("vtkImageData"),t.setExtent=function(){if(e.deleted)return Ct("instance deleted - cannot call any method"),!1;for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];const s=n.length===1?n[0]:n;if(s.length!==6)return!1;const i=e.extent.some((o,c)=>o!==s[c]);return i&&(e.extent=s.slice(),e.dataDescription=uv.getDataDescriptionFromExtent(e.extent),t.modified()),i},t.setDimensions=function(){let r,n,a;if(e.deleted){Ct("instance deleted - cannot call any method");return}if(arguments.length===1){const s=arguments.length<=0?void 0:arguments[0];r=s[0],n=s[1],a=s[2]}else if(arguments.length===3)r=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1],a=arguments.length<=2?void 0:arguments[2];else{Ct("Bad dimension specification");return}t.setExtent(0,r-1,0,n-1,0,a-1)},t.getDimensions=()=>[e.extent[1]-e.extent[0]+1,e.extent[3]-e.extent[2]+1,e.extent[5]-e.extent[4]+1],t.getNumberOfCells=()=>{const r=t.getDimensions();let n=1;for(let a=0;a<3;a++){if(r[a]===0)return 0;r[a]>1&&(n*=r[a]-1)}return n},t.getNumberOfPoints=()=>{const r=t.getDimensions();return r[0]*r[1]*r[2]},t.getPoint=r=>{const n=t.getDimensions();if(n[0]===0||n[1]===0||n[2]===0)return Ct("Requesting a point from an empty image."),null;const a=new Float64Array(3);switch(e.dataDescription){case Be.EMPTY:return null;case Be.SINGLE_POINT:break;case Be.X_LINE:a[0]=r;break;case Be.Y_LINE:a[1]=r;break;case Be.Z_LINE:a[2]=r;break;case Be.XY_PLANE:a[0]=r%n[0],a[1]=r/n[0];break;case Be.YZ_PLANE:a[1]=r%n[1],a[2]=r/n[1];break;case Be.XZ_PLANE:a[0]=r%n[0],a[2]=r/n[0];break;case Be.XYZ_GRID:a[0]=r%n[0],a[1]=r/n[0]%n[1],a[2]=r/(n[0]*n[1]);break;default:Ct("Invalid dataDescription");break}const s=[0,0,0];return t.indexToWorld(a,s),s},t.getBounds=()=>t.extentToBounds(t.getSpatialExtent()),t.extentToBounds=r=>ee.transformBounds(r,e.indexToWorld),t.getSpatialExtent=()=>ee.inflate([...e.extent],.5),t.computeTransforms=()=>{oc(e.indexToWorld,e.origin),e.indexToWorld[0]=e.direction[0],e.indexToWorld[1]=e.direction[1],e.indexToWorld[2]=e.direction[2],e.indexToWorld[4]=e.direction[3],e.indexToWorld[5]=e.direction[4],e.indexToWorld[6]=e.direction[5],e.indexToWorld[8]=e.direction[6],e.indexToWorld[9]=e.direction[7],e.indexToWorld[10]=e.direction[8],qt(e.indexToWorld,e.indexToWorld,e.spacing),Re(e.worldToIndex,e.indexToWorld)},t.indexToWorld=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return I(n,r,e.indexToWorld),n},t.indexToWorldVec3=t.indexToWorld,t.worldToIndex=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return I(n,r,e.worldToIndex),n},t.worldToIndexVec3=t.worldToIndex,t.indexToWorldBounds=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return ee.transformBounds(r,e.indexToWorld,n)},t.worldToIndexBounds=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return ee.transformBounds(r,e.worldToIndex,n)},t.onModified(t.computeTransforms),t.computeTransforms(),t.getCenter=()=>ee.getCenter(t.getBounds()),t.computeHistogram=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const a=[0,0,0,0,0,0];t.worldToIndexBounds(r,a);const s=[0,0,0],i=[0,0,0];ee.computeCornerPoints(a,s,i),Zi(s,s),Zi(i,i);const o=t.getDimensions();Ji(s,[0,0,0],[o[0]-1,o[1]-1,o[2]-1],s),Ji(i,[0,0,0],[o[0]-1,o[1]-1,o[2]-1],i);const c=o[0],u=o[0]*o[1],g=t.getPointData().getScalars().getData();let f=-1/0,l=1/0,p=0,y=0,h=0;for(let d=s[2];d<=i[2];d++)for(let T=s[1];T<=i[1];T++){let w=s[0]+T*c+d*u;for(let C=s[0];C<=i[0];C++){if(!n||n([C,T,d],a)){const O=g[w];O>f&&(f=O),O<l&&(l=O),p+=O*O,y+=O,h+=1}++w}}const v=h>0?y/h:0,x=h?Math.abs(p/h-v*v):0,S=Math.sqrt(x);return{minimum:l,maximum:f,average:v,variance:x,sigma:S,count:h}},t.computeIncrements=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const a=[];let s=n;for(let i=0;i<3;++i)a[i]=s,s*=r[i*2+1]-r[i*2]+1;return a},t.computeOffsetIndex=r=>{let[n,a,s]=r;const i=t.getExtent(),o=t.getPointData().getScalars().getNumberOfComponents(),c=t.computeIncrements(i,o);return Math.floor((Math.round(n)-i[0])*c[0]+(Math.round(a)-i[2])*c[1]+(Math.round(s)-i[4])*c[2])},t.getOffsetIndexFromWorld=r=>{const n=t.getExtent(),a=t.worldToIndex(r);for(let s=0;s<3;++s)if(a[s]<n[s*2]||a[s]>n[s*2+1])return Ct(`GetScalarPointer: Pixel ${a} is not in memory. Current extent = ${n}`),NaN;return t.computeOffsetIndex(a)},t.getScalarValueFromWorld=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const a=t.getPointData().getScalars().getNumberOfComponents();if(n<0||n>=a)return Ct(`GetScalarPointer: Scalar Component ${n} is not within bounds. Current Scalar numberOfComponents: ${a}`),NaN;const s=t.getOffsetIndexFromWorld(r);return Number.isNaN(s)?s:t.getPointData().getScalars().getComponent(s,n)}}const lv={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:Be.EMPTY};function tu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lv,r),bt.extend(t,e,r),e.direction?Array.isArray(e.direction)&&(e.direction=new Float64Array(e.direction.slice(0,9))):e.direction=Gt(new Float64Array(9)),e.indexToWorld=new Float64Array(16),e.worldToIndex=new Float64Array(16),E.get(t,e,["indexToWorld","worldToIndex"]),E.setGetArray(t,e,["origin","spacing"],3),E.setGetArray(t,e,["direction"],9),E.getArray(t,e,["extent"],6),gv(t,e)}const pv=E.newInstance(tu,"vtkImageData");var hv={newInstance:pv,extend:tu};const vv={MAGNITUDE:0,COMPONENT:1,RGBCOLORS:2},is={LUMINANCE:1,LUMINANCE_ALPHA:2,RGB:3,RGBA:4};var Hs={VectorMode:vv,ScalarMappingTarget:is};const yv={DEFAULT:0,MAP_SCALARS:1,DIRECT_SCALARS:2},dv={DEFAULT:0,USE_POINT_DATA:1,USE_CELL_DATA:2,USE_POINT_FIELD_DATA:3,USE_CELL_FIELD_DATA:4,USE_FIELD_DATA:5},Tv={BY_ID:0,BY_NAME:1};var Xn={ColorMode:yv,GetArray:Tv,ScalarMode:dv};const{ScalarMappingTarget:so,VectorMode:He}=Hs,{VtkDataTypes:it}=Q,{ColorMode:Ar}=Xn,{vtkErrorMacro:io}=E;function xv(t){return t}function oo(t){return Math.floor(t*255+.5)}function Sv(t,e){e.classHierarchy.push("vtkScalarsToColors"),t.setVectorModeToMagnitude=()=>t.setVectorMode(He.MAGNITUDE),t.setVectorModeToComponent=()=>t.setVectorMode(He.COMPONENT),t.setVectorModeToRGBColors=()=>t.setVectorMode(He.RGBCOLORS),t.build=()=>{},t.isOpaque=()=>!0,t.setAnnotations=(r,n)=>{if(!(r&&!n||!r&&n)){if(r&&n&&r.length!==n.length){io("Values and annotations do not have the same number of tuples so ignoring");return}if(e.annotationArray=[],n&&r){const a=n.length;for(let s=0;s<a;s++)e.annotationArray.push({value:r[s],annotation:String(n[s])})}t.updateAnnotatedValueMap(),t.modified()}},t.setAnnotation=(r,n)=>{let a=t.checkForAnnotatedValue(r),s=!1;return a>=0?e.annotationArray[a].annotation!==n&&(e.annotationArray[a].annotation=n,s=!0):(e.annotationArray.push({value:r,annotation:n}),a=e.annotationArray.length-1,s=!0),s&&(t.updateAnnotatedValueMap(),t.modified()),a},t.getNumberOfAnnotatedValues=()=>e.annotationArray.length,t.getAnnotatedValue=r=>r<0||r>=e.annotationArray.length?null:e.annotationArray[r].value,t.getAnnotation=r=>e.annotationArray[r]===void 0?null:e.annotationArray[r].annotation,t.getAnnotatedValueIndex=r=>e.annotationArray.length?t.checkForAnnotatedValue(r):-1,t.removeAnnotation=r=>{const n=t.checkForAnnotatedValue(r),a=n>=0;return a&&(e.annotationArray.splice(n,1),t.updateAnnotatedValueMap(),t.modified()),a},t.resetAnnotations=()=>{e.annotationArray=[],e.annotatedValueMap=[],t.modified()},t.getAnnotationColor=(r,n)=>{if(e.indexedLookup){const a=t.getAnnotatedValueIndex(r);t.getIndexedColor(a,n)}else t.getColor(parseFloat(r),n),n[3]=1},t.checkForAnnotatedValue=r=>t.getAnnotatedValueIndexInternal(r),t.getAnnotatedValueIndexInternal=r=>{if(e.annotatedValueMap[r]!==void 0){const n=e.annotationArray.length;return e.annotatedValueMap[r]%n}return-1},t.getIndexedColor=(r,n)=>{n[0]=0,n[1]=0,n[2]=0,n[3]=0},t.updateAnnotatedValueMap=()=>{e.annotatedValueMap=[];const r=e.annotationArray.length;for(let n=0;n<r;n++)e.annotatedValueMap[e.annotationArray[n].value]=n},t.mapScalars=(r,n,a)=>{const s=r.getNumberOfComponents();let i=null;if(n===Ar.DEFAULT&&(r.getDataType()===it.UNSIGNED_CHAR||r.getDataType()===it.UNSIGNED_CHAR_CLAMPED)||n===Ar.DIRECT_SCALARS&&r)i=t.convertToRGBA(r,s,r.getNumberOfTuples());else{const o={type:"vtkDataArray",name:"temp",numberOfComponents:4,dataType:it.UNSIGNED_CHAR},c=E.newTypedArray(o.dataType,4*r.getNumberOfTuples());o.values=c,o.size=c.length,i=Q.newInstance(o);let u=a;u<0&&s>1?t.mapVectorsThroughTable(r,i,so.RGBA,-1,-1):(u<0&&(u=0),u>=s&&(u=s-1),t.mapScalarsThroughTable(r,i,so.RGBA,u))}return i},t.mapVectorsToMagnitude=(r,n,a)=>{const s=r.getNumberOfTuples(),i=r.getNumberOfComponents(),o=n.getData(),c=r.getData();for(let u=0;u<s;u++){let g=0;for(let f=0;f<a;f++)g+=c[u*i+f]*c[u*i+f];o[u]=Math.sqrt(g)}},t.mapVectorsThroughTable=(r,n,a,s,i)=>{let o=t.getVectorMode(),c=i,u=s;const g=r.getNumberOfComponents();o===He.COMPONENT?(u===-1&&(u=t.getVectorComponent()),u<0&&(u=0),u>=g&&(u=g-1)):(c===-1&&(c=t.getVectorSize()),c<=0?(u=0,c=g):(u<0&&(u=0),u>=g&&(u=g-1),u+c>g&&(c=g-u)),o===He.MAGNITUDE&&(g===1||c===1)&&(o=He.COMPONENT));let f=0;switch(u>0&&(f=u),o){case He.COMPONENT:{t.mapScalarsThroughTable(r,n,a,f);break}case He.RGBCOLORS:break;case He.MAGNITUDE:default:{const l=Q.newInstance({numberOfComponents:1,values:new Float32Array(r.getNumberOfTuples())});t.mapVectorsToMagnitude(r,l,c),t.mapScalarsThroughTable(l,n,a,0);break}}},t.luminanceToRGBA=(r,n,a,s)=>{const i=s(a),o=n.getData(),c=r.getData(),u=o.length,g=0,f=1;let l=0;for(let p=g;p<u;p+=f){const y=s(o[p]);c[l*4]=y,c[l*4+1]=y,c[l*4+2]=y,c[l*4+3]=i,l++}},t.luminanceAlphaToRGBA=(r,n,a,s)=>{const i=n.getData(),o=r.getData(),c=i.length,u=0,g=2;let f=0;for(let l=u;l<c;l+=g){const p=s(i[l]);o[f]=p,o[f+1]=p,o[f+2]=p,o[f+3]=s(i[l+1])*a,f+=4}},t.rGBToRGBA=(r,n,a,s)=>{const i=oo(a),o=n.getData(),c=r.getData(),u=o.length,g=0,f=3;let l=0;for(let p=g;p<u;p+=f)c[l*4]=s(o[p]),c[l*4+1]=s(o[p+1]),c[l*4+2]=s(o[p+2]),c[l*4+3]=i,l++},t.rGBAToRGBA=(r,n,a,s)=>{const i=n.getData(),o=r.getData(),c=i.length,u=0,g=4;let f=0;for(let l=u;l<c;l+=g)o[f*4]=s(i[l]),o[f*4+1]=s(i[l+1]),o[f*4+2]=s(i[l+2]),o[f*4+3]=s(i[l+3])*a,f++},t.convertToRGBA=(r,n,a)=>{let{alpha:s}=e;if(n===4&&s>=1&&r.getDataType()===it.UNSIGNED_CHAR)return r;const i=Q.newInstance({numberOfComponents:4,empty:!0,size:4*a,dataType:it.UNSIGNED_CHAR});if(a<=0)return i;s=s>0?s:0,s=s<1?s:1;let o=xv;switch((r.getDataType()===it.FLOAT||r.getDataType()===it.DOUBLE)&&(o=oo),n){case 1:t.luminanceToRGBA(i,r,s,o);break;case 2:t.luminanceAlphaToRGBA(i,r,o);break;case 3:t.rGBToRGBA(i,r,s,o);break;case 4:t.rGBAToRGBA(i,r,s,o);break;default:return io("Cannot convert colors"),null}return i},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>256*256*256,t.setRange=(r,n)=>t.setMappingRange(r,n),t.getRange=()=>t.getMappingRange(),t.areScalarsOpaque=(r,n,a)=>{if(!r)return t.isOpaque();const s=r.getNumberOfComponents();return n===Ar.DEFAULT&&r.getDataType()===it.UNSIGNED_CHAR||n===Ar.DIRECT_SCALARS?s===3||s===1?e.alpha>=1:r.getRange(s-1)[0]===255:!0}}const Cv={alpha:1,vectorComponent:0,vectorSize:-1,vectorMode:He.COMPONENT,mappingRange:null,annotationArray:null,annotatedValueMap:null,indexedLookup:!1};function ru(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Cv,r),E.obj(t,e),e.mappingRange=[0,255],e.annotationArray=[],e.annotatedValueMap=[],E.setGet(t,e,["vectorSize","vectorComponent","vectorMode","alpha","indexedLookup"]),E.setArray(t,e,["mappingRange"],2),E.getArray(t,e,["mappingRange"]),Sv(t,e)}const wv=E.newInstance(ru,"vtkScalarsToColors");var nu={newInstance:wv,extend:ru,...Hs};const{vtkErrorMacro:co}=E,fo=0,uo=1,wa=2;function Ev(t,e){e.classHierarchy.push("vtkLookupTable"),t.isOpaque=()=>{if(e.opaqueFlagBuildTime.getMTime()<t.getMTime()){let r=!0;e.nanColor[3]<1&&(r=0),e.useBelowRangeColor&&e.belowRangeColor[3]<1&&(r=0),e.useAboveRangeColor&&e.aboveRangeColor[3]<1&&(r=0);for(let n=3;n<e.table.length&&r;n+=4)e.table[n]<255&&(r=!1);e.opaqueFlag=r,e.opaqueFlagBuildTime.modified()}return e.opaqueFlag},t.usingLogScale=()=>!1,t.getNumberOfAvailableColors=()=>e.table.length/4-3,t.linearIndexLookup=(r,n)=>{let a=0;const s=Number(r);return s<n.range[0]?a=n.maxIndex+fo+1.5:s>n.range[1]?a=n.maxIndex+uo+1.5:(a=(s+n.shift)*n.scale,a=a<n.maxIndex?a:n.maxIndex),Math.floor(a)},t.linearLookup=(r,n,a)=>{let s=0;ff(r)?s=Math.floor(a.maxIndex+1.5+wa):s=t.linearIndexLookup(r,a);const i=4*s;return n.slice(i,i+4)},t.indexedLookupFunction=(r,n,a)=>{let s=t.getAnnotatedValueIndexInternal(r);s===-1&&(s=e.numberOfColors+wa);const i=4*s;return[n[i],n[i+1],n[i+2],n[i+3]]},t.lookupShiftAndScale=(r,n)=>{n.shift=-r[0],n.scale=Number.MAX_VALUE,r[1]>r[0]&&(n.scale=(n.maxIndex+1)/(r[1]-r[0]))},t.mapScalarsThroughTable=(r,n,a,s)=>{let i=t.linearLookup;e.indexedLookup&&(i=t.indexedLookupFunction);const o=t.getMappingRange(),c={maxIndex:t.getNumberOfColors()-1,range:o,shift:0,scale:0};t.lookupShiftAndScale(o,c);const u=t.getAlpha(),g=r.getNumberOfTuples(),f=r.getNumberOfComponents(),l=n.getData(),p=r.getData();if(u>=1){if(a===is.RGBA)for(let y=0;y<g;y++){const h=i(p[y*f+s],e.table,c);l[y*4]=h[0],l[y*4+1]=h[1],l[y*4+2]=h[2],l[y*4+3]=h[3]}}else if(a===is.RGBA)for(let y=0;y<g;y++){const h=i(p[y*f+s],e.table,c);l[y*4]=h[0],l[y*4+1]=h[1],l[y*4+2]=h[2],l[y*4+3]=Math.floor(h[3]*u+.5)}},t.forceBuild=()=>{let r=0,n=0,a=0,s=0;const i=e.numberOfColors-1;i&&(r=(e.hueRange[1]-e.hueRange[0])/i,n=(e.saturationRange[1]-e.saturationRange[0])/i,a=(e.valueRange[1]-e.valueRange[0])/i,s=(e.alphaRange[1]-e.alphaRange[0])/i),e.table.length=4*i+16;const o=[],c=[];for(let u=0;u<=i;u++)o[0]=e.hueRange[0]+u*r,o[1]=e.saturationRange[0]+u*n,o[2]=e.valueRange[0]+u*a,Xh(o,c),c[3]=e.alphaRange[0]+u*s,e.table[u*4]=c[0]*255+.5,e.table[u*4+1]=c[1]*255+.5,e.table[u*4+2]=c[2]*255+.5,e.table[u*4+3]=c[3]*255+.5;t.buildSpecialColors(),e.buildTime.modified()},t.setTable=r=>{if(Array.isArray(r)){const a=r[0].length;e.numberOfColors=r.length;const s=4-a;let i=0;for(let o=0;o<e.numberOfColors;o++)e.table[o*4]=255,e.table[o*4+1]=255,e.table[o*4+2]=255,e.table[o*4+3]=255;for(let o=0;o<r.length;o++){const c=r[o];for(let u=0;u<a;u++)e.table[i++]=c[u];i+=s}return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0}if(r.getNumberOfComponents()!==4)return co("Expected 4 components for RGBA colors"),!1;if(r.getDataType()!==le.UNSIGNED_CHAR)return co("Expected unsigned char values for RGBA colors"),!1;e.numberOfColors=r.getNumberOfTuples();const n=r.getData();e.table.length=n.length;for(let a=0;a<n.length;a++)e.table[a]=n[a];return t.buildSpecialColors(),e.insertTime.modified(),t.modified(),!0},t.buildSpecialColors=()=>{const{numberOfColors:r}=e,n=e.table;let a=(r+fo)*4;e.useBelowRangeColor||r===0?(n[a]=e.belowRangeColor[0]*255+.5,n[a+1]=e.belowRangeColor[1]*255+.5,n[a+2]=e.belowRangeColor[2]*255+.5,n[a+3]=e.belowRangeColor[3]*255+.5):(n[a]=n[0],n[a+1]=n[1],n[a+2]=n[2],n[a+3]=n[3]),a=(r+uo)*4,e.useAboveRangeColor||r===0?(n[a]=e.aboveRangeColor[0]*255+.5,n[a+1]=e.aboveRangeColor[1]*255+.5,n[a+2]=e.aboveRangeColor[2]*255+.5,n[a+3]=e.aboveRangeColor[3]*255+.5):(n[a]=n[4*(r-1)+0],n[a+1]=n[4*(r-1)+1],n[a+2]=n[4*(r-1)+2],n[a+3]=n[4*(r-1)+3]),a=(r+wa)*4,n[a]=e.nanColor[0]*255+.5,n[a+1]=e.nanColor[1]*255+.5,n[a+2]=e.nanColor[2]*255+.5,n[a+3]=e.nanColor[3]*255+.5},t.build=()=>{(e.table.length<1||t.getMTime()>e.buildTime.getMTime()&&e.insertTime.getMTime()<=e.buildTime.getMTime())&&t.forceBuild()},e.table.length>0&&(t.buildSpecialColors(),e.insertTime.modified())}const Ov={numberOfColors:256,hueRange:[0,.66667],saturationRange:[1,1],valueRange:[1,1],alphaRange:[1,1],nanColor:[.5,0,0,1],belowRangeColor:[0,0,0,1],aboveRangeColor:[1,1,1,1],useAboveRangeColor:!1,useBelowRangeColor:!1,alpha:1};function au(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ov,r),nu.extend(t,e,r),e.table||(e.table=[]),e.buildTime={},E.obj(e.buildTime),e.opaqueFlagBuildTime={},E.obj(e.opaqueFlagBuildTime,{mtime:0}),e.insertTime={},E.obj(e.insertTime,{mtime:0}),E.get(t,e,["buildTime"]),E.setGet(t,e,["numberOfColors","useAboveRangeColor","useBelowRangeColor"]),E.setArray(t,e,["alphaRange","hueRange","saturationRange","valueRange"],2),E.setArray(t,e,["nanColor","belowRangeColor","aboveRangeColor"],4),E.getArray(t,e,["hueRange","saturationRange","valueRange","alphaRange","nanColor","belowRangeColor","aboveRangeColor"]),Ev(t,e)}const Rv=E.newInstance(au,"vtkLookupTable");var mn={newInstance:Rv,extend:au};const Tt={Off:0,PolygonOffset:1};let os=Tt.PolygonOffset,kn=Tt.Off;const Mv=["VTK_RESOLVE_OFF","VTK_RESOLVE_POLYGON_OFFSET"];function Dv(){return os}function Lv(t){const e=os===t;return os=t,e}function Vv(){return kn}function Pn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const e=kn===t;return kn=t,e}function _v(){return Pn(Tt.Off)}function Bv(){return Pn(Tt.Off)}function Fv(){return Pn(Tt.PolygonOffset)}function Uv(){return Mv[kn]}var cs={Resolve:Tt,getResolveCoincidentTopologyAsString:Uv,getResolveCoincidentTopologyPolygonOffsetFaces:Dv,getResolveCoincidentTopology:Vv,setResolveCoincidentTopology:Pn,setResolveCoincidentTopologyPolygonOffsetFaces:Lv,setResolveCoincidentTopologyToDefault:_v,setResolveCoincidentTopologyToOff:Bv,setResolveCoincidentTopologyToPolygonOffset:Fv};function su(t,e,r){r.forEach(n=>{t[`get${n.method}`]=()=>e[n.key],t[`set${n.method}`]=E.objectSetterMap.object(t,e,{name:n.key,params:["factor","offset"]})})}const As=["Polygon","Line","Point"],mv={Polygon:{factor:2,offset:0},Line:{factor:1,offset:-1},Point:{factor:0,offset:-2}},kv=()=>{},_t={modified:kv};su(_t,mv,As.map(t=>({key:t,method:`ResolveCoincidentTopology${t}OffsetParameters`})));function Nv(t,e){e.resolveCoincidentTopology===void 0&&(e.resolveCoincidentTopology=!1),E.setGet(t,e,["resolveCoincidentTopology"]),e.topologyOffset={Polygon:{factor:0,offset:0},Line:{factor:0,offset:0},Point:{factor:0,offset:0}},Object.keys(cs).forEach(r=>{t[r]=cs[r]}),Object.keys(_t).filter(r=>r!=="modified").forEach(r=>{t[r]=_t[r]}),su(t,e.topologyOffset,As.map(r=>({key:r,method:`RelativeCoincidentTopology${r}OffsetParameters`}))),t.getCoincidentTopologyPolygonOffsetParameters=()=>{const r=_t.getResolveCoincidentTopologyPolygonOffsetParameters(),n=t.getRelativeCoincidentTopologyPolygonOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}},t.getCoincidentTopologyLineOffsetParameters=()=>{const r=_t.getResolveCoincidentTopologyLineOffsetParameters(),n=t.getRelativeCoincidentTopologyLineOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}},t.getCoincidentTopologyPointOffsetParameter=()=>{const r=_t.getResolveCoincidentTopologyPointOffsetParameters(),n=t.getRelativeCoincidentTopologyPointOffsetParameters();return{factor:r.factor+n.factor,offset:r.offset+n.offset}}}var iu={implementCoincidentTopologyMethods:Nv,staticOffsetAPI:_t,otherStaticMethods:cs,CATEGORIES:As,Resolve:Tt};const we={MIN_KNOWN_PASS:0,ACTOR_PASS:0,COMPOSITE_INDEX_PASS:1,ID_LOW24:2,ID_HIGH24:3,MAX_KNOWN_PASS:3};var ou={PassTypes:we};const{FieldAssociations:go}=bt,{staticOffsetAPI:Gv,otherStaticMethods:bv}=iu,{ColorMode:jr,ScalarMode:wt,GetArray:Ea}=Xn,{VectorMode:$v}=Hs,{VtkDataTypes:Wv}=Q;function fr(t){return()=>E.vtkErrorMacro(`vtkMapper::${t} - NOT IMPLEMENTED`)}function zv(t,e){const r=t[1]%2===0?1:-1;if(t[0]+=r,t[0]>=e[0]||t[0]<0){const n=t[2]%2===0?1:-1;t[0]-=r,t[1]+=n,(t[1]>=e[1]||t[1]<0)&&(t[1]-=n,t[2]++)}}function Hv(t,e){return t[0]+e[0]*(t[1]+e[1]*t[2])}function lo(t,e,r){const n=Math.floor(e),a=n%(2*r[0]);let s,i;a<r[0]?(t[0]=a,s=1,i=t[0]===r[0]-1):(t[0]=2*r[0]-1-a,s=-1,i=t[0]===0);const o=Math.floor(n/r[0]),c=o%(2*r[1]);let u,g;c<r[1]?(t[1]=c,u=1,g=t[1]===r[1]-1):(t[1]=2*r[1]-1-c,u=-1,g=t[1]===0),t[2]=Math.floor(o/r[1]);const f=e-n;i?g?t[2]+=f:t[1]+=u*f:t[0]+=s*f,t[0]=(t[0]+.5)/r[0],t[1]=(t[1]+.5)/r[1],t[2]=(t[2]+.5)/r[2]}const po=new WeakMap;function Av(t,e,r,n,a,s,i){var V;const o=new Array(arguments.length);for(let B=0;B<arguments.length;++B){const _=arguments[B];o[B]=((V=_.getMTime)==null?void 0:V.call(_))??_}const c=o.join("/"),u=po.get(t);if(u&&u.stringHash===c)return u.textureCoordinates;const g=(r[1]-r[0])/(n-1),[f,l]=[r[0]-g,r[1]+g],p=f-.5*g,y=1/(l-f+g),h=f,v=(n+1)/(l-f),x=t.getData(),S=t.getNumberOfTuples(),d=t.getNumberOfComponents(),T=e<0||e>=d,w=a[2]<=1?2:3,C=Q.newInstance({numberOfComponents:w,values:new Float32Array(S*w)}),O=C.getData(),R=[0,0,0];lo(R,n+2,a);let L=0,M=0;const D=[.5,.5,.5];for(let B=0;B<S;++B){let _;if(T){let k=0;for(let G=0;G<d;++G){const b=x[L+G];k+=b*b}_=Math.sqrt(k)}else _=x[L+e];if(L+=d,s&&(_=mn.applyLogScale(_,r,r)),ff(_))D[0]=R[0],D[1]=R[1],D[2]=R[2];else if(i){let k=(_-h)*v;k<1?k=0:k>n&&(k=n+1),lo(D,k,a)}else{D[1]=.49;const k=(_-p)*y;k>1e3?D[0]=1e3:k<-1e3?D[0]=-1e3:D[0]=k}for(let k=0;k<w;++k)O[M++]=D[k]}return po.set(t,{stringHash:c,textureCoordinates:C}),C}function jv(t,e){e.classHierarchy.push("vtkMapper"),t.getBounds=()=>{const r=t.getInputData();return r?(e.static||t.update(),e.bounds=r.getBounds()):e.bounds=Fs(),e.bounds},t.setForceCompileOnly=r=>{e.forceCompileOnly=r},t.setSelectionWebGLIdsToVTKIds=r=>{e.selectionWebGLIdsToVTKIds=r},t.createDefaultLookupTable=()=>{e.lookupTable=mn.newInstance()},t.getColorModeAsString=()=>E.enumToString(jr,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>E.enumToString(wt,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(r,n,a,s,i)=>{if(!r||!e.scalarVisibility)return{scalars:null,cellFlag:!1};let o=null,c=!1;if(n===wt.DEFAULT)o=r.getPointData().getScalars(),o||(o=r.getCellData().getScalars(),c=!0);else if(n===wt.USE_POINT_DATA)o=r.getPointData().getScalars();else if(n===wt.USE_CELL_DATA)o=r.getCellData().getScalars(),c=!0;else if(n===wt.USE_POINT_FIELD_DATA){const u=r.getPointData();a===Ea.BY_ID?o=u.getArrayByIndex(s):o=u.getArrayByName(i)}else if(n===wt.USE_CELL_FIELD_DATA){const u=r.getCellData();c=!0,a===Ea.BY_ID?o=u.getArrayByIndex(s):o=u.getArrayByName(i)}else if(n===wt.USE_FIELD_DATA){const u=r.getFieldData();a===Ea.BY_ID?o=u.getArrayByIndex(s):o=u.getArrayByName(i)}return{scalars:o,cellFlag:c}},t.mapScalars=(r,n)=>{const{scalars:a,cellFlag:s}=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName);if(e.areScalarsMappedFromCells=s,!a){e.colorCoordinates=null,e.colorTextureMap=null,e.colorMapColors=null;return}const i=`${t.getMTime()}${a.getMTime()}${n}`;if(e.colorBuildString!==i){if(e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]),t.canUseTextureMapForColoring(a,s))e.mapScalarsToTexture(a,s,n);else{e.colorCoordinates=null,e.colorTextureMap=null;const o=t.getLookupTable();o&&(o.build(),e.colorMapColors=o.mapScalars(a,e.colorMode,e.fieldDataTupleId))}e.colorBuildString=`${t.getMTime()}${a.getMTime()}${n}`}},e.mapScalarsToTexture=(r,n,a)=>{const s=e.lookupTable.getRange(),i=e.lookupTable.usingLogScale();i&&mn.getLogRange(s,s);const o=e.lookupTable.getAlpha();if(e.colorMapColors=null,e.colorTextureMap==null||t.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getMTime()>e.colorTextureMap.getMTime()||e.lookupTable.getAlpha()!==a){e.lookupTable.setAlpha(a),e.colorTextureMap=null,e.lookupTable.build();const u=e.lookupTable.getNumberOfAvailableColors(),g=2048,f=g**3-3,p=4096-2,y=2,h=n?f:p;e.numberOfColorsInRange=Math.min(Math.max(u,y),h);const v=e.numberOfColorsInRange+3,x=e.numberOfColorsInRange+2,S=n?[Math.min(Math.ceil(v/g**0),g),Math.min(Math.ceil(v/g**1),g),Math.min(Math.ceil(v/g**2),g)]:[x,2,1],d=S[0]*S[1]*S[2],T=new Float64Array(d);T.fill(NaN);const w=e.numberOfColorsInRange,C=w+2,O=[0,0,0],R=s[0],L=s[1]-s[0];for(let V=0;V<C;++V){const B=Hv(O,S),_=R+L*(V-1)/(w-1);T[B]=i?10**_:_,zv(O,S)}const M=Q.newInstance({numberOfComponents:1,values:T}),D=e.lookupTable.mapScalars(M,e.colorMode,0);e.colorTextureMap=hv.newInstance(),e.colorTextureMap.setDimensions(S),e.colorTextureMap.getPointData().setScalars(D),e.lookupTable.setAlpha(o)}const c=e.lookupTable.getVectorMode()===$v.MAGNITUDE&&r.getNumberOfComponents()>1?-1:e.lookupTable.getVectorComponent();e.colorCoordinates=Av(r,c,s,e.numberOfColorsInRange,e.colorTextureMap.getDimensions(),i,n)},t.getIsOpaque=()=>{const r=t.getInputData(),a=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!e.scalarVisibility||a==null)return!0;const s=t.getLookupTable();return s?(s.build(),s.areScalarsOpaque(a,e.colorMode,-1)):!0},t.canUseTextureMapForColoring=(r,n)=>n&&e.colorMode!==jr.DIRECT_SCALARS?!0:!(!e.interpolateScalarsBeforeMapping||e.lookupTable&&e.lookupTable.getIndexedLookup()||!r||e.colorMode===jr.DEFAULT&&r.getDataType()===Wv.UNSIGNED_CHAR||e.colorMode===jr.DIRECT_SCALARS),t.clearColorArrays=()=>{e.colorMapColors=null,e.colorCoordinates=null,e.colorTextureMap=null},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let r=e.mtime;if(e.lookupTable!==null){const n=e.lookupTable.getMTime();r=n>r?n:r}return r},t.getPrimitiveCount=()=>{const r=t.getInputData();return{points:r.getPoints().getNumberOfValues()/3,verts:r.getVerts().getNumberOfValues()-r.getVerts().getNumberOfCells(),lines:r.getLines().getNumberOfValues()-2*r.getLines().getNumberOfCells(),triangles:r.getPolys().getNumberOfValues()-3*r.getPolys().getNumberOfCells()}},t.acquireInvertibleLookupTable=fr("AcquireInvertibleLookupTable"),t.valueToColor=fr("ValueToColor"),t.colorToValue=fr("ColorToValue"),t.useInvertibleColorFor=fr("UseInvertibleColorFor"),t.clearInvertibleColor=fr("ClearInvertibleColor"),t.processSelectorPixelBuffers=(r,n)=>{if(!r||!e.selectionWebGLIdsToVTKIds||!e.populateSelectionSettings)return;const a=r.getRawPixelBuffer(we.ID_LOW24),s=r.getRawPixelBuffer(we.ID_HIGH24),i=r.getCurrentPass(),o=r.getFieldAssociation();let c=null;o===go.FIELD_ASSOCIATION_POINTS?c=e.selectionWebGLIdsToVTKIds.points:o===go.FIELD_ASSOCIATION_CELLS&&(c=e.selectionWebGLIdsToVTKIds.cells),c&&n.forEach(u=>{if(i===we.ID_LOW24){let g=0;s&&(g+=s[u],g*=256),g+=a[u+2],g*=256,g+=a[u+1],g*=256,g+=a[u];const f=c[g],l=r.getPixelBuffer(we.ID_LOW24);l[u]=f&255,l[u+1]=(f&65280)>>8,l[u+2]=(f&16711680)>>16}else if(i===we.ID_HIGH24&&s){let g=0;g+=s[u],g*=256,g+=a[u+2],g*=256,g+=a[u+1],g*=256,g+=a[u];const f=c[g],l=r.getPixelBuffer(we.ID_HIGH24);l[u]=(f&4278190080)>>24}})}}const Kv={colorMapColors:null,areScalarsMappedFromCells:!1,static:!1,lookupTable:null,scalarVisibility:!0,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,fieldDataTupleId:-1,populateSelectionSettings:!0,selectionWebGLIdsToVTKIds:null,interpolateScalarsBeforeMapping:!1,colorCoordinates:null,colorTextureMap:null,numberOfColorsInRange:0,forceCompileOnly:0,useInvertibleColors:!1,invertibleScalars:null,customShaderAttributes:[]};function cu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Kv,r),z1.extend(t,e,r),E.get(t,e,["areScalarsMappedFromCells","colorCoordinates","colorMapColors","colorTextureMap","numberOfColorsInRange","selectionWebGLIdsToVTKIds"]),E.setGet(t,e,["colorByArrayName","arrayAccessMode","colorMode","fieldDataTupleId","interpolateScalarsBeforeMapping","lookupTable","populateSelectionSettings","renderTime","scalarMode","scalarVisibility","static","useLookupTableScalarRange","customShaderAttributes"]),E.setGetArray(t,e,["scalarRange"],2),iu.implementCoincidentTopologyMethods(t,e),jv(t,e)}const Xv=E.newInstance(cu,"vtkMapper");var rt={newInstance:Xv,extend:cu,...Gv,...bv,...Xn};function fu(t){let e=0;return t.filter((r,n)=>n===e?(e+=r+1,!0):!1)}function uu(t){let e=0;for(let r=0;r<t.length;)r+=t[r]+1,e++;return e}const Pv={extractCellSizes:fu,getNumberOfCells:uu};function Yv(t,e){e.classHierarchy.push("vtkCellArray");const r={...t};t.getNumberOfCells=n=>(e.numberOfCells!==void 0&&!n||(e.cellSizes?e.numberOfCells=e.cellSizes.length:e.numberOfCells=uu(t.getData())),e.numberOfCells),t.getCellSizes=n=>(e.cellSizes!==void 0&&!n||(e.cellSizes=fu(t.getData())),e.cellSizes),t.resize=n=>{const a=t.getNumberOfTuples();r.resize(n);const s=t.getNumberOfTuples();s<a&&(s===0?(e.numberOfCells=0,e.cellSizes=[]):(e.numberOfCells=void 0,e.cellSizes=void 0))},t.setData=n=>{r.setData(n,1),e.numberOfCells=void 0,e.cellSizes=void 0},t.getCell=n=>{let a=n;const s=e.values[a++];return e.values.subarray(a,a+s)},t.insertNextCell=n=>{const a=t.getNumberOfCells();return t.insertNextTuples([n.length,...n]),++e.numberOfCells,e.cellSizes!=null&&e.cellSizes.push(n.length),a}}function qv(t){return{empty:!0,numberOfComponents:1,dataType:le.UNSIGNED_INT,...t}}function gu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Q.extend(t,e,qv(r)),Yv(t,e)}const Iv=E.newInstance(gu,"vtkCellArray");var Nn={newInstance:Iv,extend:gu,...Pv};const{vtkErrorMacro:Qv}=E,Zv=[1,-1,1,-1,1,-1];function Jv(t,e){e.classHierarchy.push("vtkPoints"),t.getNumberOfPoints=t.getNumberOfTuples,t.setNumberOfPoints=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:3;t.getNumberOfPoints()!==r&&(e.size=r*n,e.values=E.newTypedArray(e.dataType,e.size),t.setNumberOfComponents(n),t.modified())},t.setPoint=function(r){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];t.setTuple(r,a)},t.getPoint=t.getTuple,t.findPoint=t.findTuple,t.insertNextPoint=(r,n,a)=>t.insertNextTuple([r,n,a]),t.getBounds=()=>{if(t.getNumberOfComponents()===3){const a=t.getRange(0);e.bounds[0]=a[0],e.bounds[1]=a[1];const s=t.getRange(1);e.bounds[2]=s[0],e.bounds[3]=s[1];const i=t.getRange(2);return e.bounds[4]=i[0],e.bounds[5]=i[1],e.bounds}if(t.getNumberOfComponents()!==2)return Qv(`getBounds called on an array with components of
        ${t.getNumberOfComponents()}`),Zv;const r=t.getRange(0);e.bounds[0]=r[0],e.bounds[1]=r[1];const n=t.getRange(1);return e.bounds[2]=n[0],e.bounds[3]=n[1],e.bounds[4]=0,e.bounds[5]=0,e.bounds},t.computeBounds=t.getBounds,t.setNumberOfComponents(e.numberOfComponents<2?3:e.numberOfComponents)}const ey={empty:!0,numberOfComponents:3,dataType:le.FLOAT,bounds:[1,-1,1,-1,1,-1]};function lu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ey,r),Q.extend(t,e,r),Jv(t,e)}const ty=E.newInstance(lu,"vtkPoints");var Mr={newInstance:ty,extend:lu};function ry(t,e){e.classHierarchy.push("vtkCell"),t.initialize=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(n){e.pointsIds=n;let a=e.points.getData();a.length!==3*e.pointsIds.length&&(a=E.newTypedArray(r.getDataType(),3*e.pointsIds.length));const s=r.getData();e.pointsIds.forEach((i,o)=>{let c=3*i,u=3*o;a[u]=s[c],a[++u]=s[++c],a[++u]=s[++c]}),e.points.setData(a)}else{e.points=r,e.pointsIds=new Array(r.getNumberOfPoints());for(let a=r.getNumberOfPoints()-1;a>=0;--a)e.pointsIds[a]=a}},t.getBounds=()=>{const r=e.points.getNumberOfPoints(),n=[];if(r){e.points.getPoint(0,n),e.bounds[0]=n[0],e.bounds[1]=n[0],e.bounds[2]=n[1],e.bounds[3]=n[1],e.bounds[4]=n[2],e.bounds[5]=n[2];for(let a=1;a<r;a++)e.points.getPoint(a,n),e.bounds[0]=n[0]<e.bounds[0]?n[0]:e.bounds[0],e.bounds[1]=n[0]>e.bounds[1]?n[0]:e.bounds[1],e.bounds[2]=n[1]<e.bounds[2]?n[1]:e.bounds[2],e.bounds[3]=n[1]>e.bounds[3]?n[1]:e.bounds[3],e.bounds[4]=n[2]<e.bounds[4]?n[2]:e.bounds[4],e.bounds[5]=n[2]>e.bounds[5]?n[2]:e.bounds[5]}else Bs(e.bounds);return e.bounds},t.getLength2=()=>{t.getBounds();let r=0,n=0;for(let a=0;a<3;a++)n=e.bounds[2*a+1]-e.bounds[2*a],r+=n*n;return r},t.getParametricDistance=r=>{let n,a=0;for(let s=0;s<3;s++)r[s]<0?n=-r[s]:r[s]>1?n=r[s]-1:n=0,n>a&&(a=n);return a},t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.deepCopy=r=>{r.initialize(e.points,e.pointsIds)},t.getCellDimension=()=>{},t.intersectWithLine=(r,n,a,s,i,o,c)=>{},t.evaluatePosition=(r,n,a,s,i,o)=>{E.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}const ny={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function pu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ny,r),E.obj(t,e),e.points||(e.points=Mr.newInstance()),E.get(t,e,["points","pointsIds"]),ry(t,e)}const ay=E.newInstance(pu,"vtkCell");var Gn={newInstance:ay,extend:pu};function sy(t,e){let r=e;for(e>=t.array.length&&(r+=t.array.length);r>t.array.length;)t.array.push({ncells:0,cells:null});t.array.length=r}function iy(t,e){e.classHierarchy.push("vtkCellLinks"),t.buildLinks=r=>{const n=r.getPoints().getNumberOfPoints(),a=r.getNumberOfCells(),s=new Uint32Array(n);if(r.isA("vtkPolyData")){for(let i=0;i<a;++i){const{cellPointIds:o}=r.getCellPoints(i);o.forEach(c=>{t.incrementLinkCount(c)})}t.allocateLinks(n),e.maxId=n-1;for(let i=0;i<a;++i){const{cellPointIds:o}=r.getCellPoints(i);o.forEach(c=>{t.insertCellReference(c,s[c]++,i)})}}else{for(let i=0;i<a;i++)Gn.newInstance().getPointsIds().forEach(c=>{t.incrementLinkCount(c)});t.allocateLinks(n),e.maxId=n-1;for(let i=0;i<a;++i)Gn.newInstance().getPointsIds().forEach(c=>{t.insertCellReference(c,s[c]++,i)})}},t.allocate=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.array=Array(r).fill().map(()=>({ncells:0,cells:null})),e.extend=n,e.maxId=-1},t.initialize=()=>{e.array=null},t.getLink=r=>e.array[r],t.getNcells=r=>e.array[r].ncells,t.getCells=r=>e.array[r].cells,t.insertNextPoint=r=>{e.array.push({ncells:r,cells:Array(r)}),++e.maxId},t.insertNextCellReference=(r,n)=>{e.array[r].cells[e.array[r].ncells++]=n},t.deletePoint=r=>{e.array[r].ncells=0,e.array[r].cells=null},t.removeCellReference=(r,n)=>{e.array[n].cells=e.array[n].cells.filter(a=>a!==r),e.array[n].ncells=e.array[n].cells.length},t.addCellReference=(r,n)=>{e.array[n].cells[e.array[n].ncells++]=r},t.resizeCellList=(r,n)=>{e.array[r].cells.length=n},t.squeeze=()=>{sy(e,e.maxId+1)},t.reset=()=>{e.maxId=-1},t.deepCopy=r=>{e.array=[...r.array],e.extend=r.extend,e.maxId=r.maxId},t.incrementLinkCount=r=>{++e.array[r].ncells},t.allocateLinks=r=>{for(let n=0;n<r;++n)e.array[n].cells=new Array(e.array[n].ncells)},t.insertCellReference=(r,n,a)=>{e.array[r].cells[n]=a}}const oy={array:null,maxId:0,extend:0};function hu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oy,r),E.obj(t,e),iy(t,e)}const cy=E.newInstance(hu,"vtkCellLinks");var fy={newInstance:cy,extend:hu};const J={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_QUAD:9,VTK_QUADRATIC_EDGE:21,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42},fs=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];function uy(t){return t<fs.length?fs[t]:"UnknownClass"}function gy(t){return fs.findIndex(t)}function ly(t){return t<J.VTK_QUADRATIC_EDGE||t===J.VTK_CONVEX_POINT_SET||t===J.VTK_POLYHEDRON}function py(t){return t===J.VTK_TRIANGLE_STRIP||t===J.VTK_POLY_LINE||t===J.VTK_POLY_VERTEX}const hy={getClassNameFromTypeId:uy,getTypeIdFromClassName:gy,isLinear:ly,hasSubCells:py};function vy(t,e){e.classHierarchy.push("vtkCellTypes"),t.allocate=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:512,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;e.size=r>0?r:1,e.extend=n>0?n:1,e.maxId=-1,e.typeArray=new Uint8Array(r),e.locationArray=new Uint32Array(r)},t.insertCell=(r,n,a)=>{e.typeArray[r]=n,e.locationArray[r]=a,r>e.maxId&&(e.maxId=r)},t.insertNextCell=(r,n)=>(t.insertCell(++e.maxId,r,n),e.maxId),t.setCellTypes=(r,n,a)=>{e.size=r,e.typeArray=n,e.locationArray=a,e.maxId=r-1},t.getCellLocation=r=>e.locationArray[r],t.deleteCell=r=>{e.typeArray[r]=J.VTK_EMPTY_CELL},t.getNumberOfTypes=()=>e.maxId+1,t.isType=r=>{const n=t.getNumberOfTypes();for(let a=0;a<n;++a)if(r===t.getCellType(a))return!0;return!1},t.insertNextType=r=>t.insertNextCell(r,-1),t.getCellType=r=>e.typeArray[r],t.reset=()=>{e.maxId=-1},t.deepCopy=r=>{t.allocate(r.getSize(),r.getExtend()),e.typeArray.set(r.getTypeArray()),e.locationArray.set(r.getLocationArray()),e.maxId=r.getMaxId()}}const yy={size:0,maxId:-1,extend:1e3};function vu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yy,r),E.obj(t,e),E.get(t,e,["size","maxId","extend"]),E.getArray(t,e,["typeArray","locationArray"]),vy(t,e)}const dy=E.newInstance(vu,"vtkCellTypes");var Ty={newInstance:dy,extend:vu,...hy};const xy={NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2};var yu={IntersectionState:xy};const{IntersectionState:Tn}=yu;function Kt(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;const a={t:Number.MIN_VALUE,distance:0},s=[];let i;s[0]=r[0]-e[0],s[1]=r[1]-e[1],s[2]=r[2]-e[2];const o=s[0]*(t[0]-e[0])+s[1]*(t[1]-e[1])+s[2]*(t[2]-e[2]),c=K(s,s);let u=1e-5*o;return c!==0&&(a.t=o/c),u<0&&(u=-u),-u<c&&c<u||c<=0||a.t<0?i=e:a.t>1?i=r:(i=s,s[0]=e[0]+a.t*s[0],s[1]=e[1]+a.t*s[1],s[2]=e[2]+a.t*s[2]),n&&(n[0]=i[0],n[1]=i[1],n[2]=i[2]),a.distance=Ae(i,t),a}function du(t,e,r,n,a,s){const i=[],o=[],c=[];a[0]=0,s[0]=0,yt(e,t,i),yt(n,r,o),yt(r,t,c);const u=[K(i,i),-K(i,o),-K(i,o),K(o,o)],g=[];if(g[0]=K(i,c),g[1]=-K(o,c),Kh(u,g,2)===0){let f=Number.MAX_VALUE;const l=[t,e,r,n],p=[r,r,t,t],y=[n,n,e,e];s[0],s[0],a[0],a[0],a[0],a[0],s[0],s[0];let h;for(let v=0;v<4;v++)h=Kt(l[v],p[v],y[v]),h.distance<f&&(f=h.distance);return Tn.ON_LINE}return a[0]=g[0],s[0]=g[1],a[0]>=0&&a[0]<=1&&s[0]>=0&&s[0]<=1?Tn.YES_INTERSECTION:Tn.NO_INTERSECTION}const Sy={distanceToLine:Kt,intersection:du};function Cy(t,e){e.classHierarchy.push("vtkLine");function r(n){return n>=0&&n<=1}t.getCellDimension=()=>1,t.intersectWithLine=(n,a,s,i,o)=>{const c={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};o[1]=0,o[2]=0;const u=[],g=[],f=[];e.points.getPoint(0,g),e.points.getPoint(1,f);const l=[],p=[],y=du(n,a,g,f,l,p);if(c.t=l[0],c.betweenPoints=r(c.t),o[0]=p[0],y===Tn.YES_INTERSECTION){for(let h=0;h<3;h++)i[h]=g[h]+o[0]*(f[h]-g[h]),u[h]=n[h]+c.t*(a[h]-n[h]);if(Ae(i,u)<=s*s)return c.intersect=1,c}else{let h;if(c.t<0)return h=Kt(n,g,f,i),h.distance<=s*s&&(c.t=0,c.intersect=1,c.betweenPoints=!0),c;if(c.t>1)return h=Kt(a,g,f,i),h.distance<=s*s&&(c.t=1,c.intersect=1,c.betweenPoints=!0),c;if(o[0]<0)return o[0]=0,h=Kt(g,n,a,i),c.t=h.t,h.distance<=s*s&&(c.intersect=1),c;if(o[0]>1)return o[0]=1,h=Kt(f,n,a,i),c.t=h.t,h.distance<=s*s&&(c.intersect=1),c}return c},t.evaluateLocation=(n,a,s)=>{const i=[],o=[];e.points.getPoint(0,i),e.points.getPoint(1,o);for(let c=0;c<3;c++)a[c]=i[c]+n[0]*(o[c]-i[c]);s[0]=1-n[0],s[1]=n[0]},t.evaluateOrientation=(n,a,s)=>e.orientations?(cn(a,e.orientations[0],e.orientations[1],n[0]),s[0]=1-n[0],s[1]=n[0],!0):!1}const wy={orientations:null};function Tu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,wy,r),Gn.extend(t,e,r),E.setGet(t,e,["orientations"]),Cy(t,e)}const Ey=E.newInstance(Tu,"vtkLine");var De={newInstance:Ey,extend:Tu,...Sy,...yu};function Oy(t,e){e.classHierarchy.push("vtkPointSet"),e.points?e.points=Ge(e.points):e.points=Mr.newInstance(),t.getNumberOfPoints=()=>e.points.getNumberOfPoints(),t.getBounds=()=>e.points.getBounds(),t.computeBounds=()=>{t.getBounds()};const r=t.shallowCopy;t.shallowCopy=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;r(n,a),e.points=Mr.newInstance(),e.points.shallowCopy(n.getPoints())}}const Ry={};function xu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ry,r),bt.extend(t,e,r),E.setGet(t,e,["points"]),Oy(t,e)}const My=E.newInstance(xu,"vtkPointSet");var Dy={newInstance:My,extend:xu};function js(t,e,r,n){const a=r[0]-e[0],s=r[1]-e[1],i=r[2]-e[2],o=t[0]-e[0],c=t[1]-e[1],u=t[2]-e[2];n[0]=s*u-i*c,n[1]=i*o-a*u,n[2]=a*c-s*o}function bn(t,e,r,n){js(t,e,r,n);const a=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);a!==0&&(n[0]/=a,n[1]/=a,n[2]/=a)}function Ly(t,e,r,n,a,s){let i=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e-6,o=!1;const c=[],u=[],g=[],f=[],l=[];bn(t,e,r,f),bn(n,a,s,l);const p=-K(f,t),y=-K(l,n),h=[K(l,t)+y,K(l,e)+y,K(l,r)+y];if(h[0]*h[1]>i&&h[0]*h[2]>i)return{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g};const v=[K(f,n)+p,K(f,a)+p,K(f,s)+p];if(v[0]*v[1]>i&&v[0]*v[2]>i)return{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g};if(Math.abs(f[0]-l[0])<1e-9&&Math.abs(f[1]-l[1])<1e-9&&Math.abs(f[2]-l[2])<1e-9&&Math.abs(p-y)<1e-9)return o=!0,{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g};const x=[t,e,r],S=[n,a,s],d=K(f,l),T=(p-y*d)/(d*d-1),w=(y-p*d)/(d*d-1),C=[T*f[0]+w*l[0],T*f[1]+w*l[1],T*f[2]+w*l[2]],O=Or(f,l,[]);Rr(O);let R=0,L=0;const M=[],D=[];let V=50,B=50;for(let G=0;G<3;G++){const b=G,Y=(G+1)%3,U=Qt.intersectWithLine(x[b],x[Y],n,l);U.intersection&&U.t>0-i&&U.t<1+i&&(U.t<1+i&&U.t>1-i&&(V=R),M[R++]=K(U.x,O)-K(C,O));const m=Qt.intersectWithLine(S[b],S[Y],t,f);m.intersection&&m.t>0-i&&m.t<1+i&&(m.t<1+i&&m.t>1-i&&(B=L),D[L++]=K(m.x,O)-K(C,O))}if(R>2){R--;const G=M[2];M[2]=M[V],M[V]=G}if(L>2){L--;const G=D[2];D[2]=D[B],D[B]=G}if(R!==2||L!==2)return{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g};if(Number.isNaN(M[0])||Number.isNaN(M[1])||Number.isNaN(D[0])||Number.isNaN(D[1]))return{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g};if(M[0]>M[1]){const G=M[1];M[1]=M[0],M[0]=G}if(D[0]>D[1]){const G=D[1];D[1]=D[0],D[0]=G}let _,k;return M[1]<D[0]||D[1]<M[0]?{intersect:!1,coplanar:o,pt1:c,pt2:u,surfaceId:g}:(M[0]<D[0]?M[1]<D[1]?(g[0]=2,g[1]=1,_=D[0],k=M[1]):(g[0]=2,g[1]=2,_=D[0],k=D[1]):M[1]<D[1]?(g[0]=1,g[1]=1,_=M[0],k=M[1]):(g[0]=1,g[1]=2,_=M[0],k=D[1]),Qi(C,O,_,c),Qi(C,O,k,u),{intersect:!0,coplanar:o,pt1:c,pt2:u,surfaceId:g})}const Vy={computeNormalDirection:js,computeNormal:bn,intersectWithTriangle:Ly};function _y(t,e){e.classHierarchy.push("vtkTriangle"),t.getCellDimension=()=>2,t.intersectWithLine=(r,n,a,s,i)=>{const o={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};i[2]=0;const c=[],u=a*a,g=[],f=[],l=[];e.points.getPoint(0,g),e.points.getPoint(1,f),e.points.getPoint(2,l);const p=[],y=[];if(bn(g,f,l,p),p[0]!==0||p[1]!==0||p[2]!==0){const d=Qt.intersectWithLine(r,n,g,p);if(o.betweenPoints=d.betweenPoints,o.t=d.t,s[0]=d.x[0],s[1]=d.x[1],s[2]=d.x[2],!d.intersection)return i[0]=0,i[1]=0,o.intersect=0,o;const T=t.evaluatePosition(s,c,i,y);if(T.evaluation>=0)return T.dist2<=u?(o.intersect=1,o):(o.intersect=T.evaluation,o)}const h=Ae(g,f),v=Ae(f,l),x=Ae(l,g);e.line||(e.line=De.newInstance()),h>v&&h>x?(e.line.getPoints().setPoint(0,g),e.line.getPoints().setPoint(1,f)):v>x&&v>h?(e.line.getPoints().setPoint(0,f),e.line.getPoints().setPoint(1,l)):(e.line.getPoints().setPoint(0,l),e.line.getPoints().setPoint(1,g));const S=e.line.intersectWithLine(r,n,a,s,i);if(o.betweenPoints=S.betweenPoints,o.t=S.t,S.intersect){const d=[],T=[],w=[];for(let C=0;C<3;C++)d[C]=g[C]-l[C],T[C]=f[C]-l[C],w[C]=s[C]-l[C];return i[0]=K(w,d)/x,i[1]=K(w,T)/v,o.intersect=1,o}return i[0]=0,i[1]=0,o.intersect=0,o},t.evaluatePosition=(r,n,a,s)=>{const i={subId:0,dist2:0,evaluation:-1};let o,c;const u=[],g=[],f=[],l=[];let p;const y=[],h=[],v=[];let x=0,S=0;const d=[];let T,w,C,O=[];const R=[],L=[],M=[];i.subId=0,a[2]=0,e.points.getPoint(1,u),e.points.getPoint(2,g),e.points.getPoint(0,f),js(u,g,f,l),Qt.generalizedProjectPoint(r,u,l,M);let D=0;for(o=0;o<3;o++)l[o]<0?p=-l[o]:p=l[o],p>D&&(D=p,S=o);for(c=0,o=0;o<3;o++)o!==S&&(d[c++]=o);for(o=0;o<2;o++)y[o]=M[d[o]]-f[d[o]],h[o]=u[d[o]]-f[d[o]],v[o]=g[d[o]]-f[d[o]];if(x=dn(h,v),x===0)return a[0]=0,a[1]=0,i.evaluation=-1,i;if(a[0]=dn(y,v)/x,a[1]=dn(h,y)/x,s[0]=1-(a[0]+a[1]),s[1]=a[0],s[2]=a[1],s[0]>=0&&s[0]<=1&&s[1]>=0&&s[1]<=1&&s[2]>=0&&s[2]<=1)n&&(i.dist2=Ae(M,r),n[0]=M[0],n[1]=M[1],n[2]=M[2]),i.evaluation=1;else{let V;if(n){if(s[1]<0&&s[2]<0)for(T=Ae(r,f),w=De.distanceToLine(r,u,f,V,R),C=De.distanceToLine(r,f,g,V,L),T<w?(i.dist2=T,O=f):(i.dist2=w,O=R),C<i.dist2&&(i.dist2=C,O=L),o=0;o<3;o++)n[o]=O[o];else if(s[2]<0&&s[0]<0)for(T=Ae(r,u),w=De.distanceToLine(r,u,f,V,R),C=De.distanceToLine(r,u,g,V,L),T<w?(i.dist2=T,O=u):(i.dist2=w,O=R),C<i.dist2&&(i.dist2=C,O=L),o=0;o<3;o++)n[o]=O[o];else if(s[1]<0&&s[0]<0)for(T=Ae(r,g),w=De.distanceToLine(r,g,f,V,R),C=De.distanceToLine(r,u,g,V,L),T<w?(i.dist2=T,O=g):(i.dist2=w,O=R),C<i.dist2&&(i.dist2=C,O=L),o=0;o<3;o++)n[o]=O[o];else if(s[0]<0){const B=De.distanceToLine(r,u,g,n);i.dist2=B.distance}else if(s[1]<0){const B=De.distanceToLine(r,g,f,n);i.dist2=B.distance}else if(s[2]<0){const B=De.distanceToLine(r,u,f,n);i.dist2=B.distance}}i.evaluation=0}return i},t.evaluateLocation=(r,n,a)=>{const s=[],i=[],o=[];e.points.getPoint(0,s),e.points.getPoint(1,i),e.points.getPoint(2,o);const c=1-r[0]-r[1];for(let u=0;u<3;u++)n[u]=s[u]*c+i[u]*r[0]+o[u]*r[1];a[0]=c,a[1]=r[0],a[2]=r[1]},t.getParametricDistance=r=>{let n,a=0;const s=[];s[0]=r[0],s[1]=r[1],s[2]=1-r[0]-r[1];for(let i=0;i<3;i++)s[i]<0?n=-s[i]:s[i]>1?n=s[i]-1:n=0,n>a&&(a=n);return a}}const By={};function Su(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,By,r),Gn.extend(t,e,r),_y(t,e)}const Fy=E.newInstance(Su,"vtkTriangle");var Uy={newInstance:Fy,extend:Su,...Vy};const Oa=["verts","lines","polys","strips"],{vtkWarningMacro:ho}=E,my={[J.VTK_LINE]:De,[J.VTK_POLY_LINE]:De,[J.VTK_TRIANGLE]:Uy};function ky(t,e){e.classHierarchy.push("vtkPolyData");function r(a){return a.replace(/(?:^\w|[A-Z]|\b\w)/g,s=>s.toUpperCase()).replace(/\s+/g,"")}Oa.forEach(a=>{t[`getNumberOf${r(a)}`]=()=>e[a].getNumberOfCells(),e[a]?e[a]=Ge(e[a]):e[a]=Nn.newInstance()}),t.getNumberOfCells=()=>Oa.reduce((a,s)=>a+e[s].getNumberOfCells(),0);const n=t.shallowCopy;t.shallowCopy=function(a){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n(a,s),Oa.forEach(i=>{e[i]=Nn.newInstance(),e[i].shallowCopy(a.getReferenceByName(i))})},t.buildCells=()=>{const a=t.getNumberOfVerts(),s=t.getNumberOfLines(),i=t.getNumberOfPolys(),o=t.getNumberOfStrips(),c=a+s+i+o,u=new Uint8Array(c);let g=u;const f=new Uint32Array(c);let l=f;if(a){let p=0;e.verts.getCellSizes().forEach((y,h)=>{l[h]=p,g[h]=y>1?J.VTK_POLY_VERTEX:J.VTK_VERTEX,p+=y+1}),l=l.subarray(a),g=g.subarray(a)}if(s){let p=0;e.lines.getCellSizes().forEach((y,h)=>{l[h]=p,g[h]=y>2?J.VTK_POLY_LINE:J.VTK_LINE,y===1&&ho("Building VTK_LINE ",h," with only one point, but VTK_LINE needs at least two points. Check the input."),p+=y+1}),l=l.subarray(s),g=g.subarray(s)}if(i){let p=0;e.polys.getCellSizes().forEach((y,h)=>{switch(l[h]=p,y){case 3:g[h]=J.VTK_TRIANGLE;break;case 4:g[h]=J.VTK_QUAD;break;default:g[h]=J.VTK_POLYGON;break}y<3&&ho("Building VTK_TRIANGLE ",h," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),p+=y+1}),l+=l.subarray(i),g+=g.subarray(i)}if(o){let p=0;g.fill(J.VTK_TRIANGLE_STRIP,0,o),e.strips.getCellSizes().forEach((y,h)=>{l[h]=p,p+=y+1})}e.cells=Ty.newInstance(),e.cells.setCellTypes(c,u,f)},t.buildLinks=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;e.cells===void 0&&t.buildCells(),e.links=fy.newInstance(),a>0?e.links.allocate(a):e.links.allocate(t.getPoints().getNumberOfPoints()),e.links.buildLinks(t)},t.getCellType=a=>e.cells.getCellType(a),t.getCellPoints=a=>{const s=t.getCellType(a);let i=null;switch(s){case J.VTK_VERTEX:case J.VTK_POLY_VERTEX:i=e.verts;break;case J.VTK_LINE:case J.VTK_POLY_LINE:i=e.lines;break;case J.VTK_TRIANGLE:case J.VTK_QUAD:case J.VTK_POLYGON:i=e.polys;break;case J.VTK_TRIANGLE_STRIP:i=e.strips;break;default:return i=null,{type:0,cellPointIds:null}}const o=e.cells.getCellLocation(a),c=i.getCell(o);return{cellType:s,cellPointIds:c}},t.getPointCells=a=>e.links.getCells(a),t.getCellEdgeNeighbors=(a,s,i)=>{const o=e.links.getLink(s),c=e.links.getLink(i);return o.cells.filter(u=>u!==a&&c.cells.indexOf(u)!==-1)},t.getCell=function(a){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const i=t.getCellPoints(a),o=s||my[i.cellType].newInstance();return o.initialize(t.getPoints(),i.cellPointIds),o}}const Ny={};function Cu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ny,r),Dy.extend(t,e,r),E.get(t,e,["cells","links"]),E.setGet(t,e,["verts","lines","polys","strips"]),ky(t,e)}const Gy=E.newInstance(Cu,"vtkPolyData");var nt={newInstance:Gy,extend:Cu};function by(t,e){e.classHierarchy.push("vtkTexture"),t.imageLoaded=()=>{e.image.removeEventListener("load",t.imageLoaded),e.imageLoaded=!0,t.modified()},t.setJsImageData=r=>{e.jsImageData!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.canvas=null),e.jsImageData=r,e.imageLoaded=!0,t.modified())},t.setCanvas=r=>{e.canvas!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.image=null,e.jsImageData=null),e.canvas=r,t.modified())},t.setImage=r=>{e.image!==r&&(r!==null&&(t.setInputData(null),t.setInputConnection(null),e.canvas=null,e.jsImageData=null),e.image=r,e.imageLoaded=!1,r.complete?t.imageLoaded():r.addEventListener("load",t.imageLoaded),t.modified())},t.getDimensionality=()=>{let r=0,n=0,a=1;if(t.getInputData()){const i=t.getInputData();r=i.getDimensions()[0],n=i.getDimensions()[1],a=i.getDimensions()[2]}return e.jsImageData&&(r=e.jsImageData.width,n=e.jsImageData.height),e.canvas&&(r=e.canvas.width,n=e.canvas.height),e.image&&(r=e.image.width,n=e.image.height),(r>1)+(n>1)+(a>1)},t.getInputAsJsImageData=()=>{if(!e.imageLoaded||t.getInputData())return null;if(e.jsImageData)return e.jsImageData();if(e.canvas)return e.canvas.getContext("2d").getImageData(0,0,e.canvas.width,e.canvas.height);if(e.image){const r=document.createElement("canvas");r.width=e.image.width,r.height=e.image.height;const n=r.getContext("2d");return n.translate(0,r.height),n.scale(1,-1),n.drawImage(e.image,0,0,e.image.width,e.image.height),n.getImageData(0,0,r.width,r.height)}return null}}const $y=(t,e,r,n)=>{const a=[1,2,1],s=4,i=a,o=s,c=t.length/(e*r);let u=e,g=r,f=t;const l=[f];for(let p=0;p<n;p++){const y=[...f];u/=2,g/=2,f=new Uint8ClampedArray(u*g*c);const h=c*u;let v=0;for(let S=0;S<f.length;S+=c){S%h===0&&(v+=2*c*u);for(let d=0;d<c;d++){let T=y[v+d];T+=y[v+c+d],T+=y[v-2*h+d],T+=y[v-2*h+c+d],T/=4,f[S+d]=T}v+=2*c}let x=[...f];for(let S=0;S<f.length;S+=c)for(let d=0;d<c;d++){let T=-(i.length-1)/2,w=o,C=0;for(let O=0;O<i.length;O++){let R=S+d+T*c;const L=R%h-(S+d)%h;L>c&&(R+=h),L<-c&&(R-=h),x[R]?C+=x[R]*i[O]:w-=i[O],T+=1}f[S+d]=C/w}x=[...f];for(let S=0;S<f.length;S+=c)for(let d=0;d<c;d++){let T=-(i.length-1)/2,w=o,C=0;for(let O=0;O<i.length;O++){const R=S+d+T*h;x[R]?C+=x[R]*i[O]:w-=i[O],T+=1}f[S+d]=C/w}l.push(f)}return l},Wy={image:null,canvas:null,jsImageData:null,imageLoaded:!1,repeat:!1,interpolate:!1,edgeClamp:!1,mipLevel:0,resizable:!1};function wu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Wy,r),E.obj(t,e),E.algo(t,e,6,0),E.get(t,e,["canvas","image","jsImageData","imageLoaded","resizable"]),E.setGet(t,e,["repeat","edgeClamp","interpolate","mipLevel"]),by(t,e)}const zy=E.newInstance(wu,"vtkTexture"),Hy={generateMipmaps:$y};var Yn={newInstance:zy,extend:wu,...Hy};const Ay=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],vo=[[8,7,11,3],[9,1,10,5],[4,9,0,8],[2,11,6,10],[0,3,2,1],[4,5,6,7]],Kr=[[0,1],[1,3],[2,3],[0,2],[4,5],[5,7],[6,7],[4,6],[0,4],[1,5],[3,7],[2,6]],yo=[0,1,0,1,0,1,0,1,2,2,2,2],re=[[1,2],[1,2],[0,2],[0,2],[0,1],[0,1]],W=new Float64Array(3),Xr=new Float64Array(3),q=new Float64Array(3),Bt=new Float64Array(3),Et=new Float64Array(3),Pr=new Float64Array(3),Ra=new Float64Array(16);function Ma(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function Eu(t){const e=[],r=[];for(let n=0;n<3;n++){const a=_s().domain([t[n*2],t[n*2+1]]);e[n]=a.ticks(5);const s=a.tickFormat(5);r[n]=e[n].map(s)}return{ticks:e,tickStrings:r}}function jy(t,e){e.classHierarchy.push("vtkCubeAxesActorHelper"),t.setRenderable=r=>{e.renderable!==r&&(e.renderable=r,e.tmActor.addTexture(e.renderable.getTmTexture()),e.tmActor.setProperty(r.getProperty()),e.tmActor.setParentProp(r),t.modified())},t.createPolyDataForOneLabel=(r,n,a,s,i,o,c)=>{const u=e.renderable.get_tmAtlas().get(r);if(!u)return;const g=e.renderable.getTextPolyData().getPoints().getData(),f=e.lastSize;W[0]=g[n*3],W[1]=g[n*3+1],W[2]=g[n*3+2],I(q,W,a),q[0]+=.1,I(Xr,q,s),vt(Et,Xr,W),q[0]-=.1,q[1]+=.1,I(Xr,q,s),vt(Pr,Xr,W);for(let y=0;y<3;y++)Et[y]/=.5*.1*f[0],Pr[y]/=.5*.1*f[1];let l=c.ptIdx,p=c.cellIdx;W[0]=g[n*3],W[1]=g[n*3+1],W[2]=g[n*3+2],i[0]<-.5?ut(q,Et,i[0]*o-u.width):i[0]>.5?ut(q,Et,i[0]*o):ut(q,Et,i[0]*o-u.width/2),lr(W,W,q),ut(q,Pr,i[1]*o-u.height/2),lr(W,W,q),c.points[l*3]=W[0],c.points[l*3+1]=W[1],c.points[l*3+2]=W[2],c.tcoords[l*2]=u.tcoords[0],c.tcoords[l*2+1]=u.tcoords[1],l++,ut(q,Et,u.width),lr(W,W,q),c.points[l*3]=W[0],c.points[l*3+1]=W[1],c.points[l*3+2]=W[2],c.tcoords[l*2]=u.tcoords[2],c.tcoords[l*2+1]=u.tcoords[3],l++,ut(q,Pr,u.height),lr(W,W,q),c.points[l*3]=W[0],c.points[l*3+1]=W[1],c.points[l*3+2]=W[2],c.tcoords[l*2]=u.tcoords[4],c.tcoords[l*2+1]=u.tcoords[5],l++,ut(q,Et,u.width),vt(W,W,q),c.points[l*3]=W[0],c.points[l*3+1]=W[1],c.points[l*3+2]=W[2],c.tcoords[l*2]=u.tcoords[6],c.tcoords[l*2+1]=u.tcoords[7],l++,c.polys[p*4]=3,c.polys[p*4+1]=l-4,c.polys[p*4+2]=l-3,c.polys[p*4+3]=l-2,p++,c.polys[p*4]=3,c.polys[p*4+1]=l-4,c.polys[p*4+2]=l-2,c.polys[p*4+3]=l-1,c.ptIdx+=4,c.cellIdx+=2},t.updateTexturePolyData=()=>{const r=e.camera.getCompositeProjectionMatrix(e.lastAspectRatio,-1,1);te(r,r);const n=e.renderable.getTextValues().length,a=n*4,s=n*2,i=new Float64Array(a*3),o=new Uint16Array(s*4),c=new Float32Array(a*2);Re(Ra,r);const u={ptIdx:0,cellIdx:0,polys:o,points:i,tcoords:c};let g=0,f=0,l=0;const p=e.renderable.getTextPolyData().getPoints().getData(),y=e.renderable.getTextValues();for(;g<p.length/3;){W[0]=p[g*3],W[1]=p[g*3+1],W[2]=p[g*3+2],I(q,W,r),W[0]=p[g*3+3],W[1]=p[g*3+4],W[2]=p[g*3+5],I(Bt,W,r),vt(q,q,Bt);const v=[q[0],q[1]];Wh(v),t.createPolyDataForOneLabel(y[f],g,r,Ra,v,e.renderable.getAxisTitlePixelOffset(),u),g+=2,f++;for(let x=0;x<e.renderable.getTickCounts()[l];x++)t.createPolyDataForOneLabel(y[f],g,r,Ra,v,e.renderable.getTickLabelPixelOffset(),u),g++,f++;l++}const h=Q.newInstance({numberOfComponents:2,values:c,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(h),e.tmPolyData.getPoints().setData(i,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(o,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updateAPISpecificData=(r,n,a)=>{(e.lastSize[0]!==r[0]||e.lastSize[1]!==r[1])&&(e.lastSize[0]=r[0],e.lastSize[1]=r[1],e.lastAspectRatio=r[0]/r[1],e.forceUpdate=!0),e.camera=n,t.updateTexturePolyData()}}const Ky=E.newInstance(function(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},r),E.obj(t,e),e.tmPolyData=nt.newInstance(),e.tmMapper=rt.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmActor=tt.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),E.setGet(t,e,["renderable"]),E.get(t,e,["lastSize","lastAspectRatio","axisTextStyle","tickTextStyle","tmActor","ticks"]),e.forceUpdate=!1,e.lastRedrawTime={},E.obj(e.lastRedrawTime,{mtime:0}),e.lastRebuildTime={},E.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.lastTickBounds=[],jy(t,e)},"vtkCubeAxesActorHelper");function Xy(t,e){e.classHierarchy.push("vtkCubeAxesActor"),t.setCamera=n=>{e.camera!==n&&(e.cameraModifiedSub&&(e.cameraModifiedSub.unsubscribe(),e.cameraModifiedSub=null),e.camera=n,n&&(e.cameraModifiedSub=n.onModified(t.update)),t.update(),t.modified())},t.computeFacesToDraw=()=>{const n=e.camera.getViewMatrix();te(n,n);let a=!1;const s=ee.getDiagonalLength(e.dataBounds),i=Math.sin(e.faceVisibilityAngle*Math.PI/180);for(let o=0;o<6;o++){let c=!1;const u=Math.floor(o/2),g=(u+1)%3,f=(u+2)%3;e.dataBounds[g*2]!==e.dataBounds[g*2+1]&&e.dataBounds[f*2]!==e.dataBounds[f*2+1]&&(W[u]=e.dataBounds[o]-.1*s*Ay[o][u],W[g]=.5*(e.dataBounds[g*2]+e.dataBounds[g*2+1]),W[f]=.5*(e.dataBounds[f*2]+e.dataBounds[f*2+1]),I(q,W,n),W[u]=e.dataBounds[o],I(Bt,W,n),vt(q,Bt,q),xr(q,q),c=q[2]>i,e.camera.getParallelProjection()||(xr(Bt,Bt),c=Tc(Bt,q)>i)),c!==e.lastFacesToDraw[o]&&(e.lastFacesToDraw[o]=c,a=!0)}return a},t.updatePolyData=(n,a,s)=>{let i=0,o=0;i+=8;let c=0;for(let p=0;p<12;p++)a[p]>0&&c++;if(o+=c,e.gridLines)for(let p=0;p<6;p++)n[p]&&(i+=s[re[p][0]].length*2+s[re[p][1]].length*2,o+=s[re[p][0]].length+s[re[p][1]].length);const u=new Float64Array(i*3),g=new Uint32Array(o*3);let f=0,l=0;for(let p=0;p<2;p++)for(let y=0;y<2;y++)for(let h=0;h<2;h++)u[f*3]=e.dataBounds[h],u[f*3+1]=e.dataBounds[2+y],u[f*3+2]=e.dataBounds[4+p],f++;for(let p=0;p<12;p++)a[p]>0&&(g[l*3]=2,g[l*3+1]=Kr[p][0],g[l*3+2]=Kr[p][1],l++);if(e.gridLines){for(let p=0;p<6;p++)if(n[p]){const y=Math.floor(p/2);let h=s[re[p][0]];for(let v=0;v<h.length;v++)u[f*3+y]=e.dataBounds[p],u[f*3+re[p][0]]=h[v],u[f*3+re[p][1]]=e.dataBounds[re[p][1]*2],f++,u[f*3+y]=e.dataBounds[p],u[f*3+re[p][0]]=h[v],u[f*3+re[p][1]]=e.dataBounds[re[p][1]*2+1],f++,g[l*3]=2,g[l*3+1]=f-2,g[l*3+2]=f-1,l++;h=s[re[p][1]];for(let v=0;v<h.length;v++)u[f*3+y]=e.dataBounds[p],u[f*3+re[p][1]]=h[v],u[f*3+re[p][0]]=e.dataBounds[re[p][0]*2],f++,u[f*3+y]=e.dataBounds[p],u[f*3+re[p][1]]=h[v],u[f*3+re[p][0]]=e.dataBounds[re[p][0]*2+1],f++,g[l*3]=2,g[l*3+1]=f-2,g[l*3+2]=f-1,l++}}e.polyData.getPoints().setData(u,3),e.polyData.getPoints().modified(),e.polyData.getLines().setData(g,1),e.polyData.getLines().modified(),e.polyData.modified()},t.updateTextData=(n,a,s,i)=>{let o=0;for(let p=0;p<12;p++)a[p]===1&&(o+=2,o+=s[yo[p]].length);const c=e.polyData.getPoints().getData(),u=new Float64Array(o*3);let g=0,f=0,l=0;for(let p=0;p<6;p++)if(n[p])for(let y=0;y<4;y++){const h=vo[p][y];if(a[h]===1){const v=yo[h],x=Kr[h][0]*3,S=Kr[h][1]*3;u[g*3]=.5*(c[x]+c[S]),u[g*3+1]=.5*(c[x+1]+c[S+1]),u[g*3+2]=.5*(c[x+2]+c[S+2]),g++;const d=Math.floor(p/2);u[g*3+d]=e.dataBounds[p],u[g*3+re[p][0]]=.5*(e.dataBounds[re[p][0]*2]+e.dataBounds[re[p][0]*2+1]),u[g*3+re[p][1]]=.5*(e.dataBounds[re[p][1]*2]+e.dataBounds[re[p][1]*2+1]),g++,e.textValues[f]=e.axisLabels[v],f++;const T=(v+1)%3,w=(v+2)%3,C=s[v],O=i[v];e.tickCounts[l]=C.length;for(let R=0;R<C.length;R++)u[g*3+v]=C[R],u[g*3+T]=c[x+T],u[g*3+w]=c[x+w],g++,e.textValues[f]=O[R],f++;l++}}e.textPolyData.getPoints().setData(u,3),e.textPolyData.modified()},t.update=()=>{if(!e.camera)return;const n=t.computeFacesToDraw(),a=e.lastFacesToDraw;let s=!1;for(let i=0;i<6;i++)e.dataBounds[i]!==e.lastTickBounds[i]&&(s=!0,e.lastTickBounds[i]=e.dataBounds[i]);if(n||s||e.forceUpdate){const i=new Array(12).fill(0);for(let c=0;c<6;c++)if(a[c])for(let u=0;u<4;u++)i[vo[c][u]]++;const o=e.generateTicks(e.dataBounds);t.updatePolyData(a,i,o.ticks),t.updateTextData(a,i,o.ticks,o.tickStrings),(s||e.forceUpdate)&&t.updateTextureAtlas(o.tickStrings)}e.forceUpdate=!1},t.updateTextureAtlas=n=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e._tmAtlas.clear();let a=0,s=1;for(let i=0;i<3;i++){if(!e._tmAtlas.has(e.axisLabels[i])){Ma(e.tmContext,e.axisTextStyle);const o=e.tmContext.measureText(e.axisLabels[i]),c={height:o.actualBoundingBoxAscent+2,startingHeight:s,width:o.width+2,textStyle:e.axisTextStyle};e._tmAtlas.set(e.axisLabels[i],c),s+=c.height,a<c.width&&(a=c.width)}Ma(e.tmContext,e.tickTextStyle);for(let o=0;o<n[i].length;o++)if(!e._tmAtlas.has(n[i][o])){const c=e.tmContext.measureText(n[i][o]),u={height:c.actualBoundingBoxAscent+2,startingHeight:s,width:c.width+2,textStyle:e.tickTextStyle};e._tmAtlas.set(n[i][o],u),s+=u.height,a<u.width&&(a=u.width)}}a=me(a),s=me(s),e._tmAtlas.forEach(i=>{i.tcoords=[0,(s-i.startingHeight-i.height)/s,i.width/a,(s-i.startingHeight-i.height)/s,i.width/a,(s-i.startingHeight)/s,0,(s-i.startingHeight)/s]}),e.tmCanvas.width=a,e.tmCanvas.height=s,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,a,s),e._tmAtlas.forEach((i,o)=>{Ma(e.tmContext,i.textStyle),e.tmContext.fillText(o,1,i.startingHeight+i.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified()},t.onModified(()=>{e.forceUpdate=!0,t.update()}),t.setTickTextStyle=n=>{e.tickTextStyle={...e.tickTextStyle,...n},t.modified()},t.setAxisTextStyle=n=>{e.axisTextStyle={...e.axisTextStyle,...n},t.modified()},t.get_tmAtlas=()=>e._tmAtlas,t.getBounds=()=>(t.update(),ee.setBounds(e.bounds,e.gridActor.getBounds()),ee.scaleAboutCenter(e.bounds,e.boundsScaleFactor,e.boundsScaleFactor,e.boundsScaleFactor),e.bounds);const r=E.chain(t.setProperty,e.gridActor.setProperty);t.setProperty=n=>r(n)[0]}function Py(t,e,r){return{boundsScaleFactor:1.3,camera:null,dataBounds:[...ee.INIT_BOUNDS],faceVisibilityAngle:8,gridLines:!0,axisLabels:null,axisTitlePixelOffset:35,tickLabelPixelOffset:12,generateTicks:Eu,...r,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif",...r==null?void 0:r.axisTextStyle},tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif",...r==null?void 0:r.tickTextStyle}}}function Ou(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};tt.extend(t,e,Py(t,e,r)),e.lastFacesToDraw=[!1,!1,!1,!1,!1,!1],e.axisLabels=["X-Axis","Y-Axis","Z-Axis"],e.tickCounts=[],e.textValues=[],e.lastTickBounds=[],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.tmTexture=Yn.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),e.gridMapper=rt.newInstance(),e.polyData=nt.newInstance(),e.gridMapper.setInputData(e.polyData),e.gridActor=tt.newInstance(),e.gridActor.setMapper(e.gridMapper),e.gridActor.setProperty(t.getProperty()),e.gridActor.setParentProp(t),e.textPolyData=nt.newInstance(),E.setGet(t,e,["axisTitlePixelOffset","boundsScaleFactor","faceVisibilityAngle","gridLines","tickLabelPixelOffset","generateTicks"]),E.setGetArray(t,e,["dataBounds"],6),E.setGetArray(t,e,["axisLabels"],3),E.get(t,e,["axisTextStyle","tickTextStyle","camera","tmTexture","textValues","textPolyData","tickCounts","gridActor"]),Xy(t,e)}const Yy=E.newInstance(Ou,"vtkCubeAxesActor");var Ru={newInstance:Yy,extend:Ou,newCubeAxesActorHelper:Ky,defaultGenerateTicks:Eu};function qy(t,e){e.classHierarchy.push("vtkOpenGLCubeAxesActor"),t.buildPass=r=>{r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){const a=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,s=e._openGLRenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([s.usize,s.vsize],a,e._openGLRenderWindow.getRenderable())}}}const Iy={};function Qy(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Iy,r),ae.extend(t,e,r),e.CubeAxesActorHelper=Ru.newCubeAxesActorHelper(),qy(t,e)}const Zy=Z(Qy,"vtkOpenGLCubeAxesActor");Ve("vtkCubeAxesActor",Zy);const dr={ARRAY_BUFFER:0,ELEMENT_ARRAY_BUFFER:1,TEXTURE_BUFFER:2};var Mu={ObjectType:dr};const{ObjectType:xn}=Mu,Jy={};function ed(t,e){e.classHierarchy.push("vtkOpenGLBufferObject");function r(o){switch(o){case xn.ELEMENT_ARRAY_BUFFER:return e.context.ELEMENT_ARRAY_BUFFER;case xn.TEXTURE_BUFFER:if("TEXTURE_BUFFER"in e.context)return e.context.TEXTURE_BUFFER;case xn.ARRAY_BUFFER:default:return e.context.ARRAY_BUFFER}}let n=null,a=null,s=!0,i="";t.getType=()=>n,t.setType=o=>{n=o},t.getHandle=()=>a,t.isReady=()=>s===!1,t.generateBuffer=o=>{const c=r(o);return a===null&&(a=e.context.createBuffer(),n=o),r(n)===c},t.upload=(o,c)=>t.generateBuffer(c)?(e.context.bindBuffer(r(n),a),e.context.bufferData(r(n),o,e.context.STATIC_DRAW),e.allocatedGPUMemoryInBytes=o.length*o.BYTES_PER_ELEMENT,s=!1,!0):(i="Trying to upload array buffer to incompatible buffer.",!1),t.bind=()=>a?(e.context.bindBuffer(r(n),a),!0):!1,t.release=()=>a?(e.context.bindBuffer(r(n),null),!0):!1,t.releaseGraphicsResources=()=>{a!==null&&(e.context.bindBuffer(r(n),null),e.context.deleteBuffer(a),a=null,e.allocatedGPUMemoryInBytes=0)},t.setOpenGLRenderWindow=o=>{e._openGLRenderWindow!==o&&(t.releaseGraphicsResources(),e._openGLRenderWindow=o,e.context=null,o&&(e.context=e._openGLRenderWindow.getContext()))},t.getError=()=>i}const td={objectType:xn.ARRAY_BUFFER,context:null,allocatedGPUMemoryInBytes:0};function Du(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,td,r),E.obj(t,e),E.get(t,e,["_openGLRenderWindow","allocatedGPUMemoryInBytes"]),E.moveToProtected(t,e,["openGLRenderWindow"]),ed(t,e)}const rd=E.newInstance(Du);var Lu={newInstance:rd,extend:Du,...Jy,...Mu};const{vtkErrorMacro:To}=E;function nd(t,e){const r=new Float64Array(3);g0(r,e);const n=new Float64Array(16);return gc(n,Nt(),t,r),n}function ad(t,e){return t===null||e===null?!1:!(ri(t,[0,0,0])&&ri(e,[1,1,1]))}function sd(t,e){e.classHierarchy.push("vtkOpenGLCellArrayBufferObject"),t.setType(dr.ARRAY_BUFFER),t.createVBO=function(r,n,a,s){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;if(!r.getData()||!r.getData().length)return e.elementCount=0,0;e.blockSize=3,e.vertexOffset=0,e.normalOffset=0,e.tCoordOffset=0,e.tCoordComponents=0,e.colorComponents=0,e.colorOffset=0,e.customData=[];const o=s.points.getData();let c=null,u=null,g=null;const f=s.colors?s.colors.getNumberOfComponents():0,l=s.tcoords?s.tcoords.getNumberOfComponents():0;s.normals&&(e.normalOffset=4*e.blockSize,e.blockSize+=3,c=s.normals.getData()),s.customAttributes&&s.customAttributes.forEach(U=>{U&&(e.customData.push({data:U.getData(),offset:4*e.blockSize,components:U.getNumberOfComponents(),name:U.getName()}),e.blockSize+=U.getNumberOfComponents())}),s.tcoords&&(e.tCoordOffset=4*e.blockSize,e.tCoordComponents=l,e.blockSize+=l,u=s.tcoords.getData()),s.colors?(e.colorComponents=s.colors.getNumberOfComponents(),e.colorOffset=0,g=s.colors.getData(),e.colorBO||(e.colorBO=Lu.newInstance()),e.colorBO.setOpenGLRenderWindow(e._openGLRenderWindow)):e.colorBO=null,e.stride=4*e.blockSize;let p=0,y=0,h=0,v=0,x=0,S=0,d;const T={anythingToPoints(U,m,$,z){for(let N=0;N<U;++N)d(m[$+N],z)},linesToWireframe(U,m,$,z){for(let N=0;N<U-1;++N)d(m[$+N],z),d(m[$+N+1],z)},polysToWireframe(U,m,$,z){if(U>2)for(let N=0;N<U;++N)d(m[$+N],z),d(m[$+(N+1)%U],z)},stripsToWireframe(U,m,$,z){if(U>2){for(let N=0;N<U-1;++N)d(m[$+N],z),d(m[$+N+1],z);for(let N=0;N<U-2;N++)d(m[$+N],z),d(m[$+N+2],z)}},polysToSurface(U,m,$,z){for(let N=0;N<U-2;N++)d(m[$+0],z),d(m[$+N+1],z),d(m[$+N+2],z)},stripsToSurface(U,m,$,z){for(let N=0;N<U-2;N++)d(m[$+N],z),d(m[$+N+1+N%2],z),d(m[$+N+1+(N+1)%2],z)}},w={anythingToPoints(U,m){return U},linesToWireframe(U,m){return U>1?(U-1)*2:0},polysToWireframe(U,m){return U>2?U*2:0},stripsToWireframe(U,m){return U>2?U*4-6:0},polysToSurface(U,m){return U>2?(U-2)*3:0},stripsToSurface(U,m,$){return U>2?(U-2)*3:0}};let C=null,O=null;a===Le.POINTS||n==="verts"?(C=T.anythingToPoints,O=w.anythingToPoints):a===Le.WIREFRAME||n==="lines"?(C=T[`${n}ToWireframe`],O=w[`${n}ToWireframe`]):(C=T[`${n}ToSurface`],O=w[`${n}ToSurface`]);const R=r.getData(),L=R.length;let M=0;for(let U=0;U<L;)M+=O(R[U],R),U+=R[U]+1;let D=null;const V=new Float32Array(M*e.blockSize);g&&(D=new Uint8Array(M*4));let B=0,_=0,k=0,G=0;for(let U=0;U<3;++U){const m=s.points.getRange(U),$=m[1]-m[0];k+=$*$;const z=.5*(m[1]+m[0]);G+=z*z}if(k>0&&(Math.abs(G)/k>1e6||Math.abs(Math.log10(k))>3||k===0&&G>1e6)){const U=new Float64Array(3),m=new Float64Array(3);for(let $=0;$<3;++$){const z=s.points.getRange($),N=z[1]-z[0];U[$]=.5*(z[1]+z[0]),m[$]=N>0?1/N:1}t.setCoordShiftAndScale(U,m)}else e.coordShiftAndScaleEnabled===!0&&t.setCoordShiftAndScale(null,null);if(i)if(!i.points&&!i.cells)i.points=new Int32Array(M),i.cells=new Int32Array(M);else{const U=new Int32Array(M+i.points.length);U.set(i.points),i.points=U;const m=new Int32Array(M+i.cells.length);m.set(i.cells),i.cells=m}let Y=s.vertexOffset;d=function(m,$){if(i&&(i.points[Y]=m,i.cells[Y]=S+s.cellOffset),++Y,p=m*3,e.coordShiftAndScaleEnabled?(V[B++]=(o[p++]-e.coordShift[0])*e.coordScale[0],V[B++]=(o[p++]-e.coordShift[1])*e.coordScale[1],V[B++]=(o[p++]-e.coordShift[2])*e.coordScale[2]):(V[B++]=o[p++],V[B++]=o[p++],V[B++]=o[p++]),c!==null&&(s.haveCellNormals?y=(S+s.cellOffset)*3:y=m*3,V[B++]=c[y++],V[B++]=c[y++],V[B++]=c[y++]),e.customData.forEach(z=>{x=m*z.components;for(let N=0;N<z.components;++N)V[B++]=z.data[x++]}),u!==null){s.useTCoordsPerCell?h=$*l:h=m*l;for(let z=0;z<l;++z)V[B++]=u[h++]}g!==null&&(s.haveCellScalars?v=(S+s.cellOffset)*f:v=m*f,D[_++]=g[v++],D[_++]=g[v++],D[_++]=g[v++],D[_++]=f===4?g[v++]:255)};for(let U=0;U<L;U+=R[U]+1,S++)C(R[U],R,U+1,S+s.cellOffset);return e.elementCount=M,t.upload(V,dr.ARRAY_BUFFER),e.colorBO&&(e.colorBOStride=4,e.colorBO.upload(D,dr.ARRAY_BUFFER)),S},t.setCoordShiftAndScale=(r,n)=>{if(r!==null&&(r.constructor!==Float64Array||r.length!==3)){To("Wrong type for coordShift, expected vec3 or null");return}if(n!==null&&(n.constructor!==Float64Array||n.length!==3)){To("Wrong type for coordScale, expected vec3 or null");return}(e.coordShift===null||r===null||!ni(r,e.coordShift))&&(e.coordShift=r),(e.coordScale===null||n===null||!ni(n,e.coordScale))&&(e.coordScale=n),e.coordShiftAndScaleEnabled=ad(e.coordShift,e.coordScale),e.coordShiftAndScaleEnabled?e.inverseShiftAndScaleMatrix=nd(e.coordShift,e.coordScale):e.inverseShiftAndScaleMatrix=null}}const id={elementCount:0,stride:0,colorBOStride:0,vertexOffset:0,normalOffset:0,tCoordOffset:0,tCoordComponents:0,colorOffset:0,colorComponents:0,tcoordBO:null,customData:[],coordShift:null,coordScale:null,coordShiftAndScaleEnabled:!1,inverseShiftAndScaleMatrix:null};function Vu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,id,r),Lu.extend(t,e,r),E.setGet(t,e,["colorBO","elementCount","stride","colorBOStride","vertexOffset","normalOffset","tCoordOffset","tCoordComponents","colorOffset","colorComponents","customData"]),E.get(t,e,["coordShift","coordScale","coordShiftAndScaleEnabled","inverseShiftAndScaleMatrix"]),sd(t,e)}const od=E.newInstance(Vu);var cd={newInstance:od,extend:Vu};const{vtkErrorMacro:fd}=E;function ud(t,e){e.classHierarchy.push("vtkShader"),t.compile=()=>{let r=e.context.VERTEX_SHADER;if(!e.source||!e.source.length||e.shaderType==="Unknown")return!1;switch(e.handle!==0&&(e.context.deleteShader(e.handle),e.handle=0),e.shaderType){case"Fragment":r=e.context.FRAGMENT_SHADER;break;case"Vertex":default:r=e.context.VERTEX_SHADER;break}if(e.handle=e.context.createShader(r),e.context.shaderSource(e.handle,e.source),e.context.compileShader(e.handle),!e.context.getShaderParameter(e.handle,e.context.COMPILE_STATUS)){const a=e.context.getShaderInfoLog(e.handle);return fd(`Error compiling shader '${e.source}': ${a}`),e.context.deleteShader(e.handle),e.handle=0,!1}return!0},t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(e.context.deleteShader(e.handle),e.handle=0,e.dirty=!0)}}const gd={shaderType:"Unknown",source:"",error:"",handle:0,dirty:!1,context:null};function _u(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,gd,r),E.obj(t,e),E.setGet(t,e,["shaderType","source","error","handle","context"]),ud(t,e)}const ld=E.newInstance(_u,"vtkShader");var Da={newInstance:ld,extend:_u};const{vtkErrorMacro:$e}=E;function pd(t,e,r,n){const a=typeof r=="string"?r:r.join(`
`),s=n===!1?e:new RegExp(e,"g"),i=t.replace(s,a);return{replace:i!==a,result:i}}function hd(t,e){e.classHierarchy.push("vtkShaderProgram"),t.compileShader=()=>e.vertexShader.compile()?e.fragmentShader.compile()?!t.attachShader(e.vertexShader)||!t.attachShader(e.fragmentShader)?($e(e.error),0):t.link()?(t.setCompiled(!0),1):($e(`Links failed: ${e.error}`),0):($e(e.fragmentShader.getSource().split(`
`).map((r,n)=>`${n}: ${r}`).join(`
`)),$e(e.fragmentShader.getError()),0):($e(e.vertexShader.getSource().split(`
`).map((r,n)=>`${n}: ${r}`).join(`
`)),$e(e.vertexShader.getError()),0),t.cleanup=()=>{e.shaderType==="Unknown"||e.handle===0||(t.release(),e.vertexShaderHandle!==0&&(e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=0),e.fragmentShaderHandle!==0&&(e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=0),e.context.deleteProgram(e.handle),e.handle=0,t.setCompiled(!1))},t.bind=()=>!e.linked&&!t.link()?!1:(e.context.useProgram(e.handle),t.setBound(!0),!0),t.isBound=()=>!!e.bound,t.release=()=>{e.context.useProgram(null),t.setBound(!1)},t.setContext=r=>{e.vertexShader.setContext(r),e.fragmentShader.setContext(r),e.geometryShader.setContext(r)},t.link=()=>{if(e.linked)return!0;if(e.handle===0)return e.error="Program has not been initialized, and/or does not have shaders.",!1;if(e.uniformLocs={},e.context.linkProgram(e.handle),!e.context.getProgramParameter(e.handle,e.context.LINK_STATUS)){const n=e.context.getProgramInfoLog(e.handle);return $e(`Error linking shader ${n}`),e.handle=0,!1}return t.setLinked(!0),e.attributeLocs={},!0},t.setUniformMatrix=(r,n)=>{const a=t.findUniform(r);if(a===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;const s=new Float32Array(n);return e.context.uniformMatrix4fv(a,!1,s),!0},t.setUniformMatrix3x3=(r,n)=>{const a=t.findUniform(r);if(a===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;const s=new Float32Array(n);return e.context.uniformMatrix3fv(a,!1,s),!0},t.setUniformf=(r,n)=>{const a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1f(a,n),!0)},t.setUniformfv=(r,n)=>{const a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1fv(a,n),!0)},t.setUniformi=(r,n)=>{const a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1i(a,n),!0)},t.setUniformiv=(r,n)=>{const a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform1iv(a,n),!0)},t.setUniform2f=(r,n,a)=>{const s=t.findUniform(r);if(s===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2f(s,n,a),!0},t.setUniform2fv=(r,n)=>{const a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform2fv(a,n),!0)},t.setUniform2i=(r,n,a)=>{const s=t.findUniform(r);if(s===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(a===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform2i(s,n,a),!0},t.setUniform2iv=(r,n)=>{const a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform2iv(a,n),!0)},t.setUniform3f=(r,n,a,s)=>{const i=t.findUniform(r);if(i===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(s===void 0)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(i,n,a,s),!0},t.setUniform3fArray=(r,n)=>{const a=t.findUniform(r);if(a===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;if(!Array.isArray(n)||n.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3f(a,n[0],n[1],n[2]),!0},t.setUniform3fv=(r,n)=>{const a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform3fv(a,n),!0)},t.setUniform3i=function(r){const n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var a=arguments.length,s=new Array(a>1?a-1:0),i=1;i<a;i++)s[i-1]=arguments[i];let o=s;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==3)throw new RangeError("Invalid number of values for array");return e.context.uniform3i(n,o[0],o[1],o[2]),!0},t.setUniform3iv=(r,n)=>{const a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform3iv(a,n),!0)},t.setUniform4f=function(r){const n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var a=arguments.length,s=new Array(a>1?a-1:0),i=1;i<a;i++)s[i-1]=arguments[i];let o=s;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4f(n,o[0],o[1],o[2],o[3]),!0},t.setUniform4fv=(r,n)=>{const a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform4fv(a,n),!0)},t.setUniform4i=function(r){const n=t.findUniform(r);if(n===-1)return e.error=`Could not set uniform ${r} . No such uniform.`,!1;for(var a=arguments.length,s=new Array(a>1?a-1:0),i=1;i<a;i++)s[i-1]=arguments[i];let o=s;if(o.length===1&&Array.isArray(o[0])&&(o=o[0]),o.length!==4)throw new RangeError("Invalid number of values for array");return e.context.uniform4i(n,o[0],o[1],o[2],o[3]),!0},t.setUniform4iv=(r,n)=>{const a=t.findUniform(r);return a===-1?(e.error=`Could not set uniform ${r} . No such uniform.`,!1):(e.context.uniform4iv(a,n),!0)},t.findUniform=r=>{if(!r||!e.linked)return-1;let n=e.uniformLocs[r];return n!==void 0?n:(n=e.context.getUniformLocation(e.handle,r),n===null?(e.error=`Uniform ${r} not found in current shader program.`,e.uniformLocs[r]=-1,-1):(e.uniformLocs[r]=n,n))},t.isUniformUsed=r=>{if(!r)return!1;let n=e.uniformLocs[r];return n!==void 0?n!==null:e.linked?(n=e.context.getUniformLocation(e.handle,r),e.uniformLocs[r]=n,n!==null):($e("attempt to find uniform when the shader program is not linked"),!1)},t.isAttributeUsed=r=>{if(!r)return!1;if(r in e.attributeLocs)return!0;if(!e.linked)return $e("attempt to find uniform when the shader program is not linked"),!1;const n=e.context.getAttribLocation(e.handle,r);return n===-1?!1:(e.attributeLocs[r]=n,!0)},t.attachShader=r=>{if(r.getHandle()===0)return e.error="Shader object was not initialized, cannot attach it.",!1;if(r.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;if(e.handle===0){const n=e.context.createProgram();if(n===0)return e.error="Could not create shader program.",!1;e.handle=n,e.linked=!1}return r.getShaderType()==="Vertex"&&(e.vertexShaderHandle!==0&&e.context.detachShader(e.handle,e.vertexShaderHandle),e.vertexShaderHandle=r.getHandle()),r.getShaderType()==="Fragment"&&(e.fragmentShaderHandle!==0&&e.context.detachShader(e.handle,e.fragmentShaderHandle),e.fragmentShaderHandle=r.getHandle()),e.context.attachShader(e.handle,r.getHandle()),t.setLinked(!1),!0},t.detachShader=r=>{if(r.getHandle()===0)return e.error="shader object was not initialized, cannot attach it.",!1;if(r.getShaderType()==="Unknown")return e.error="Shader object is of type Unknown and cannot be used.",!1;switch(e.handle===0&&(e.error="This shader program has not been initialized yet."),r.getShaderType()){case"Vertex":return e.vertexShaderHandle!==r.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,r.getHandle()),e.vertexShaderHandle=0,e.linked=!1,!0);case"Fragment":return e.fragmentShaderHandle!==r.getHandle()?(e.error="The supplied shader was not attached to this program.",!1):(e.context.detachShader(e.handle,r.getHandle()),e.fragmentShaderHandle=0,e.linked=!1,!0);default:return!1}},t.setContext=r=>{e.context=r,e.vertexShader.setContext(r),e.fragmentShader.setContext(r),e.geometryShader.setContext(r)},t.setLastCameraMTime=r=>{e.lastCameraMTime=r}}const vd={vertexShaderHandle:0,fragmentShaderHandle:0,geometryShaderHandle:0,vertexShader:null,fragmentShader:null,geometryShader:null,linked:!1,bound:!1,compiled:!1,error:"",handle:0,numberOfOutputs:0,attributesLocs:null,uniformLocs:null,md5Hash:0,context:null,lastCameraMTime:null};function Bu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vd,r),e.attributesLocs={},e.uniformLocs={},e.vertexShader=Da.newInstance(),e.vertexShader.setShaderType("Vertex"),e.fragmentShader=Da.newInstance(),e.fragmentShader.setShaderType("Fragment"),e.geometryShader=Da.newInstance(),e.geometryShader.setShaderType("Geometry"),E.obj(t,e),E.get(t,e,["lastCameraMTime"]),E.setGet(t,e,["error","handle","compiled","bound","md5Hash","vertexShader","fragmentShader","geometryShader","linked"]),hd(t,e)}const yd=E.newInstance(Bu,"vtkShaderProgram");var F={newInstance:yd,extend:Bu,substitute:pd};function dd(t,e){e.classHierarchy.push("vtkOpenGLVertexArrayObject"),t.exposedMethod=()=>{},t.initialize=()=>{e.instancingExtension=null,e._openGLRenderWindow.getWebgl2()||(e.instancingExtension=e.context.getExtension("ANGLE_instanced_arrays")),!e.forceEmulation&&e._openGLRenderWindow&&e._openGLRenderWindow.getWebgl2()?(e.extension=null,e.supported=!0,e.handleVAO=e.context.createVertexArray()):(e.extension=e.context.getExtension("OES_vertex_array_object"),!e.forceEmulation&&e.extension?(e.supported=!0,e.handleVAO=e.extension.createVertexArrayOES()):e.supported=!1)},t.isReady=()=>e.handleVAO!==0||e.supported===!1,t.bind=()=>{if(t.isReady()||t.initialize(),t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(e.handleVAO):e.context.bindVertexArray(e.handleVAO);else if(t.isReady()){const r=e.context;for(let n=0;n<e.buffers.length;++n){const a=e.buffers[n];e.context.bindBuffer(r.ARRAY_BUFFER,a.buffer);for(let s=0;s<a.attributes.length;++s){const i=a.attributes[s],o=i.isMatrix?i.size:1;for(let c=0;c<o;++c)r.enableVertexAttribArray(i.index+c),r.vertexAttribPointer(i.index+c,i.size,i.type,i.normalize,i.stride,i.offset+i.stride*c/i.size),i.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(i.index+c,1):r.vertexAttribDivisor(i.index+c,1))}}}},t.release=()=>{if(t.isReady()&&e.supported)e.extension?e.extension.bindVertexArrayOES(null):e.context.bindVertexArray(null);else if(t.isReady()){const r=e.context;for(let n=0;n<e.buffers.length;++n){const a=e.buffers[n];e.context.bindBuffer(r.ARRAY_BUFFER,a.buffer);for(let s=0;s<a.attributes.length;++s){const i=a.attributes[s],o=i.isMatrix?i.size:1;for(let c=0;c<o;++c)r.enableVertexAttribArray(i.index+c),r.vertexAttribPointer(i.index+c,i.size,i.type,i.normalize,i.stride,i.offset+i.stride*c/i.size),i.divisor>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(i.index+c,0):r.vertexAttribDivisor(i.index+c,0)),r.disableVertexAttribArray(i.index+c)}}}},t.shaderProgramChanged=()=>{t.release(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.handleProgram=0},t.releaseGraphicsResources=()=>{t.shaderProgramChanged(),e.handleVAO&&(e.extension?e.extension.deleteVertexArrayOES(e.handleVAO):e.context.deleteVertexArray(e.handleVAO)),e.handleVAO=0,e.supported=!0,e.handleProgram=0},t.addAttributeArray=(r,n,a,s,i,o,c,u)=>t.addAttributeArrayWithDivisor(r,n,a,s,i,o,c,u,0,!1),t.addAttributeArrayWithDivisor=(r,n,a,s,i,o,c,u,g,f)=>{if(!r||!r.isBound()||n.getHandle()===0||n.getType()!==dr.ARRAY_BUFFER||(e.handleProgram===0&&(e.handleProgram=r.getHandle()),t.isReady()||t.initialize(),!t.isReady()||e.handleProgram!==r.getHandle()))return!1;const l=e.context,p={};if(p.name=a,p.index=l.getAttribLocation(e.handleProgram,a),p.offset=s,p.stride=i,p.type=o,p.size=c,p.normalize=u,p.isMatrix=f,p.divisor=g,p.Index===-1)return!1;if(n.bind(),l.enableVertexAttribArray(p.index),l.vertexAttribPointer(p.index,p.size,p.type,p.normalize,p.stride,p.offset),g>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(p.index,1):l.vertexAttribDivisor(p.index,1)),p.buffer=n.getHandle(),!e.supported){let y=!1;for(let h=0;h<e.buffers.length;++h){const v=e.buffers[h];if(v.buffer===p.buffer){y=!0;let x=!1;for(let S=0;S<v.attributes.length;++S)v.attributes[S].name===a&&(x=!0,v.attributes[S]=p);x||v.attributes.push(p)}}y||e.buffers.push({buffer:p.buffer,attributes:[p]})}return!0},t.addAttributeMatrixWithDivisor=(r,n,a,s,i,o,c,u,g)=>{const f=t.addAttributeArrayWithDivisor(r,n,a,s,i,o,c,u,g,!0);if(!f)return f;const l=e.context,p=l.getAttribLocation(e.handleProgram,a);for(let y=1;y<c;y++)l.enableVertexAttribArray(p+y),l.vertexAttribPointer(p+y,c,o,u,i,s+i*y/c),g>0&&(e.instancingExtension?e.instancingExtension.vertexAttribDivisorANGLE(p+y,1):l.vertexAttribDivisor(p+y,1));return!0},t.removeAttributeArray=r=>{if(!t.isReady()||e.handleProgram===0)return!1;if(!e.supported)for(let n=0;n<e.buffers.length;++n){const a=e.buffers[n];for(let s=0;s<a.attributes.length;++s)if(a.attributes[s].name===r)return a.attributes.splice(s,1),a.attributes.length||e.buffers.splice(n,1),!0}return!0},t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))}}const Td={forceEmulation:!1,handleVAO:0,handleProgram:0,supported:!0,buffers:null,context:null};function Fu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Td,r),e.buffers=[],E.obj(t,e),E.get(t,e,["supported"]),E.setGet(t,e,["forceEmulation"]),dd(t,e)}const xd=E.newInstance(Fu,"vtkOpenGLVertexArrayObject");var Uu={newInstance:xd,extend:Fu};const gt={Start:0,Points:0,Lines:1,Tris:2,TriStrips:3,TrisEdges:4,TriStripsEdges:5,End:6};function Sd(t,e){e.classHierarchy.push("vtkOpenGLHelper"),t.setOpenGLRenderWindow=r=>{e.context=r.getContext(),e.program.setContext(e.context),e.VAO.setOpenGLRenderWindow(r),e.CABO.setOpenGLRenderWindow(r)},t.releaseGraphicsResources=r=>{e.VAO.releaseGraphicsResources(),e.CABO.releaseGraphicsResources(),e.CABO.setElementCount(0)},t.drawArrays=(r,n,a,s)=>{if(e.CABO.getElementCount()){const i=t.getOpenGLMode(a),o=t.haveWideLines(r,n),c=e.context,u=c.getParameter(c.DEPTH_WRITEMASK);e.pointPicking&&c.depthMask(!1),i===c.LINES&&o?(t.updateShaders(r,n,s),c.drawArraysInstanced(i,0,e.CABO.getElementCount(),2*Math.ceil(n.getProperty().getLineWidth()))):(c.lineWidth(n.getProperty().getLineWidth()),t.updateShaders(r,n,s),c.drawArrays(i,0,e.CABO.getElementCount()),c.lineWidth(1));const f=(i===c.POINTS?1:0)||(i===c.LINES?2:3);return e.pointPicking&&c.depthMask(u),e.CABO.getElementCount()/f}return 0},t.getOpenGLMode=r=>{if(e.pointPicking)return e.context.POINTS;const n=e.primitiveType;return r===Le.POINTS||n===gt.Points?e.context.POINTS:r===Le.WIREFRAME||n===gt.Lines||n===gt.TrisEdges||n===gt.TriStripsEdges?e.context.LINES:e.context.TRIANGLES},t.haveWideLines=(r,n)=>n.getProperty().getLineWidth()>1?!(e.CABO.getOpenGLRenderWindow()&&e.CABO.getOpenGLRenderWindow().getHardwareMaximumLineWidth()>=n.getProperty().getLineWidth()):!1,t.getNeedToRebuildShaders=(r,n,a)=>!!(a.getNeedToRebuildShaders(t,r,n)||t.getProgram()===0||t.getShaderSourceTime().getMTime()<a.getMTime()||t.getShaderSourceTime().getMTime()<n.getMTime()),t.updateShaders=(r,n,a)=>{if(t.getNeedToRebuildShaders(r,n,a)){const s={Vertex:null,Fragment:null,Geometry:null};a.buildShaders(s,r,n);const i=e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgramArray(s.Vertex,s.Fragment,s.Geometry);i!==t.getProgram()&&(t.setProgram(i),t.getVAO().releaseGraphicsResources()),t.getShaderSourceTime().modified()}else e.CABO.getOpenGLRenderWindow().getShaderCache().readyShaderProgram(t.getProgram());t.getVAO().bind(),a.setMapperShaderParameters(t,r,n),a.setPropertyShaderParameters(t,r,n),a.setCameraShaderParameters(t,r,n),a.setLightingShaderParameters(t,r,n),a.invokeShaderCallbacks(t,r,n)},t.setMapperShaderParameters=(r,n,a)=>{if(t.haveWideLines(r,n)){t.getProgram().setUniform2f("viewportSize",a.usize,a.vsize);const s=parseFloat(n.getProperty().getLineWidth()),i=s/2;t.getProgram().setUniformf("lineWidthStepSize",s/Math.ceil(s)),t.getProgram().setUniformf("halfLineWidth",i)}e.primitiveType===gt.Points||n.getProperty().getRepresentation()===Le.POINTS?t.getProgram().setUniformf("pointSize",n.getProperty().getPointSize()):e.pointPicking&&t.getProgram().setUniformf("pointSize",t.getPointPickingPrimitiveSize())},t.replaceShaderPositionVC=(r,n,a)=>{let s=r.Vertex;s=F.substitute(s,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform float pointSize;"]).result,s=F.substitute(s,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl","  gl_PointSize = pointSize;"],!1).result,t.getOpenGLMode(a.getProperty().getRepresentation())===e.context.LINES&&t.haveWideLines(n,a)&&(s=F.substitute(s,"//VTK::PositionVC::Dec",["//VTK::PositionVC::Dec","uniform vec2 viewportSize;","uniform float lineWidthStepSize;","uniform float halfLineWidth;"]).result,s=F.substitute(s,"//VTK::PositionVC::Impl",["//VTK::PositionVC::Impl"," if (halfLineWidth > 0.0)","   {","   float offset = float(gl_InstanceID / 2) * lineWidthStepSize - halfLineWidth;","   vec4 tmpPos = gl_Position;","   vec3 tmpPos2 = tmpPos.xyz / tmpPos.w;","   tmpPos2.x = tmpPos2.x + 2.0 * mod(float(gl_InstanceID), 2.0) * offset / viewportSize[0];","   tmpPos2.y = tmpPos2.y + 2.0 * mod(float(gl_InstanceID + 1), 2.0) * offset / viewportSize[1];","   gl_Position = vec4(tmpPos2.xyz * tmpPos.w, tmpPos.w);","   }"]).result),r.Vertex=s},t.getPointPickingPrimitiveSize=()=>e.primitiveType===gt.Points?2:e.primitiveType===gt.Lines?4:6,t.getAllocatedGPUMemoryInBytes=()=>t.getCABO().getAllocatedGPUMemoryInBytes()}const Cd={context:null,program:null,shaderSourceTime:null,VAO:null,attributeUpdateTime:null,CABO:null,primitiveType:0,pointPicking:!1};function mu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Cd,r),E.obj(t,e),e.shaderSourceTime={},E.obj(e.shaderSourceTime),e.attributeUpdateTime={},E.obj(e.attributeUpdateTime),E.setGet(t,e,["program","shaderSourceTime","VAO","attributeUpdateTime","CABO","primitiveType","pointPicking"]),e.program=F.newInstance(),e.VAO=Uu.newInstance(),e.CABO=cd.newInstance(),Sd(t,e)}const wd=E.newInstance(mu);var ar={newInstance:wd,extend:mu,primTypes:gt};const Ed={CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},us={NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5};var ku={Wrap:Ed,Filter:us};const Nu=new Float32Array(1),Od=new Int32Array(Nu.buffer);function Rd(t){Nu[0]=t;const e=Od[0];let r=e>>16&32768,n=e>>12&2047;const a=e>>23&255;return a<103?r:a>142?(r|=31744,r|=(a===255?0:1)&&e&8388607,r):a<113?(n|=2048,r|=(n>>114-a)+(n>>113-a&1),r):(r|=a-112<<10|n>>1,r+=n&1,r)}function Md(t){const e=(t&32768)>>15,r=(t&31744)>>10,n=t&1023;return r===0?(e?-1:1)*2**-14*(n/2**10):r===31?n?NaN:(e?-1:1)*(1/0):(e?-1:1)*2**(r-15)*(1+n/2**10)}var Ne={fromHalf:Md,toHalf:Rd};function Dd(){try{const n=new Int16Array([0,32767]),a=[1,1],s=document.createElement("canvas");s.width=4,s.height=4;const i=s.getContext("webgl2");if(!i)return!1;const o=i.getExtension("EXT_texture_norm16");if(!o)return!1;const c=`#version 300 es
    void main() {
      gl_PointSize = ${4 .toFixed(1)};
      gl_Position = vec4(0, 0, 0, 1);
    }
  `,u=`#version 300 es
    precision highp float;
    precision highp int;
    precision highp sampler2D;

    uniform sampler2D u_image;

    out vec4 color;

    void main() {
        vec4 intColor = texture(u_image, gl_PointCoord.xy);
        color = vec4(vec3(intColor.rrr), 1);
    }
    `,g=i.createShader(i.VERTEX_SHADER);if(i.shaderSource(g,c),i.compileShader(g),!i.getShaderParameter(g,i.COMPILE_STATUS))return!1;const f=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(f,u),i.compileShader(f),!i.getShaderParameter(f,i.COMPILE_STATUS))return!1;const l=i.createProgram();if(i.attachShader(l,g),i.attachShader(l,f),i.linkProgram(l),!i.getProgramParameter(l,i.LINK_STATUS))return!1;const p=i.createTexture();i.bindTexture(i.TEXTURE_2D,p),i.texImage2D(i.TEXTURE_2D,0,o.R16_SNORM_EXT,2,1,0,i.RED,i.SHORT,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.useProgram(l),i.drawArrays(i.POINTS,0,1);const y=new Uint8Array(4);i.readPixels(a[0],a[1],1,1,i.RGBA,i.UNSIGNED_BYTE,y);const[h,v,x]=y,S=i.getExtension("WEBGL_lose_context");return S&&S.loseContext(),h===v&&v===x&&h!==0}catch{return!1}}let La;function Ld(){return La===void 0&&(La=Dd()),La}const{Wrap:Qe,Filter:ce}=ku,{VtkDataTypes:X}=Q,{vtkDebugMacro:Va,vtkErrorMacro:$t,vtkWarningMacro:xo}=Pe,{toHalf:Vd}=Ne;function _d(t,e){e.classHierarchy.push("vtkOpenGLTexture"),t.render=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(u?e._openGLRenderWindow=u:(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow")),e.context=e._openGLRenderWindow.getContext(),e.renderable.getInterpolate()?(e.generateMipmap?t.setMinificationFilter(ce.LINEAR_MIPMAP_LINEAR):t.setMinificationFilter(ce.LINEAR),t.setMagnificationFilter(ce.LINEAR)):(t.setMinificationFilter(ce.NEAREST),t.setMagnificationFilter(ce.NEAREST)),e.renderable.getRepeat()&&(t.setWrapR(Qe.REPEAT),t.setWrapS(Qe.REPEAT),t.setWrapT(Qe.REPEAT)),e.renderable.getInputData()&&e.renderable.setImage(null),!e.handle||e.renderable.getMTime()>e.textureBuildTime.getMTime()){if(e.renderable.getImage()!==null&&(e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(ce.LINEAR_MIPMAP_LINEAR)),e.renderable.getImage()&&e.renderable.getImageLoaded()&&(t.create2DFromImage(e.renderable.getImage()),t.activate(),t.sendParameters(),e.textureBuildTime.modified())),e.renderable.getCanvas()!==null){e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(ce.LINEAR_MIPMAP_LINEAR));const f=e.renderable.getCanvas();t.create2DFromRaw(f.width,f.height,4,X.UNSIGNED_CHAR,f,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}if(e.renderable.getJsImageData()!==null){const f=e.renderable.getJsImageData();e.renderable.getInterpolate()&&(e.generateMipmap=!0,t.setMinificationFilter(ce.LINEAR_MIPMAP_LINEAR)),t.create2DFromRaw(f.width,f.height,4,X.UNSIGNED_CHAR,f.data,!0),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}const g=e.renderable.getInputData(0);if(g&&g.getPointData().getScalars()){const f=g.getExtent(),l=g.getPointData().getScalars(),p=[];for(let y=0;y<e.renderable.getNumberOfInputPorts();++y){const h=e.renderable.getInputData(y),v=h?h.getPointData().getScalars().getData():null;v&&p.push(v)}e.renderable.getInterpolate()&&l.getNumberOfComponents()===4&&(e.generateMipmap=!0,t.setMinificationFilter(ce.LINEAR_MIPMAP_LINEAR)),p.length%6===0?t.createCubeFromRaw(f[1]-f[0]+1,f[3]-f[2]+1,l.getNumberOfComponents(),l.getDataType(),p):t.create2DFromRaw(f[1]-f[0]+1,f[3]-f[2]+1,l.getNumberOfComponents(),l.getDataType(),l.getData()),t.activate(),t.sendParameters(),e.textureBuildTime.modified()}}e.handle&&t.activate()};const r=()=>{if(!((e.minificationFilter===ce.LINEAR||e.magnificationFilter===ce.LINEAR)&&!Ld()))return e.oglNorm16Ext};t.destroyTexture=()=>{t.deactivate(),e.context&&e.handle&&e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.components=0,e.width=0,e.height=0,e.depth=0,t.resetFormatAndType()},t.createTexture=()=>{e.handle||(e.handle=e.context.createTexture(),e.target&&(e.context.bindTexture(e.target,e.handle),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.bindTexture(e.target,null)))},t.getTextureUnit=()=>e._openGLRenderWindow?e._openGLRenderWindow.getTextureUnitForTexture(t):-1,t.activate=()=>{e._openGLRenderWindow.activateTexture(t),t.bind()},t.deactivate=()=>{e._openGLRenderWindow&&e._openGLRenderWindow.deactivateTexture(t)},t.releaseGraphicsResources=u=>{u&&e.handle&&(u.activateTexture(t),u.deactivateTexture(t),e.context.deleteTexture(e.handle),e.handle=0,e.numberOfDimensions=0,e.target=0,e.internalFormat=0,e.format=0,e.openGLDataType=0,e.components=0,e.width=0,e.height=0,e.depth=0,e.allocatedGPUMemoryInBytes=0),e.shaderProgram&&(e.shaderProgram.releaseGraphicsResources(u),e.shaderProgram=null)},t.bind=()=>{e.context.bindTexture(e.target,e.handle),e.autoParameters&&t.getMTime()>e.sendParametersTime.getMTime()&&t.sendParameters()},t.isBound=()=>{let u=!1;if(e.context&&e.handle){let g=0;switch(e.target){case e.context.TEXTURE_2D:g=e.context.TEXTURE_BINDING_2D;break;default:xo("impossible case");break}u=e.context.getIntegerv(g)===e.handle}return u},t.sendParameters=()=>{e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_S,t.getOpenGLWrapMode(e.wrapS)),e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_T,t.getOpenGLWrapMode(e.wrapT)),e._openGLRenderWindow.getWebgl2()&&e.context.texParameteri(e.target,e.context.TEXTURE_WRAP_R,t.getOpenGLWrapMode(e.wrapR)),e.context.texParameteri(e.target,e.context.TEXTURE_MIN_FILTER,t.getOpenGLFilterMode(e.minificationFilter)),e.context.texParameteri(e.target,e.context.TEXTURE_MAG_FILTER,t.getOpenGLFilterMode(e.magnificationFilter)),e._openGLRenderWindow.getWebgl2()&&(e.context.texParameteri(e.target,e.context.TEXTURE_BASE_LEVEL,e.baseLevel),e.context.texParameteri(e.target,e.context.TEXTURE_MAX_LEVEL,e.maxLevel)),e.sendParametersTime.modified()},t.getInternalFormat=(u,g)=>(e._forceInternalFormat||(e.internalFormat=t.getDefaultInternalFormat(u,g)),e.internalFormat||Va(`Unable to find suitable internal format for T=${u} NC= ${g}`),[e.context.R32F,e.context.RG32F,e.context.RGB32F,e.context.RGBA32F].includes(e.internalFormat)&&!e.context.getExtension("OES_texture_float_linear")&&xo("Failed to load OES_texture_float_linear. Texture filtering is not available for *32F internal formats."),e.internalFormat),t.getDefaultInternalFormat=(u,g)=>{let f=0;return f=e._openGLRenderWindow.getDefaultTextureInternalFormat(u,g,r(),t.useHalfFloat()),f||(f||(Va("Unsupported internal texture type!"),Va(`Unable to find suitable internal format for T=${u} NC= ${g}`)),f)},t.useHalfFloat=()=>e.enableUseHalfFloat&&e.canUseHalfFloat,t.setInternalFormat=u=>{e._forceInternalFormat=!0,u!==e.internalFormat&&(e.internalFormat=u,t.modified())},t.getFormat=(u,g)=>(e.format=t.getDefaultFormat(u,g),e.format),t.getDefaultFormat=(u,g)=>{if(e._openGLRenderWindow.getWebgl2())switch(g){case 1:return e.context.RED;case 2:return e.context.RG;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}else switch(g){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:return e.context.RGBA;default:return e.context.RGB}},t.resetFormatAndType=()=>{e.format=0,e.internalFormat=0,e._forceInternalFormat=!1,e.openGLDataType=0},t.getDefaultDataType=u=>{const g=t.useHalfFloat();if(e._openGLRenderWindow.getWebgl2())switch(u){case X.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case(r()&&!g&&X.SHORT):return e.context.SHORT;case(r()&&!g&&X.UNSIGNED_SHORT):return e.context.UNSIGNED_SHORT;case(g&&X.SHORT):return e.context.HALF_FLOAT;case(g&&X.UNSIGNED_SHORT):return e.context.HALF_FLOAT;case X.FLOAT:case X.VOID:default:return e.context.FLOAT}switch(u){case X.UNSIGNED_CHAR:return e.context.UNSIGNED_BYTE;case X.FLOAT:case X.VOID:default:if(e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear"))return e.context.FLOAT;{const f=e.context.getExtension("OES_texture_half_float");if(f&&e.context.getExtension("OES_texture_half_float_linear"))return f.HALF_FLOAT_OES}return e.context.UNSIGNED_BYTE}},t.getOpenGLDataType=function(u){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(!e.openGLDataType||g)&&(e.openGLDataType=t.getDefaultDataType(u)),e.openGLDataType},t.getShiftAndScale=()=>{let u=0,g=1;switch(e.openGLDataType){case e.context.BYTE:g=127.5,u=g-128;break;case e.context.UNSIGNED_BYTE:g=255,u=0;break;case e.context.SHORT:g=32767.5,u=g-32768;break;case e.context.UNSIGNED_SHORT:g=65536,u=0;break;case e.context.INT:g=21474836475e-1,u=g-2147483648;break;case e.context.UNSIGNED_INT:g=4294967295,u=0;break;case e.context.FLOAT:}return{shift:u,scale:g}},t.getOpenGLFilterMode=u=>{switch(u){case ce.NEAREST:return e.context.NEAREST;case ce.LINEAR:return e.context.LINEAR;case ce.NEAREST_MIPMAP_NEAREST:return e.context.NEAREST_MIPMAP_NEAREST;case ce.NEAREST_MIPMAP_LINEAR:return e.context.NEAREST_MIPMAP_LINEAR;case ce.LINEAR_MIPMAP_NEAREST:return e.context.LINEAR_MIPMAP_NEAREST;case ce.LINEAR_MIPMAP_LINEAR:return e.context.LINEAR_MIPMAP_LINEAR;default:return e.context.NEAREST}},t.getOpenGLWrapMode=u=>{switch(u){case Qe.CLAMP_TO_EDGE:return e.context.CLAMP_TO_EDGE;case Qe.REPEAT:return e.context.REPEAT;case Qe.MIRRORED_REPEAT:return e.context.MIRRORED_REPEAT;default:return e.context.CLAMP_TO_EDGE}},t.updateArrayDataTypeForGL=function(u,g){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const l=[];let p=e.width*e.height*e.components;if(f&&(p*=e.depth),u!==X.FLOAT&&e.openGLDataType===e.context.FLOAT)for(let h=0;h<g.length;h++)if(g[h]){const v=g[h].length>p?g[h].subarray(0,p):g[h];l.push(new Float32Array(v))}else l.push(null);if(u!==X.UNSIGNED_CHAR&&e.openGLDataType===e.context.UNSIGNED_BYTE)for(let h=0;h<g.length;h++)if(g[h]){const v=g[h].length>p?g[h].subarray(0,p):g[h];l.push(new Uint8Array(v))}else l.push(null);let y=!1;if(e._openGLRenderWindow.getWebgl2())y=e.openGLDataType===e.context.HALF_FLOAT;else{const h=e.context.getExtension("OES_texture_half_float");y=h&&e.openGLDataType===h.HALF_FLOAT_OES}if(y)for(let h=0;h<g.length;h++)if(g[h]){const v=new Uint16Array(p),x=g[h];for(let S=0;S<p;S++)v[S]=Vd(x[S]);l.push(v)}else l.push(null);if(l.length===0)for(let h=0;h<g.length;h++)l.push(g[h]);return l};function n(u){if(e._openGLRenderWindow.getWebgl2())return u;const g=[],f=e.width,l=e.height,p=e.components;if(u&&(!Wr(f)||!Wr(l))){const y=e.context.getExtension("OES_texture_half_float"),h=me(f),v=me(l),x=h*v*e.components;for(let S=0;S<u.length;S++)if(u[S]!==null){let d=null;const T=l/v,w=f/h;let C=!1;e.openGLDataType===e.context.FLOAT?d=new Float32Array(x):y&&e.openGLDataType===y.HALF_FLOAT_OES?(d=new Uint16Array(x),C=!0):d=new Uint8Array(x);for(let O=0;O<v;O++){const R=O*h*p,L=O*T;let M=Math.floor(L),D=Math.ceil(L);D>=l&&(D=l-1);const V=L-M,B=1-V;M=M*f*p,D=D*f*p;for(let _=0;_<h;_++){const k=_*p,G=_*w;let b=Math.floor(G),Y=Math.ceil(G);Y>=f&&(Y=f-1);const U=G-b;b*=p,Y*=p;for(let m=0;m<p;m++)C?d[R+k+m]=Ne.toHalf(Ne.fromHalf(u[S][M+b+m])*B*(1-U)+Ne.fromHalf(u[S][M+Y+m])*B*U+Ne.fromHalf(u[S][D+b+m])*V*(1-U)+Ne.fromHalf(u[S][D+Y+m])*V*U):d[R+k+m]=u[S][M+b+m]*B*(1-U)+u[S][M+Y+m]*B*U+u[S][D+b+m]*V*(1-U)+u[S][D+Y+m]*V*U}}g.push(d),e.width=h,e.height=v}else g.push(null)}if(g.length===0)for(let y=0;y<u.length;y++)g.push(u[y]);return g}function a(u){var g;return e._openGLRenderWindow?e.resizable||(g=e.renderable)!=null&&g.getResizable()?!1:e._openGLRenderWindow.getWebgl2()?!(e._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&r()&&(u===X.UNSIGNED_SHORT||u===X.SHORT)):!1:!1}t.create2DFromRaw=function(u,g,f,l,p){let y=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;if(t.getOpenGLDataType(l,!0),t.getInternalFormat(l,f),t.getFormat(l,f),!e.internalFormat||!e.format||!e.openGLDataType)return $t("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=f,e.width=u,e.height=g,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const h=[p],v=t.updateArrayDataTypeForGL(l,h),x=n(v);return e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,y),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),a(l)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),x[0]!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,x[0])):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,x[0]),e.generateMipmap&&e.context.generateMipmap(e.target),y&&e.context.pixelStorei(e.context.UNPACK_FLIP_Y_WEBGL,!1),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*f*e._openGLRenderWindow.getDefaultTextureByteSize(l,r(),t.useHalfFloat()),t.deactivate(),!0},t.createCubeFromRaw=(u,g,f,l,p)=>{if(t.getOpenGLDataType(l),t.getInternalFormat(l,f),t.getFormat(l,f),!e.internalFormat||!e.format||!e.openGLDataType)return $t("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_CUBE_MAP,e.components=f,e.width=u,e.height=g,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),e.maxLevel=p.length/6-1,t.createTexture(),t.bind();const y=t.updateArrayDataTypeForGL(l,p),h=n(y),v=[];let x=e.width,S=e.height;for(let d=0;d<h.length;d++){d%6===0&&d!==0&&(x/=2,S/=2),v[d]=tr(l,S*x*e.components);for(let T=0;T<S;++T){const w=T*x*e.components,C=(S-T-1)*x*e.components;v[d].set(h[d].slice(C,C+x*e.components),w)}}e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),a(l)&&e.context.texStorage2D(e.target,6,e.internalFormat,e.width,e.height);for(let d=0;d<6;d++){let T=0,w=e.width,C=e.height;for(;w>=1&&C>=1;){let O=null;T<=e.maxLevel&&(O=v[6*T+d]),a(l)?O!=null&&e.context.texSubImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+d,T,0,0,w,C,e.format,e.openGLDataType,O):e.context.texImage2D(e.context.TEXTURE_CUBE_MAP_POSITIVE_X+d,T,e.internalFormat,w,C,0,e.format,e.openGLDataType,O),T++,w/=2,C/=2}}return e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*f*e._openGLRenderWindow.getDefaultTextureByteSize(l,r(),t.useHalfFloat()),t.deactivate(),!0},t.createDepthFromRaw=(u,g,f,l)=>(t.getOpenGLDataType(f),e.format=e.context.DEPTH_COMPONENT,e._openGLRenderWindow.getWebgl2()?f===X.FLOAT?e.internalFormat=e.context.DEPTH_COMPONENT32F:e.internalFormat=e.context.DEPTH_COMPONENT16:e.internalFormat=e.context.DEPTH_COMPONENT,!e.internalFormat||!e.format||!e.openGLDataType?($t("Failed to determine texture parameters."),!1):(e.target=e.context.TEXTURE_2D,e.components=1,e.width=u,e.height=g,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),a(f)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),l!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,l)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,l),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(f,r(),t.useHalfFloat()),t.deactivate(),!0)),t.create2DFromImage=u=>{if(t.getOpenGLDataType(X.UNSIGNED_CHAR),t.getInternalFormat(X.UNSIGNED_CHAR,4),t.getFormat(X.UNSIGNED_CHAR,4),!e.internalFormat||!e.format||!e.openGLDataType)return $t("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=4,e.depth=1,e.numberOfDimensions=2,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1);const g=!e._openGLRenderWindow.getWebgl2()&&(!Wr(u.width)||!Wr(u.height)),f=document.createElement("canvas");f.width=g?me(u.width):u.width,f.height=g?me(u.height):u.height,e.width=f.width,e.height=f.height;const l=f.getContext("2d");l.translate(0,f.height),l.scale(1,-1),l.drawImage(u,0,0,u.width,u.height,0,0,f.width,f.height);const p=f;return a(X.UNSIGNED_CHAR)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),p!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,p)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,p),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(X.UNSIGNED_CHAR,r(),t.useHalfFloat()),t.deactivate(),!0};function s(u,g,f){const l=new Array(f),p=new Array(f);for(let y=0;y<f;++y)l[y]=u[y],p[y]=g[y]-u[y]||1;return{scale:p,offset:l}}function i(u,g){for(let f=0;f<u.length;f++){const l=u[f],p=g[f]+l;if(l<-2048||l>2048||p<-2048||p>2048)return!1}return!0}function o(u,g,f,l){t.getOpenGLDataType(u);const p=i(g,f)||l;let y=!1;if(e._openGLRenderWindow.getWebgl2())y=e.openGLDataType===e.context.FLOAT&&e.context.getExtension("OES_texture_float_linear")===null&&p||e.openGLDataType===e.context.HALF_FLOAT;else{const h=e.context.getExtension("OES_texture_half_float");y=h&&e.openGLDataType===h.HALF_FLOAT_OES}e.canUseHalfFloat=y&&p}function c(u,g){const f=u.getNumberOfComponents(),l=u.getDataType(),p=u.getData(),y=new Array(f),h=new Array(f);for(let x=0;x<f;++x){const[S,d]=u.getRange(x);y[x]=S,h[x]=d}const v=s(y,h,f);return o(l,v.offset,v.scale,g),t.useHalfFloat()||t.getOpenGLDataType(l,!0),{numComps:f,dataType:l,data:p,scaleOffsets:v}}t.create2DFilterableFromRaw=function(u,g,f,l,p){let y=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;return t.create2DFilterableFromDataArray(u,g,Q.newInstance({numberOfComponents:f,dataType:l,values:p}),y)},t.create2DFilterableFromDataArray=function(u,g,f){let l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const{numComps:p,dataType:y,data:h}=c(f,l);t.create2DFromRaw(u,g,p,y,h)},t.updateVolumeInfoForGL=(u,g)=>{var p,y;let f=!1;const l=t.useHalfFloat();(!((p=e.volumeInfo)!=null&&p.scale)||!((y=e.volumeInfo)!=null&&y.offset))&&(e.volumeInfo={scale:new Array(g),offset:new Array(g)});for(let h=0;h<g;++h)e.volumeInfo.scale[h]=1,e.volumeInfo.offset[h]=0;if(r()&&!l&&u===X.SHORT){for(let h=0;h<g;++h)e.volumeInfo.scale[h]=32767;f=!0}if(r()&&!l&&u===X.UNSIGNED_SHORT){for(let h=0;h<g;++h)e.volumeInfo.scale[h]=65535;f=!0}if(u===X.UNSIGNED_CHAR){for(let h=0;h<g;++h)e.volumeInfo.scale[h]=255;f=!0}return(u===X.FLOAT||l&&(u===X.SHORT||u===X.UNSIGNED_SHORT))&&(f=!0),f},t.create3DFromRaw=(u,g,f,l,p,y)=>{let h=p,v=y;if(!t.updateVolumeInfoForGL(h,l)&&v){const w=u*g*f,C=structuredClone(e.volumeInfo),O=new Float32Array(w*l);e.volumeInfo.offset=C.offset,e.volumeInfo.scale=C.scale;let R=0;const L=C.scale.map(M=>1/M);for(let M=0;M<w;M++)for(let D=0;D<l;D++)O[R]=(v[R]-C.offset[D])*L[D],R++;h=X.FLOAT,v=O}if(t.getOpenGLDataType(h),t.getInternalFormat(h,l),t.getFormat(h,l),!e.internalFormat||!e.format||!e.openGLDataType)return $t("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_3D,e.components=l,e.width=u,e.height=g,e.depth=f,e.numberOfDimensions=3,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind();const x=[v],d=t.updateArrayDataTypeForGL(h,x,!0),T=n(d);return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),a(h)?(e.context.texStorage3D(e.target,1,e.internalFormat,e.width,e.height,e.depth),T[0]!=null&&e.context.texSubImage3D(e.target,0,0,0,0,e.width,e.height,e.depth,e.format,e.openGLDataType,T[0])):e.context.texImage3D(e.target,0,e.internalFormat,e.width,e.height,e.depth,0,e.format,e.openGLDataType,T[0]),e.generateMipmap&&e.context.generateMipmap(e.target),e.allocatedGPUMemoryInBytes=e.width*e.height*e.depth*e.components*e._openGLRenderWindow.getDefaultTextureByteSize(h,r(),t.useHalfFloat()),t.deactivate(),!0},t.create3DFilterableFromRaw=function(u,g,f,l,p,y){let h=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1;return t.create3DFilterableFromDataArray(u,g,f,Q.newInstance({numberOfComponents:l,dataType:p,values:y}),h)},t.create3DFilterableFromDataArray=function(u,g,f,l){let p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{numComps:y,dataType:h,data:v,scaleOffsets:x}=c(l,p),S=[],d=[];for(let m=0;m<y;++m)S[m]=0,d[m]=1;if(e.volumeInfo={scale:d,offset:S,dataComputedScale:x.scale,dataComputedOffset:x.offset,width:u,height:g,depth:f},e._openGLRenderWindow.getWebgl2())return t.create3DFromRaw(u,g,f,y,h,v);const T=u*g*f,w=structuredClone(x);let C=(m,$,z,N,be)=>{m[$]=z},O=X.UNSIGNED_CHAR;if(h===X.UNSIGNED_CHAR)for(let m=0;m<y;++m)w.offset[m]=0,w.scale[m]=255;else e.context.getExtension("OES_texture_float")&&e.context.getExtension("OES_texture_float_linear")?(O=X.FLOAT,C=(m,$,z,N,be)=>{m[$]=(z-N)/be}):(O=X.UNSIGNED_CHAR,C=(m,$,z,N,be)=>{m[$]=255*(z-N)/be});if(t.getOpenGLDataType(O),t.getInternalFormat(O,y),t.getFormat(O,y),!e.internalFormat||!e.format||!e.openGLDataType)return $t("Failed to determine texture parameters."),!1;e.target=e.context.TEXTURE_2D,e.components=y,e.depth=1,e.numberOfDimensions=2;let R=e.context.getParameter(e.context.MAX_TEXTURE_SIZE);R>4096&&(O===X.FLOAT||y>=3)&&(R=4096);let L=1,M=1;T>R*R&&(L=Math.ceil(Math.sqrt(T/(R*R))),M=L);let D=Math.sqrt(T)/L;D=me(D);const V=Math.floor(D*L/u),B=Math.ceil(f/V),_=me(g*B/M);e.width=D,e.height=_,e._openGLRenderWindow.activateTexture(t),t.createTexture(),t.bind(),e.volumeInfo.xreps=V,e.volumeInfo.yreps=B,e.volumeInfo.xstride=L,e.volumeInfo.ystride=M,e.volumeInfo.offset=w.offset,e.volumeInfo.scale=w.scale;let k;const G=D*_*y;O===X.FLOAT?k=new Float32Array(G):k=new Uint8Array(G);let b=0;const Y=Math.floor(u/L),U=Math.floor(g/M);for(let m=0;m<B;m++){const $=Math.min(V,f-m*V),z=y*(e.width-$*Math.floor(u/L));for(let N=0;N<U;N++){for(let be=0;be<$;be++){const Qn=y*((m*V+be)*u*g+M*N*u);for(let Fr=0;Fr<Y;Fr++)for(let _e=0;_e<y;_e++)C(k,b,v[Qn+L*Fr*y+_e],w.offset[_e],w.scale[_e]),b++}b+=z}}return e.context.pixelStorei(e.context.UNPACK_ALIGNMENT,1),a(O)?(e.context.texStorage2D(e.target,1,e.internalFormat,e.width,e.height),k!=null&&e.context.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.openGLDataType,k)):e.context.texImage2D(e.target,0,e.internalFormat,e.width,e.height,0,e.format,e.openGLDataType,k),t.deactivate(),!0},t.setOpenGLRenderWindow=u=>{e._openGLRenderWindow!==u&&(t.releaseGraphicsResources(),e._openGLRenderWindow=u,e.context=null,u&&(e.context=e._openGLRenderWindow.getContext()))},t.getMaximumTextureSize=u=>u&&u.isCurrent()?u.getIntegerv(u.MAX_TEXTURE_SIZE):-1,t.enableUseHalfFloat=u=>{e.enableUseHalfFloat=u}}const Bd={_openGLRenderWindow:null,_forceInternalFormat:!1,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:Qe.CLAMP_TO_EDGE,wrapT:Qe.CLAMP_TO_EDGE,wrapR:Qe.CLAMP_TO_EDGE,minificationFilter:ce.NEAREST,magnificationFilter:ce.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0,enableUseHalfFloat:!0,canUseHalfFloat:!1};function Gu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Bd,r),ae.extend(t,e,r),e.sendParametersTime={},ve(e.sendParametersTime,{mtime:0}),e.textureBuildTime={},ve(e.textureBuildTime,{mtime:0}),Dr(t,e,["format","openGLDataType"]),ue(t,e,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),Ee(t,e,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),Lr(t,e,["openGLRenderWindow"]),_d(t,e)}const bu=Z(Gu,"vtkOpenGLTexture");var mt={newInstance:bu,extend:Gu,...ku};Ve("vtkTexture",bu);var Fd=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

attribute vec4 vertexMC;

// frag position in VC
//VTK::PositionVC::Dec

// optional normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// Texture coordinates
//VTK::TCoord::Dec

// material property values
//VTK::Color::Dec

// clipping plane vars
//VTK::Clip::Dec

// camera and actor matrix values
//VTK::Camera::Dec

// Apple Bug
//VTK::PrimID::Dec

// picking support
//VTK::Picking::Dec

void main()
{
  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Clip::Impl

  //VTK::PrimID::Impl

  //VTK::PositionVC::Impl

  //VTK::Light::Impl

  //VTK::Picking::Impl
}
`,Ud=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyDataFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/
// Template for the polydata mappers fragment shader

uniform int PrimitiveIDOffset;

// VC position of this fragment
//VTK::PositionVC::Dec

// optional color passed in from the vertex shader, vertexColor
//VTK::Color::Dec

// optional surface normal declaration
//VTK::Normal::Dec

// extra lighting parameters
//VTK::Light::Dec

// define vtkImageLabelOutlineOn
//VTK::ImageLabelOutlineOn

// Texture coordinates
//VTK::TCoord::Dec

// picking support
//VTK::Picking::Dec

// Depth Peeling Support
//VTK::DepthPeeling::Dec

// clipping plane vars
//VTK::Clip::Dec

// label outline 
//VTK::LabelOutline::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

// handle coincident offsets
//VTK::Coincident::Dec

//VTK::ZBuffer::Dec

//VTK::LabelOutlineHelperFunction

void main()
{
  // VC position of this fragment. This should not branch/return/discard.
  //VTK::PositionVC::Impl

  // Place any calls that require uniform flow (e.g. dFdx) here.
  //VTK::UniformFlow::Impl

  // Set gl_FragDepth here (gl_FragCoord.z by default)
  //VTK::Depth::Impl

  // Early depth peeling abort:
  //VTK::DepthPeeling::PreColor

  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Clip::Impl

  //VTK::Color::Impl

  // Generate the normal if we are not passed in one
  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Light::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }

  //VTK::DepthPeeling::Impl

  //VTK::Picking::Impl

  // handle coincident offsets
  //VTK::Coincident::Impl

  //VTK::ZBuffer::Impl

  //VTK::RenderPassFragmentShader::Impl
}
`;function md(t,e){t.replaceShaderCoincidentOffset=(r,n,a)=>{const s=t.getCoincidentParameters(n,a);if(s&&(s.factor!==0||s.offset!==0)){let i=r.Fragment;i=F.substitute(i,"//VTK::Coincident::Dec",["uniform float cfactor;","uniform float coffset;"]).result,e.context.getExtension("EXT_frag_depth")&&(s.factor!==0?(i=F.substitute(i,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,i=F.substitute(i,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):i=F.substitute(i,"//VTK::Depth::Impl","gl_FragDepthEXT = gl_FragCoord.z + 0.000016*coffset;").result),e._openGLRenderWindow.getWebgl2()&&(s.factor!==0?(i=F.substitute(i,"//VTK::UniformFlow::Impl",["float cscale = length(vec2(dFdx(gl_FragCoord.z),dFdy(gl_FragCoord.z)));","//VTK::UniformFlow::Impl"],!1).result,i=F.substitute(i,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + cfactor*cscale + 0.000016*coffset;").result):i=F.substitute(i,"//VTK::Depth::Impl","gl_FragDepth = gl_FragCoord.z + 0.000016*coffset;").result),r.Fragment=i}}}function kd(t,e){t.applyShaderReplacements=(r,n,a)=>{let s=null;if(n&&(s=n.ShaderReplacements),s)for(let i=0;i<s.length;i++){const o=s[i];if(a&&o.replaceFirst||!a&&!o.replaceFirst){const c=o.shaderType,u=r[c],g=F.substitute(u,o.originalValue,o.replacementValue,o.replaceAll);r[c]=g.result}}},t.buildShaders=(r,n,a)=>{t.getReplacedShaderTemplate(r,n,a),e.lastRenderPassShaderReplacement=e.currentRenderPass?e.currentRenderPass.getShaderReplacement():null,e.lastRenderPassShaderReplacement&&e.lastRenderPassShaderReplacement(r);const s=e.renderable.getViewSpecificProperties().OpenGL;t.applyShaderReplacements(r,s,!0),t.replaceShaderValues(r,n,a),t.applyShaderReplacements(r,s)},t.getReplacedShaderTemplate=(r,n,a)=>{const s=e.renderable.getViewSpecificProperties().OpenGL;t.getShaderTemplate(r,n,a);let i=r.Vertex;if(s){const u=s.VertexShaderCode;u!==void 0&&u!==""&&(i=u)}r.Vertex=i;let o=r.Fragment;if(s){const u=s.FragmentShaderCode;u!==void 0&&u!==""&&(o=u)}r.Fragment=o;let c=r.Geometry;if(s){const u=s.GeometryShaderCode;u!==void 0&&(c=u)}r.Geometry=c}}var $n={implementReplaceShaderCoincidentOffset:md,implementBuildShadersWithReplacements:kd};const{FieldAssociations:_a}=bt,{primTypes:fe}=ar,{Representation:Wt,Shading:So}=nr,{ScalarMode:Yr}=rt,{Filter:Co,Wrap:wo}=mt,{vtkErrorMacro:Ot}=Pe,Nd={type:"StartEvent"},Gd={type:"EndEvent"},{CoordinateSystem:bd}=_r;function $d(t){const e=t.getSelector();return e?e.getCurrentPass():we.MIN_KNOWN_PASS-1}function Wd(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper"),t.buildPass=n=>{n&&(e.currentRenderPass=null,e.openGLActor=t.getFirstAncestorOfType("vtkOpenGLActor"),e._openGLRenderer=e.openGLActor.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.translucentPass=(n,a)=>{n&&(e.currentRenderPass=a,t.render())},t.zBufferPass=n=>{n&&(e.haveSeenDepthRequest=!0,e.renderDepth=!0,t.render(),e.renderDepth=!1)},t.opaqueZBufferPass=n=>t.zBufferPass(n),t.opaquePass=n=>{n&&t.render()},t.render=()=>{const n=e._openGLRenderWindow.getContext();if(e.context!==n){e.context=n;for(let i=fe.Start;i<fe.End;i++)e.primitives[i].setOpenGLRenderWindow(e._openGLRenderWindow)}const a=e.openGLActor.getRenderable(),s=e._openGLRenderer.getRenderable();t.renderPiece(s,a)},t.getShaderTemplate=(n,a,s)=>{n.Vertex=Fd,n.Fragment=Ud,n.Geometry=""},t.replaceShaderColor=(n,a,s)=>{let i=n.Vertex,o=n.Geometry,c=n.Fragment;const u=e.lastBoundBO.getReferenceByName("lastLightComplexity");let g=["uniform float ambient;","uniform float diffuse;","uniform float specular;","uniform float opacityUniform; // the fragment opacity","uniform vec3 ambientColorUniform;","uniform vec3 diffuseColorUniform;"];u&&(g=g.concat(["uniform vec3 specularColorUniform;","uniform float specularPowerUniform;"]));let f=["vec3 ambientColor;","  vec3 diffuseColor;","  float opacity;"];u&&(f=f.concat(["  vec3 specularColor;","  float specularPower;"])),f=f.concat(["  ambientColor = ambientColorUniform;","  diffuseColor = diffuseColorUniform;","  opacity = opacityUniform;"]),u&&(f=f.concat(["  specularColor = specularColorUniform;","  specularPower = specularPowerUniform;"])),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges&&(g=g.concat(["varying vec4 vertexColorVSOutput;"]),i=F.substitute(i,"//VTK::Color::Dec",["attribute vec4 scalarColor;","varying vec4 vertexColorVSOutput;"]).result,i=F.substitute(i,"//VTK::Color::Impl",["vertexColorVSOutput =  scalarColor;"]).result,o=F.substitute(o,"//VTK::Color::Dec",["in vec4 vertexColorVSOutput[];","out vec4 vertexColorGSOutput;"]).result,o=F.substitute(o,"//VTK::Color::Impl",["vertexColorGSOutput = vertexColorVSOutput[i];"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0&&!e.drawingEdges?c=F.substitute(c,"//VTK::Color::Impl",f.concat(["  diffuseColor = vertexColorVSOutput.rgb;","  ambientColor = vertexColorVSOutput.rgb;","  opacity = opacity*vertexColorVSOutput.a;"])).result:(e.renderable.getAreScalarsMappedFromCells()||e.renderable.getInterpolateScalarsBeforeMapping())&&e.renderable.getColorCoordinates()&&!e.drawingEdges?c=F.substitute(c,"//VTK::Color::Impl",f.concat(["  vec4 texColor = texture2D(texture1, tcoordVCVSOutput.st);","  diffuseColor = texColor.rgb;","  ambientColor = texColor.rgb;","  opacity = opacity*texColor.a;"])).result:(s.getBackfaceProperty()&&!e.drawingEdges&&(g=g.concat(["uniform float opacityUniformBF; // the fragment opacity","uniform float ambientIntensityBF; // the material ambient","uniform float diffuseIntensityBF; // the material diffuse","uniform vec3 ambientColorUniformBF; // ambient material color","uniform vec3 diffuseColorUniformBF; // diffuse material color"]),u?(g=g.concat(["uniform float specularIntensityBF; // the material specular intensity","uniform vec3 specularColorUniformBF; // intensity weighted color","uniform float specularPowerUniformBF;"]),f=f.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  specularColor = specularIntensityBF * specularColorUniformBF;","  specularPower = specularPowerUniformBF;","  opacity = opacityUniformBF; }"])):f=f.concat(["if (gl_FrontFacing == false) {","  ambientColor = ambientIntensityBF * ambientColorUniformBF;","  diffuseColor = diffuseIntensityBF * diffuseColorUniformBF;","  opacity = opacityUniformBF; }"])),e.haveCellScalars&&!e.drawingEdges&&(g=g.concat(["uniform samplerBuffer texture1;"])),c=F.substitute(c,"//VTK::Color::Impl",f).result),c=F.substitute(c,"//VTK::Color::Dec",g).result,n.Vertex=i,n.Geometry=o,n.Fragment=c},t.replaceShaderLight=(n,a,s)=>{let i=n.Fragment;const o="",c=e.lastBoundBO.getReferenceByName("lastLightComplexity"),u=e.lastBoundBO.getReferenceByName("lastLightCount");let g=[];switch(c){case 0:i=F.substitute(i,"//VTK::Light::Impl",["  gl_FragData[0] = vec4(ambientColor * ambient + diffuseColor * diffuse, opacity);","  //VTK::Light::Impl"],!1).result;break;case 1:i=F.substitute(i,"//VTK::Light::Impl",["  float df = max(0.0, normalVCVSOutput.z);","  float sf = pow(df, specularPower);","  vec3 diffuseL = df * diffuseColor;","  vec3 specularL = sf * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"],!1).result;break;case 2:for(let f=0;f<u;++f)g=g.concat([`uniform vec3 lightColor${f};`,`uniform vec3 lightDirectionVC${f}; // normalized`,`uniform vec3 lightHalfAngleVC${f}; // normalized`]);i=F.substitute(i,"//VTK::Light::Dec",g).result,g=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  float df;"];for(let f=0;f<u;++f)g=g.concat([`  df = max(0.0, dot(normalVCVSOutput, -lightDirectionVC${f}));`,`  diffuseL += ((df${o}) * lightColor${f});`,`  if (dot(normalVCVSOutput, lightDirectionVC${f}) < 0.0)`,"    {",`    float sf = sign(df)*pow(max(1e-5,
                                              dot(reflect(lightDirectionVC${f},normalVCVSOutput),
                                                  normalize(-vertexVC.xyz))),
                                         specularPower);`,`    specularL += (sf${o} * lightColor${f});`,"    }"]);g=g.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),i=F.substitute(i,"//VTK::Light::Impl",g,!1).result;break;case 3:for(let f=0;f<u;++f)g=g.concat([`uniform vec3 lightColor${f};`,`uniform vec3 lightDirectionVC${f}; // normalized`,`uniform vec3 lightHalfAngleVC${f}; // normalized`,`uniform vec3 lightPositionVC${f};`,`uniform vec3 lightAttenuation${f};`,`uniform float lightConeAngle${f};`,`uniform float lightExponent${f};`,`uniform int lightPositional${f};`]);i=F.substitute(i,"//VTK::Light::Dec",g).result,g=["vec3 diffuseL = vec3(0,0,0);","  vec3 specularL = vec3(0,0,0);","  vec3 vertLightDirectionVC;","  float attenuation;","  float df;"];for(let f=0;f<u;++f)g=g.concat(["  attenuation = 1.0;",`  if (lightPositional${f} == 0)`,"    {",`      vertLightDirectionVC = lightDirectionVC${f};`,"    }","  else","    {",`    vertLightDirectionVC = vertexVC.xyz - lightPositionVC${f};`,"    float distanceVC = length(vertLightDirectionVC);","    vertLightDirectionVC = normalize(vertLightDirectionVC);","    attenuation = 1.0 /",`      (lightAttenuation${f}.x`,`       + lightAttenuation${f}.y * distanceVC`,`       + lightAttenuation${f}.z * distanceVC * distanceVC);`,"    // per OpenGL standard cone angle is 90 or less for a spot light",`    if (lightConeAngle${f} <= 90.0)`,"      {",`      float coneDot = dot(vertLightDirectionVC, lightDirectionVC${f});`,"      // if inside the cone",`      if (coneDot >= cos(radians(lightConeAngle${f})))`,"        {",`        attenuation = attenuation * pow(coneDot, lightExponent${f});`,"        }","      else","        {","        attenuation = 0.0;","        }","      }","    }","    df = max(0.0, attenuation*dot(normalVCVSOutput, -vertLightDirectionVC));",`    diffuseL += ((df${o}) * lightColor${f});`,"    if (dot(normalVCVSOutput, vertLightDirectionVC) < 0.0)","      {",`      float sf = sign(df)*attenuation*pow(max(1e-5,
                                                           dot(reflect(lightDirectionVC${f},
                                                                       normalVCVSOutput),
                                                               normalize(-vertexVC.xyz))),
                                                       specularPower);`,`    specularL += ((sf${o}) * lightColor${f});`,"    }"]);g=g.concat(["  diffuseL = diffuseL * diffuseColor;","  specularL = specularL * specularColor;","  gl_FragData[0] = vec4(ambientColor * ambient + diffuseL * diffuse + specularL * specular, opacity);","  //VTK::Light::Impl"]),i=F.substitute(i,"//VTK::Light::Impl",g,!1).result;break;default:Ot("bad light complexity")}n.Fragment=i},t.replaceShaderNormal=(n,a,s)=>{if(e.lastBoundBO.getReferenceByName("lastLightComplexity")>0){let o=n.Vertex,c=n.Geometry,u=n.Fragment;e.lastBoundBO.getCABO().getNormalOffset()?(o=F.substitute(o,"//VTK::Normal::Dec",["attribute vec3 normalMC;","uniform mat3 normalMatrix;","varying vec3 normalVCVSOutput;"]).result,o=F.substitute(o,"//VTK::Normal::Impl",["normalVCVSOutput = normalMatrix * normalMC;"]).result,c=F.substitute(c,"//VTK::Normal::Dec",["in vec3 normalVCVSOutput[];","out vec3 normalVCGSOutput;"]).result,c=F.substitute(c,"//VTK::Normal::Impl",["normalVCGSOutput = normalVCVSOutput[i];"]).result,u=F.substitute(u,"//VTK::Normal::Dec",["varying vec3 normalVCVSOutput;"]).result,u=F.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalVCVSOutput);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.haveCellNormals?(u=F.substitute(u,"//VTK::Normal::Dec",["uniform mat3 normalMatrix;","uniform samplerBuffer textureN;"]).result,u=F.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput = normalize(normalMatrix *","    texelFetchBuffer(textureN, gl_PrimitiveID + PrimitiveIDOffset).xyz);","  if (gl_FrontFacing == false) { normalVCVSOutput = -normalVCVSOutput; }"]).result):e.lastBoundBO.getOpenGLMode(s.getProperty().getRepresentation())===e.context.LINES?(u=F.substitute(u,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,u=F.substitute(u,"//VTK::Normal::Impl",["vec3 normalVCVSOutput;","  if (abs(fdx.x) > 0.0)","    { fdx = normalize(fdx); normalVCVSOutput = normalize(cross(vec3(fdx.y, -fdx.x, 0.0), fdx)); }","  else { fdy = normalize(fdy); normalVCVSOutput = normalize(cross(vec3(fdy.y, -fdy.x, 0.0), fdy));}"]).result):(u=F.substitute(u,"//VTK::Normal::Dec",["uniform int cameraParallel;"]).result,u=F.substitute(u,"//VTK::UniformFlow::Impl",["  vec3 fdx = dFdx(vertexVC.xyz);","  vec3 fdy = dFdy(vertexVC.xyz);","  //VTK::UniformFlow::Impl"]).result,u=F.substitute(u,"//VTK::Normal::Impl",["  fdx = normalize(fdx);","  fdy = normalize(fdy);","  vec3 normalVCVSOutput = normalize(cross(fdx,fdy));","  if (cameraParallel == 1 && normalVCVSOutput.z < 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }","  if (cameraParallel == 0 && dot(normalVCVSOutput,vertexVC.xyz) > 0.0) { normalVCVSOutput = -1.0*normalVCVSOutput; }"]).result),n.Vertex=o,n.Geometry=c,n.Fragment=u}},t.replaceShaderPositionVC=(n,a,s)=>{e.lastBoundBO.replaceShaderPositionVC(n,a,s);let i=n.Vertex,o=n.Geometry,c=n.Fragment;e.lastBoundBO.getReferenceByName("lastLightComplexity")>0?(i=F.substitute(i,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,i=F.substitute(i,"//VTK::PositionVC::Impl",["vertexVCVSOutput = MCVCMatrix * vertexMC;","  gl_Position = MCPCMatrix * vertexMC;"]).result,i=F.substitute(i,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;","uniform mat4 MCVCMatrix;"]).result,o=F.substitute(o,"//VTK::PositionVC::Dec",["in vec4 vertexVCVSOutput[];","out vec4 vertexVCGSOutput;"]).result,o=F.substitute(o,"//VTK::PositionVC::Impl",["vertexVCGSOutput = vertexVCVSOutput[i];"]).result,c=F.substitute(c,"//VTK::PositionVC::Dec",["varying vec4 vertexVCVSOutput;"]).result,c=F.substitute(c,"//VTK::PositionVC::Impl",["vec4 vertexVC = vertexVCVSOutput;"]).result):(i=F.substitute(i,"//VTK::Camera::Dec",["uniform mat4 MCPCMatrix;"]).result,i=F.substitute(i,"//VTK::PositionVC::Impl",["  gl_Position = MCPCMatrix * vertexMC;"]).result),n.Vertex=i,n.Geometry=o,n.Fragment=c},t.replaceShaderTCoord=(n,a,s)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let i=n.Vertex,o=n.Geometry,c=n.Fragment;if(e.drawingEdges)return;i=F.substitute(i,"//VTK::TCoord::Impl","tcoordVCVSOutput = tcoordMC;").result;const u=e.openGLActor.getActiveTextures();let g=2,f=2;if(u&&u.length>0&&(g=u[0].getComponents(),u[0].getTarget()===e.context.TEXTURE_CUBE_MAP&&(f=3)),e.renderable.getColorTextureMap()&&(g=e.renderable.getColorTextureMap().getPointData().getScalars().getNumberOfComponents(),f=2),f===2){if(i=F.substitute(i,"//VTK::TCoord::Dec","attribute vec2 tcoordMC; varying vec2 tcoordVCVSOutput;").result,o=F.substitute(o,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput[];","out vec2 tcoordVCGSOutput;"]).result,o=F.substitute(o,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=F.substitute(c,"//VTK::TCoord::Dec",["varying vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,u&&u.length>=1)switch(g){case 1:c=F.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=F.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=F.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = texture2D(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}}else switch(i=F.substitute(i,"//VTK::TCoord::Dec","attribute vec3 tcoordMC; varying vec3 tcoordVCVSOutput;").result,o=F.substitute(o,"//VTK::TCoord::Dec",["in vec3 tcoordVCVSOutput[];","out vec3 tcoordVCGSOutput;"]).result,o=F.substitute(o,"//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];").result,c=F.substitute(c,"//VTK::TCoord::Dec",["varying vec3 tcoordVCVSOutput;","uniform samplerCube texture1;"]).result,g){case 1:c=F.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;"]).result;break;case 2:c=F.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.r;","  diffuseColor = diffuseColor*tcolor.r;","  opacity = opacity * tcolor.g;"]).result;break;default:c=F.substitute(c,"//VTK::TCoord::Impl",["  vec4 tcolor = textureCube(texture1, tcoordVCVSOutput);","  ambientColor = ambientColor*tcolor.rgb;","  diffuseColor = diffuseColor*tcolor.rgb;","  opacity = opacity * tcolor.a;"]).result}n.Vertex=i,n.Geometry=o,n.Fragment=c}},t.replaceShaderClip=(n,a,s)=>{let i=n.Vertex,o=n.Fragment;if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes();i=F.substitute(i,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`uniform vec4 clipPlanes[${c}];`,`varying float clipDistancesVSOutput[${c}];`]).result,i=F.substitute(i,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    clipDistancesVSOutput[planeNum] = dot(clipPlanes[planeNum], vertexMC);","    }"]).result,o=F.substitute(o,"//VTK::Clip::Dec",["uniform int numClipPlanes;",`varying float clipDistancesVSOutput[${c}];`]).result,o=F.substitute(o,"//VTK::Clip::Impl",[`for (int planeNum = 0; planeNum < ${c}; planeNum++)`,"    {","    if (planeNum >= numClipPlanes)","        {","        break;","        }","    if (clipDistancesVSOutput[planeNum] < 0.0) discard;","    }"]).result}n.Vertex=i,n.Fragment=o},t.getCoincidentParameters=(n,a)=>{let s={factor:0,offset:0};const i=a.getProperty();if(e.renderable.getResolveCoincidentTopology()==Tt.PolygonOffset||i.getEdgeVisibility()&&i.getRepresentation()===Wt.SURFACE){const c=e.lastBoundBO.getPrimitiveType();c===fe.Points||i.getRepresentation()===Wt.POINTS?s=e.renderable.getCoincidentTopologyPointOffsetParameter():c===fe.Lines||i.getRepresentation()===Wt.WIREFRAME?s=e.renderable.getCoincidentTopologyLineOffsetParameters():(c===fe.Tris||c===fe.TriStrips)&&(s=e.renderable.getCoincidentTopologyPolygonOffsetParameters()),(c===fe.TrisEdges||c===fe.TriStripsEdges)&&(s=e.renderable.getCoincidentTopologyPolygonOffsetParameters(),s.factor/=2,s.offset/=2)}const o=e._openGLRenderer.getSelector();return o&&o.getFieldAssociation()===_a.FIELD_ASSOCIATION_POINTS&&(s.offset-=2),s},t.replaceShaderPicking=(n,a,s)=>{let i=n.Fragment,o=n.Vertex;if(i=F.substitute(i,"//VTK::Picking::Dec",["uniform int picking;","//VTK::Picking::Dec"]).result,!!e._openGLRenderer.getSelector()){switch((e.lastSelectionState===we.ID_LOW24||e.lastSelectionState===we.ID_HIGH24)&&(o=F.substitute(o,"//VTK::Picking::Dec",[`flat out int vertexIDVSOutput;
`,`uniform int VertexIDOffset;
`]).result,o=F.substitute(o,"//VTK::Picking::Impl",`  vertexIDVSOutput = gl_VertexID + VertexIDOffset;
`).result,i=F.substitute(i,"//VTK::Picking::Dec",`flat in int vertexIDVSOutput;
`).result,i=F.substitute(i,"//VTK::Picking::Impl",["  int idx = vertexIDVSOutput;","//VTK::Picking::Impl"]).result),e.lastSelectionState){case we.ID_LOW24:i=F.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float(idx%256)/255.0, float((idx/256)%256)/255.0, float((idx/65536)%256)/255.0, 1.0);").result;break;case we.ID_HIGH24:i=F.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = vec4(float((idx/16777216)%256)/255.0, 0.0, 0.0, 1.0);").result;break;default:i=F.substitute(i,"//VTK::Picking::Dec","uniform vec3 mapperIndex;").result,i=F.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result}n.Fragment=i,n.Vertex=o}},t.replaceShaderValues=(n,a,s)=>{if(t.replaceShaderColor(n,a,s),t.replaceShaderNormal(n,a,s),t.replaceShaderLight(n,a,s),t.replaceShaderTCoord(n,a,s),t.replaceShaderPicking(n,a,s),t.replaceShaderClip(n,a,s),t.replaceShaderCoincidentOffset(n,a,s),t.replaceShaderPositionVC(n,a,s),e.haveSeenDepthRequest){let i=n.Fragment;i=F.substitute(i,"//VTK::ZBuffer::Dec","uniform int depthRequest;").result,i=F.substitute(i,"//VTK::ZBuffer::Impl",["if (depthRequest == 1) {","float iz = floor(gl_FragCoord.z*65535.0 + 0.1);","float rf = floor(iz/256.0)/255.0;","float gf = mod(iz,256.0)/255.0;","gl_FragData[0] = vec4(rf, gf, 0.0, 1.0); }"]).result,n.Fragment=i}},t.getNeedToRebuildShaders=(n,a,s)=>{let i=0,o=0;const c=n.getPrimitiveType(),u=e.currentInput;let g=!1;const f=u.getPointData().getNormals(),l=u.getCellData().getNormals(),p=s.getProperty().getInterpolation()===So.FLAT,y=s.getProperty().getRepresentation(),h=n.getOpenGLMode(y,c);if((h===e.context.TRIANGLES||l&&!f||!p&&f||!p&&h===e.context.LINES)&&(g=!0),s.getProperty().getLighting()&&g){i=0;const d=a.getLightsByReference();for(let T=0;T<d.length;++T){const w=d[T];w.getSwitch()>0&&(o++,i===0&&(i=1)),i===1&&(o>1||w.getIntensity()!==1||!w.lightTypeIsHeadLight())&&(i=2),i<3&&w.getPositional()&&(i=3)}}let v=!1;const x=e.lastBoundBO.getReferenceByName("lastLightComplexity"),S=e.lastBoundBO.getReferenceByName("lastLightCount");return(x!==i||S!==o)&&(e.lastBoundBO.set({lastLightComplexity:i},!0),e.lastBoundBO.set({lastLightCount:o},!0),v=!0),(!e.currentRenderPass&&e.lastRenderPassShaderReplacement||e.currentRenderPass&&e.currentRenderPass.getShaderReplacement()!==e.lastRenderPassShaderReplacement)&&(v=!0),e.lastHaveSeenDepthRequest!==e.haveSeenDepthRequest||n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime()||n.getShaderSourceTime().getMTime()<e.selectionStateChanged.getMTime()||v?(e.lastHaveSeenDepthRequest=e.haveSeenDepthRequest,!0):!1},t.invokeShaderCallbacks=(n,a,s)=>{const i=e.renderable.getViewSpecificProperties().ShadersCallbacks;i&&i.forEach(o=>{o.callback(o.userData,n,a,s)})},t.setMapperShaderParameters=(n,a,s)=>{if(n.getProgram().isUniformUsed("PrimitiveIDOffset")&&n.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),n.getProgram().isUniformUsed("VertexIDOffset")&&n.getProgram().setUniformi("VertexIDOffset",e.vertexIDOffset),n.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){const c=e.lastBoundBO.getReferenceByName("lastLightComplexity");n.getProgram().isAttributeUsed("vertexMC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexMC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||Ot("Error setting vertexMC in shader VAO.")),n.getProgram().isAttributeUsed("normalMC")&&n.getCABO().getNormalOffset()&&c>0?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"normalMC",n.getCABO().getNormalOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||Ot("Error setting normalMC in shader VAO."):n.getVAO().removeAttributeArray("normalMC"),e.renderable.getCustomShaderAttributes().forEach((u,g)=>{n.getProgram().isAttributeUsed(`${u}MC`)&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),`${u}MC`,n.getCABO().getCustomData()[g].offset,n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getCustomData()[g].components,!1)||Ot(`Error setting ${u}MC in shader VAO.`))}),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),!1)||Ot("Error setting tcoordMC in shader VAO."):n.getVAO().removeAttributeArray("tcoordMC"),n.getProgram().isAttributeUsed("scalarColor")&&n.getCABO().getColorComponents()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO().getColorBO(),"scalarColor",n.getCABO().getColorOffset(),n.getCABO().getColorBOStride(),e.context.UNSIGNED_BYTE,4,!0)||Ot("Error setting scalarColor in shader VAO."):n.getVAO().removeAttributeArray("scalarColor"),n.getAttributeUpdateTime().modified()}if(e.renderable.getNumberOfClippingPlanes()){const c=e.renderable.getNumberOfClippingPlanes(),u=[],f=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,l=f?ye(e.tmpMat4,s.getMatrix()):s.getMatrix();f&&(te(l,l),de(l,l,f),te(l,l));for(let p=0;p<c;p++){const y=[];e.renderable.getClippingPlaneInDataCoords(l,p,y);for(let h=0;h<4;h++)u.push(y[h])}n.getProgram().setUniformi("numClipPlanes",c),n.getProgram().setUniform4fv("clipPlanes",u)}e.internalColorTexture&&n.getProgram().isUniformUsed("texture1")&&n.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const i=e.openGLActor.getActiveTextures();if(i)for(let c=0;c<i.length;++c){const g=i[c].getTextureUnit(),f=`texture${g+1}`;n.getProgram().isUniformUsed(f)&&n.getProgram().setUniformi(f,g)}if(e.haveSeenDepthRequest&&n.getProgram().setUniformi("depthRequest",e.renderDepth?1:0),n.getProgram().isUniformUsed("coffset")){const c=t.getCoincidentParameters(a,s);n.getProgram().setUniformf("coffset",c.offset),n.getProgram().isUniformUsed("cfactor")&&n.getProgram().setUniformf("cfactor",c.factor)}n.setMapperShaderParameters(a,s,e._openGLRenderer.getTiledSizeAndOrigin());const o=e._openGLRenderer.getSelector();n.getProgram().setUniform3fArray("mapperIndex",o?o.getPropColorValue():[0,0,0]),n.getProgram().setUniformi("picking",o?o.getCurrentPass()+1:0)},t.setLightingShaderParameters=(n,a,s)=>{const i=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(i<2)return;const o=n.getProgram();let c=0;const u=a.getLightsByReference();for(let l=0;l<u.length;++l){const p=u[l];if(p.getSwitch()>0){const h=p.getColorByReference(),v=p.getIntensity();e.lightColor[0]=h[0]*v,e.lightColor[1]=h[1]*v,e.lightColor[2]=h[2]*v;const x=p.getDirection(),S=a.getActiveCamera().getViewMatrix(),d=[...x];p.lightTypeIsSceneLight()&&(d[0]=S[0]*x[0]+S[1]*x[1]+S[2]*x[2],d[1]=S[4]*x[0]+S[5]*x[1]+S[6]*x[2],d[2]=S[8]*x[0]+S[9]*x[1]+S[10]*x[2],Rr(d)),e.lightDirection[0]=d[0],e.lightDirection[1]=d[1],e.lightDirection[2]=d[2],Rr(e.lightDirection),o.setUniform3fArray(`lightColor${c}`,e.lightColor),o.setUniform3fArray(`lightDirectionVC${c}`,e.lightDirection),c++}}if(i<3)return;const f=a.getActiveCamera().getViewMatrix();te(f,f),c=0;for(let l=0;l<u.length;++l){const p=u[l];if(p.getSwitch()>0){const h=p.getTransformedPosition(),v=new Float64Array(3);I(v,h,f),o.setUniform3fArray(`lightAttenuation${c}`,p.getAttenuationValuesByReference()),o.setUniformi(`lightPositional${c}`,p.getPositional()),o.setUniformf(`lightExponent${c}`,p.getExponent()),o.setUniformf(`lightConeAngle${c}`,p.getConeAngle()),o.setUniform3fArray(`lightPositionVC${c}`,[v[0],v[1],v[2]]),c++}}};function r(n,a,s){return a.identity(s),n.reduce((i,o,c)=>c===0?o?a.copy(i,o):a.identity(i):o?a.multiply(i,i,o):i,s)}t.setCameraShaderParameters=(n,a,s)=>{const i=n.getProgram(),o=e.openGLCamera.getKeyMatrices(a),c=a.getActiveCamera(),u=e.openGLCamera.getKeyMatrixTime().getMTime(),g=i.getLastCameraMTime(),l=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,p=s.getIsIdentity(),y=p?{mcwc:null,normalMatrix:null}:e.openGLActor.getKeyMatrices();if(s.getCoordinateSystem()===bd.DISPLAY){const h=e._openGLRenderer.getTiledSizeAndOrigin();j(e.tmpMat4),e.tmpMat4[0]=2/h.usize,e.tmpMat4[12]=-1,e.tmpMat4[5]=2/h.vsize,e.tmpMat4[13]=-1,de(e.tmpMat4,e.tmpMat4,l),i.setUniformMatrix("MCPCMatrix",e.tmpMat4)}else i.setUniformMatrix("MCPCMatrix",r([o.wcpc,y.mcwc,l],Pa,e.tmpMat4));i.isUniformUsed("MCVCMatrix")&&i.setUniformMatrix("MCVCMatrix",r([o.wcvc,y.mcwc,l],Pa,e.tmpMat4)),i.isUniformUsed("normalMatrix")&&i.setUniformMatrix3x3("normalMatrix",r([o.normalMatrix,y.normalMatrix],Gl,e.tmpMat3)),g!==u&&(i.isUniformUsed("cameraParallel")&&i.setUniformi("cameraParallel",c.getParallelProjection()),i.setLastCameraMTime(u)),p||i.setLastCameraMTime(0)},t.setPropertyShaderParameters=(n,a,s)=>{const i=n.getProgram();let o=s.getProperty(),c=o.getOpacity(),u=e.drawingEdges?o.getEdgeColorByReference():o.getAmbientColorByReference(),g=e.drawingEdges?o.getEdgeColorByReference():o.getDiffuseColorByReference(),f=e.drawingEdges?1:o.getAmbient(),l=e.drawingEdges?0:o.getDiffuse(),p=e.drawingEdges?0:o.getSpecular();const y=o.getSpecularPower();i.setUniformf("opacityUniform",c),i.setUniform3fArray("ambientColorUniform",u),i.setUniform3fArray("diffuseColorUniform",g),i.setUniformf("ambient",f),i.setUniformf("diffuse",l);const h=e.lastBoundBO.getReferenceByName("lastLightComplexity");if(h<1)return;let v=o.getSpecularColorByReference();if(i.setUniform3fArray("specularColorUniform",v),i.setUniformf("specularPowerUniform",y),i.setUniformf("specular",p),i.isUniformUsed("ambientIntensityBF")){if(o=s.getBackfaceProperty(),c=o.getOpacity(),u=o.getAmbientColor(),f=o.getAmbient(),g=o.getDiffuseColor(),l=o.getDiffuse(),v=o.getSpecularColor(),p=o.getSpecular(),i.setUniformf("ambientIntensityBF",f),i.setUniformf("diffuseIntensityBF",l),i.setUniformf("opacityUniformBF",c),i.setUniform3fArray("ambientColorUniformBF",u),i.setUniform3fArray("diffuseColorUniformBF",g),h<1)return;i.setUniformf("specularIntensityBF",p),i.setUniform3fArray("specularColorUniformBF",v),i.setUniformf("specularPowerUniformBF",y)}},t.updateMaximumPointCellIds=(n,a)=>{var o,c,u,g;const s=e._openGLRenderer.getSelector();if(!s)return;if((c=(o=e.selectionWebGLIdsToVTKIds)==null?void 0:o.points)!=null&&c.length){const f=e.selectionWebGLIdsToVTKIds.points.length;s.setMaximumPointId(f-1)}if((g=(u=e.selectionWebGLIdsToVTKIds)==null?void 0:u.cells)!=null&&g.length){const f=e.selectionWebGLIdsToVTKIds.cells.length;s.setMaximumCellId(f-1)}s.getFieldAssociation()===_a.FIELD_ASSOCIATION_POINTS&&(e.pointPicking=!0)},t.renderPieceStart=(n,a)=>{e.primitiveIDOffset=0,e.vertexIDOffset=0;const s=$d(e._openGLRenderer);if(e.lastSelectionState!==s&&(e.selectionStateChanged.modified(),e.lastSelectionState=s),e._openGLRenderer.getSelector())switch(s){default:e._openGLRenderer.getSelector().renderProp(a)}t.updateBufferObjects(n,a),e.renderable.getColorTextureMap()&&e.internalColorTexture.activate(),e.lastBoundBO=null},t.renderPieceDraw=(n,a)=>{const s=a.getProperty().getRepresentation(),i=a.getProperty().getEdgeVisibility()&&s===Wt.SURFACE,o=e._openGLRenderer.getSelector(),c=o&&o.getFieldAssociation()===_a.FIELD_ASSOCIATION_POINTS&&(e.lastSelectionState===we.ID_LOW24||e.lastSelectionState===we.ID_HIGH24);for(let u=fe.Start;u<fe.End;u++)e.primitives[u].setPointPicking(c),e.primitives[u].getCABO().getElementCount()&&(e.drawingEdges=i&&(u===fe.TrisEdges||u===fe.TriStripsEdges),(!e.drawingEdges||!(e.renderDepth||e.lastSelectionState>=0))&&(e.lastBoundBO=e.primitives[u],e.primitiveIDOffset+=e.primitives[u].drawArrays(n,a,s,t),e.vertexIDOffset+=e.primitives[u].getCABO().getElementCount()))},t.renderPieceFinish=(n,a)=>{e.LastBoundBO&&e.LastBoundBO.getVAO().release(),e.renderable.getColorTextureMap()&&e.internalColorTexture.deactivate()},t.renderPiece=(n,a)=>{if(t.invokeEvent(Nd),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(Gd),!e.currentInput){Ot("No input!");return}if(!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues())return;const s=e.context,i=a.getProperty().getBackfaceCulling(),o=a.getProperty().getFrontfaceCulling();!i&&!o?e._openGLRenderWindow.disableCullFace():o?(e._openGLRenderWindow.enableCullFace(),s.cullFace(s.FRONT)):(e._openGLRenderWindow.enableCullFace(),s.cullFace(s.BACK)),t.renderPieceStart(n,a),t.renderPieceDraw(n,a),t.renderPieceFinish(n,a)},t.computeBounds=(n,a)=>{if(!t.getInput()){Bs(e.bounds);return}e.bounds=t.getInput().getBounds()},t.updateBufferObjects=(n,a)=>{t.getNeedToRebuildBufferObjects(n,a)&&t.buildBufferObjects(n,a),t.updateMaximumPointCellIds()},t.getNeedToRebuildBufferObjects=(n,a)=>{const s=e.VBOBuildTime.getMTime();return s<t.getMTime()||s<e.renderable.getMTime()||s<a.getMTime()||s<e.currentInput.getMTime()},t.buildBufferObjects=(n,a)=>{const s=e.currentInput;if(s===null)return;e.renderable.mapScalars(s,1);const i=e.renderable.getColorMapColors();e.haveCellScalars=!1;const o=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(o===Yr.USE_CELL_DATA||o===Yr.USE_CELL_FIELD_DATA||o===Yr.USE_FIELD_DATA||!s.getPointData().getScalars())&&o!==Yr.USE_POINT_FIELD_DATA&&i&&(e.haveCellScalars=!0);let c=a.getProperty().getInterpolation()!==So.FLAT?s.getPointData().getNormals():null;c===null&&s.getCellData().getNormals()&&(e.haveCellNormals=!0,c=s.getCellData().getNormals());const u=a.getProperty().getRepresentation();let g=s.getPointData().getTCoords();e.openGLActor.getActiveTextures()||(g=null);let f=!1;if(e.renderable.getColorCoordinates()){g=e.renderable.getColorCoordinates(),f=e.renderable.getAreScalarsMappedFromCells(),e.internalColorTexture||(e.internalColorTexture=mt.newInstance({resizable:!0}));const p=e.internalColorTexture;p.setMinificationFilter(Co.NEAREST),p.setMagnificationFilter(Co.NEAREST),p.setWrapS(wo.CLAMP_TO_EDGE),p.setWrapT(wo.CLAMP_TO_EDGE),p.setOpenGLRenderWindow(e._openGLRenderWindow);const y=e.renderable.getColorTextureMap(),h=y.getExtent(),v=y.getPointData().getScalars();p.create2DFromRaw(h[1]-h[0]+1,h[3]-h[2]+1,v.getNumberOfComponents(),v.getDataType(),v.getData()),p.activate(),p.sendParameters(),p.deactivate()}const l=`${s.getMTime()}A${u}B${s.getMTime()}C${c?c.getMTime():1}D${i?i.getMTime():1}E${a.getProperty().getEdgeVisibility()}F${g?g.getMTime():1}`;if(e.VBOBuildString!==l){const y={points:s.getPoints(),normals:c,tcoords:g,colors:i,cellOffset:0,vertexOffset:0,useTCoordsPerCell:f,haveCellScalars:e.haveCellScalars,haveCellNormals:e.haveCellNormals,customAttributes:e.renderable.getCustomShaderAttributes().map(x=>s.getPointData().getArrayByName(x))};e.renderable.getPopulateSelectionSettings()&&(e.selectionWebGLIdsToVTKIds={points:null,cells:null});const h=[{inRep:"verts",cells:s.getVerts()},{inRep:"lines",cells:s.getLines()},{inRep:"polys",cells:s.getPolys()},{inRep:"strips",cells:s.getStrips()},{inRep:"polys",cells:s.getPolys()},{inRep:"strips",cells:s.getStrips()}],v=a.getProperty().getEdgeVisibility()&&u===Wt.SURFACE;for(let x=fe.Start;x<fe.End;x++)x!==fe.TrisEdges&&x!==fe.TriStripsEdges?(y.cellOffset+=e.primitives[x].getCABO().createVBO(h[x].cells,h[x].inRep,u,y,e.selectionWebGLIdsToVTKIds),y.vertexOffset+=e.primitives[x].getCABO().getElementCount()):v?e.primitives[x].getCABO().createVBO(h[x].cells,h[x].inRep,Wt.WIREFRAME,{...y,tcoords:null,colors:null,haveCellScalars:!1,haveCellNormals:!1}):e.primitives[x].releaseGraphicsResources();e.renderable.getPopulateSelectionSettings()&&e.renderable.setSelectionWebGLIdsToVTKIds(e.selectionWebGLIdsToVTKIds),e.VBOBuildString=l}e.VBOBuildTime.modified()},t.getAllocatedGPUMemoryInBytes=()=>{let n=0;return e.primitives.forEach(a=>{n+=a.getAllocatedGPUMemoryInBytes()}),n}}const zd={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null,tmpMat4:null,ambientColor:[],diffuseColor:[],specularColor:[],lightColor:[],lightDirection:[],lastHaveSeenDepthRequest:!1,haveSeenDepthRequest:!1,lastSelectionState:we.MIN_KNOWN_PASS-1,selectionStateChanged:null,selectionWebGLIdsToVTKIds:null,pointPicking:!1};function Hd(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,zd,r),ae.extend(t,e,r),$n.implementReplaceShaderCoincidentOffset(t,e,r),$n.implementBuildShadersWithReplacements(t,e,r),e.primitives=[],e.primTypes=fe,e.tmpMat3=Gt(new Float64Array(9)),e.tmpMat4=j(new Float64Array(16));for(let n=fe.Start;n<fe.End;n++)e.primitives[n]=ar.newInstance(),e.primitives[n].setPrimitiveType(n),e.primitives[n].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);ue(t,e,["context"]),e.VBOBuildTime={},ve(e.VBOBuildTime,{mtime:0}),e.selectionStateChanged={},ve(e.selectionStateChanged,{mtime:0}),Wd(t,e)}const Ad=Z(Hd,"vtkOpenGLPolyDataMapper");Ve("vtkMapper",Ad);const{ColorMode:jd,ScalarMode:Rt,GetArray:Ba}=Xn;function Kd(t,e){e.classHierarchy.push("vtkMapper2D"),t.createDefaultLookupTable=()=>{e.lookupTable=mn.newInstance()},t.getColorModeAsString=()=>E.enumToString(jd,e.colorMode),t.setColorModeToDefault=()=>t.setColorMode(0),t.setColorModeToMapScalars=()=>t.setColorMode(1),t.setColorModeToDirectScalars=()=>t.setColorMode(2),t.getScalarModeAsString=()=>E.enumToString(Rt,e.scalarMode),t.setScalarModeToDefault=()=>t.setScalarMode(0),t.setScalarModeToUsePointData=()=>t.setScalarMode(1),t.setScalarModeToUseCellData=()=>t.setScalarMode(2),t.setScalarModeToUsePointFieldData=()=>t.setScalarMode(3),t.setScalarModeToUseCellFieldData=()=>t.setScalarMode(4),t.setScalarModeToUseFieldData=()=>t.setScalarMode(5),t.getAbstractScalars=(r,n,a,s,i)=>{if(!r||!e.scalarVisibility)return{scalars:null,cellFLag:!1};let o=null,c=!1;if(n===Rt.DEFAULT)o=r.getPointData().getScalars(),o||(o=r.getCellData().getScalars(),c=!0);else if(n===Rt.USE_POINT_DATA)o=r.getPointData().getScalars();else if(n===Rt.USE_CELL_DATA)o=r.getCellData().getScalars(),c=!0;else if(n===Rt.USE_POINT_FIELD_DATA){const u=r.getPointData();a===Ba.BY_ID?o=u.getArrayByIndex(s):o=u.getArrayByName(i)}else if(n===Rt.USE_CELL_FIELD_DATA){const u=r.getCellData();c=!0,a===Ba.BY_ID?o=u.getArrayByIndex(s):o=u.getArrayByName(i)}else if(n===Rt.USE_FIELD_DATA){const u=r.getFieldData();a===Ba.BY_ID?o=u.getArrayByIndex(s):o=u.getArrayByName(i)}return{scalars:o,cellFlag:c}},t.getLookupTable=()=>(e.lookupTable||t.createDefaultLookupTable(),e.lookupTable),t.getMTime=()=>{let r=e.mtime;if(e.lookupTable!==null){const n=e.lookupTable.getMTime();r=n>r?n:r}return r},t.mapScalars=(r,n)=>{const a=t.getAbstractScalars(r,e.scalarMode,e.arrayAccessMode,e.arrayId,e.colorByArrayName).scalars;if(!a){e.colorMapColors=null;return}const s=`${t.getMTime()}${a.getMTime()}${n}`;if(e.colorBuildString===s)return;e.useLookupTableScalarRange||t.getLookupTable().setRange(e.scalarRange[0],e.scalarRange[1]);const i=t.getLookupTable();i&&(i.build(),e.colorMapColors=i.mapScalars(a,e.colorMode,e.fieldDataTupleId)),e.colorBuildString=`${t.getMTime()}${a.getMTime()}${n}`},t.getPrimitiveCount=()=>{const r=t.getInputData();return{points:r.getPoints().getNumberOfValues()/3,verts:r.getVerts().getNumberOfValues()-r.getVerts().getNumberOfCells(),lines:r.getLines().getNumberOfValues()-2*r.getLines().getNumberOfCells(),triangles:r.getPolys().getNumberOfValues()-3*r.getPolys().getNumberOfCells()}}}const Xd={static:!1,lookupTable:null,scalarVisibility:!1,scalarRange:[0,1],useLookupTableScalarRange:!1,colorMode:0,scalarMode:0,arrayAccessMode:1,renderTime:0,colorByArrayName:null,transformCoordinate:null,viewSpecificProperties:null,customShaderAttributes:[]};function Pd(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Xd,r),qf.extend(t,e,r),E.get(t,e,["colorMapColors"]),E.setGet(t,e,["arrayAccessMode","colorByArrayName","colorMode","lookupTable","renderTime","scalarMode","scalarVisibility","static","transformCoordinate","useLookupTableScalarRange","viewSpecificProperties","customShaderAttributes"]),E.setGetArray(t,e,["scalarRange"],2),e.viewSpecificProperties||(e.viewSpecificProperties={}),Kd(t,e)}E.newInstance(Pd,"vtkMapper2D");var Yd={},qd=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DFS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

uniform int PrimitiveIDOffset;

// Texture coordinates
//VTK::TCoord::Dec

// Scalar coloring
//VTK::Color::Dec

// Depth Peeling
//VTK::DepthPeeling::Dec

// picking support
//VTK::Picking::Dec

// the output of this shader
//VTK::Output::Dec

// Apple Bug
//VTK::PrimID::Dec

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  //VTK::Color::Impl
  //VTK::TCoord::Impl

  //VTK::DepthPeeling::Impl
  //VTK::Picking::Impl

  if (gl_FragData[0].a <= 0.0)
    {
    discard;
    }
}
`,Id=`//VTK::System::Dec

/*=========================================================================

  Program:   Visualization Toolkit
  Module:    vtkPolyData2DVS.glsl

  Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen
  All rights reserved.
  See Copyright.txt or http://www.kitware.com/Copyright.htm for details.

     This software is distributed WITHOUT ANY WARRANTY; without even
     the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
     PURPOSE.  See the above copyright notice for more information.

=========================================================================*/

// all variables that represent positions or directions have a suffix
// indicating the coordinate system they are in. The possible values are
// MC - Model Coordinates
// WC - WC world coordinates
// VC - View Coordinates
// DC - Display Coordinates

in vec4 vertexWC;

// frag position in VC
//VTK::PositionVC::Dec

// material property values
//VTK::Color::Dec

// Texture coordinates
//VTK::TCoord::Dec

// Apple Bug
//VTK::PrimID::Dec

uniform mat4 WCVCMatrix;  // World to view matrix

void main()
{
  // Apple Bug
  //VTK::PrimID::Impl

  gl_Position = WCVCMatrix*vertexWC;

  //VTK::TCoord::Impl

  //VTK::Color::Impl

  //VTK::PositionVC::Impl
}
`;const $u={BACKGROUND:0,FOREGROUND:1};var Wu={DisplayLocation:$u};const{primTypes:Fe}=ar,{ScalarMode:qr}=Yd,{vtkErrorMacro:Ir}=Pe,Qd={type:"StartEvent"},Zd={type:"EndEvent"};function Jd(t,e){e.classHierarchy.push("vtkOpenGLPolyDataMapper2D"),t.buildPass=n=>{n&&(e.openGLActor2D=t.getFirstAncestorOfType("vtkOpenGLActor2D"),e._openGLRenderer=e.openGLActor2D.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.openGLCamera=e._openGLRenderer.getViewNodeFor(e._openGLRenderer.getRenderable().getActiveCamera()))},t.overlayPass=n=>{n&&t.render()},t.getShaderTemplate=(n,a,s)=>{n.Vertex=Id,n.Fragment=qd,n.Geometry=""},t.render=()=>{const n=e._openGLRenderWindow.getContext();if(e.context!==n){e.context=n;for(let i=Fe.Start;i<Fe.End;i++)e.primitives[i].setOpenGLRenderWindow(e._openGLRenderWindow)}const a=e.openGLActor2D.getRenderable(),s=e._openGLRenderer.getRenderable();t.renderPiece(s,a)},t.renderPiece=(n,a)=>{if(t.invokeEvent(Qd),e.renderable.getStatic()||e.renderable.update(),e.currentInput=e.renderable.getInputData(),t.invokeEvent(Zd),!e.currentInput){Ir("No input!");return}!e.currentInput.getPoints||!e.currentInput.getPoints().getNumberOfValues()||(t.renderPieceStart(n,a),t.renderPieceDraw(n,a),t.renderPieceFinish(n,a))},t.renderPieceStart=(n,a)=>{if(e.primitiveIDOffset=0,e._openGLRenderer.getSelector())switch(e._openGLRenderer.getSelector().getCurrentPass()){default:e._openGLRenderer.getSelector().renderProp(a)}t.updateBufferObjects(n,a),e.lastBoundBO=null},t.getNeedToRebuildShaders=(n,a,s)=>n.getShaderSourceTime().getMTime()<e.renderable.getMTime()||n.getShaderSourceTime().getMTime()<e.currentInput.getMTime(),t.updateBufferObjects=(n,a)=>{t.getNeedToRebuildBufferObjects(n,a)&&t.buildBufferObjects(n,a)},t.getNeedToRebuildBufferObjects=(n,a)=>{const s=e.VBOBuildTime.getMTime();return!!(s<t.getMTime()||s<e._openGLRenderWindow.getMTime()||s<e.renderable.getMTime()||s<a.getMTime()||s<e.currentInput.getMTime()||e.renderable.getTransformCoordinate()&&s<n.getMTime())},t.buildBufferObjects=(n,a)=>{const s=e.currentInput;if(s===null)return;e.renderable.mapScalars(s,a.getProperty().getOpacity());const i=e.renderable.getColorMapColors();e.haveCellScalars=!1;const o=e.renderable.getScalarMode();e.renderable.getScalarVisibility()&&(o===qr.USE_CELL_DATA||o===qr.USE_CELL_FIELD_DATA||o===qr.USE_FIELD_DATA||!s.getPointData().getScalars())&&o!==qr.USE_POINT_FIELD_DATA&&i&&(e.haveCellScalars=!0);const c=a.getProperty().getRepresentation();let u=s.getPointData().getTCoords();e.openGLActor2D.getActiveTextures()||(u=null);const g=e.renderable.getTransformCoordinate(),l=n.getRenderWindow().getViews()[0].getViewportSize(n),p=`${s.getMTime()}A${c}B${s.getMTime()}C${i?i.getMTime():1}D${u?u.getMTime():1}E${g?n.getMTime():1}F${l}`;if(e.VBOBuildString!==p){let y=s.getPoints();if(g){const v=Mr.newInstance(),x=y.getNumberOfPoints();v.setNumberOfPoints(x);const S=[];for(let d=0;d<x;++d){y.getPoint(d,S),g.setValue(S);const T=g.getComputedDoubleViewportValue(n);v.setPoint(d,T[0],T[1],0)}y=v}const h={points:y,tcoords:u,colors:i,cellOffset:0,haveCellScalars:e.haveCellSCalars,customAttributes:e.renderable.getCustomShaderAttributes().map(v=>s.getPointData().getArrayByName(v))};h.cellOffset+=e.primitives[Fe.Points].getCABO().createVBO(s.getVerts(),"verts",c,h),h.cellOffset+=e.primitives[Fe.Lines].getCABO().createVBO(s.getLines(),"lines",c,h),h.cellOffset+=e.primitives[Fe.Tris].getCABO().createVBO(s.getPolys(),"polys",c,h),h.cellOffset+=e.primitives[Fe.TriStrips].getCABO().createVBO(s.getStrips(),"strips",c,h),e.VBOBuildTime.modified(),e.VBOBuildString=p}},t.renderPieceDraw=(n,a)=>{const s=a.getProperty().getRepresentation();e.context.depthMask(!0);for(let o=Fe.Start;o<Fe.End;o++)e.primitives[o].getCABO().getElementCount()&&(e.lastBoundBO=e.primitives[o],e.primitiveIDOffset+=e.primitives[o].drawArrays(n,a,s,t))},t.renderPieceFinish=(n,a)=>{e.lastBoundBO&&e.lastBoundBO.getVAO().release()},t.replaceShaderValues=(n,a,s)=>{t.replaceShaderColor(n,a,s),t.replaceShaderTCoord(n,a,s),t.replaceShaderPicking(n,a,s),t.replaceShaderPositionVC(n,a,s)},t.replaceShaderColor=(n,a,s)=>{let i=n.Vertex,o=n.Geometry,c=n.Fragment;e.haveCellScalars&&(c=F.substitute(c,"//VTK::Color::Dec",["uniform samplerBuffer texture1;"]).result,c=F.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = texelFetchBuffer(texture1, gl_PrimitiveID + PrimitiveIDOffset);"]).result),e.lastBoundBO.getCABO().getColorComponents()!==0?(i=F.substitute(i,"//VTK::Color::Dec",["in vec4 diffuseColor;","out vec4 fcolorVSOutput;"]).result,i=F.substitute(i,"//VTK::Color::Impl",["fcolorVSOutput = diffuseColor;"]).result,o=F.substitute(o,"//VTK::Color::Dec",[`in vec4 fcolorVSOutput[];
`,"out vec4 fcolorGSOutput;"]).result,o=F.substitute(o,"//VTK::Color::Impl",["fcolorGSOutput = fcolorVSOutput[i];"]).result,c=F.substitute(c,"//VTK::Color::Dec",["in vec4 fcolorVSOutput;"]).result,c=F.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = fcolorVSOutput;"]).result):(c=F.substitute(c,"//VTK::Color::Dec",["uniform vec4 diffuseColor;"]).result,c=F.substitute(c,"//VTK::Color::Impl",["gl_FragData[0] = diffuseColor;"]).result),n.Vertex=i,n.Geometry=o,n.Fragment=c},t.replaceShaderTCoord=(n,a,s)=>{if(e.lastBoundBO.getCABO().getTCoordOffset()){let i=n.Vertex,o=n.Geometry,c=n.Fragment;const u=e.lastBoundBO.getCABO().getTCoordComponents();u===1?(i=F.substitute(i,"//VTK::TCoord::Dec",["in float tcoordMC;","out float tcoordVCVSOutput;"]).result,i=F.substitute(i,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,o=F.substitute(o,"//VTK::TCoord::Dec",[`in float tcoordVCVSOutput[];
`,"out float tcoordVCGSOutput;"]).result,o=F.substitute(o,["//VTK::TCoord::Impl","tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=F.substitute(c,"//VTK::TCoord::Dec",["in float tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=F.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, vec2(tcoordVCVSOutput,0));"]).result):u===2&&(i=F.substitute(i,"//VTK::TCoord::Dec",["in vec2 tcoordMC;","out vec2 tcoordVCVSOutput;"]).result,i=F.substitute(i,"//VTK::TCoord::Impl",["tcoordVCVSOutput = tcoordMC;"]).result,o=F.substitute(o,"//VTK::TCoord::Dec",[`in vec2 tcoordVCVSOutput[];
`,"out vec2 tcoordVCGSOutput;"]).result,o=F.substitute(o,"//VTK::TCoord::Impl",["tcoordVCGSOutput = tcoordVCVSOutput[i];"]).result,c=F.substitute(c,"//VTK::TCoord::Dec",["in vec2 tcoordVCVSOutput;","uniform sampler2D texture1;"]).result,c=F.substitute(c,"//VTK::TCoord::Impl",["gl_FragData[0] = gl_FragData[0]*texture2D(texture1, tcoordVCVSOutput.st);"]).result),e.haveCellScalars&&(o=F.substitute(o,"//VTK::PrimID::Impl",["gl_PrimitiveID = gl_PrimitiveIDIn;"]).result),n.Vertex=i,n.Geometry=o,n.Fragment=c}},t.replaceShaderPicking=(n,a,s)=>{let i=n.Fragment;i=F.substitute(i,"//VTK::Picking::Dec",["uniform vec3 mapperIndex;","uniform int picking;"]).result,i=F.substitute(i,"//VTK::Picking::Impl","  gl_FragData[0] = picking != 0 ? vec4(mapperIndex,1.0) : gl_FragData[0];").result,n.Fragment=i},t.replaceShaderPositionVC=(n,a,s)=>{e.lastBoundBO.replaceShaderPositionVC(n,a,s)},t.invokeShaderCallbacks=(n,a,s)=>{const i=e.renderable.getViewSpecificProperties().ShadersCallbacks;i&&i.forEach(o=>{o.callback(o.userData,n,a,s)})},t.setMapperShaderParameters=(n,a,s)=>{if(n.getProgram().isUniformUsed("PrimitiveIDOffset")&&n.getProgram().setUniformi("PrimitiveIDOffset",e.primitiveIDOffset),n.getProgram().isAttributeUsed("vertexWC")&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"vertexWC",n.getCABO().getVertexOffset(),n.getCABO().getStride(),e.context.FLOAT,3,!1)||Ir("Error setting vertexWC in shader VAO.")),n.getCABO().getElementCount()&&(e.VBOBuildTime.getMTime()>n.getAttributeUpdateTime().getMTime()||n.getShaderSourceTime().getMTime()>n.getAttributeUpdateTime().getMTime())){e.renderable.getCustomShaderAttributes().forEach((c,u)=>{n.getProgram().isAttributeUsed(`${c}MC`)&&(n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),`${c}MC`,n.getCABO().getCustomData()[u].offset,n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getCustomData()[u].components,!1)||Ir(`Error setting ${c}MC in shader VAO.`))}),n.getProgram().isAttributeUsed("tcoordMC")&&n.getCABO().getTCoordOffset()?n.getVAO().addAttributeArray(n.getProgram(),n.getCABO(),"tcoordMC",n.getCABO().getTCoordOffset(),n.getCABO().getStride(),e.context.FLOAT,n.getCABO().getTCoordComponents(),!1)||Ir("Error setting tcoordMC in shader VAO."):n.getVAO().removeAttributeArray("tcoordMC"),e.internalColorTexture&&n.getProgram().isUniformUsed("texture1")&&n.getProgram().setUniformi("texture1",e.internalColorTexture.getTextureUnit());const i=e.openGLActor2D.getActiveTextures();if(i)for(let c=0;c<i.length;++c){const g=i[c].getTextureUnit(),f=`texture${g+1}`;n.getProgram().isUniformUsed(f)&&n.getProgram().setUniformi(f,g)}n.setMapperShaderParameters(a,s,e._openGLRenderer.getTiledSizeAndOrigin());const o=e._openGLRenderer.getSelector();n.getProgram().setUniform3fArray("mapperIndex",o?o.getPropColorValue():[0,0,0]),n.getProgram().setUniformi("picking",o?o.getCurrentPass()+1:0)}},t.setPropertyShaderParameters=(n,a,s)=>{const i=e.renderable.getColorMapColors();if(!i||i.getNumberOfComponents()===0){const o=n.getProgram(),c=s.getProperty(),u=c.getOpacity(),g=c.getColor(),f=[g[0],g[1],g[2],u];o.setUniform4f("diffuseColor",f)}},t.setLightingShaderParameters=(n,a,s)=>{};function r(n,a,s){return a.identity(s),n.reduce((i,o,c)=>c===0?o?a.copy(i,o):a.identity(i):o?a.multiply(i,i,o):i,s)}t.setCameraShaderParameters=(n,a,s)=>{const i=n.getProgram(),c=n.getCABO().getCoordShiftAndScaleEnabled()?n.getCABO().getInverseShiftAndScaleMatrix():null,g=a.getRenderWindow().getViews()[0].getViewportSize(a),f=a.getViewport(),l=s.getActualPositionCoordinate().getComputedDoubleViewportValue(a),p=[0,0,1,1],y=[0,0,1,1];if(y[0]=f[0]>=p[0]?f[0]:p[0],y[1]=f[1]>=p[1]?f[1]:p[1],y[2]=f[2]<=p[2]?f[2]:p[2],y[3]=f[3]<=p[3]?f[3]:p[3],y[0]>=y[2]||y[1]>=y[3])return;g[0]=$r(g[0]*(y[2]-y[0])/(f[2]-f[0])),g[1]=$r(g[1]*(y[3]-y[1])/(f[3]-f[1]));const h=e._openGLRenderer.getParent().getSize(),v=$r(l[0]-(y[0]-f[0])*h[0]),x=$r(l[1]-(y[1]-f[1])*h[1]),S=-v;let d=-v+g[0];const T=-x;let w=-x+g[1];S===d&&(d=S+1),T===w&&(w=T+1);const C=j(new Float64Array(16));C[0]=2/(d-S),C[1*4+1]=2/(w-T),C[0*4+3]=-1*(d+S)/(d-S),C[1*4+3]=-1*(w+T)/(w-T),C[2*4+2]=0,C[2*4+3]=s.getProperty().getDisplayLocation()===$u.FOREGROUND?-1:1,C[3*4+3]=1,te(C,C),i.setUniformMatrix("WCVCMatrix",r([C,c],Pa,e.tmpMat4))},t.getAllocatedGPUMemoryInBytes=()=>{let n=0;return e.primitives.forEach(a=>{n+=a.getAllocatedGPUMemoryInBytes()}),n}}const eT={context:null,VBOBuildTime:0,VBOBuildString:null,primitives:null,primTypes:null,shaderRebuildString:null};function tT(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,eT,r),ae.extend(t,e,r),$n.implementReplaceShaderCoincidentOffset(t,e,r),$n.implementBuildShadersWithReplacements(t,e,r),e.primitives=[],e.primTypes=Fe,e.tmpMat4=j(new Float64Array(16));for(let n=Fe.Start;n<Fe.End;n++)e.primitives[n]=ar.newInstance(),e.primitives[n].setPrimitiveType(n),e.primitives[n].set({lastLightComplexity:0,lastLightCount:0,lastSelectionPass:!1},!0);ue(t,e,["context"]),e.VBOBuildTime={},ve(e.VBOBuildTime,{mtime:0}),Jd(t,e)}const rT=Z(tT,"vtkOpenGLPolyDataMapper2D");Ve("vtkMapper2D",rT);const{VectorMode:nT}=nu;function Fa(t,e){t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeSize,t.fillStyle=e.fontColor,t.font=`${e.fontStyle} ${e.fontSize}px ${e.fontFamily}`}function zu(t,e){return r=>{const n=r.getLastSize(),a=(n[0]/700)**.8,s=(n[1]/700)**.8,i=Math.min(a,s),o=r.getAxisTextStyle(),c=r.getTickTextStyle();Object.assign(o,e.axisTextStyle),Object.assign(c,e.tickTextStyle),o.fontSize=Math.max(24*i,12),r.getLastAspectRatio()>1?c.fontSize=Math.max(20*i,10):c.fontSize=Math.max(16*i,10);const u=r.updateTextureAtlas();r.setTopTitle(!1);const g=r.getBoxSizeByReference();if(r.getLastAspectRatio()>1)r.setTickLabelPixelOffset(.3*c.fontSize),u.titleWidth<=u.tickWidth+r.getTickLabelPixelOffset()+.8*c.fontSize?(r.setTopTitle(!0),r.setAxisTitlePixelOffset(.2*c.fontSize),g[0]=2*(u.tickWidth+r.getTickLabelPixelOffset()+.8*c.fontSize)/n[0],r.setBoxPosition([.98-g[0],-.92])):(r.setAxisTitlePixelOffset(.2*c.fontSize),g[0]=2*(u.titleHeight+r.getAxisTitlePixelOffset()+u.tickWidth+r.getTickLabelPixelOffset()+.8*c.fontSize)/n[0],r.setBoxPosition([.99-g[0],-.92])),g[1]=Math.max(1.2,Math.min(1.84/s,1.84));else{r.setAxisTitlePixelOffset(1.2*c.fontSize),r.setTickLabelPixelOffset(.1*c.fontSize);const f=2*(.8*c.fontSize+u.titleHeight+r.getAxisTitlePixelOffset())/n[1],l=2*u.tickWidth/n[0];g[0]=Math.min(1.9,Math.max(1.4,1.4*l*(r.getTicks().length+3))),g[1]=f,r.setBoxPosition([-.5*g[0],-.97])}r.recomputeBarSegments(u)}}function Hu(t,e){return r=>{const n=r.getLastTickBounds(),a=_s().domain([n[0],n[1]]),s=a.ticks(5),i=a.tickFormat(5);r.setTicks(s),r.setTickStrings(s.map(i))}}function aT(t,e){e.classHierarchy.push("vtkScalarBarActorHelper"),t.setRenderable=a=>{e.renderable!==a&&(e.renderable=a,e.barActor.setProperty(a.getProperty()),e.barActor.setParentProp(a),e.barActor.setCoordinateSystemToDisplay(),e.tmActor.setProperty(a.getProperty()),e.tmActor.setParentProp(a),e.tmActor.setCoordinateSystemToDisplay(),e.generateTicks=a.generateTicks,e.axisTextStyle={...a.getAxisTextStyle()},e.tickTextStyle={...a.getTickTextStyle()},t.modified())},t.updateAPISpecificData=(a,s,i)=>{(e.lastSize[0]!==a[0]||e.lastSize[1]!==a[1])&&(e.lastSize[0]=a[0],e.lastSize[1]=a[1],e.lastAspectRatio=a[0]/a[1],e.forceUpdate=!0);const o=e.renderable.getScalarsToColors();if(!(!o||!e.renderable.getVisibility())&&(e.barMapper.setLookupTable(o),e.camera=s,e.renderWindow=i,e.forceUpdate||Math.max(o.getMTime(),t.getMTime(),e.renderable.getMTime())>e.lastRebuildTime.getMTime())){const c=o.getMappingRange();if(e.lastTickBounds=[...c],e.renderable.getGenerateTicks()(t),e.renderable.getAutomated())e.renderable.getAutoLayout()(t);else{e.axisTextStyle={...e.renderable.getAxisTextStyle()},e.tickTextStyle={...e.renderable.getTickTextStyle()},e.barPosition=[...e.renderable.getBarPosition()],e.barSize=[...e.renderable.getBarSize()],e.boxPosition=[...e.renderable.getBoxPosition()],e.boxSize=[...e.renderable.getBoxSize()],e.axisTitlePixelOffset=e.renderable.getAxisTitlePixelOffset(),e.tickLabelPixelOffset=e.renderable.getTickLabelPixelOffset();const u=t.updateTextureAtlas();t.recomputeBarSegments(u)}t.updatePolyDataForLabels(),t.updatePolyDataForBarSegments(),e.lastRebuildTime.modified(),e.forceUpdate=!1}},t.updateTextureAtlas=()=>{e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left";const a={},s=new Map;let i=0,o=1;Fa(e.tmContext,e.axisTextStyle);let c=e.tmContext.measureText(e.renderable.getAxisLabel()),u={height:c.actualBoundingBoxAscent+2,startingHeight:o,width:c.width+2,textStyle:e.axisTextStyle};s.set(e.renderable.getAxisLabel(),u),o+=u.height,i=u.width,a.titleWidth=u.width,a.titleHeight=u.height,a.tickWidth=0,a.tickHeight=0,Fa(e.tmContext,e.tickTextStyle);const g=[...t.getTickStrings(),"NaN","Below","Above"];for(let f=0;f<g.length;f++)s.has(g[f])||(c=e.tmContext.measureText(g[f]),u={height:c.actualBoundingBoxAscent+2,startingHeight:o,width:c.width+2,textStyle:e.tickTextStyle},s.set(g[f],u),o+=u.height,i<u.width&&(i=u.width),a.tickWidth<u.width&&(a.tickWidth=u.width),a.tickHeight<u.height&&(a.tickHeight=u.height));return i=me(i),o=me(o),s.forEach(f=>{f.tcoords=[0,(o-f.startingHeight-f.height)/o,f.width/i,(o-f.startingHeight-f.height)/o,f.width/i,(o-f.startingHeight)/o,0,(o-f.startingHeight)/o]}),e.tmCanvas.width=i,e.tmCanvas.height=o,e.tmContext.textBaseline="bottom",e.tmContext.textAlign="left",e.tmContext.clearRect(0,0,i,o),s.forEach((f,l)=>{Fa(e.tmContext,f.textStyle),e.tmContext.fillText(l,1,f.startingHeight+f.height-1)}),e.tmTexture.setCanvas(e.tmCanvas),e.tmTexture.modified(),e._tmAtlas=s,a},t.computeBarSize=a=>{e.vertical=e.boxSize[1]>e.boxSize[0];const s=2*a.tickHeight/e.lastSize[1],i=[1,1];if(e.vertical){const o=2*(a.tickWidth+e.tickLabelPixelOffset)/e.lastSize[0];if(e.topTitle){const c=2*(a.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0]-o,e.barSize[1]=e.boxSize[1]-c}else{const c=2*(a.titleHeight+e.axisTitlePixelOffset)/e.lastSize[0];e.barSize[0]=e.boxSize[0]-c-o,e.barSize[1]=e.boxSize[1]}e.barPosition[0]=e.boxPosition[0]+o,e.barPosition[1]=e.boxPosition[1],i[1]=s}else{const o=(2*a.tickWidth-8)/e.lastSize[0],c=2*(a.titleHeight+e.axisTitlePixelOffset)/e.lastSize[1];e.barSize[0]=e.boxSize[0],e.barPosition[0]=e.boxPosition[0],e.barSize[1]=e.boxSize[1]-c,e.barPosition[1]=e.boxPosition[1],i[0]=o}return i},t.recomputeBarSegments=a=>{var l,p,y,h;const s=t.computeBarSize(a);e.barSegments=[];const i=[0,0],o=e.vertical?1:0,c=e.vertical?.01:.02;function u(v,x){e.barSegments.push({corners:[[...i],[i[0]+s[0],i[1]],[i[0]+s[0],i[1]+s[1]],[i[0],i[1]+s[1]]],scalars:x,title:v}),i[o]+=s[o]+c}e.renderable.getDrawNanAnnotation()&&e.renderable.getScalarsToColors().getNanColor()&&u("NaN",[NaN,NaN,NaN,NaN]),e.renderable.getDrawBelowRangeSwatch()&&((p=(l=e.renderable.getScalarsToColors()).getUseBelowRangeColor)!=null&&p.call(l))&&u("Below",[-.1,-.1,-.1,-.1]);const g=(h=(y=e.renderable.getScalarsToColors()).getUseAboveRangeColor)==null?void 0:h.call(y);i[o]+=c;const f=s[o];s[o]=g?1-2*c-s[o]-i[o]:1-c-i[o],u("ticks",e.vertical?[0,0,.995,.995]:[0,.995,.995,0]),e.renderable.getDrawAboveRangeSwatch()&&g&&(s[o]=f,i[o]+=c,u("Above",[1.1,1.1,1.1,1.1]))};const r=new Float64Array(3);t.createPolyDataForOneLabel=(a,s,i,o,c,u)=>{const g=e._tmAtlas.get(a);if(!g)return;let f=u.ptIdx,l=u.cellIdx;r[0]=(.5*s[0]+.5)*e.lastSize[0],r[1]=(.5*s[1]+.5)*e.lastSize[1],r[2]=s[2],r[0]+=c[0],r[1]+=c[1];const p=[],y=o==="vertical"?[1,0]:[0,1];o==="vertical"?(p[0]=g.width,p[1]=-g.height,i[0]==="middle"?r[1]-=g.width/2:i[0]==="right"&&(r[1]-=g.width),i[1]==="middle"?r[0]+=g.height/2:i[1]==="top"&&(r[0]+=g.height)):(p[0]=g.width,p[1]=g.height,i[0]==="middle"?r[0]-=g.width/2:i[0]==="right"&&(r[0]-=g.width),i[1]==="middle"?r[1]-=g.height/2:i[1]==="top"&&(r[1]-=g.height)),u.points[f*3]=r[0],u.points[f*3+1]=r[1],u.points[f*3+2]=r[2],u.tcoords[f*2]=g.tcoords[0],u.tcoords[f*2+1]=g.tcoords[1],f++,r[y[0]]+=p[0],u.points[f*3]=r[0],u.points[f*3+1]=r[1],u.points[f*3+2]=r[2],u.tcoords[f*2]=g.tcoords[2],u.tcoords[f*2+1]=g.tcoords[3],f++,r[y[1]]+=p[1],u.points[f*3]=r[0],u.points[f*3+1]=r[1],u.points[f*3+2]=r[2],u.tcoords[f*2]=g.tcoords[4],u.tcoords[f*2+1]=g.tcoords[5],f++,r[y[0]]-=p[0],u.points[f*3]=r[0],u.points[f*3+1]=r[1],u.points[f*3+2]=r[2],u.tcoords[f*2]=g.tcoords[6],u.tcoords[f*2+1]=g.tcoords[7],f++,u.polys[l*4]=3,u.polys[l*4+1]=f-4,u.polys[l*4+2]=f-3,u.polys[l*4+3]=f-2,l++,u.polys[l*4]=3,u.polys[l*4+1]=f-4,u.polys[l*4+2]=f-2,u.polys[l*4+3]=f-1,u.ptIdx+=4,u.cellIdx+=2};const n=new Float64Array(3);t.updatePolyDataForLabels=()=>{const a=t.getTickStrings().length+e.barSegments.length,s=a*4,i=a*2,o=new Float64Array(s*3),c=new Uint16Array(i*4),u=new Float32Array(s*2),g={ptIdx:0,cellIdx:0,polys:c,points:o,tcoords:u},f=e.vertical?0:1,l=e.vertical?1:0;n[2]=-.99;const p=e.vertical?["right","middle"]:["middle","bottom"];let y=[0,1];const h=[0,0];e.vertical?(h[0]=-e.tickLabelPixelOffset,e.topTitle?(n[0]=e.boxPosition[0]+.5*e.boxSize[0],n[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),n,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],g)):(n[0]=e.barPosition[0]+e.barSize[0],n[1]=e.barPosition[1]+.5*e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),n,["middle","top"],"vertical",[e.axisTitlePixelOffset,0],g)),y=[-1,0]):(h[1]=e.tickLabelPixelOffset,n[0]=e.barPosition[0]+.5*e.barSize[0],n[1]=e.barPosition[1]+e.barSize[1],t.createPolyDataForOneLabel(e.renderable.getAxisLabel(),n,["middle","bottom"],"horizontal",[0,e.axisTitlePixelOffset],g)),n[f]=e.barPosition[f]+(.5*y[f]+.5)*e.barSize[f],n[l]=e.barPosition[l]+e.barSize[l]*.5;let v=null;for(let C=0;C<e.barSegments.length;C++){const O=e.barSegments[C];O.title==="ticks"?v=O:(n[l]=e.barPosition[l]+.5*e.barSize[l]*(O.corners[2][l]+O.corners[0][l]),t.createPolyDataForOneLabel(O.title,n,p,"horizontal",h,g))}const x=e.barPosition[l]+e.barSize[l]*v.corners[0][l],S=e.barSize[l]*(v.corners[2][l]-v.corners[0][l]),d=t.getTicks(),T=t.getTickStrings();for(let C=0;C<d.length;C++){const O=(d[C]-e.lastTickBounds[0])/(e.lastTickBounds[1]-e.lastTickBounds[0]);n[l]=x+S*O,t.createPolyDataForOneLabel(T[C],n,p,"horizontal",h,g)}const w=Q.newInstance({numberOfComponents:2,values:u,name:"TextureCoordinates"});e.tmPolyData.getPointData().setTCoords(w),e.tmPolyData.getPoints().setData(o,3),e.tmPolyData.getPoints().modified(),e.tmPolyData.getPolys().setData(c,1),e.tmPolyData.getPolys().modified(),e.tmPolyData.modified()},t.updatePolyDataForBarSegments=()=>{var h,v;const a=e.renderable.getScalarsToColors();let s=0;e.renderable.getDrawNanAnnotation()&&a.getNanColor()&&(s+=1),e.renderable.getDrawBelowRangeSwatch()&&((h=a.getUseBelowRangeColor)!=null&&h.call(a))&&(s+=1),e.renderable.getDrawAboveRangeSwatch()&&((v=a.getUseAboveRangeColor)!=null&&v.call(a))&&(s+=1);const i=4*(1+s),o=i;let c=1;a.getVectorMode()===nT.COMPONENT&&(c=a.getVectorComponent()+1);const u=new Float64Array(i*3),g=new Uint16Array(o*5),f=new Float32Array(i*c);let l=0,p=0;for(let x=0;x<e.barSegments.length;x++){const S=e.barSegments[x];for(let d=0;d<4;d++){n[0]=e.barPosition[0]+S.corners[d][0]*e.barSize[0],n[1]=e.barPosition[1]+S.corners[d][1]*e.barSize[1],u[l*3]=(.5*n[0]+.5)*e.lastSize[0],u[l*3+1]=(.5*n[1]+.5)*e.lastSize[1],u[l*3+2]=n[2];for(let T=0;T<c;T++)f[l*c+T]=e.lastTickBounds[0]+S.scalars[d]*(e.lastTickBounds[1]-e.lastTickBounds[0]);l++}g[p*5]=4,g[p*5+1]=l-4,g[p*5+2]=l-3,g[p*5+3]=l-2,g[p*5+4]=l-1,p++}const y=Q.newInstance({numberOfComponents:c,values:f,name:"Scalars"});e.polyData.getPointData().setScalars(y),e.polyData.getPoints().setData(u,3),e.polyData.getPoints().modified(),e.polyData.getPolys().setData(g,1),e.polyData.getPolys().modified(),e.polyData.modified()}}const sT=E.newInstance(function(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{renderable:null};Object.assign(e,{},r),E.obj(t,e),E.setGet(t,e,["axisTitlePixelOffset","tickLabelPixelOffset","renderable","topTitle","ticks","tickStrings"]),E.get(t,e,["lastSize","lastAspectRatio","lastTickBounds","axisTextStyle","tickTextStyle","barActor","tmActor"]),E.getArray(t,e,["boxPosition","boxSize"]),E.setArray(t,e,["boxPosition","boxSize"],2),e.forceUpdate=!1,e.lastRebuildTime={},E.obj(e.lastRebuildTime,{mtime:0}),e.lastSize=[-1,-1],e.tmCanvas=document.createElement("canvas"),e.tmContext=e.tmCanvas.getContext("2d"),e._tmAtlas=new Map,e.barMapper=rt.newInstance(),e.barMapper.setInterpolateScalarsBeforeMapping(!0),e.barMapper.setUseLookupTableScalarRange(!0),e.polyData=nt.newInstance(),e.barMapper.setInputData(e.polyData),e.barActor=tt.newInstance(),e.barActor.setMapper(e.barMapper),e.tmPolyData=nt.newInstance(),e.tmMapper=rt.newInstance(),e.tmMapper.setInputData(e.tmPolyData),e.tmTexture=Yn.newInstance({resizable:!0}),e.tmTexture.setInterpolate(!1),e.tmActor=tt.newInstance({parentProp:t}),e.tmActor.setMapper(e.tmMapper),e.tmActor.addTexture(e.tmTexture),e.barPosition=[0,0],e.barSize=[0,0],e.boxPosition=[.88,-.92],e.boxSize=[.1,1.1],e.lastTickBounds=[],aT(t,e)},"vtkScalarBarActorHelper");function iT(t,e){e.classHierarchy.push("vtkScalarBarActor"),t.setTickTextStyle=r=>{e.tickTextStyle={...e.tickTextStyle,...r},t.modified()},t.setAxisTextStyle=r=>{e.axisTextStyle={...e.axisTextStyle,...r},t.modified()},t.resetAutoLayoutToDefault=()=>{t.setAutoLayout(zu(t,e))},t.resetGenerateTicksToDefault=()=>{t.setGenerateTicks(Hu())}}function oT(t){return{automated:!0,autoLayout:null,axisLabel:"Scalar Value",barPosition:[0,0],barSize:[0,0],boxPosition:[.88,-.92],boxSize:[.1,1.1],scalarToColors:null,axisTitlePixelOffset:36,axisTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:18,fontFamily:"serif"},tickLabelPixelOffset:14,tickTextStyle:{fontColor:"white",fontStyle:"normal",fontSize:14,fontFamily:"serif"},generateTicks:null,drawNanAnnotation:!0,drawBelowRangeSwatch:!0,drawAboveRangeSwatch:!0,...t}}function Au(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,oT(r)),e.autoLayout||(e.autoLayout=zu(t,e)),e.generateTicks||(e.generateTicks=Hu()),tt.extend(t,e,r),t.getProperty().setDiffuse(0),t.getProperty().setAmbient(1),E.setGet(t,e,["automated","autoLayout","axisTitlePixelOffset","axisLabel","scalarsToColors","tickLabelPixelOffset","generateTicks","drawNanAnnotation","drawBelowRangeSwatch","drawAboveRangeSwatch"]),E.get(t,e,["axisTextStyle","tickTextStyle"]),E.getArray(t,e,["barPosition","barSize","boxPosition","boxSize"]),E.setArray(t,e,["barPosition","barSize","boxPosition","boxSize"],2),iT(t,e)}const cT=E.newInstance(Au,"vtkScalarBarActor");var ju={newInstance:cT,extend:Au,newScalarBarActorHelper:sT};function fT(t,e){e.classHierarchy.push("vtkOpenGLScalarBarActor"),t.buildPass=r=>{r&&(e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){const a=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,s=e._openGLRenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([s.usize,s.vsize],a,e._openGLRenderWindow.getRenderable())}}}const uT={};function gT(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uT,r),ae.extend(t,e,r),e.scalarBarActorHelper=ju.newScalarBarActorHelper(),fT(t,e)}const lT=Z(gT,"vtkOpenGLScalarBarActor");Ve("vtkScalarBarActor",lT);const{vtkErrorMacro:Eo}=Pe;function pT(t,e){e.classHierarchy.push("vtkOpenGLSkybox"),t.buildPass=r=>{if(r){e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getParent(),e.context=e._openGLRenderWindow.getContext(),e.tris.setOpenGLRenderWindow(e._openGLRenderWindow),e.openGLTexture.setOpenGLRenderWindow(e._openGLRenderWindow);const n=e._openGLRenderer.getRenderable();e.openGLCamera=e._openGLRenderer.getViewNodeFor(n.getActiveCamera())}},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;n.incrementOpaqueActorCount()}},t.opaquePass=(r,n)=>{if(r&&!e._openGLRenderer.getSelector()){t.updateBufferObjects(),e.context.depthMask(!0),e._openGLRenderWindow.getShaderCache().readyShaderProgram(e.tris.getProgram()),e.openGLTexture.render(e._openGLRenderWindow);const a=e.openGLTexture.getTextureUnit();e.tris.getProgram().setUniformi("sbtexture",a);const s=e._openGLRenderer.getRenderable(),i=e.openGLCamera.getKeyMatrices(s),o=new Float64Array(16);if(Re(o,i.wcpc),e.tris.getProgram().setUniformMatrix("IMCPCMatrix",o),e.lastFormat==="box"){const c=s.getActiveCamera().getPosition();e.tris.getProgram().setUniform3f("camPos",c[0],c[1],c[2])}e.tris.getVAO().bind(),e.context.drawArrays(e.context.TRIANGLES,0,e.tris.getCABO().getElementCount()),e.tris.getVAO().release(),e.openGLTexture.deactivate()}},t.updateBufferObjects=()=>{if(!e.tris.getCABO().getElementCount()){const n=new Float32Array(12);for(let o=0;o<4;o++)n[o*3]=o%2*2-1,n[o*3+1]=o>1?1:-1,n[o*3+2]=1;const a=Q.newInstance({numberOfComponents:3,values:n});a.setName("points");const s=new Uint16Array(8);s[0]=3,s[1]=0,s[2]=1,s[3]=3,s[4]=3,s[5]=0,s[6]=3,s[7]=2;const i=Q.newInstance({numberOfComponents:1,values:s});e.tris.getCABO().createVBO(i,"polys",Le.SURFACE,{points:a,cellOffset:0})}e.renderable.getFormat()!==e.lastFormat&&(e.lastFormat=e.renderable.getFormat(),e.lastFormat==="box"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec3 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = wpos.xyz/wpos.w;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec3 TexCoords;
             uniform samplerCube sbtexture;
             uniform vec3 camPos;
             void main () {
               // skybox looks from inside out
               // which means we have to adjust
               // our tcoords. Otherwise text would
               // be flipped
               vec3 tc = normalize(TexCoords - camPos);
               if (abs(tc.z) < max(abs(tc.x),abs(tc.y)))
               {
                 tc = vec3(1.0, 1.0, -1.0) * tc;
               }
               else
               {
                 tc = vec3(-1.0, 1.0, 1.0) * tc;
               }
               gl_FragData[0] = textureCube(sbtexture, tc);
             }`,"")),e.lastFormat==="background"&&e.tris.setProgram(e._openGLRenderWindow.getShaderCache().readyShaderProgramArray(`//VTK::System::Dec
             attribute vec3 vertexMC;
             uniform mat4 IMCPCMatrix;
             varying vec2 TexCoords;
             void main () {
              gl_Position = vec4(vertexMC.xyz, 1.0);
              vec4 wpos = IMCPCMatrix * gl_Position;
              TexCoords = vec2(vertexMC.x, vertexMC.y)*0.5 + 0.5;
             }`,`//VTK::System::Dec
             //VTK::Output::Dec
             varying vec2 TexCoords;
             uniform sampler2D sbtexture;
             void main () {
               gl_FragData[0] = texture2D(sbtexture, TexCoords);
             }`,"")),e.tris.getShaderSourceTime().modified(),e.tris.getVAO().bind(),e.tris.getVAO().addAttributeArray(e.tris.getProgram(),e.tris.getCABO(),"vertexMC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),e.context.FLOAT,3,e.context.FALSE)||Eo("Error setting vertexMC in shader VAO."));const r=e.renderable.getTextures();r.length||Eo("vtkSkybox requires a texture map"),e.openGLTexture.getRenderable()!==r[0]&&(e.openGLTexture.releaseGraphicsResources(e._openGLRenderWindow),e.openGLTexture.setRenderable(r[0]))}}const hT={context:null};function vT(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hT,r),ae.extend(t,e,r),e.openGLTexture=mt.newInstance(),e.tris=ar.newInstance(),e.keyMatrixTime={},ve(e.keyMatrixTime,{mtime:0}),e.keyMatrices={normalMatrix:Gt(new Float64Array(9)),mcwc:j(new Float64Array(16))},ue(t,e,["context"]),Ee(t,e,["activeTextures"]),pT(t,e)}const yT=Z(vT);Ve("vtkSkybox",yT);const{vtkDebugMacro:dT}=Pe;function TT(t,e){e.classHierarchy.push("vtkOpenGLPixelSpaceCallbackMapper"),t.opaquePass=(r,n)=>{e._openGLRenderer=t.getFirstAncestorOfType("vtkOpenGLRenderer"),e._openGLRenderWindow=e._openGLRenderer.getLastAncestorOfType("vtkOpenGLRenderWindow");const a=e._openGLRenderer.getAspectRatio(),s=e._openGLRenderer?e._openGLRenderer.getRenderable().getActiveCamera():null,i=e._openGLRenderer.getTiledSizeAndOrigin();let o=null;if(e.renderable.getUseZValues()){const c=n.getZBufferTexture(),u=Math.floor(c.getWidth()),g=Math.floor(c.getHeight()),f=e._openGLRenderWindow.getContext();c.bind();const l=n.getFramebuffer();l?l.saveCurrentBindingsAndBuffers():dT("No framebuffer to save/restore");const p=f.createFramebuffer();f.bindFramebuffer(f.FRAMEBUFFER,p),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,c.getHandle(),0),f.checkFramebufferStatus(f.FRAMEBUFFER)===f.FRAMEBUFFER_COMPLETE&&(o=new Uint8Array(u*g*4),f.viewport(0,0,u,g),f.readPixels(0,0,u,g,f.RGBA,f.UNSIGNED_BYTE,o)),l&&l.restorePreviousBindingsAndBuffers(),f.deleteFramebuffer(p)}e.renderable.invokeCallback(e.renderable.getInputData(),s,a,i,o)},t.queryPass=(r,n)=>{r&&e.renderable.getUseZValues()&&n.requestDepth()}}const xT={};function ST(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,xT,r),ae.extend(t,e,r),TT(t,e)}const CT=Z(ST,"vtkOpenGLPixelSpaceCallbackMapper");Ve("vtkPixelSpaceCallbackMapper",CT);const Ku=Object.create(null);function Ye(t,e){Ku[t]=e}function wT(t,e){e.classHierarchy.push("vtkWebGPUViewNodeFactory")}const ET={};function Xu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ET,r),e.overrides=Ku,Qc.extend(t,e,r),wT(t,e)}const OT=E.newInstance(Xu,"vtkWebGPUViewNodeFactory");var RT={newInstance:OT,extend:Xu};function MT(t,e){e.classHierarchy.push("vtkWebGPUCamera"),t.getProjectionMatrix=(r,n,a,s)=>{if(j(r),e.renderable.getParallelProjection()){const i=e.renderable.getParallelScale(),o=i*n,c=i,u=(s[0]-1)*o,g=(s[0]+1)*o,f=(s[1]-1)*c,l=(s[1]+1)*c,p=1/(g-u),y=1/(l-f);r[0]=2*p,r[5]=2*y,r[10]=1/(a[1]-a[0]),r[12]=(g+u)*p,r[13]=(l+f)*y,r[14]=a[1]/(a[1]-a[0])}else{const i=Math.tan(Math.PI*e.renderable.getViewAngle()/360);let o,c;e.renderable.getUseHorizontalViewAngle()===!0?(o=a[0]*i,c=a[0]*i/n):(o=a[0]*i*n,c=a[0]*i);const u=(s[0]-1)*o,g=(s[0]+1)*o,f=(s[1]-1)*c,l=(s[1]+1)*c;r[0]=2*a[0]/(g-u),r[5]=2*a[0]/(l-f),r[12]=(u+g)/(g-u),r[13]=(f+l)/(l-f),r[10]=0,r[14]=a[0],r[11]=-1,r[15]=0}},t.convertToOpenGLDepth=r=>{if(e.renderable.getParallelProjection())return 1-r;const n=e.renderable.getClippingRangeByReference();let a=-n[0]/r;return a=(n[0]+n[1])/(n[1]-n[0])+2*n[0]*n[1]/(a*(n[1]-n[0])),.5*a+.5},t.getKeyMatrices=r=>{const n=r.getRenderable(),a=r.getParent();if(Math.max(a.getMTime(),t.getMTime(),n.getMTime(),e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatrixTime.getMTime()){const s=e.renderable.getViewMatrix();ye(e.keyMatrices.normalMatrix,s),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Re(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),te(e.keyMatrices.wcvc,s);const i=r.getStabilizedCenterByReference();oe(e.keyMatrices.scvc,e.keyMatrices.wcvc,i);const o=r.getAspectRatio(),c=e.renderable.getClippingRangeByReference();t.getProjectionMatrix(e.keyMatrices.vcpc,o,c,e.renderable.getWindowCenterByReference()),de(e.keyMatrices.scpc,e.keyMatrices.vcpc,e.keyMatrices.scvc),Re(e.keyMatrices.pcsc,e.keyMatrices.scpc),e.keyMatrixTime.modified()}return e.keyMatrices}}const DT={keyMatrixTime:null,keyMatrices:null};function LT(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DT,r),ae.extend(t,e,r),e.keyMatrixTime={},E.obj(e.keyMatrixTime),e.keyMatrices={normalMatrix:new Float64Array(16),vcpc:new Float64Array(16),pcsc:new Float64Array(16),wcvc:new Float64Array(16),scpc:new Float64Array(16),scvc:new Float64Array(16)},E.setGet(t,e,["keyMatrixTime"]),MT(t,e)}const VT=E.newInstance(LT);Ye("vtkCamera",VT);function _T(t,e){e.classHierarchy.push("vtkWebGPUBindGroup"),t.setBindables=r=>{if(e.bindables.length===r.length){let n=!0;for(let a=0;a<e.bindables.length;a++)e.bindables[a]!==r[a]&&(n=!1);if(n)return}e.bindables=r,t.modified()},t.getBindGroupLayout=r=>{const n=[];for(let a=0;a<e.bindables.length;a++){const s=e.bindables[a].getBindGroupLayoutEntry();s.binding=a,n.push(s)}return r.getBindGroupLayout({entries:n})},t.getBindGroup=r=>{let n=t.getMTime();for(let s=0;s<e.bindables.length;s++){const i=e.bindables[s].getBindGroupTime().getMTime();n=i>n?i:n}if(n<e.bindGroupTime.getMTime())return e.bindGroup;const a=[];for(let s=0;s<e.bindables.length;s++){const i=e.bindables[s].getBindGroupEntry();i.binding=s,a.push(i)}return e.bindGroup=r.getHandle().createBindGroup({layout:t.getBindGroupLayout(r),entries:a,label:e.label}),e.bindGroupTime.modified(),e.bindGroup},t.getShaderCode=r=>{const n=[],a=r.getBindGroupLayoutCount(e.label);for(let s=0;s<e.bindables.length;s++)n.push(e.bindables[s].getShaderCode(s,a));return n.join(`
`)}}const BT={device:null,handle:null,label:null};function Pu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,BT,r),E.obj(t,e),e.bindables=[],e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),E.get(t,e,["bindGroupTime","handle","sizeInBytes","usage"]),E.setGet(t,e,["label","device","arrayInformation"]),_T(t,e)}const FT=E.newInstance(Pu);var Yu={newInstance:FT,extend:Pu};function UT(t,e){e.classHierarchy.push("vtkWebGPUShaderModule"),t.initialize=(r,n)=>{e.device=r,e.handle=e.device.getHandle().createShaderModule({code:n.getCode()})}}const mT={device:null,handle:null};function qu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mT,r),E.obj(t,e),E.get(t,e,["lastCameraMTime"]),E.setGet(t,e,["device","handle"]),UT(t,e)}const kT=E.newInstance(qu,"vtkWebGPUShaderModule");var NT={newInstance:kT,extend:qu};function GT(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;const a=Array.isArray(r)?r.join(`
`):r;let s=!1;t.search(e)!==-1&&(s=!0);let i="";n&&(i="g");const o=new RegExp(e,i),c=t.replace(o,a);return{replace:s,result:c}}function bT(t,e){e.classHierarchy.push("vtkWebGPUShaderCache"),t.getShaderModule=r=>{const n=r.getType(),a=r.getHash(),s=e._shaderModules.keys();for(let o=0;o<s.length;o++){const c=s[o];if(c.getHash()===a&&c.getType()===n)return e._shaderModules.get(c)}const i=NT.newInstance();return i.initialize(e.device,r),e._shaderModules.set(r,i),i}}const $T={shaderModules:null,device:null,window:null};function Iu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$T,r),e._shaderModules=new Map,E.obj(t,e),E.setGet(t,e,["device","window"]),bT(t,e)}const WT=E.newInstance(Iu,"vtkWebGPUShaderCache");var H={newInstance:WT,extend:Iu,substitute:GT};function zT(t,e){e.classHierarchy.push("vtkWebGPUPipeline"),t.getShaderDescriptions=()=>e.shaderDescriptions,t.initialize=(r,n)=>{e.pipelineDescription=e.renderEncoder.getPipelineSettings(),e.pipelineDescription.primitive.topology=e.topology,e.pipelineDescription.vertex=e.vertexState,e.pipelineDescription.label=n;const a=[];for(let s=0;s<e.layouts.length;s++)a.push(e.layouts[s].layout);e.pipelineLayout=r.getHandle().createPipelineLayout({bindGroupLayouts:a}),e.pipelineDescription.layout=e.pipelineLayout;for(let s=0;s<e.shaderDescriptions.length;s++){const i=e.shaderDescriptions[s],o=r.getShaderModule(i);i.getType()==="vertex"&&(e.pipelineDescription.vertex.module=o.getHandle(),e.pipelineDescription.vertex.entryPoint="main"),i.getType()==="fragment"&&(e.pipelineDescription.fragment.module=o.getHandle(),e.pipelineDescription.fragment.entryPoint="main")}e.handle=r.getHandle().createRenderPipeline(e.pipelineDescription)},t.getShaderDescription=r=>{for(let n=0;n<e.shaderDescriptions.length;n++)if(e.shaderDescriptions[n].getType()===r)return e.shaderDescriptions[n];return null},t.addBindGroupLayout=r=>{r&&e.layouts.push({layout:r.getBindGroupLayout(e.device),label:r.getLabel()})},t.getBindGroupLayout=r=>e.layouts[r].layout,t.getBindGroupLayoutCount=r=>{for(let n=0;n<e.layouts.length;n++)if(e.layouts[n].label===r)return n;return 0},t.bindVertexInput=(r,n)=>{n.bindBuffers(r)}}const HT={handle:null,layouts:null,renderEncoder:null,shaderDescriptions:null,vertexState:null,topology:null,pipelineDescription:null};function Qu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HT,r),ve(t,e),e.layouts=[],e.shaderDescriptions=[],Ee(t,e,["handle","pipelineDescription"]),ue(t,e,["device","renderEncoder","topology","vertexState"]),zT(t,e)}const AT=Z(Qu,"vtkWebGPUPipeline");var jT={newInstance:AT,extend:Qu};function KT(t,e){e.classHierarchy.push("vtkWebGPUShaderDescription"),t.hasOutput=r=>e.outputNames.includes(r),t.addOutput=function(r,n){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;e.outputTypes.push(r),e.outputNames.push(n),e.outputInterpolations.push(a)},t.addBuiltinOutput=(r,n)=>{e.builtinOutputTypes.push(r),e.builtinOutputNames.push(n)},t.addBuiltinInput=(r,n)=>{e.builtinInputTypes.push(r),e.builtinInputNames.push(n)},t.replaceShaderCode=(r,n)=>{const a=[];let s=[];if(n&&a.push(n.getShaderCode()),r||e.builtinInputNames.length){const i=[];if(i.push(`struct ${e.type}Input
{`),r){const o=r.getOutputNamesByReference(),c=r.getOutputTypesByReference(),u=r.getOutputInterpolationsByReference();for(let g=0;g<o.length;g++)u[g]!==void 0?i.push(`  @location(${g}) @interpolate(${u[g]}) ${o[g]} : ${c[g]},`):i.push(`  @location(${g}) ${o[g]} : ${c[g]},`)}for(let o=0;o<e.builtinInputNames.length;o++)i.push(`  ${e.builtinInputNames[o]} : ${e.builtinInputTypes[o]},`);i.length>1&&(i.push("};"),s=i,a[a.length-1]+=",",a.push(`input: ${e.type}Input`))}if(a.length&&(e.code=H.substitute(e.code,"//VTK::IOStructs::Input",a).result),e.outputNames.length+e.builtinOutputNames.length){const i=[`struct ${e.type}Output
{`];for(let o=0;o<e.outputNames.length;o++)e.outputInterpolations[o]!==void 0?i.push(`  @location(${o}) @interpolate(${e.outputInterpolations[o]}) ${e.outputNames[o]} : ${e.outputTypes[o]},`):i.push(`  @location(${o}) ${e.outputNames[o]} : ${e.outputTypes[o]},`);for(let o=0;o<e.builtinOutputNames.length;o++)i.push(`  ${e.builtinOutputNames[o]} : ${e.builtinOutputTypes[o]},`);i.push("};"),s=s.concat(i),e.code=H.substitute(e.code,"//VTK::IOStructs::Output",[`-> ${e.type}Output`]).result}e.code=H.substitute(e.code,"//VTK::IOStructs::Dec",s).result}}const XT={type:null,hash:null,code:null,outputNames:null,outputTypes:null};function Zu(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XT,r),e.outputNames=[],e.outputTypes=[],e.outputInterpolations=[],e.builtinOutputNames=[],e.builtinOutputTypes=[],e.builtinInputNames=[],e.builtinInputTypes=[],E.obj(t,e),E.setGet(t,e,["type","hash","code"]),E.getArray(t,e,["outputTypes","outputNames","outputInterpolations"]),KT(t,e)}const PT=E.newInstance(Zu,"vtkWebGPUShaderDescription");var Oo={newInstance:PT,extend:Zu};const Ro={r8unorm:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"float"},r8snorm:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"float"},r8uint:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},r8sint:{numComponents:1,nativeType:Int8Array,stride:1,elementSize:1,sampleType:"sint"},r16uint:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"uint"},r16sint:{numComponents:1,nativeType:Int16Array,stride:2,elementSize:2,sampleType:"sint"},r16float:{numComponents:1,nativeType:Float32Array,stride:2,elementSize:2,sampleType:"float"},rg8unorm:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"float"},rg8snorm:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"float"},rg8uint:{numComponents:2,nativeType:Uint8Array,stride:2,elementSize:1,sampleType:"uint"},rg8sint:{numComponents:2,nativeType:Int8Array,stride:2,elementSize:1,sampleType:"sint"},r32uint:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:4,sampleType:"uint"},r32sint:{numComponents:1,nativeType:Int32Array,stride:4,elementSize:4,sampleType:"sint"},r32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"unfilterable-float"},rg16uint:{numComponents:2,nativeType:Uint16Array,stride:4,elementSize:2,sampleType:"uint"},rg16sint:{numComponents:2,nativeType:Int16Array,stride:4,elementSize:2,sampleType:"sint"},rg16float:{numComponents:2,nativeType:Float32Array,stride:4,elementSize:2,sampleType:"float"},rgba8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"rgba8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgba8snorm:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"float"},rgba8uint:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"uint"},rgba8sint:{numComponents:4,nativeType:Int8Array,stride:4,elementSize:1,sampleType:"sint"},bgra8unorm:{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},"bgra8unorm-srgb":{numComponents:4,nativeType:Uint8Array,stride:4,elementSize:1,sampleType:"float"},rgb9e5ufloat:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rgb10a2unorm:{numComponents:4,nativeType:Uint32Array,stride:4,sampleType:"float"},rg11b10ufloat:{numComponents:4,nativeType:Float32Array,stride:4,sampleType:"float"},rg32uint:{numComponents:2,nativeType:Uint32Array,stride:8,elementSize:4,sampleType:"uint"},rg32sint:{numComponents:2,nativeType:Int32Array,stride:8,elementSize:4,sampleType:"sint"},rg32float:{numComponents:2,nativeType:Float32Array,stride:8,elementSize:4,sampleType:"unfilterable-float"},rgba16uint:{numComponents:4,nativeType:Uint16Array,stride:8,elementSize:2,sampleType:"uint"},rgba16sint:{numComponents:4,nativeType:Int16Array,stride:8,elementSize:2,sampleType:"sint"},rgba16float:{numComponents:4,nativeType:Float32Array,stride:8,elementSize:2,sampleType:"float"},rgba32uint:{numComponents:4,nativeType:Uint32Array,stride:16,elementSize:4,sampleType:"uint"},rgba32sint:{numComponents:4,nativeType:Int32Array,stride:16,elementSize:4,sampleType:"sint"},rgba32float:{numComponents:4,nativeType:Float32Array,stride:16,elementSize:4,sampleType:"unfilterable-float"},stencil8:{numComponents:1,nativeType:Uint8Array,stride:1,elementSize:1,sampleType:"uint"},depth16unorm:{numComponents:1,nativeType:Uint16Array,stride:2,elementSize:2,sampleType:"depth"},depth24plus:{numComponents:1,nativeType:Uint32Array,stride:4,elementSize:3,sampleType:"depth"},"depth24plus-stencil8":{numComponents:2,nativeType:Uint32Array,stride:4,sampleType:"mixed"},depth32float:{numComponents:1,nativeType:Float32Array,stride:4,elementSize:4,sampleType:"depth"}};function YT(t){return!t||t.length<6?0:t in Ro?Ro[t]:(A(`unknown format ${t}`),null)}function qT(t){if(!t||t.length<5)return 0;let e=1;t[t.length-2]==="x"&&(e=Number(t[t.length-1]));const r=e===1?t.length-1:t.length-3,n=Number(t[r]);if(Number.isNaN(n))return A(`unknown format ${t}`),0;const a=5-n/2;return e*a}function IT(t){if(!t||t.length<5)return 0;let e=1;return t[t.length-2]==="x"&&(e=Number(t[t.length-1])),e}function QT(t){if(!t||t.length<5)return 0;let e;if(t[0]==="f")e="Float";else if(t[0]==="s")e="Int";else if(t[0]==="u")e="Uint";else{A(`unknown format ${t}`);return}const r=t.split("x")[0],n=Number(r[r.length-1]);if(Number.isNaN(n)){A(`unknown format ${t}`);return}return e+=8*(5-n/2),e+="Array",e}function ZT(t){let e;if(t[0]==="f"||t[1]==="n")e="f32";else if(t[0]==="s"&&t[1]==="i")e="i32";else if(t[0]==="u"&&t[1]==="i")e="u32";else{A(`unknown format ${t}`);return}let r=1;return t[t.length-2]==="x"&&(r=Number(t[t.length-1])),r===4?`vec4<${e}>`:r===3?`vec3<${e}>`:r===2?`vec2<${e}>`:e}function JT(t){if(!t)return 0;let e=1;return t.substring(0,3)==="vec"?e=Number(t[3]):t.substring(0,3)==="mat"&&(e=t[3]*t[5]),e*4}function ex(t){if(t){if(t.includes("f32"))return"Float32Array";if(t.includes("i32"))return"Int32Array";if(t.includes("u32"))return"Uint32Array";A(`unknown format ${t}`)}}var pe={getDetailsFromTextureFormat:YT,getByteStrideFromBufferFormat:qT,getNumberOfComponentsFromBufferFormat:IT,getNativeTypeFromBufferFormat:QT,getShaderTypeFromBufferFormat:ZT,getByteStrideFromShaderFormat:JT,getNativeTypeFromShaderFormat:ex};function tx(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!e.includes(t[r]))return!1;return!0}function rx(t,e){e.classHierarchy.push("vtkWebGPUVertexInput"),t.addBuffer=function(r,n){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"vertex",s=n;Array.isArray(s)||(s=[s]);for(let i=0;i<e.inputs.length;i++)if(tx(e.inputs[i].names,s)){if(e.inputs[i].buffer===r)return;e.inputs[i].buffer=r;return}e.inputs.push({buffer:r,stepMode:a,names:s}),e.inputs=e.inputs.sort((i,o)=>i.names[0]<o.names[0]?-1:i.names[0]>o.names[0]?1:0)},t.removeBufferIfPresent=r=>{for(let n=0;n<e.inputs.length;n++)e.inputs[n].names.includes(r)&&e.inputs.splice(n,1)},t.getBuffer=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return e.inputs[n].buffer;return null},t.hasAttribute=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return!0;return!1},t.getAttributeTime=r=>{for(let n=0;n<e.inputs.length;n++)if(e.inputs[n].names.includes(r))return e.inputs[n].buffer.getSourceTime();return 0},t.getShaderCode=()=>{let r="",n=0;for(let a=0;a<e.inputs.length;a++)for(let s=0;s<e.inputs[a].names.length;s++){const i=e.inputs[a].buffer.getArrayInformation()[s],o=pe.getShaderTypeFromBufferFormat(i.format);n>0&&(r+=`,
`),r=`${r}  @location(${n}) ${e.inputs[a].names[s]} : ${o}`,n++}return r},t.getVertexInputInformation=()=>{const r={};if(e.inputs.length){const n=[];let a=0;for(let s=0;s<e.inputs.length;s++){const i=e.inputs[s].buffer,o={arrayStride:i.getStrideInBytes(),stepMode:e.inputs[s].stepMode,attributes:[]},c=i.getArrayInformation();for(let u=0;u<e.inputs[s].names.length;u++)o.attributes.push({shaderLocation:a,offset:c[u].offset,format:c[u].format}),a++;n.push(o)}r.buffers=n}return r},t.bindBuffers=r=>{for(let n=0;n<e.inputs.length;n++)r.setVertexBuffer(n,e.inputs[n].buffer.getHandle());e.indexBuffer&&r.setIndexBuffer(e.indexBuffer.getHandle(),e.indexBuffer.getArrayInformation()[0].format)},t.getReady=()=>{},t.releaseGraphicsResources=()=>{e.created&&(e.inputs=[],e.bindingDescriptions=[],e.attributeDescriptions=[])}}const nx={inputs:null,bindingDescriptions:!1,attributeDescriptions:null,indexBuffer:null};function Ju(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nx,r),ve(t,e),e.bindingDescriptions=[],e.attributeDescriptions=[],e.inputs=[],ue(t,e,["created","device","handle","indexBuffer"]),rx(t,e)}const ax=Z(Ju,"vtkWebGPUVertexInput");var sx={newInstance:ax,extend:Ju};const ix=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  // var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,ox=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::Light::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  // var computedColor:vec4<f32> = vec4<f32>(1.0,0.5,0.5,1.0);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function cx(t,e){e.classHierarchy.push("vtkWebGPUSimpleMapper"),t.generateShaderDescriptions=(r,n,a)=>{const s=Oo.newInstance({type:"vertex",hash:r,code:e.vertexShaderTemplate}),i=Oo.newInstance({type:"fragment",hash:r,code:e.fragmentShaderTemplate}),o=n.getShaderDescriptions();o.push(s),o.push(i);const c=e.vertexShaderTemplate+e.fragmentShaderTemplate,u=new RegExp("//VTK::[^:]*::","g"),f=c.match(u).filter((l,p,y)=>y.indexOf(l)===p).map(l=>`replaceShader${l.substring(7,l.length-2)}`);for(let l=0;l<f.length;l++){const p=f[l];p!=="replaceShaderIOStructs"&&e.shaderReplacements.has(p)&&e.shaderReplacements.get(p)(r,n,a)}t.replaceShaderIOStructs(r,n,a)},t.replaceShaderIOStructs=(r,n,a)=>{const s=n.getShaderDescription("vertex");s.replaceShaderCode(null,a),n.getShaderDescription("fragment").replaceShaderCode(s)},t.replaceShaderRenderEncoder=(r,n,a)=>{e.renderEncoder.replaceShaderCode(n)},e.shaderReplacements.set("replaceShaderRenderEncoder",t.replaceShaderRenderEncoder),t.replaceShaderRenderer=(r,n,a)=>{if(!e.WebGPURenderer)return;const s=e.WebGPURenderer.getBindGroup().getShaderCode(n),i=n.getShaderDescription("vertex");let o=i.getCode();o=H.substitute(o,"//VTK::Renderer::Dec",[s]).result,i.setCode(o);const c=n.getShaderDescription("fragment");o=c.getCode(),o=H.substitute(o,"//VTK::Renderer::Dec",[s]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderRenderer",t.replaceShaderRenderer),t.replaceShaderMapper=(r,n,a)=>{const s=e.bindGroup.getShaderCode(n),i=n.getShaderDescription("vertex");let o=i.getCode();o=H.substitute(o,"//VTK::Mapper::Dec",[s]).result,i.setCode(o);const c=n.getShaderDescription("fragment");c.addBuiltinInput("bool","@builtin(front_facing) frontFacing"),o=c.getCode(),o=H.substitute(o,"//VTK::Mapper::Dec",[s]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderMapper",t.replaceShaderMapper),t.replaceShaderPosition=(r,n,a)=>{const s=n.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let i=s.getCode();i=H.substitute(i,"//VTK::Position::Impl",["    output.Position = rendererUBO.SCPCMatrix*vertexBC;"]).result,s.setCode(i)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderTCoord=(r,n,a)=>{n.getShaderDescription("vertex").addOutput("vec2<f32>","tcoordVS")},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.addTextureView=r=>{e.textureViews.includes(r)||e.textureViews.push(r)},t.prepareToDraw=r=>{e.renderEncoder=r,t.updateInput(),t.updateBuffers(),t.updateBindings(),t.updatePipeline()},t.updateInput=()=>{},t.updateBuffers=()=>{},t.updateBindings=()=>{e.bindGroup.setBindables(t.getBindables())},t.computePipelineHash=()=>{},t.registerDrawCallback=r=>{r.registerDrawCallback(e.pipeline,t.draw)},t.prepareAndDraw=r=>{t.prepareToDraw(r),r.setPipeline(e.pipeline),t.draw(r)},t.draw=r=>{const n=r.getBoundPipeline();r.activateBindGroup(e.bindGroup),e.WebGPURenderer&&e.WebGPURenderer.bindUBO(r),n.bindVertexInput(r,e.vertexInput);const a=e.vertexInput.getIndexBuffer();a?r.drawIndexed(a.getIndexCount(),e.numberOfInstances,0,0,0):r.draw(e.numberOfVertices,e.numberOfInstances,0,0)},t.getBindables=()=>{const r=[...e.additionalBindables];e.UBO&&r.push(e.UBO),e.SSBO&&r.push(e.SSBO);for(let n=0;n<e.textureViews.length;n++){r.push(e.textureViews[n]);const a=e.textureViews[n].getSampler();a&&r.push(a)}return r},t.updatePipeline=()=>{t.computePipelineHash(),e.pipeline=e.device.getPipeline(e.pipelineHash),e.pipeline||(e.pipeline=jT.newInstance(),e.pipeline.setDevice(e.device),e.WebGPURenderer&&e.pipeline.addBindGroupLayout(e.WebGPURenderer.getBindGroup()),e.pipeline.addBindGroupLayout(e.bindGroup),t.generateShaderDescriptions(e.pipelineHash,e.pipeline,e.vertexInput),e.pipeline.setTopology(e.topology),e.pipeline.setRenderEncoder(e.renderEncoder),e.pipeline.setVertexState(e.vertexInput.getVertexInputInformation()),e.device.createPipeline(e.pipelineHash,e.pipeline))}}const fx={additionalBindables:void 0,bindGroup:null,device:null,fragmentShaderTemplate:null,numberOfInstances:1,numberOfVertices:0,pipelineHash:null,shaderReplacements:null,SSBO:null,textureViews:null,topology:"triangle-list",UBO:null,vertexShaderTemplate:null,WebGPURenderer:null};function eg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,fx,r),ae.extend(t,e,r),e.textureViews=[],e.vertexInput=sx.newInstance(),e.bindGroup=Yu.newInstance({label:"mapperBG"}),e.additionalBindables=[],e.fragmentShaderTemplate=e.fragmentShaderTemplate||ox,e.vertexShaderTemplate=e.vertexShaderTemplate||ix,e.shaderReplacements=new Map,E.get(t,e,["pipeline","vertexInput"]),E.setGet(t,e,["additionalBindables","device","fragmentShaderTemplate","interpolate","numberOfInstances","numberOfVertices","pipelineHash","shaderReplacements","SSBO","textureViews","topology","UBO","vertexShaderTemplate","WebGPURenderer"]),cx(t,e)}const ux=E.newInstance(eg,"vtkWebGPUSimpleMapper");var Ks={newInstance:ux,extend:eg};function gx(t,e){e.classHierarchy.push("vtkWebGPUFullScreenQuad"),t.replaceShaderPosition=(r,n,a)=>{const s=n.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),s.addOutput("vec4<f32>","vertexVC");let i=s.getCode();i=H.substitute(i,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);","output.vertexVC = vec4<f32>(vertexBC, 1);"]).result,s.setCode(i)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.updateBuffers=()=>{const r=e.device.getBufferManager().getFullScreenQuadBuffer();e.vertexInput.addBuffer(r,["vertexBC"]),e.numberOfVertices=6}}const lx={};function tg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,lx,r),Ks.extend(t,e,r),gx(t,e)}const px=E.newInstance(tg,"vtkWebGPUFullScreenQuad");var Zt={newInstance:px,extend:tg};const hx={Verts:0,Lines:1,Triangles:2,Strips:3,LinesFromStrips:4,LinesFromTriangles:5,Points:6,UniformArray:7,PointArray:8,NormalsFromPoints:9,Texture:10,RawVertex:11,Storage:12,Index:13},vx={Start:0,Points:0,Lines:1,Triangles:2,TriangleStrips:3,TriangleEdges:4,TriangleStripEdges:5,End:6};var Br={BufferUsage:hx,PrimitiveTypes:vx};const Ua=["getMappedRange","mapAsync","unmap"];function yx(t,e,r,n){const a=n.byteLength,s=t.createBuffer({size:a,usage:GPUBufferUsage.COPY_SRC,mappedAtCreation:!0}),i=s.getMappedRange(0,a);new Uint8Array(i).set(new Uint8Array(n)),s.unmap();const o=t.createCommandEncoder();o.copyBufferToBuffer(s,0,e,r,a);const c=o.finish();t.queue.submit([c]),s.destroy()}function dx(t,e){e.classHierarchy.push("vtkWebGPUBuffer"),t.create=(r,n)=>{e.handle=e.device.getHandle().createBuffer({size:r,usage:n,label:e.label}),e.sizeInBytes=r,e.usage=n},t.write=r=>{yx(e.device.getHandle(),e.handle,0,r.buffer)},t.createAndWrite=(r,n)=>{e.handle=e.device.getHandle().createBuffer({size:r.byteLength,usage:n,mappedAtCreation:!0,label:e.label}),e.sizeInBytes=r.byteLength,e.usage=n,new Uint8Array(e.handle.getMappedRange()).set(new Uint8Array(r.buffer)),e.handle.unmap()};for(let r=0;r<Ua.length;r++)t[Ua[r]]=function(){return e.handle[Ua[r]](...arguments)}}const Tx={device:null,handle:null,sizeInBytes:0,strideInBytes:0,arrayInformation:null,usage:null,label:null,sourceTime:null};function rg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Tx,r),E.obj(t,e),E.get(t,e,["handle","sizeInBytes","usage"]),E.setGet(t,e,["strideInBytes","device","arrayInformation","label","sourceTime"]),dx(t,e)}const xx=E.newInstance(rg);var Jt={newInstance:xx,extend:rg,...Br};const{Representation:Mo}=nr,{PrimitiveTypes:pt}=Br;class Sx{constructor(){this.keys=new Uint32Array(10),this.values=new Uint32Array(10),this.count=0}clear(){this.count=0}has(e){for(let r=0;r<this.count;r++)if(this.keys[r]===e)return!0}get(e){for(let r=0;r<this.count;r++)if(this.keys[r]===e)return this.values[r]}set(e,r){this.count<9&&(this.keys[this.count]=e,this.values[this.count++]=r)}}function Cx(t){switch(t){case pt.Points:return"points";case pt.Lines:return"lines";case pt.Triangles:case pt.TriangleEdges:return"polys";case pt.TriangleStripEdges:case pt.TriangleStrips:return"strips";default:return""}}function Qr(t,e,r){let n=t.pointIdToFlatId[e];return n<0&&(n=t.flatId,t.pointIdToFlatId[e]=n,t.flatIdToPointId[t.flatId]=e,t.flatIdToCellId[t.flatId]=r,t.flatId++),n}function wx(t,e,r){const n=t.length;for(let i=0;i<n;i++){let o=t[i];if(r.cellProvokedMap.has(o)){r.ibo[r.iboId++]=r.cellProvokedMap.get(o);for(let c=i+1;c<i+n;c++){o=t[c%n];const u=Qr(r,o,e);r.ibo[r.iboId++]=u}return}}for(let i=0;i<n;i++){let o=t[i];if(!r.provokedPointIds[o]){let c=Qr(r,o,e);r.provokedPointIds[o]=1,r.cellProvokedMap.set(o,c),r.flatIdToCellId[c]=e,r.ibo[r.iboId++]=c;for(let u=i+1;u<i+n;u++)o=t[u%n],c=Qr(r,o,e),r.ibo[r.iboId++]=c;return}}let a=t[0],s=r.flatId;r.cellProvokedMap.set(a,s),r.flatIdToPointId[r.flatId]=a,r.flatIdToCellId[r.flatId]=e,r.flatId++,r.ibo[r.iboId++]=s;for(let i=1;i<n;i++)a=t[i],s=Qr(r,a,e),r.ibo[r.iboId++]=s}function Ex(t,e,r){const n=t.length;r.iboSize+=n;for(let a=0;a<n;a++){const s=t[a];if(r.cellProvokedMap.has(s))return}for(let a=0;a<n;a++){const s=t[a];if(!r.provokedPointIds[s]){r.provokedPointIds[s]=1,r.cellProvokedMap.set(s,1);return}}r.cellProvokedMap.set(t[0],1),r.extraPoints++}let Ie;const Do=new Uint32Array(1),Me=new Uint32Array(2),ot=new Uint32Array(3),ma={anythingToPoints(t,e,r,n,a){for(let s=0;s<t;++s)Do[0]=e[r+s],Ie(Do,n,a)},linesToWireframe(t,e,r,n,a){for(let s=0;s<t-1;++s)Me[0]=e[r+s],Me[1]=e[r+s+1],Ie(Me,n,a)},polysToWireframe(t,e,r,n,a){if(t>2)for(let s=0;s<t;++s)Me[0]=e[r+s],Me[1]=e[r+(s+1)%t],Ie(Me,n,a)},stripsToWireframe(t,e,r,n,a){if(t>2){for(let s=0;s<t-1;++s)Me[0]=e[r+s],Me[1]=e[r+s+1],Ie(Me,n,a);for(let s=0;s<t-2;s++)Me[0]=e[r+s],Me[1]=e[r+s+2],Ie(Me,n,a)}},polysToSurface(t,e,r,n,a){for(let s=0;s<t-2;s++)ot[0]=e[r],ot[1]=e[r+s+1],ot[2]=e[r+s+2],Ie(ot,n,a)},stripsToSurface(t,e,r,n,a){for(let s=0;s<t-2;s++)ot[0]=e[r+s],ot[1]=e[r+s+1+s%2],ot[2]=e[r+s+1+(s+1)%2],Ie(ot,n,a)}};function Ox(t,e){e.classHierarchy.push("vtkWebGPUIndexBuffer"),t.buildIndexBuffer=r=>{const n=r.cells,a=r.primitiveType,s=r.representation,i=r.cellOffset,o=n.getData(),c=o.length,u=Cx(a),g=r.numberOfPoints,f={provokedPointIds:new Uint8Array(g),extraPoints:0,iboSize:0,flatId:0,iboId:0,cellProvokedMap:new Sx};let l=null;s===Mo.POINTS||a===pt.Points?l=ma.anythingToPoints:s===Mo.WIREFRAME||a===pt.Lines?l=ma[`${u}ToWireframe`]:l=ma[`${u}ToSurface`],Ie=Ex;let p=i||0;for(let y=0;y<c;)f.cellProvokedMap.clear(),l(o[y],o,y+1,p,f),y+=o[y]+1,p++;g<=65535?f.flatIdToPointId=new Uint16Array(g+f.extraPoints):f.flatIdToPointId=new Uint32Array(g+f.extraPoints),g+f.extraPoints<36863?f.pointIdToFlatId=new Int16Array(g):f.pointIdToFlatId=new Int32Array(g),g+f.extraPoints<=65535?(f.ibo=new Uint16Array(f.iboSize),r.format="uint16"):(f.ibo=new Uint32Array(f.iboSize),r.format="uint32"),p<=65535?f.flatIdToCellId=new Uint16Array(g+f.extraPoints):f.flatIdToCellId=new Uint32Array(g+f.extraPoints),f.pointIdToFlatId.fill(-1),f.provokedPointIds.fill(0),Ie=wx,p=i||0;for(let y=0;y<c;)f.cellProvokedMap.clear(),l(o[y],o,y+1,p,f),y+=o[y]+1,p++;delete f.provokedPointIds,delete f.pointIdToFlatId,r.nativeArray=f.ibo,e.flatIdToPointId=f.flatIdToPointId,e.flatIdToCellId=f.flatIdToCellId,e.flatSize=f.flatId,e.indexCount=f.iboId}}const Rx={flatIdToPointId:null,flatIdToCellId:null,flatSize:0,indexCount:0};function ng(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Rx,r),Jt.extend(t,e,r),E.setGet(t,e,["flatIdToPointId","flatIdToCellId","flatSize","indexCount"]),Ox(t,e)}const Mx=E.newInstance(ng);var Dx={newInstance:Mx,extend:ng,...Br};const{BufferUsage:ct}=Br,{vtkErrorMacro:Lx}=Pe,{VtkDataTypes:Mt}=Q,Vx={};function _x(t){let e;switch(t.getDataType()){case Mt.UNSIGNED_CHAR:e="uint8";break;case Mt.FLOAT:e="float32";break;case Mt.UNSIGNED_INT:e="uint32";break;case Mt.INT:e="sint32";break;case Mt.DOUBLE:e="float32";break;case Mt.UNSIGNED_SHORT:e="uint16";break;case Mt.SHORT:e="sin16";break;default:e="float32";break}switch(t.getNumberOfComponents()){case 2:e+="x2";break;case 3:e.includes("32")||Lx(`unsupported x3 type for ${e}`),e+="x3";break;case 4:e+="x4";break}return e}function Lo(t,e,r,n,a){const s={},i=t.getFlatSize();if(!i)return s;let o=[0,0,0,0];a.shift&&(a.shift.length?o=a.shift:o.fill(a.shift));let c=[1,1,1,1];a.scale&&(a.scale.length?c=a.scale:c.fill(a.scale));const u=Object.prototype.hasOwnProperty.call(a,"packExtra")?a.packExtra:!1;let g,f=0;const l=r+(u?1:0),p=tr(n,i*l);let y=t.getFlatIdToPointId();a.cellData&&(y=t.getFlatIdToCellId()),r===1?g=function(v){p[f++]=c[0]*e[v]+o[0]}:r===2?g=function(v){p[f++]=c[0]*e[v]+o[0],p[f++]=c[1]*e[v+1]+o[1]}:r===3&&!u?g=function(v){p[f++]=c[0]*e[v]+o[0],p[f++]=c[1]*e[v+1]+o[1],p[f++]=c[2]*e[v+2]+o[2]}:r===3&&u?g=function(v){p[f++]=c[0]*e[v]+o[0],p[f++]=c[1]*e[v+1]+o[1],p[f++]=c[2]*e[v+2]+o[2],p[f++]=c[3]*1+o[3]}:r===4&&(g=function(v){p[f++]=c[0]*e[v]+o[0],p[f++]=c[1]*e[v+1]+o[1],p[f++]=c[2]*e[v+2]+o[2],p[f++]=c[3]*e[v+3]+o[3]});for(let h=0;h<i;h++){const v=r*y[h];g(v)}return s.nativeArray=p,s}function Bx(t,e,r,n){const a=[t[n*3]-t[r*3],t[n*3+1]-t[r*3+1],t[n*3+2]-t[r*3+2]],s=[t[e*3]-t[r*3],t[e*3+1]-t[r*3+1],t[e*3+2]-t[r*3+2]],i=[];return Or(a,s,i),Rr(i),i}function Fx(t,e){const r=e.getData(),n=t.getData();if(!n||!r)return null;const a=new Int8Array(t.getNumberOfCells()*4),s=n.length;let i=0;for(let o=0;o<s;){const c=Bx(r,n[o+1],n[o+2],n[o+3]);a[i++]=127*c[0],a[i++]=127*c[1],a[i++]=127*c[2],a[i++]=127,o+=n[o]+1}return a}function Ux(t,e){e.classHierarchy.push("vtkWebGPUBufferManager");function r(n){n.dataArray&&!n.nativeArray&&(n.nativeArray=n.dataArray.getData());let a,s;if(n.usage===ct.Index&&(a=Dx.newInstance({label:n.label}),a.setDevice(e.device),s=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,a.buildIndexBuffer(n),a.createAndWrite(n.nativeArray,s),a.setArrayInformation([{format:n.format}])),a||(a=Jt.newInstance({label:n.label}),a.setDevice(e.device)),n.usage===ct.UniformArray&&(s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a.createAndWrite(n.nativeArray,s)),n.usage===ct.Storage&&(s=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,a.createAndWrite(n.nativeArray,s)),n.usage===ct.Texture&&(s=GPUBufferUsage.COPY_SRC,a.createAndWrite(n.nativeArray,s)),n.usage===ct.PointArray){s=GPUBufferUsage.VERTEX;const i=pe.getNativeTypeFromBufferFormat(n.format),o=Lo(n.indexBuffer,n.dataArray.getData(),n.dataArray.getNumberOfComponents(),i,{packExtra:n.packExtra,shift:n.shift,scale:n.scale,cellData:n.cellData,cellOffset:n.cellOffset});a.createAndWrite(o.nativeArray,s),a.setStrideInBytes(pe.getByteStrideFromBufferFormat(n.format)),a.setArrayInformation([{offset:0,format:n.format,interpolation:n.cellData?"flat":"perspective"}])}if(n.usage===ct.NormalsFromPoints){s=GPUBufferUsage.VERTEX;const i=pe.getNativeTypeFromBufferFormat(n.format),o=Fx(n.cells,n.dataArray),c=Lo(n.indexBuffer,o,4,i,{cellData:!0});a.createAndWrite(c.nativeArray,s),a.setStrideInBytes(pe.getByteStrideFromBufferFormat(n.format)),a.setArrayInformation([{offset:0,format:n.format,interpolation:"flat"}])}return n.usage===ct.RawVertex&&(s=GPUBufferUsage.VERTEX,a.createAndWrite(n.nativeArray,s),a.setStrideInBytes(pe.getByteStrideFromBufferFormat(n.format)),a.setArrayInformation([{offset:0,format:n.format}])),a.setSourceTime(n.time),a}t.hasBuffer=n=>e.device.hasCachedObject(n),t.getBuffer=n=>n.hash?e.device.getCachedObject(n.hash,r,n):r(n),t.getBufferForPointArray=(n,a)=>{const s=_x(n),i={hash:`${n.getMTime()}I${a.getMTime()}${s}`,usage:ct.PointArray,format:s,dataArray:n,indexBuffer:a};return t.getBuffer(i)},t.getFullScreenQuadBuffer=()=>{if(e.fullScreenQuadBuffer)return e.fullScreenQuadBuffer;e.fullScreenQuadBuffer=Jt.newInstance(),e.fullScreenQuadBuffer.setDevice(e.device);const n=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]);return e.fullScreenQuadBuffer.createAndWrite(n,GPUBufferUsage.VERTEX),e.fullScreenQuadBuffer.setStrideInBytes(12),e.fullScreenQuadBuffer.setArrayInformation([{offset:0,format:"float32x3"}]),e.fullScreenQuadBuffer}}const mx={device:null,fullScreenQuadBuffer:null};function ag(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,mx,r),ve(t,e),ue(t,e,["device"]),Ux(t,e)}const kx=Z(ag);var xt={newInstance:kx,extend:ag,...Vx,...Br};const{BufferUsage:Nx}=xt,{vtkErrorMacro:zt}=E;function Gx(t,e){e.classHierarchy.push("vtkWebGPUStorageBuffer"),t.addEntry=(r,n)=>{if(e._bufferEntryNames.has(r)){zt(`entry named ${r} already exists`);return}e._bufferEntryNames.set(r,e.bufferEntries.length);const a=pe.getByteStrideFromShaderFormat(n);e.bufferEntries.push({name:r,type:n,sizeInBytes:a,offset:e.sizeInBytes,nativeType:pe.getNativeTypeFromShaderFormat(n)}),e.sizeInBytes+=a},t.send=r=>{if(!e._buffer){const n={nativeArray:e.Float32Array,usage:Nx.Storage,label:e.label};e._buffer=r.getBufferManager().getBuffer(n),e.bindGroupTime.modified(),e._sendTime.modified();return}r.getHandle().queue.writeBuffer(e._buffer.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes*e.numberOfInstances),e._sendTime.modified()},t.createView=r=>{r in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes*e.numberOfInstances)),e[r]=E.newTypedArray(r,e.arrayBuffer))},t.setValue=(r,n,a)=>{const s=e._bufferEntryNames.get(r);if(s===void 0){zt(`entry named ${r} not found in UBO`);return}const i=e.bufferEntries[s];t.createView(i.nativeType);const o=e[i.nativeType];o[(i.offset+n*e.sizeInBytes)/o.BYTES_PER_ELEMENT]=a},t.setArray=(r,n,a)=>{const s=e._bufferEntryNames.get(r);if(s===void 0){zt(`entry named ${r} not found in UBO`);return}const i=e.bufferEntries[s];t.createView(i.nativeType);const o=e[i.nativeType],c=(i.offset+n*e.sizeInBytes)/o.BYTES_PER_ELEMENT;for(let u=0;u<a.length;u++)o[c+u]=a[u]},t.setAllInstancesFromArray=(r,n)=>{const a=e._bufferEntryNames.get(r);if(a===void 0){zt(`entry named ${r} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const i=e[s.nativeType],o=n.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const u=(s.offset+c*e.sizeInBytes)/i.BYTES_PER_ELEMENT;for(let g=0;g<o;g++)i[u+g]=n[c*o+g]}},t.setAllInstancesFromArrayColorToFloat=(r,n)=>{const a=e._bufferEntryNames.get(r);if(a===void 0){zt(`entry named ${r} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const i=e[s.nativeType],o=n.length/e.numberOfInstances;for(let c=0;c<e.numberOfInstances;c++){const u=(s.offset+c*e.sizeInBytes)/i.BYTES_PER_ELEMENT;for(let g=0;g<o;g++)i[u+g]=n[c*o+g]/255}},t.setAllInstancesFromArray3x3To4x4=(r,n)=>{const a=e._bufferEntryNames.get(r);if(a===void 0){zt(`entry named ${r} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const i=e[s.nativeType],o=9;for(let c=0;c<e.numberOfInstances;c++){const u=(s.offset+c*e.sizeInBytes)/i.BYTES_PER_ELEMENT;for(let g=0;g<3;g++)for(let f=0;f<3;f++)i[u+g*4+f]=n[c*o+g*3+f]}},t.getSendTime=()=>e._sendTime.getMTime(),t.getShaderCode=(r,n)=>{const a=[`struct ${e.label}StructEntry
{`];for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];a.push(`  ${i.name}: ${i.type},`)}return a.push(`
};
struct ${e.label}Struct
{
  values: array<${e.label}StructEntry>,
};
@binding(${r}) @group(${n}) var<storage, read> ${e.label}: ${e.label}Struct;
`),a.join(`
`)},t.getBindGroupEntry=()=>({resource:{buffer:e._buffer.getHandle()}}),t.clearData=()=>{e.numberOfInstances=0,e.sizeInBytes=0,e.bufferEntries=[],e._bufferEntryNames=new Map,e._buffer=null,delete e.arrayBuffer,delete e.Float32Array}}const bx={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,numberOfInstances:1};function sg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,bx,r),E.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e._sendTime={},E.obj(e._sendTime,{mtime:0}),e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"read-only-storage"}},E.get(t,e,["bindGroupTime"]),E.setGet(t,e,["device","bindGroupLayoutEntry","label","numberOfInstances","sizeInBytes"]),Gx(t,e)}const $x=E.newInstance(sg,"vtkWebGPUStorageBuffer");var gs={newInstance:$x,extend:sg};const{BufferUsage:Wx}=xt,{vtkErrorMacro:ka}=E;function zx(t,e){e.classHierarchy.push("vtkWebGPUUniformBuffer"),t.addEntry=(r,n)=>{if(e._bufferEntryNames.has(r)){ka(`entry named ${r} already exists`);return}e.sortDirty=!0,e._bufferEntryNames.set(r,e.bufferEntries.length),e.bufferEntries.push({name:r,type:n,sizeInBytes:pe.getByteStrideFromShaderFormat(n),offset:-1,nativeType:pe.getNativeTypeFromShaderFormat(n),packed:!1})},t.sortBufferEntries=()=>{if(!e.sortDirty)return;let r=0;const n=[];let a=4;for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];i.sizeInBytes%16===0&&(a=Math.max(16,a)),i.sizeInBytes%8===0&&(a=Math.max(8,a))}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];i.packed===!1&&i.sizeInBytes%16===0&&(i.packed=!0,i.offset=r,n.push(i),r+=i.sizeInBytes)}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];if(i.packed===!1&&i.sizeInBytes===12)for(let o=0;o<e.bufferEntries.length;o++){const c=e.bufferEntries[o];if(c.packed===!1&&c.sizeInBytes===4){i.packed=!0,i.offset=r,n.push(i),r+=i.sizeInBytes,c.packed=!0,c.offset=r,n.push(c),r+=c.sizeInBytes;break}}}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];if(!i.packed&&i.sizeInBytes%8===0)for(let o=s+1;o<e.bufferEntries.length;o++){const c=e.bufferEntries[o];if(!c.packed&&c.sizeInBytes%8===0){i.packed=!0,i.offset=r,n.push(i),r+=i.sizeInBytes,c.packed=!0,c.offset=r,n.push(c),r+=c.sizeInBytes;break}}}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];if(!i.packed&&i.sizeInBytes%8===0){let o=!1;for(let c=0;!o&&c<e.bufferEntries.length;c++){const u=e.bufferEntries[c];if(!u.packed&&u.sizeInBytes===4)for(let g=c+1;g<e.bufferEntries.length;g++){const f=e.bufferEntries[g];if(!f.packed&&f.sizeInBytes===4){i.packed=!0,i.offset=r,n.push(i),r+=i.sizeInBytes,u.packed=!0,u.offset=r,n.push(u),r+=u.sizeInBytes,f.packed=!0,f.offset=r,n.push(f),r+=f.sizeInBytes,o=!0;break}}}}}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];!i.packed&&i.sizeInBytes>4&&(i.packed=!0,i.offset=r,n.push(i),r+=i.sizeInBytes)}for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];i.packed||(i.packed=!0,i.offset=r,n.push(i),r+=i.sizeInBytes)}e.bufferEntries=n,e._bufferEntryNames.clear();for(let s=0;s<e.bufferEntries.length;s++)e._bufferEntryNames.set(e.bufferEntries[s].name,s);e.sizeInBytes=r,e.sizeInBytes=a*Math.ceil(e.sizeInBytes/a),e.sortDirty=!1},t.sendIfNeeded=r=>{if(!e.UBO){const n={nativeArray:e.Float32Array,usage:Wx.UniformArray,label:e.label};e.UBO=r.getBufferManager().getBuffer(n),e.bindGroupTime.modified(),e.sendDirty=!1}e.sendDirty&&(r.getHandle().queue.writeBuffer(e.UBO.getHandle(),0,e.arrayBuffer,0,e.sizeInBytes),e.sendDirty=!1),e.sendTime.modified()},t.createView=r=>{r in e||(e.arrayBuffer||(e.arrayBuffer=new ArrayBuffer(e.sizeInBytes)),e[r]=E.newTypedArray(r,e.arrayBuffer))},t.setValue=(r,n)=>{t.sortBufferEntries();const a=e._bufferEntryNames.get(r);if(a===void 0){ka(`entry named ${r} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const i=e[s.nativeType];s.lastValue!==n&&(i[s.offset/i.BYTES_PER_ELEMENT]=n,e.sendDirty=!0),s.lastValue=n},t.setArray=(r,n)=>{t.sortBufferEntries();const a=e._bufferEntryNames.get(r);if(a===void 0){ka(`entry named ${r} not found in UBO`);return}const s=e.bufferEntries[a];t.createView(s.nativeType);const i=e[s.nativeType];let o=!1;for(let c=0;c<n.length;c++)(!s.lastValue||s.lastValue[c]!==n[c])&&(i[s.offset/i.BYTES_PER_ELEMENT+c]=n[c],o=!0);o&&(e.sendDirty=!0,s.lastValue=[...n])},t.getBindGroupEntry=()=>({resource:{buffer:e.UBO.getHandle()}}),t.getSendTime=()=>e.sendTime.getMTime(),t.getShaderCode=(r,n)=>{t.sortBufferEntries();const a=[`struct ${e.label}Struct
{`];for(let s=0;s<e.bufferEntries.length;s++){const i=e.bufferEntries[s];a.push(`  ${i.name}: ${i.type},`)}return a.push(`};
@binding(${r}) @group(${n}) var<uniform> ${e.label}: ${e.label}Struct;`),a.join(`
`)}}const Hx={bufferEntries:null,bufferEntryNames:null,sizeInBytes:0,label:null,bindGroupLayoutEntry:null,bindGroupEntry:null};function ig(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Hx,r),E.obj(t,e),e._bufferEntryNames=new Map,e.bufferEntries=[],e.bindGroupLayoutEntry=e.bindGroupLayoutEntry||{buffer:{type:"uniform"}},e.sendTime={},E.obj(e.sendTime,{mtime:0}),e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),e.sendDirty=!0,e.sortDirty=!0,E.get(t,e,["binding","bindGroupTime"]),E.setGet(t,e,["bindGroupLayoutEntry","device","label","sizeInBytes"]),zx(t,e)}const Ax=E.newInstance(ig,"vtkWebGPUUniformBuffer");var kt={newInstance:Ax,extend:ig};const{vtkDebugMacro:jx}=Pe,Vo=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = mapperUBO.BackgroundColor;

  //VTK::RenderEncoder::Impl
  return output;
}
`,Kx=`
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec4<f32> = vec4<f32>(input.vertexVC.xy, -1, 1);
  var V: vec4<f32> = normalize(mapperUBO.FSQMatrix * tcoord); // vec2<f32>((input.tcoordVS.x - 0.5) * 2, -(input.tcoordVS.y - 0.5) * 2);
  // textureSampleLevel gets rid of some ugly artifacts
  var background = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, vecToRectCoord(V.xyz), 0.0);
  var computedColor: vec4<f32> = vec4<f32>(background.rgb, 1);

  //VTK::RenderEncoder::Impl
  return output;
}
`,Zr=new Float64Array(16),_o=new Float64Array(16);function Xx(t){return t.getPositional()?t.getConeAngle()>=90?0:2:1}function Px(t,e){e.classHierarchy.push("vtkWebGPURenderer"),t.buildPass=r=>{if(r){if(!e.renderable)return;e.camera=e.renderable.getActiveCamera(),t.updateLights(),t.prepareNodes(),t.addMissingNode(e.camera),t.addMissingNodes(e.renderable.getViewPropsWithNestedProps()),t.removeUnusedNodes(),e.webgpuCamera=t.getViewNodeFor(e.camera),t.updateStabilizedMatrix()}},t.updateStabilizedMatrix=()=>{const r=e.camera.getClippingRange(),n=e.camera.getPositionByReference(),a=e.camera.getDirectionOfProjectionByReference(),s=[],i=[];ut(i,a,.5*(r[0]+r[1])),lr(s,n,i),Ya(i,s,e.stabilizedCenter),xc(i)/(r[1]-r[0])>e.recenterThreshold&&(e.stabilizedCenter=s,e.stabilizedTime.modified())},t.updateLights=()=>{let r=0;const n=e.renderable.getLightsByReference();for(let a=0;a<n.length;++a)n[a].getSwitch()>0&&r++;return r||(jx("No lights are on, creating one."),e.renderable.createLight()),r},t.updateUBO=()=>{var n;const r=e.UBO.getSendTime();if(e._parent.getMTime()>r||t.getMTime()>r||e.camera.getMTime()>r||e.renderable.getMTime()>r){const a=e.webgpuCamera.getKeyMatrices(t);e.UBO.setArray("WCVCMatrix",a.wcvc),e.UBO.setArray("SCPCMatrix",a.scpc),e.UBO.setArray("PCSCMatrix",a.pcsc),e.UBO.setArray("SCVCMatrix",a.scvc),e.UBO.setArray("VCPCMatrix",a.vcpc),e.UBO.setArray("WCVCNormals",a.normalMatrix),e.UBO.setValue("LightCount",e.renderable.getLights().length),e.UBO.setValue("MaxEnvironmentMipLevel",(n=e.renderable.getEnvironmentTexture())==null?void 0:n.getMipLevel()),e.UBO.setValue("BackgroundDiffuseStrength",e.renderable.getEnvironmentTextureDiffuseStrength()),e.UBO.setValue("BackgroundSpecularStrength",e.renderable.getEnvironmentTextureSpecularStrength());const s=t.getYInvertedTiledSizeAndOrigin();e.UBO.setArray("viewportSize",[s.usize,s.vsize]),e.UBO.setValue("cameraParallel",e.camera.getParallelProjection());const i=e._parent.getDevice();e.UBO.sendIfNeeded(i)}},t.updateSSBO=()=>{const r=e.renderable.getLights(),n=e.webgpuCamera.getKeyMatrices(t);let a=`${e.renderable.getMTime()}`;for(let s=0;s<r.length;s++)a+=r[s].getMTime();if(a!==e.lightTimeString){const s=new Float32Array(r.length*4),i=new Float32Array(r.length*4),o=new Float32Array(r.length*4),c=new Float32Array(r.length*4);for(let g=0;g<r.length;g++){const f=g*4,l=r[g].getPosition();I(l,l,n.wcvc),s[f]=l[0],s[f+1]=l[1],s[f+2]=l[2],s[f+3]=0,i[f]=-r[g].getDirection()[0],i[f+1]=-r[g].getDirection()[1],i[f+2]=-r[g].getDirection()[2],i[f+3]=0,o[f]=r[g].getColor()[0],o[f+1]=r[g].getColor()[1],o[f+2]=r[g].getColor()[2],o[f+3]=r[g].getIntensity()*5,c[f]=Xx(r[g]),c[f+1]=Math.cos(ie(r[g].getConeAngle())),c[f+2]=Math.cos(ie(r[g].getConeAngle()+r[g].getConeFalloff())),c[f+3]=0}e.SSBO.clearData(),e.SSBO.setNumberOfInstances(r.length),e.SSBO.addEntry("LightPos","vec4<f32>"),e.SSBO.addEntry("LightDir","vec4<f32>"),e.SSBO.addEntry("LightColor","vec4<f32>"),e.SSBO.addEntry("LightData","vec4<f32>"),e.SSBO.setAllInstancesFromArray("LightPos",s),e.SSBO.setAllInstancesFromArray("LightDir",i),e.SSBO.setAllInstancesFromArray("LightColor",o),e.SSBO.setAllInstancesFromArray("LightData",c);const u=e._parent.getDevice();e.SSBO.send(u)}e.lightTimeString=a},t.scissorAndViewport=r=>{const n=t.getYInvertedTiledSizeAndOrigin();r.getHandle().setViewport(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize,0,1),r.getHandle().setScissorRect(n.lowerLeftU,n.lowerLeftV,n.usize,n.vsize)},t.bindUBO=r=>{r.activateBindGroup(e.bindGroup)},t.opaquePass=r=>{r?(e.renderEncoder.begin(e._parent.getCommandEncoder()),t.updateUBO(),t.updateSSBO()):(t.scissorAndViewport(e.renderEncoder),t.clear(),e.renderEncoder.end())},t.clear=()=>{var s;if(e.renderable.getTransparent()||e.suppressClear)return;const r=e._parent.getDevice();if(!e.clearFSQ){e.clearFSQ=Zt.newInstance(),e.clearFSQ.setDevice(r),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(Vo);const i=kt.newInstance({label:"mapperUBO"});i.addEntry("FSQMatrix","mat4x4<f32>"),i.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(i),e.backgroundTex=e.renderable.getEnvironmentTexture()}if(e.clearFSQ.getPipelineHash()!=="clearfsqwithtexture"&&e.renderable.getUseEnvironmentTextureAsBackground()&&((s=e.backgroundTex)!=null&&s.getImageLoaded())){e.clearFSQ.setFragmentShaderTemplate(Kx);const i=kt.newInstance({label:"mapperUBO"});i.addEntry("FSQMatrix","mat4x4<f32>"),i.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(i);const o=r.getTextureManager().getTextureForVTKTexture(e.backgroundTex);if(o.getReady()){const c=o.createView("EnvironmentTexture");e.clearFSQ.setTextureViews([c]),e.backgroundTexLoaded=!0;const u=e.backgroundTex.getInterpolate()?"linear":"nearest";c.addSampler(r,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:u,magFilter:u,mipmapFilter:"linear"})}e.clearFSQ.setPipelineHash("clearfsqwithtexture")}else if(e.clearFSQ.getPipelineHash()==="clearfsqwithtexture"&&!e.renderable.getUseEnvironmentTextureAsBackground()){e.clearFSQ=Zt.newInstance(),e.clearFSQ.setDevice(r),e.clearFSQ.setPipelineHash("clearfsq"),e.clearFSQ.setFragmentShaderTemplate(Vo);const i=kt.newInstance({label:"mapperUBO"});i.addEntry("FSQMatrix","mat4x4<f32>"),i.addEntry("BackgroundColor","vec4<f32>"),e.clearFSQ.setUBO(i)}const n=e.webgpuCamera.getKeyMatrices(t),a=e.renderable.getBackgroundByReference();e.clearFSQ.getUBO().setArray("BackgroundColor",a),te(_o,n.normalMatrix),Xa(Zr,n.scvc,n.pcsc),Xa(Zr,_o,Zr),e.clearFSQ.getUBO().setArray("FSQMatrix",Zr),e.clearFSQ.getUBO().sendIfNeeded(r),e.clearFSQ.prepareAndDraw(e.renderEncoder)},t.translucentPass=r=>{r?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.volumeDepthRangePass=r=>{r?e.renderEncoder.begin(e._parent.getCommandEncoder()):(t.scissorAndViewport(e.renderEncoder),e.renderEncoder.end())},t.getAspectRatio=()=>{const r=e._parent.getSizeByReference(),n=e.renderable.getViewportByReference();return r[0]*(n[2]-n[0])/((n[3]-n[1])*r[1])},t.convertToOpenGLDepth=r=>e.webgpuCamera.convertToOpenGLDepth(r),t.getYInvertedTiledSizeAndOrigin=()=>{const r=t.getTiledSizeAndOrigin(),n=e._parent.getSizeByReference();return r.lowerLeftV=n[1]-r.vsize-r.lowerLeftV,r},t.getTiledSizeAndOrigin=()=>{const r=e.renderable.getViewportByReference(),n=[0,0,1,1],a=r[0]-n[0],s=r[1]-n[1],i=e._parent.normalizedDisplayToDisplay(a,s),o=Math.round(i[0]),c=Math.round(i[1]),u=r[2]-n[0],g=r[3]-n[1],f=e._parent.normalizedDisplayToDisplay(u,g);let l=Math.round(f[0])-o,p=Math.round(f[1])-c;return l<0&&(l=0),p<0&&(p=0),{usize:l,vsize:p,lowerLeftU:o,lowerLeftV:c}},t.getPropFromID=r=>{for(let n=0;n<e.children.length;n++)if((e.children[n].getPropID?e.children[n].getPropID():-1)===r)return e.children[n];return null},t.getStabilizedTime=()=>e.stabilizedTime.getMTime(),t.releaseGraphicsResources=()=>{e.selector!==null&&e.selector.releaseGraphicsResources()}}const Yx={bindGroup:null,selector:null,renderEncoder:null,recenterThreshold:20,suppressClear:!1,stabilizedCenter:[0,0,0]};function qx(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Yx,r),ae.extend(t,e,r),e.UBO=kt.newInstance({label:"rendererUBO"}),e.UBO.addEntry("WCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("PCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("SCVCMatrix","mat4x4<f32>"),e.UBO.addEntry("VCPCMatrix","mat4x4<f32>"),e.UBO.addEntry("WCVCNormals","mat4x4<f32>"),e.UBO.addEntry("viewportSize","vec2<f32>"),e.UBO.addEntry("LightCount","i32"),e.UBO.addEntry("MaxEnvironmentMipLevel","f32"),e.UBO.addEntry("BackgroundDiffuseStrength","f32"),e.UBO.addEntry("BackgroundSpecularStrength","f32"),e.UBO.addEntry("cameraParallel","u32"),e.SSBO=gs.newInstance({label:"rendererLightSSBO"}),e.lightTimeString="",e.bindGroup=Yu.newInstance({label:"rendererBG"}),e.bindGroup.setBindables([e.UBO,e.SSBO]),e.tmpMat4=j(new Float64Array(16)),e.stabilizedTime={},ve(e.stabilizedTime,{mtime:0}),Ee(t,e,["bindGroup","stabilizedTime"]),rr(t,e,["stabilizedCenter"]),ue(t,e,["renderEncoder","selector","suppressClear","UBO"]),Px(t,e)}const Ix=Z(qx,"vtkWebGPURenderer");Ye("vtkRenderer",Ix);const{CoordinateSystem:Bo}=_r;function Qx(t,e){e.classHierarchy.push("vtkWebGPUActor"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.getBufferShift=r=>(t.getKeyMatrices(r),e.bufferShift),t.getKeyMatrices=r=>{if(Math.max(e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.renderable.computeMatrix();const n=e.renderable.getMatrix();e.bufferShift[0]=n[3],e.bufferShift[1]=n[7],e.bufferShift[2]=n[11];const a=r.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===Bo.WORLD&&(e.bufferShift[0]-=a[0],e.bufferShift[1]-=a[1],e.bufferShift[2]-=a[2]),te(e.keyMatrices.bcwc,n),e.renderable.getIsIdentity()?j(e.keyMatrices.normalMatrix):(ye(e.keyMatrices.normalMatrix,e.keyMatrices.bcwc),e.keyMatrices.normalMatrix[3]=0,e.keyMatrices.normalMatrix[7]=0,e.keyMatrices.normalMatrix[11]=0,Re(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix),te(e.keyMatrices.normalMatrix,e.keyMatrices.normalMatrix)),oe(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===Bo.WORLD?oe(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-a[0],-a[1],-a[2]]):ye(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const Zx={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function Jx(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Zx,r),ae.extend(t,e,r),e.keyMatricesTime={},E.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},E.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],Qx(t,e)}const eS=E.newInstance(Jx);Ye("vtkActor",eS);const{CoordinateSystem:Fo}=_r;function tS(t,e){e.classHierarchy.push("vtkWebGPUActor2D"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getFirstAncestorOfType("vtkWebGPURenderWindow"),e.propID===void 0&&(e.propID=e.WebGPURenderWindow.getUniquePropID()),t.prepareNodes(),t.addMissingNode(e.renderable.getMapper()),t.removeUnusedNodes())},t.traverseOpaquePass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||!e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.traverseTranslucentPass=r=>{!e.renderable||!e.renderable.getNestedVisibility()||e.renderable.getIsOpaque()||e.WebGPURenderer.getSelector()&&!e.renderable.getNestedPickable()||(t.apply(r,!0),e.children[0]&&e.children[0].traverse(r),t.apply(r,!1))},t.queryPass=(r,n)=>{if(r){if(!e.renderable||!e.renderable.getVisibility())return;e.renderable.getIsOpaque()?n.incrementOpaqueActorCount():n.incrementTranslucentActorCount()}},t.getBufferShift=r=>(t.getKeyMatrices(r),e.bufferShift),t.getKeyMatrices=r=>{if(Math.max(e.renderable.getMTime(),r.getStabilizedTime())>e.keyMatricesTime.getMTime()){e.bufferShift[0]=0,e.bufferShift[1]=0,e.bufferShift[2]=0;const n=r.getStabilizedCenterByReference();e.renderable.getCoordinateSystem()===Fo.WORLD&&(e.bufferShift[0]-=n[0],e.bufferShift[1]-=n[1],e.bufferShift[2]-=n[2]),j(e.keyMatrices.bcwc),j(e.keyMatrices.normalMatrix),oe(e.keyMatrices.bcwc,e.keyMatrices.bcwc,[-e.bufferShift[0],-e.bufferShift[1],-e.bufferShift[2]]),e.renderable.getCoordinateSystem()===Fo.WORLD?oe(e.keyMatrices.bcsc,e.keyMatrices.bcwc,[-n[0],-n[1],-n[2]]):ye(e.keyMatrices.bcsc,e.keyMatrices.bcwc),e.keyMatricesTime.modified()}return e.keyMatrices}}const rS={keyMatricesTime:null,keyMatrices:null,propID:void 0,bufferShift:void 0};function nS(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rS,r),ae.extend(t,e,r),e.keyMatricesTime={},E.obj(e.keyMatricesTime,{mtime:0}),e.keyMatrices={normalMatrix:new Float64Array(16),bcwc:new Float64Array(16),bcsc:new Float64Array(16)},E.get(t,e,["propID","keyMatricesTime"]),e.bufferShift=[0,0,0,0],tS(t,e)}const aS=E.newInstance(nS);Ye("vtkActor2D",aS);function sS(t,e){e.classHierarchy.push("vtkWebGPUCubeAxesActor"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.CubeAxesActorHelper.getRenderable()||e.CubeAxesActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.CubeAxesActorHelper.getTmActor()),t.addMissingNode(e.renderable.getGridActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){const a=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,s=e.WebGPURenderer.getTiledSizeAndOrigin();e.CubeAxesActorHelper.updateAPISpecificData([s.usize,s.vsize],a,e.WebGPURenderWindow.getRenderable())}}}const iS={};function oS(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,iS,r),ae.extend(t,e,r),e.CubeAxesActorHelper=Ru.newCubeAxesActorHelper(),sS(t,e)}const cS=Z(oS,"vtkWebGPUCubeAxesActor");Ye("vtkCubeAxesActor",cS);const{DisplayLocation:ls}=Wu;function fS(t,e){e.classHierarchy.push("vtkProperty2D"),t.setDisplayLocationToBackground=()=>t.setDisplayLocation(ls.BACKGROUND),t.setDisplayLocationToForeground=()=>t.setDisplayLocation(ls.FOREGROUND),t.setRepresentationToWireframe=()=>t.setRepresentation(Le.WIREFRAME),t.setRepresentationToSurface=()=>t.setRepresentation(Le.SURFACE),t.setRepresentationToPoints=()=>t.setRepresentation(Le.POINTS),t.getRepresentationAsString=()=>E.enumToString(Le,e.representation)}const uS={color:[1,1,1],opacity:1,pointSize:1,lineWidth:1,representation:Le.SURFACE,displayLocation:ls.FOREGROUND};function gS(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,uS,r),E.obj(t,e),E.setGet(t,e,["opacity","lineWidth","pointSize","displayLocation","representation"]),E.setGetArray(t,e,["color"],3),fS(t,e)}E.newInstance(gS,"vtkProperty2D");var lS={...Wu};const{BufferUsage:ge,PrimitiveTypes:xe}=xt,{Representation:Jr}=nr,{ScalarMode:en}=rt,{CoordinateSystem:pS}=_r,{DisplayLocation:hS}=lS,vS=`
//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::Normal::Dec

//VTK::TCoord::Dec

//VTK::Select::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@vertex
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : vertexOutput;

  var vertex: vec4<f32> = vertexBC;

  //VTK::Color::Impl

  //VTK::Normal::Impl

  //VTK::TCoord::Impl

  //VTK::Select::Impl

  //VTK::Position::Impl

  return output;
}
`,yS=`
struct PBRData {
  diffuse: vec3<f32>,
  specular: vec3<f32>,
}

// Dot product with the max already in it
fn mdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  return max(0.0, dot(a, b));
}
// Dot product with a max in it that does not allow for negative values
// Physically based rendering is accurate as long as normals are accurate,
// however this is pretty often not the case. In order to prevent negative
// values from ruining light calculations and creating zones of zero light,
// this remapping is used, which smoothly clamps the dot product between
// zero and one while still maintaining a good amount of accuracy.
fn cdot(a: vec3<f32>, b: vec3<f32>) -> f32 {
  var d: f32 = max(0.0, dot(a, b));
  d = pow((d + 1.0) / 2.0, 2.6);
  return d;
}

// Lambertian diffuse model
fn lambertDiffuse(base: vec3<f32>, N: vec3<f32>, L: vec3<f32>) -> vec3<f32> {
  var pi: f32 = 3.14159265359; 
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5);
  return (base/pi)*NdotL;
}

// Yasuhiro Fujii improvement on the Oren-Nayar model
// https://mimosa-pudica.net/improved-oren-nayar.html
// p is surface color, o is roughness
fn fujiiOrenNayar(p: vec3<f32>, o: f32, N: vec3<f32>, L: vec3<f32>, V: vec3<f32>) -> vec3<f32> {
  var invpi: f32 = 0.31830988618; // 1/pi

  var o2 = o*o;
  var NdotL: f32 = mdot(N, L);
  NdotL = pow(NdotL, 1.5); // Less physically accurate, but hides the "seams" between lights better

  var NdotV: f32 = mdot(N, V);
  var LdotV: f32 = mdot(L, V);

  var s: f32 = LdotV - NdotL*NdotV;
  var t: f32 = mix(1.0, max(NdotL, NdotV), step(0.0, s)); // Mix with step is the equivalent of an if statement
  var A: vec3<f32> = 0.5*(o2 / (o2 + 0.33)) + 0.17*p*(o2 / (o2 + 0.13));
  A = invpi*(1 - A);
  var B: f32 = 0.45*(o2 / (o2 + 0.09));
  B = invpi*B;

  return p*NdotL*(A + B*(s/t));
}

// Fresnel portion of BRDF (IOR only, simplified)
fn schlickFresnelIOR(V: vec3<f32>, N: vec3<f32>, ior: f32, k: f32) -> f32 {
  var NdotV: f32 = mdot(V, N);
  var F0: f32 = (pow((ior - 1.0), 2.0) + k*k) / (pow((ior + 1.0), 2.0) + k*k); // This takes into account the roughness, which the other one does not
  return F0 + (1.0 - F0) * pow((1.0-NdotV), 5.0);
}

// Fresnel portion of BRDF (Color ior, better)
fn schlickFresnelRGB(V: vec3<f32>, N: vec3<f32>, F0: vec3<f32>) -> vec3<f32> {
  var NdotV: f32 = mdot(V, N);
  return F0 + (1.0 - F0) * pow((1-NdotV), 5.0);
}

// Normal portion of BRDF
// https://learnopengl.com/PBR/Theory
// Trowbridge-Reitz GGX functions: normal, halfway, roughness^2
fn trGGX(N: vec3<f32>, H: vec3<f32>, a: f32) -> f32 {
  var pi: f32 = 3.14159265359; 

  var a2: f32 = a*a;
  var NdotH = mdot(N, H);
  var NdotH2 = NdotH*NdotH;
  
  var denom: f32 = NdotH2 * (a2 - 1.0) + 1.0;

  return a2 / max((pi*denom*denom), 0.000001);
}

// A VERY bad approximation of anisotropy. Real anisotropic calculations require tangent and bitangent
fn anisotrophicTrGGX(N: vec3<f32>, H: vec3<f32>, O: vec3<f32>, s: f32, a: f32) -> f32 {
  var Op: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(O) * s, 0.)).xyz;

  var ggx1: f32 = trGGX(N + Op*s, H, a);
  var ggx2: f32 = trGGX(N - Op*s, H, a);
  return (0.5 * ggx1 + 0.5 * ggx2);
}

// Geometry portion of BRDF
fn schlickGGX(N: vec3<f32>, X: vec3<f32>, k: f32) -> f32 {
  var NdotX = cdot(N, X);
  return NdotX / max(0.000001, (NdotX*(1.0-k) + k));
}

fn smithSurfaceRoughness(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, k: f32) -> f32 {
  var ggx1: f32 = min(1.0, schlickGGX(N, V, k));
  var ggx2: f32 = min(1.0, schlickGGX(N, L, k));
  return ggx1*ggx2;
}

// BRDF Combination
fn cookTorrance(D: f32, F: f32, G: f32, N: vec3<f32>, V: vec3<f32>, L: vec3<f32>) -> f32 {
  var num: f32 = D*F*G;
  var denom: f32 = 4*cdot(V, N)*cdot(L, N);

  return num / max(denom, 0.000001);
}

// Different lighting calculations for different light sources
fn calcDirectionalLight(N: vec3<f32>, V: vec3<f32>, ior: f32, roughness: f32, metallic: f32, direction: vec3<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {  
  var L: vec3<f32> = normalize(direction); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2;

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L); // Fresnel term is replaced with 1 because it is added later
  var incoming: vec3<f32> = color;
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5);

  var specular: vec3<f32> = brdf*incoming*angle;
  // Oren-Nayar gives a clay-like effect when fully rough which some people may not want, so it might be better to give a separate
  // control property for the diffuse vs specular roughness
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V); 
  // Stores the specular and diffuse separately to allow for finer post processing
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// TODO: find some way to reduce the number of arguments going in here
fn calcPointLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, ior: f32, roughness: f32, metallic: f32, position: vec3<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {
  var L: vec3<f32> = normalize(position - fragPos); // Light Vector
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(position, fragPos);

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  var incoming: vec3<f32> = color * (1.0 / (dist*dist));
  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" bewteen light sources

  var specular: vec3<f32> = brdf*incoming*angle;
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// For a reason unknown to me, spheres dont seem to behave propperly with head-on spot lights
fn calcSpotLight(N: vec3<f32>, V: vec3<f32>, fragPos: vec3<f32>, ior: f32, roughness: f32, metallic: f32, position: vec3<f32>, direction: vec3<f32>, cones: vec2<f32>, color: vec3<f32>, base: vec3<f32>) -> PBRData {
  var L: vec3<f32> = normalize(position - fragPos);
  var H: vec3<f32> = normalize(L + V); // Halfway Vector
  var dist = distance(position, fragPos);

  var alpha = roughness*roughness;
  var k: f32 = alpha*alpha / 2.0; // could also be pow(alpha + 1.0, 2) / 8

  var D: f32 = trGGX(N, H, alpha); // Distribution
  // var F: f32 = schlickFresnelIOR(V, N, ior, k); // Fresnel
  var G: f32 = smithSurfaceRoughness(N, V, L, k); // Geometry

  var brdf: f32 = cookTorrance(D, 1.0, G, N, V, L);
  
  // Cones.x is the inner phi and cones.y is the outer phi
  var theta: f32 = mdot(normalize(direction), L);
  var epsilon: f32 = cones.x - cones.y;
  var intensity: f32 = (theta - cones.y) / epsilon;
  intensity = clamp(intensity, 0.0, 1.0);
  intensity /= dist*dist;

  var incoming: vec3<f32> = color * intensity;

  var angle: f32 = mdot(L, N);
  angle = pow(angle, 1.5); // Smoothing factor makes it less accurate, but reduces ugly "seams" bewteen light sources

  var specular: vec3<f32> = brdf*incoming*angle;
  var diffuse: vec3<f32> = incoming*fujiiOrenNayar(base, roughness, N, L, V);

  // Stores the specular and diffuse separately to allow for finer post processing
  // Could also be done (propably more properly) with a struct
  var out = PBRData(diffuse, specular);
  
  return out; // Returns angle along with color of light so the final color can be multiplied by angle as well (creates black areas)
}

// Environment mapping stuff
// Takes in a vector and converts it to an equivalent coordinate in a rectilinear texture. Should be replaced with cubemaps at some point
fn vecToRectCoord(dir: vec3<f32>) -> vec2<f32> {
  var tau: f32 = 6.28318530718;
  var pi: f32 = 3.14159265359;
  var out: vec2<f32> = vec2<f32>(0.0);

  out.x = atan2(dir.z, dir.x) / tau;
  out.x += 0.5;

  var phix: f32 = length(vec2(dir.x, dir.z));
  out.y = atan2(dir.y, phix) / pi + 0.5;

  return out;
}

//VTK::Renderer::Dec

//VTK::Color::Dec

//VTK::TCoord::Dec

// optional surface normal declaration
//VTK::Normal::Dec

//VTK::Select::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  // Temporary ambient, diffuse, and opacity
  var ambientColor: vec4<f32> = mapperUBO.AmbientColor;
  var diffuseColor: vec4<f32> = mapperUBO.DiffuseColor;
  var opacity: f32 = mapperUBO.Opacity;

  // This should be declared somewhere else
  var _diffuseMap: vec4<f32> = vec4<f32>(1.0);
  var _roughnessMap: vec4<f32> = vec4<f32>(1.0);
  var _metallicMap: vec4<f32> = vec4<f32>(1.0);
  var _normalMap: vec4<f32> = vec4<f32>(0.0, 0.0, 1.0, 0.0); // normal map was setting off the normal vector detection in fragment
  var _ambientOcclusionMap: vec4<f32> = vec4<f32>(1.);
  var _emissionMap: vec4<f32> = vec4<f32>(0.);

  //VTK::Color::Impl

  //VTK::TCoord::Impl

  //VTK::Normal::Impl

  var computedColor: vec4<f32> = vec4<f32>(diffuseColor.rgb, 1.0);

  //VTK::Light::Impl

  //VTK::Select::Impl

  if (computedColor.a == 0.0) { discard; };

  //VTK::Position::Impl

  //VTK::RenderEncoder::Impl

  return output;
}
`;function Uo(t){return t.indexOf("edge")>=0}function dS(t,e){e.classHierarchy.push("vtkWebGPUCellArrayMapper"),t.buildPass=r=>{r&&(e.is2D?(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.forceZValue=!0):(e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.forceZValue=!1),e.coordinateSystem=e.WebGPUActor.getRenderable().getCoordinateSystem(),e.useRendererMatrix=e.coordinateSystem!==pS.DISPLAY,e.WebGPURenderer=e.WebGPUActor.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.device=e.WebGPURenderWindow.getDevice())},t.translucentPass=r=>{r&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.opaquePass=r=>{r&&(t.prepareToDraw(e.WebGPURenderer.getRenderEncoder()),e.renderEncoder.registerDrawCallback(e.pipeline,t.draw))},t.updateUBO=()=>{var s;const n=e.WebGPUActor.getRenderable().getProperty(),a=e.UBO.getSendTime();if(t.getMTime()>a||n.getMTime()>a||e.renderable.getMTime()>a){const i=e.WebGPUActor.getKeyMatrices(e.WebGPURenderer);if(e.UBO.setArray("BCWCMatrix",i.bcwc),e.UBO.setArray("BCSCMatrix",i.bcsc),e.UBO.setArray("MCWCNormals",i.normalMatrix),e.is2D){e.UBO.setValue("ZValue",e.WebGPUActor.getRenderable().getProperty().getDisplayLocation()===hS.FOREGROUND?1:0);const u=n.getColorByReference();e.UBO.setValue("AmbientIntensity",1),e.UBO.setArray("DiffuseColor",[u[0],u[1],u[2],1]),e.UBO.setValue("DiffuseIntensity",0),e.UBO.setValue("SpecularIntensity",0)}else{let u=n.getAmbientColorByReference();e.UBO.setValue("AmbientIntensity",n.getAmbient()),e.UBO.setArray("AmbientColor",[u[0],u[1],u[2],1]),e.UBO.setValue("DiffuseIntensity",n.getDiffuse()),u=n.getDiffuseColorByReference(),e.UBO.setArray("DiffuseColor",[u[0],u[1],u[2],1]),e.UBO.setValue("Roughness",n.getRoughness()),e.UBO.setValue("BaseIOR",n.getBaseIOR()),e.UBO.setValue("Metallic",n.getMetallic()),e.UBO.setValue("NormalStrength",n.getNormalStrength()),e.UBO.setValue("Emission",n.getEmission()),e.UBO.setValue("SpecularIntensity",n.getSpecular()),u=n.getSpecularColorByReference(),e.UBO.setArray("SpecularColor",[u[0],u[1],u[2],1])}const o=(s=n.getEdgeColorByReference)==null?void 0:s.call(n);o&&e.UBO.setArray("EdgeColor",[o[0],o[1],o[2],1]),e.UBO.setValue("LineWidth",n.getLineWidth()),e.UBO.setValue("Opacity",n.getOpacity()),e.UBO.setValue("PropID",e.WebGPUActor.getPropID());const c=e.WebGPURenderWindow.getDevice();e.UBO.sendIfNeeded(c)}},t.haveWideLines=()=>{const r=e.WebGPUActor.getRenderable(),n=r.getProperty().getRepresentation();return r.getProperty().getLineWidth()<=1||e.primitiveType===xe.Verts?!1:e.primitiveType===xe.Triangles||e.primitiveType===xe.TriangleStrips?n===Jr.WIREFRAME:!0},t.replaceShaderPosition=(r,n,a)=>{const s=n.getShaderDescription("vertex");s.addBuiltinOutput("vec4<f32>","@builtin(position) Position"),s.hasOutput("vertexVC")||s.addOutput("vec4<f32>","vertexVC");let i=s.getCode();e.useRendererMatrix?(i=H.substitute(i,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = rendererUBO.SCPCMatrix*mapperUBO.BCSCMatrix*vertexBC;","    output.vertexVC = rendererUBO.SCVCMatrix * mapperUBO.BCSCMatrix * vec4<f32>(vertexBC.xyz, 1.0);","//VTK::Position::Impl"]).result,e.forceZValue&&(i=H.substitute(i,"//VTK::Position::Impl",["pCoord = vec4<f32>(pCoord.xyz/pCoord.w, 1.0);","pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)):(i=H.substitute(i,"//VTK::Position::Impl",["    var pCoord: vec4<f32> = mapperUBO.BCSCMatrix*vertexBC;","    pCoord.x = 2.0* pCoord.x / rendererUBO.viewportSize.x - 1.0;","    pCoord.y = 2.0* pCoord.y / rendererUBO.viewportSize.y - 1.0;","    pCoord.z = 0.5 - 0.5 * pCoord.z;","//VTK::Position::Impl"]).result,e.forceZValue&&(i=H.substitute(i,"//VTK::Position::Impl",["    pCoord.z = mapperUBO.ZValue;","//VTK::Position::Impl"]).result)),t.haveWideLines()&&(s.addBuiltinInput("u32","@builtin(instance_index) instanceIndex"),i=H.substitute(i,"//VTK::Position::Impl",["    var tmpPos: vec4<f32> = pCoord;","    var numSteps: f32 = ceil(mapperUBO.LineWidth - 1.0);","    var offset: f32 = (mapperUBO.LineWidth - 1.0) * (f32(input.instanceIndex / 2u) - numSteps/2.0) / numSteps;","    var tmpPos2: vec3<f32> = tmpPos.xyz / tmpPos.w;","    tmpPos2.x = tmpPos2.x + 2.0 * (f32(input.instanceIndex) % 2.0) * offset / rendererUBO.viewportSize.x;","    tmpPos2.y = tmpPos2.y + 2.0 * (f32(input.instanceIndex + 1u) % 2.0) * offset / rendererUBO.viewportSize.y;","    tmpPos2.z = min(1.0, tmpPos2.z + 0.00001);","    pCoord = vec4<f32>(tmpPos2.xyz * tmpPos.w, tmpPos.w);","//VTK::Position::Impl"]).result),i=H.substitute(i,"//VTK::Position::Impl",["    output.Position = pCoord;"]).result,s.setCode(i)},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderNormal=(r,n,a)=>{const s=a.getBuffer("normalMC"),i=e.WebGPUActor.getRenderable();if(s){const o=n.getShaderDescription("vertex");o.hasOutput("normalVC")||o.addOutput("vec3<f32>","normalVC",s.getArrayInformation()[0].interpolation),o.hasOutput("tangentVC")||o.addOutput("vec3<f32>","tangentVC",s.getArrayInformation()[0].interpolation),o.hasOutput("bitangentVC")||o.addOutput("vec3<f32>","bitangentVC",s.getArrayInformation()[0].interpolation);let c=o.getCode();c=H.substitute(c,"//VTK::Normal::Impl",["  output.normalVC = normalize((rendererUBO.WCVCNormals * mapperUBO.MCWCNormals * normalMC).xyz);","  var c1: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 0, 1));","  var c2: vec3<f32> = cross(output.normalVC, vec3<f32>(0, 1, 0));","  var tangent: vec3<f32> = mix(c1, c2, distance(c1, c2));","  output.tangentVC = normalize(tangent);","  output.bitangentVC = normalize(cross(output.normalVC, tangent));"]).result,o.setCode(c);const u=n.getShaderDescription("fragment");c=u.getCode(),i.getProperty().getNormalTexture()?c=H.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  var tangent: vec3<f32> = input.tangentVC;","  var bitangent: vec3<f32> = input.bitangentVC;","  var TCVCMatrix: mat3x3<f32> = mat3x3<f32>(","    tangent.x, bitangent.x, normal.x,","    tangent.y, bitangent.y, normal.y,","    tangent.z, bitangent.z, normal.z,","  );","  var mappedNormal: vec3<f32> = TCVCMatrix * (_normalMap.xyz * 2 - 1);","  normal = mix(normal, mappedNormal, mapperUBO.NormalStrength);","  normal = normalize(normal);"]).result:c=H.substitute(c,"//VTK::Normal::Impl",["  var normal: vec3<f32> = input.normalVC;","  if (!input.frontFacing) { normal = -normal; }","  normal = normalize(normal);"]).result,u.setCode(c)}},e.shaderReplacements.set("replaceShaderNormal",t.replaceShaderNormal),t.replaceShaderLight=(r,n,a)=>{var u;if(r.includes("sel"))return;const s=n.getShaderDescription("vertex");s.hasOutput("vertexVC")||s.addOutput("vec4<f32>","vertexVC");const i=e.WebGPURenderer.getRenderable(),o=n.getShaderDescription("fragment");let c=o.getCode();if(c.includes("var normal:")&&e.useRendererMatrix&&!Uo(r)&&!e.is2D&&!r.includes("sel")){const g=["  var pi: f32 = 3.14159265359;","  var fragPos: vec3<f32> = vec3<f32>(input.vertexVC.xyz);","  var V: vec3<f32> = mix(normalize(-fragPos), vec3<f32>(0, 0, 1), f32(rendererUBO.cameraParallel)); // View Vector","  var baseColor: vec3<f32> = _diffuseMap.rgb * diffuseColor.rgb;","  var roughness: f32 = max(0.000001, mapperUBO.Roughness * _roughnessMap.r);","  var metallic: f32 = mapperUBO.Metallic * _metallicMap.r;","  var alpha: f32 = roughness*roughness;","  var ior: f32 = mapperUBO.BaseIOR;","  var k: f32 = alpha*alpha / 2;","  var diffuse: vec3<f32> = vec3<f32>(0.);","  var specular: vec3<f32> = vec3<f32>(0.);","  var emission: vec3<f32> = _emissionMap.rgb * mapperUBO.Emission;","  {","    var i: i32 = 0;","    loop {","      if !(i < rendererUBO.LightCount) { break; }","      switch (i32(rendererLightSSBO.values[i].LightData.x)) {","         // Point Light","         case 0 {","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var pos: vec3<f32> = (rendererLightSSBO.values[i].LightPos).xyz;","           var calculated: PBRData = calcPointLight(normal, V, fragPos, ior, roughness, metallic, pos, color, baseColor);","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","          }","         // Directional light","         case 1 {","           var dir: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz;","           dir = normalize(dir);","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var calculated: PBRData = calcDirectionalLight(normal, V, ior, roughness, metallic, dir, color, baseColor); // diffuseColor.rgb needs to be fixed with a more dynamic diffuse color","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","         }","         // Spot Light","         case 2 {","           var color: vec3<f32> = rendererLightSSBO.values[i].LightColor.rgb * rendererLightSSBO.values[i].LightColor.w;","           var pos: vec3<f32> = (rendererLightSSBO.values[i].LightPos).xyz;","           var dir: vec3<f32> = (rendererUBO.WCVCNormals * vec4<f32>(normalize(rendererLightSSBO.values[i].LightDir.xyz), 0.)).xyz;","           dir = normalize(dir);","           var cones: vec2<f32> = vec2<f32>(rendererLightSSBO.values[i].LightData.y, rendererLightSSBO.values[i].LightData.z);","           var calculated: PBRData = calcSpotLight(normal, V, fragPos, ior, roughness, metallic, pos, dir, cones, color, baseColor);","           diffuse += max(vec3<f32>(0), calculated.diffuse);","           specular += max(vec3<f32>(0), calculated.specular);","         }","         default { continue; }","       }","      continuing { i++; }","    }","  }","  var fresnel: f32 = schlickFresnelIOR(V, normal, ior, k); // Fresnel","  fresnel = min(1.0, fresnel);","  // This could be controlled with its own variable (that isnt base color) for better artistic control","  var fresnelMetallic: vec3<f32> = schlickFresnelRGB(V, normal, baseColor); // Fresnel for metal, takes color into account","  var kS: vec3<f32> = mix(vec3<f32>(fresnel), fresnelMetallic, metallic);","  kS = min(vec3<f32>(1.0), kS);","  var kD: vec3<f32> = (1.0 - kS) * (1.0 - metallic);","  var PBR: vec3<f32> = mapperUBO.DiffuseIntensity*kD*diffuse + kS*specular;","  PBR += emission;","  computedColor = vec4<f32>(PBR, mapperUBO.Opacity);"];(u=i.getEnvironmentTexture())!=null&&u.getImageLoaded()&&g.push("  // To get diffuse IBL, the texture is sampled with normals in worldspace","  var diffuseIBLCoords: vec3<f32> = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(normal, 1.)).xyz;","  var diffuseCoords: vec2<f32> = vecToRectCoord(diffuseIBLCoords);","  // To get specular IBL, the texture is sampled as the worldspace reflection between the normal and view vectors","  // Reflections are first calculated in viewspace, then converted to worldspace to sample the environment","  var VreflN: vec3<f32> = normalize(reflect(-V, normal));","  var reflectionIBLCoords = (transpose(rendererUBO.WCVCNormals) * vec4<f32>(VreflN, 1.)).xyz;","  var specularCoords: vec2<f32> = vecToRectCoord(reflectionIBLCoords);","  var diffuseIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, diffuseCoords, rendererUBO.MaxEnvironmentMipLevel);","  var level = roughness * rendererUBO.MaxEnvironmentMipLevel;","  var specularIBL = textureSampleLevel(EnvironmentTexture, EnvironmentTextureSampler, specularCoords, level);","  var specularIBLContribution: vec3<f32> = specularIBL.rgb*rendererUBO.BackgroundSpecularStrength;","  computedColor += vec4<f32>(specularIBLContribution*kS, 0);","  var diffuseIBLContribution: vec3<f32> = diffuseIBL.rgb*rendererUBO.BackgroundDiffuseStrength;","  diffuseIBLContribution *= baseColor * _ambientOcclusionMap.rgb;","  computedColor += vec4<f32>(diffuseIBLContribution*kD, 0);"),c=H.substitute(c,"//VTK::Light::Impl",g).result,o.setCode(c)}else c=H.substitute(c,"//VTK::Light::Impl",["  var diffuse: vec3<f32> = diffuseColor.rgb;","  var specular: vec3<f32> = mapperUBO.SpecularColor.rgb * mapperUBO.SpecularColor.a;","  computedColor = vec4<f32>(diffuse * _diffuseMap.rgb, mapperUBO.Opacity);"]).result,o.setCode(c)},e.shaderReplacements.set("replaceShaderLight",t.replaceShaderLight),t.replaceShaderColor=(r,n,a)=>{if(Uo(r)){const u=n.getShaderDescription("fragment");let g=u.getCode();g=H.substitute(g,"//VTK::Color::Impl",["ambientColor = mapperUBO.EdgeColor;","diffuseColor = mapperUBO.EdgeColor;"]).result,u.setCode(g);return}const s=a.getBuffer("colorVI");if(!s)return;const i=n.getShaderDescription("vertex");i.addOutput("vec4<f32>","color",s.getArrayInformation()[0].interpolation);let o=i.getCode();o=H.substitute(o,"//VTK::Color::Impl",["  output.color = colorVI;"]).result,i.setCode(o);const c=n.getShaderDescription("fragment");o=c.getCode(),o=H.substitute(o,"//VTK::Color::Impl",["ambientColor = input.color;","diffuseColor = input.color;","opacity = mapperUBO.Opacity * input.color.a;"]).result,c.setCode(o)},e.shaderReplacements.set("replaceShaderColor",t.replaceShaderColor),t.replaceShaderTCoord=(r,n,a)=>{var p,y,h,v,x,S,d,T,w,C,O,R,L,M,D,V,B,_,k,G;if(!a.hasAttribute("tcoord"))return;const s=n.getShaderDescription("vertex"),i=a.getBuffer("tcoord"),o=pe.getNumberOfComponentsFromBufferFormat(i.getArrayInformation()[0].format);let c=s.getCode();s.addOutput(`vec${o}<f32>`,"tcoordVS"),c=H.substitute(c,"//VTK::TCoord::Impl",["  output.tcoordVS = tcoord;"]).result,s.setCode(c);const u=n.getShaderDescription("fragment");c=u.getCode();const g=e.WebGPUActor.getRenderable(),f=b=>b?b.getDimensionality()===o:!1,l=[];((h=(y=(p=g.getProperty()).getDiffuseTexture)==null?void 0:y.call(p))!=null&&h.getImageLoaded()||g.getTextures()[0]||e.colorTexture)&&(f((x=(v=g.getProperty()).getDiffuseTexture)==null?void 0:x.call(v))||f(g.getTextures()[0])||f(e.colorTexture))&&l.push("_diffuseMap = textureSample(DiffuseTexture, DiffuseTextureSampler, input.tcoordVS);"),(T=(d=(S=g.getProperty()).getRoughnessTexture)==null?void 0:d.call(S))!=null&&T.getImageLoaded()&&f(g.getProperty().getRoughnessTexture())&&l.push("_roughnessMap = textureSample(RoughnessTexture, RoughnessTextureSampler, input.tcoordVS);"),(O=(C=(w=g.getProperty()).getMetallicTexture)==null?void 0:C.call(w))!=null&&O.getImageLoaded()&&f(g.getProperty().getMetallicTexture())&&l.push("_metallicMap = textureSample(MetallicTexture, MetallicTextureSampler, input.tcoordVS);"),(M=(L=(R=g.getProperty()).getNormalTexture)==null?void 0:L.call(R))!=null&&M.getImageLoaded()&&f(g.getProperty().getNormalTexture())&&l.push("_normalMap = textureSample(NormalTexture, NormalTextureSampler, input.tcoordVS);"),(B=(V=(D=g.getProperty()).getAmbientOcclusionTexture)==null?void 0:V.call(D))!=null&&B.getImageLoaded()&&f(g.getProperty().getAmbientOcclusionTexture())&&l.push("_ambientOcclusionMap = textureSample(AmbientOcclusionTexture, AmbientOcclusionTextureSampler, input.tcoordVS);"),(G=(k=(_=g.getProperty()).getEmissionTexture)==null?void 0:k.call(_))!=null&&G.getImageLoaded()&&f(g.getProperty().getEmissionTexture())&&l.push("_emissionMap = textureSample(EmissionTexture, EmissionTextureSampler, input.tcoordVS);"),c=H.substitute(c,"//VTK::TCoord::Impl",l).result,u.setCode(c)},e.shaderReplacements.set("replaceShaderTCoord",t.replaceShaderTCoord),t.replaceShaderSelect=(r,n,a)=>{if(r.includes("sel")){const s=n.getShaderDescription("fragment");let i=s.getCode();i=H.substitute(i,"//VTK::Select::Impl",["  var compositeID: u32 = 0u;"]).result,s.setCode(i)}},e.shaderReplacements.set("replaceShaderSelect",t.replaceShaderSelect),t.getUsage=(r,n)=>r===Jr.POINTS||n===xe.Points?ge.Verts:n===xe.Lines?ge.Lines:r===Jr.WIREFRAME?n===xe.Triangles?ge.LinesFromTriangles:ge.LinesFromStrips:n===xe.Triangles?ge.Triangles:n===xe.TriangleStrips?ge.Strips:n===xe.TriangleEdges?ge.LinesFromTriangles:ge.LinesFromStrips,t.getHashFromUsage=r=>`pt${r}`,t.getTopologyFromUsage=r=>{switch(r){case ge.Triangles:return"triangle-list";case ge.Verts:return"point-list";case ge.Lines:default:return"line-list"}},t.buildVertexInput=()=>{var h,v;const r=e.currentInput,n=e.cellArray,a=e.primitiveType;let i=e.WebGPUActor.getRenderable().getProperty().getRepresentation();const o=e.WebGPURenderWindow.getDevice();let c=!1;a===xe.TriangleEdges&&(c=!0,i=Jr.WIREFRAME);const u=e.vertexInput,g=r.getPoints();let f;if(n){const x={hash:`R${i}P${a}${n.getMTime()}`,usage:ge.Index,cells:n,numberOfPoints:g.getNumberOfPoints(),primitiveType:a,representation:i};f=o.getBufferManager().getBuffer(x),u.setIndexBuffer(f)}else u.setIndexBuffer(null);if(g){const x=e.WebGPUActor.getBufferShift(e.WebGPURenderer),S={hash:`${g.getMTime()}I${f.getMTime()}${x.join()}float32x4`,usage:ge.PointArray,format:"float32x4",dataArray:g,indexBuffer:f,shift:x,packExtra:!0},d=o.getBufferManager().getBuffer(S);u.addBuffer(d,["vertexBC"])}else u.removeBufferIfPresent("vertexBC");const l=t.getUsage(i,a);if(e._usesCellNormals=!1,!e.is2D&&(l===ge.Triangles||l===ge.Strips)){const x=r.getPointData().getNormals(),S={format:"snorm8x4",indexBuffer:f,packExtra:!0,shift:0,scale:127};if(x){S.hash=`${x.getMTime()}I${f.getMTime()}snorm8x4`,S.dataArray=x,S.usage=ge.PointArray;const d=o.getBufferManager().getBuffer(S);u.addBuffer(d,["normalMC"])}else if(a===xe.Triangles){e._usesCellNormals=!0,S.hash=`PFN${g.getMTime()}I${f.getMTime()}snorm8x4`,S.dataArray=g,S.cells=n,S.usage=ge.NormalsFromPoints;const d=o.getBufferManager().getBuffer(S);u.addBuffer(d,["normalMC"])}else u.removeBufferIfPresent("normalMC")}else u.removeBufferIfPresent("normalMC");let p=!1;if(e.renderable.getScalarVisibility()){const x=e.renderable.getColorMapColors();if(x&&!c){const S=e.renderable.getScalarMode();let d=!1;(S===en.USE_CELL_DATA||S===en.USE_CELL_FIELD_DATA||S===en.USE_FIELD_DATA||!r.getPointData().getScalars())&&S!==en.USE_POINT_FIELD_DATA&&x&&(d=!0);const T={usage:ge.PointArray,format:"unorm8x4",hash:`${d}${x.getMTime()}I${f.getMTime()}unorm8x4`,dataArray:x,indexBuffer:f,cellData:d,cellOffset:0},w=o.getBufferManager().getBuffer(T);u.addBuffer(w,["colorVI"]),p=!0}}p||u.removeBufferIfPresent("colorVI");let y=null;if((v=(h=e.renderable).getInterpolateScalarsBeforeMapping)!=null&&v.call(h)&&e.renderable.getColorCoordinates()?y=e.renderable.getColorCoordinates():y=r.getPointData().getTCoords(),y&&!c){const x=o.getBufferManager().getBufferForPointArray(y,u.getIndexBuffer());u.addBuffer(x,["tcoord"])}else u.removeBufferIfPresent("tcoord")},t.updateTextures=()=>{var c,u,g,f,l,p,y,h,v,x,S,d,T,w,C;const r=[],n=[],a=(u=(c=e.renderable).getColorTextureMap)==null?void 0:u.call(c);a&&(e.colorTexture||(e.colorTexture=Yn.newInstance({label:"polyDataColor"})),e.colorTexture.setInputData(a),n.push(["Diffuse",e.colorTexture]));const s=e.WebGPUActor.getRenderable(),i=e.WebGPURenderer.getRenderable(),o=[];if((f=(g=s.getProperty()).getDiffuseTexture)!=null&&f.call(g)){const O=["Diffuse",s.getProperty().getDiffuseTexture()];o.push(O)}if(s.getTextures()[0]){const O=["Diffuse",s.getTextures()[0]];o.push(O)}if(e.colorTexture){const O=["Diffuse",e.colorTexture];o.push(O)}if((p=(l=s.getProperty()).getRoughnessTexture)!=null&&p.call(l)){const O=["Roughness",s.getProperty().getRoughnessTexture()];o.push(O)}if((h=(y=s.getProperty()).getMetallicTexture)!=null&&h.call(y)){const O=["Metallic",s.getProperty().getMetallicTexture()];o.push(O)}if((x=(v=s.getProperty()).getNormalTexture)!=null&&x.call(v)){const O=["Normal",s.getProperty().getNormalTexture()];o.push(O)}if((d=(S=s.getProperty()).getAmbientOcclusionTexture)!=null&&d.call(S)){const O=["AmbientOcclusion",s.getProperty().getAmbientOcclusionTexture()];o.push(O)}if((w=(T=s.getProperty()).getEmissionTexture)!=null&&w.call(T)){const O=["Emission",s.getProperty().getEmissionTexture()];o.push(O)}if((C=i.getEnvironmentTexture)!=null&&C.call(i)){const O=["Environment",i.getEnvironmentTexture()];o.push(O)}for(let O=0;O<o.length;O++)(o[O][1].getInputData()||o[O][1].getJsImageData()||o[O][1].getCanvas())&&n.push(o[O]),o[O][1].getImage()&&o[O][1].getImageLoaded()&&n.push(o[O]);for(let O=0;O<n.length;O++){const R=n[O][1],L=n[O][0],M=e.device.getTextureManager().getTextureForVTKTexture(R);if(M.getReady()){let D=!1;for(let V=0;V<e.textures.length;V++)e.textures[V]===M&&(D=!0,r[V]=!0);if(!D){r[e.textures.length]=!0;const V=M.createView(`${L}Texture`);e.textures.push(M),e.textureViews.push(V);const B=R.getInterpolate()?"linear":"nearest";let _=null;!_&&R.getEdgeClamp()&&R.getRepeat()&&(_="mirror-repeat"),!_&&R.getEdgeClamp()&&(_="clamp-to-edge"),!_&&R.getRepeat()&&(_="repeat"),L!=="Environment"?V.addSampler(e.device,{addressModeU:_,addressModeV:_,addressModeW:_,minFilter:B,magFilter:B}):V.addSampler(e.device,{addressModeU:"repeat",addressModeV:"clamp-to-edge",addressModeW:"repeat",minFilter:B,magFilter:B,mipmapFilter:"linear"})}}}for(let O=e.textures.length-1;O>=0;O--)r[O]||(e.textures.splice(O,1),e.textureViews.splice(O,1))},t.computePipelineHash=()=>{let r=`pd${e.useRendererMatrix?"r":""}${e.forceZValue?"z":""}`;if(e.primitiveType===xe.TriangleEdges||e.primitiveType===xe.TriangleStripEdges)r+="edge";else{if(e.vertexInput.hasAttribute("normalMC")&&(r+="n"),e.vertexInput.hasAttribute("colorVI")&&(r+="c"),e.vertexInput.hasAttribute("tcoord")){const a=e.vertexInput.getBuffer("tcoord"),s=pe.getNumberOfComponentsFromBufferFormat(a.getArrayInformation()[0].format);r+=`t${s}`}e.textures.length&&(r+=`tx${e.textures.length}`)}e._usesCellNormals&&(r+="cn"),e.SSBO&&(r+="ssbo");const n=t.getHashFromUsage(e.usage);r+=n,r+=e.renderEncoder.getPipelineHash(),e.pipelineHash=r},t.updateBuffers=()=>{e.primitiveType!==xe.TriangleEdges&&e.primitiveType!==xe.TriangleStripEdges&&t.updateTextures();const r=e.WebGPUActor.getRenderable(),n=r.getProperty().getRepresentation();e.usage=t.getUsage(n,e.primitiveType),t.buildVertexInput();const a=e.vertexInput.getBuffer("vertexBC");if(t.setNumberOfVertices(a.getSizeInBytes()/a.getStrideInBytes()),t.setTopology(t.getTopologyFromUsage(e.usage)),t.updateUBO(),t.haveWideLines()){const s=r.getProperty();t.setNumberOfInstances(Math.ceil(s.getLineWidth()*2))}else t.setNumberOfInstances(1)}}const TS={is2D:!1,cellArray:null,currentInput:null,cellOffset:0,primitiveType:0,colorTexture:null,renderEncoder:null,textures:null};function og(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,TS,r),Ks.extend(t,e,r),e.fragmentShaderTemplate=yS,e.vertexShaderTemplate=vS,e._tmpMat3=Gt(new Float64Array(9)),e._tmpMat4=j(new Float64Array(16)),e.UBO=kt.newInstance({label:"mapperUBO"}),e.UBO.addEntry("BCWCMatrix","mat4x4<f32>"),e.UBO.addEntry("BCSCMatrix","mat4x4<f32>"),e.UBO.addEntry("MCWCNormals","mat4x4<f32>"),e.UBO.addEntry("AmbientColor","vec4<f32>"),e.UBO.addEntry("DiffuseColor","vec4<f32>"),e.UBO.addEntry("EdgeColor","vec4<f32>"),e.UBO.addEntry("SpecularColor","vec4<f32>"),e.UBO.addEntry("AmbientIntensity","f32"),e.UBO.addEntry("DiffuseIntensity","f32"),e.UBO.addEntry("Roughness","f32"),e.UBO.addEntry("Metallic","f32"),e.UBO.addEntry("Ambient","f32"),e.UBO.addEntry("Normal","f32"),e.UBO.addEntry("Emission","f32"),e.UBO.addEntry("NormalStrength","f32"),e.UBO.addEntry("BaseIOR","f32"),e.UBO.addEntry("SpecularIntensity","f32"),e.UBO.addEntry("LineWidth","f32"),e.UBO.addEntry("Opacity","f32"),e.UBO.addEntry("ZValue","f32"),e.UBO.addEntry("PropID","u32"),e.UBO.addEntry("ClipNear","f32"),e.UBO.addEntry("ClipFar","f32"),e.UBO.addEntry("Time","u32"),ue(t,e,["cellArray","currentInput","cellOffset","is2D","primitiveType","renderEncoder"]),e.textures=[],dS(t,e)}const xS=Z(og,"vtkWebGPUCellArrayMapper");var cg={newInstance:xS,extend:og};const{PrimitiveTypes:tn}=xt;function SS(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper"),t.createCellArrayMapper=()=>cg.newInstance(),t.buildPass=r=>{if(r){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor"),e.renderable.getStatic()||e.renderable.update();const n=e.renderable.getInputData();e.renderable.mapScalars(n,1),t.updateCellArrayMappers(n)}},t.updateCellArrayMappers=r=>{const n=[r.getVerts(),r.getLines(),r.getPolys(),r.getStrips()],a=[];let s=0;for(let i=tn.Points;i<=tn.Triangles;i++)if(n[i].getNumberOfValues()>0){e.primitives[i]||(e.primitives[i]=t.createCellArrayMapper());const o=e.primitives[i];o.setCellArray(n[i]),o.setCurrentInput(r),o.setCellOffset(s),o.setPrimitiveType(i),o.setRenderable(e.renderable),s+=n[i].getNumberOfCells(),a.push(o)}else e.primitives[i]=null;if(e.WebGPUActor.getRenderable().getProperty().getEdgeVisibility())for(let i=tn.TriangleEdges;i<=tn.TriangleStripEdges;i++)if(n[i-2].getNumberOfValues()>0){e.primitives[i]||(e.primitives[i]=t.createCellArrayMapper());const o=e.primitives[i];o.setCellArray(n[i-2]),o.setCurrentInput(r),o.setCellOffset(e.primitives[i-2].getCellOffset()),o.setPrimitiveType(i),o.setRenderable(e.renderable),a.push(o)}else e.primitives[i]=null;t.prepareNodes(),t.addMissingChildren(a),t.removeUnusedNodes()}}const CS={primitives:null};function wS(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,CS,r),ae.extend(t,e,r),e.primitives=[],SS(t,e)}const ES=Z(wS,"vtkWebGPUPolyDataMapper");Ye("vtkMapper",ES);const{PrimitiveTypes:mo}=xt;function OS(t,e){e.classHierarchy.push("vtkWebGPUPolyDataMapper2D"),t.createCellArrayMapper=()=>cg.newInstance(),t.buildPass=r=>{if(r){e.WebGPUActor=t.getFirstAncestorOfType("vtkWebGPUActor2D"),e.renderable.getStatic()||e.renderable.update();const n=e.renderable.getInputData();e.renderable.mapScalars(n,1),t.updateCellArrayMappers(n)}},t.updateCellArrayMappers=r=>{const n=[r.getVerts(),r.getLines(),r.getPolys(),r.getStrips()],a=[];let s=0;for(let i=mo.Points;i<=mo.Triangles;i++)if(n[i].getNumberOfValues()>0){e.primitives[i]||(e.primitives[i]=t.createCellArrayMapper());const o=e.primitives[i];o.setCellArray(n[i]),o.setCurrentInput(r),o.setCellOffset(s),o.setPrimitiveType(i),o.setRenderable(e.renderable),o.setIs2D(!0),s+=n[i].getNumberOfCells(),a.push(o)}else e.primitives[i]=null;t.prepareNodes(),t.addMissingChildren(a),t.removeUnusedNodes()}}function RS(t){return{primitives:[],...t}}function MS(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,RS(r)),ae.extend(t,e,r),e.primitives=[],OS(t,e)}const DS=Z(MS,"vtkWebGPUPolyDataMapper2D");Ye("vtkMapper2D",DS);function LS(t,e){e.classHierarchy.push("vtkWebGPUScalarBarActor"),t.buildPass=r=>{r&&(e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent(),e.scalarBarActorHelper.getRenderable()||e.scalarBarActorHelper.setRenderable(e.renderable),t.prepareNodes(),t.addMissingNode(e.scalarBarActorHelper.getBarActor()),t.addMissingNode(e.scalarBarActorHelper.getTmActor()),t.removeUnusedNodes())},t.opaquePass=(r,n)=>{if(r){const a=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,s=e.WebGPURenderer.getTiledSizeAndOrigin();e.scalarBarActorHelper.updateAPISpecificData([s.usize,s.vsize],a,e.WebGPURenderWindow.getRenderable())}}}const VS={};function _S(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,VS,r),ae.extend(t,e,r),e.scalarBarActorHelper=ju.newScalarBarActorHelper(),LS(t,e)}const BS=Z(_S,"vtkWebGPUScalarBarActor");Ye("vtkScalarBarActor",BS);function FS(t,e){e.classHierarchy.push("vtkWebGPUSampler"),t.create=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e.device=r,e.options.addressModeU=n.addressModeU?n.addressModeU:"clamp-to-edge",e.options.addressModeV=n.addressModeV?n.addressModeV:"clamp-to-edge",e.options.addressModeW=n.addressModeW?n.addressModeW:"clamp-to-edge",e.options.magFilter=n.magFilter?n.magFilter:"nearest",e.options.minFilter=n.minFilter?n.minFilter:"nearest",e.options.mipmapFilter=n.mipmapFilter?n.mipmapFilter:"nearest",e.options.label=e.label,e.handle=e.device.getHandle().createSampler(e.options),e.bindGroupTime.modified()},t.getShaderCode=(r,n)=>`@binding(${r}) @group(${n}) var ${e.label}: sampler;`,t.getBindGroupEntry=()=>({resource:e.handle})}const US={device:null,handle:null,label:null,options:null};function fg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,US,r),E.obj(t,e),e.options={},e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{}},e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),E.get(t,e,["bindGroupTime","handle","options"]),E.setGet(t,e,["bindGroupLayoutEntry","device","label"]),FS(t,e)}const mS=E.newInstance(fg);var Xs={newInstance:mS,extend:fg};function kS(t,e){e.classHierarchy.push("vtkWebGPUTextureView"),t.create=(r,n)=>{e.texture=r,e.options=n,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=r.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const a=pe.getDetailsFromTextureFormat(e.texture.getFormat());e.bindGroupLayoutEntry.texture.sampleType=a.sampleType},t.createFromTextureHandle=(r,n)=>{e.texture=null,e.options=n,e.options.dimension=e.options.dimension||"2d",e.options.label=e.label,e.textureHandle=r,e.handle=e.textureHandle.createView(e.options),e.bindGroupLayoutEntry.texture.viewDimension=e.options.dimension;const a=pe.getDetailsFromTextureFormat(n.format);e.bindGroupLayoutEntry.texture.sampleType=a.sampleType,e.bindGroupTime.modified()},t.getBindGroupEntry=()=>({resource:t.getHandle()}),t.getShaderCode=(r,n)=>{let a="f32";e.bindGroupLayoutEntry.texture.sampleType==="sint"?a="i32":e.bindGroupLayoutEntry.texture.sampleType==="uint"&&(a="u32");let s=`@binding(${r}) @group(${n}) var ${e.label}: texture_${e.options.dimension}<${a}>;`;return e.bindGroupLayoutEntry.texture.sampleType==="depth"&&(s=`@binding(${r}) @group(${n}) var ${e.label}: texture_depth_${e.options.dimension};`),s},t.addSampler=(r,n)=>{const a=Xs.newInstance({label:`${e.label}Sampler`});a.create(r,n),t.setSampler(a)},t.getBindGroupTime=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.bindGroupTime),t.getHandle=()=>(e.texture&&e.texture.getHandle()!==e.textureHandle&&(e.textureHandle=e.texture.getHandle(),e.handle=e.textureHandle.createView(e.options),e.bindGroupTime.modified()),e.handle)}const NS={texture:null,handle:null,sampler:null,label:null};function ug(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NS,r),E.obj(t,e),e.bindGroupLayoutEntry={visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d"}},e.bindGroupTime={},E.obj(e.bindGroupTime,{mtime:0}),E.get(t,e,["bindGroupTime","texture"]),E.setGet(t,e,["bindGroupLayoutEntry","label","sampler"]),kS(t,e)}const GS=E.newInstance(ug);var gg={newInstance:GS,extend:ug};const{BufferUsage:ko}=xt;function bS(t,e){e.classHierarchy.push("vtkWebGPUTexture"),t.create=(r,n)=>{e.device=r,e.width=n.width,e.height=n.height,e.depth=n.depth?n.depth:1;const a=e.depth===1?"2d":"3d";e.format=n.format?n.format:"rgba8unorm",e.mipLevel=n.mipLevel?n.mipLevel:0,e.usage=n.usage?n.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label,dimension:a,mipLevelCount:e.mipLevel+1})},t.assignFromHandle=(r,n,a)=>{e.device=r,e.handle=n,e.width=a.width,e.height=a.height,e.depth=a.depth?a.depth:1,e.format=a.format?a.format:"rgba8unorm",e.usage=a.usage?a.usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST},t.writeImageData=r=>{let n=[];if(r.canvas){e.device.getHandle().queue.copyExternalImageToTexture({source:r.canvas,flipY:r.flip},{texture:e.handle,premultipliedAlpha:!0},[e.width,e.height,e.depth]),e.ready=!0;return}r.jsImageData&&!r.nativeArray&&(r.width=r.jsImageData.width,r.height=r.jsImageData.height,r.depth=1,r.format="rgba8unorm",r.flip=!0,r.nativeArray=r.jsImageData.data);const a=pe.getDetailsFromTextureFormat(e.format);let s=e.width*a.stride;const i=(c,u,g)=>{const f=c.length/(u*g)*c.BYTES_PER_ELEMENT,l=a.elementSize===2&&a.sampleType==="float";if(l||f%256){const p=c,y=f/p.BYTES_PER_ELEMENT,h=a.elementSize,v=256*Math.floor((y*h+255)/256),x=v/h,S=E.newTypedArray(l?"Uint16Array":p.constructor.name,x*u*g);for(let d=0;d<u*g;d++)if(l)for(let T=0;T<y;T++)S[d*x+T]=Ne.toHalf(p[d*y+T]);else S.set(p.subarray(d*y,(d+1)*y),d*x);return[S,v]}return[c,f]};if(r.nativeArray&&(n=r.nativeArray),r.image){const c=document.createElement("canvas");c.width=r.image.width,c.height=r.image.height;const u=c.getContext("2d");u.translate(0,c.height),u.scale(1,-1),u.drawImage(r.image,0,0,r.image.width,r.image.height,0,0,c.width,c.height),n=u.getImageData(0,0,r.image.width,r.image.height).data}const o=e.device.createCommandEncoder();if(t.getDimensionality()!==3){const c=Yn.generateMipmaps(n,e.width,e.height,e.mipLevel);let u=e.width,g=e.height;for(let f=0;f<=e.mipLevel;f++){const l=i(c[f],g,1);s=l[1];const p={dataArray:r.dataArray?r.dataArray:null,nativeArray:l[0],usage:ko.Texture},y=e.device.getBufferManager().getBuffer(p);o.copyBufferToTexture({buffer:y.getHandle(),offset:0,bytesPerRow:s,rowsPerImage:g},{texture:e.handle,mipLevel:f},[u,g,1]),u/=2,g/=2}e.device.submitCommandEncoder(o),e.ready=!0}else{const c=i(n,e.height,e.depth);s=c[1];const u={dataArray:r.dataArray?r.dataArray:null,usage:ko.Texture};u.nativeArray=c[0];const g=e.device.getBufferManager().getBuffer(u);o.copyBufferToTexture({buffer:g.getHandle(),offset:0,bytesPerRow:s,rowsPerImage:e.height},{texture:e.handle},[e.width,e.height,e.depth]),e.device.submitCommandEncoder(o),e.ready=!0}},t.getScale=()=>{const r=pe.getDetailsFromTextureFormat(e.format);return r.elementSize===2&&r.sampleType==="float"?1:255},t.getNumberOfComponents=()=>pe.getDetailsFromTextureFormat(e.format).numComponents,t.getDimensionality=()=>{let r=0;return e.width>1&&r++,e.height>1&&r++,e.depth>1&&r++,r},t.resizeToMatch=r=>{(r.getWidth()!==e.width||r.getHeight()!==e.height||r.getDepth()!==e.depth)&&(e.width=r.getWidth(),e.height=r.getHeight(),e.depth=r.getDepth(),e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.resize=function(r,n){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;(r!==e.width||n!==e.height||a!==e.depth)&&(e.width=r,e.height=n,e.depth=a,e.handle=e.device.getHandle().createTexture({size:[e.width,e.height,e.depth],format:e.format,usage:e.usage,label:e.label}))},t.createView=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};n.dimension||(n.dimension=e.depth===1?"2d":"3d");const a=gg.newInstance({label:r});return a.create(t,n),a}}const $S={device:null,handle:null,buffer:null,ready:!1,label:null};function lg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,$S,r),E.obj(t,e),E.get(t,e,["handle","ready","width","height","depth","format","usage"]),E.setGet(t,e,["device","label"]),bS(t,e)}const WS=E.newInstance(lg);var Xe={newInstance:WS,extend:lg};function zS(t,e){e.classHierarchy.push("vtkWebGPUPixelSpaceCallbackMapper"),t.opaquePass=(r,n)=>{e.WebGPURenderer=t.getFirstAncestorOfType("vtkWebGPURenderer"),e.WebGPURenderWindow=e.WebGPURenderer.getParent();const a=e.WebGPURenderer.getAspectRatio(),s=e.WebGPURenderer?e.WebGPURenderer.getRenderable().getActiveCamera():null,i=e.WebGPURenderer.getTiledSizeAndOrigin(),o=null;e.renderable.getUseZValues(),e.renderable.invokeCallback(e.renderable.getInputData(),s,a,i,o)}}const HS={};function AS(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,HS,r),ae.extend(t,e,r),zS(t,e)}const jS=E.newInstance(AS,"vtkWebGPUPixelSpaceCallbackMapper");Ye("vtkPixelSpaceCallbackMapper",jS);const{vtkDebugMacro:rn}=E;function KS(t,e){e.classHierarchy.push("vtkCamera");const r=new Float64Array(3),n=new Float64Array([0,0,-1]),a=new Float64Array([0,1,0]),s=j(new Float64Array(16)),i=j(new Float64Array(16)),o=new Float64Array(3),c=new Float64Array(3),u=new Float64Array(3),g=j(new Float64Array(16)),f=j(new Float64Array(16)),l=new Float64Array(3),p=new Float64Array(3);function y(){e.viewPlaneNormal[0]=-e.directionOfProjection[0],e.viewPlaneNormal[1]=-e.directionOfProjection[1],e.viewPlaneNormal[2]=-e.directionOfProjection[2]}t.orthogonalizeViewUp=()=>{const h=t.getViewMatrix();e.viewUp[0]=h[4],e.viewUp[1]=h[5],e.viewUp[2]=h[6],t.modified()},t.setPosition=(h,v,x)=>{h===e.position[0]&&v===e.position[1]&&x===e.position[2]||(e.position[0]=h,e.position[1]=v,e.position[2]=x,t.computeDistance(),t.modified())},t.setFocalPoint=(h,v,x)=>{h===e.focalPoint[0]&&v===e.focalPoint[1]&&x===e.focalPoint[2]||(e.focalPoint[0]=h,e.focalPoint[1]=v,e.focalPoint[2]=x,t.computeDistance(),t.modified())},t.setDistance=h=>{if(e.distance===h)return;e.distance=h,e.distance<1e-20&&(e.distance=1e-20,rn("Distance is set to minimum."));const v=e.directionOfProjection;e.focalPoint[0]=e.position[0]+v[0]*e.distance,e.focalPoint[1]=e.position[1]+v[1]*e.distance,e.focalPoint[2]=e.position[2]+v[2]*e.distance,t.modified()},t.computeDistance=()=>{const h=e.focalPoint[0]-e.position[0],v=e.focalPoint[1]-e.position[1],x=e.focalPoint[2]-e.position[2];if(e.distance=Math.sqrt(h*h+v*v+x*x),e.distance<1e-20){e.distance=1e-20,rn("Distance is set to minimum.");const S=e.directionOfProjection;e.focalPoint[0]=e.position[0]+S[0]*e.distance,e.focalPoint[1]=e.position[1]+S[1]*e.distance,e.focalPoint[2]=e.position[2]+S[2]*e.distance}e.directionOfProjection[0]=h/e.distance,e.directionOfProjection[1]=v/e.distance,e.directionOfProjection[2]=x/e.distance,y()},t.dolly=h=>{if(h<=0)return;const v=e.distance/h;t.setPosition(e.focalPoint[0]-v*e.directionOfProjection[0],e.focalPoint[1]-v*e.directionOfProjection[1],e.focalPoint[2]-v*e.directionOfProjection[2])},t.roll=h=>{const v=e.position,x=e.focalPoint,S=e.viewUp,d=new Float64Array([S[0],S[1],S[2],0]);j(g);const T=new Float64Array([x[0]-v[0],x[1]-v[1],x[2]-v[2]]);ze(g,g,ie(h),T),mr(d,d,g),e.viewUp[0]=d[0],e.viewUp[1]=d[1],e.viewUp[2]=d[2],t.modified()},t.azimuth=h=>{const v=e.focalPoint;j(f),oe(f,f,v),ze(f,f,ie(h),e.viewUp),oe(f,f,[-v[0],-v[1],-v[2]]),I(l,e.position,f),t.setPosition(l[0],l[1],l[2])},t.yaw=h=>{const v=e.position;j(f),oe(f,f,v),ze(f,f,ie(h),e.viewUp),oe(f,f,[-v[0],-v[1],-v[2]]),I(p,e.focalPoint,f),t.setFocalPoint(p[0],p[1],p[2])},t.elevation=h=>{const v=e.focalPoint,x=t.getViewMatrix(),S=[-x[0],-x[1],-x[2]];j(f),oe(f,f,v),ze(f,f,ie(h),S),oe(f,f,[-v[0],-v[1],-v[2]]),I(l,e.position,f),t.setPosition(l[0],l[1],l[2])},t.pitch=h=>{const v=e.position,x=t.getViewMatrix(),S=[x[0],x[1],x[2]];j(f),oe(f,f,v),ze(f,f,ie(h),S),oe(f,f,[-v[0],-v[1],-v[2]]),I(p,e.focalPoint,f),t.setFocalPoint(...p)},t.zoom=h=>{h<=0||(e.parallelProjection?e.parallelScale/=h:e.viewAngle/=h,t.modified())},t.translate=(h,v,x)=>{const S=[h,v,x];ts(e.position,S,e.position),ts(e.focalPoint,S,e.focalPoint),t.computeDistance(),t.modified()},t.applyTransform=h=>{const v=[...e.viewUp,1],x=[],S=[],d=[];v[0]+=e.position[0],v[1]+=e.position[1],v[2]+=e.position[2],mr(x,[...e.position,1],h),mr(S,[...e.focalPoint,1],h),mr(d,v,h),d[0]-=x[0],d[1]-=x[1],d[2]-=x[2],t.setPosition(...x.slice(0,3)),t.setFocalPoint(...S.slice(0,3)),t.setViewUp(...d.slice(0,3))},t.getThickness=()=>e.clippingRange[1]-e.clippingRange[0],t.setThickness=h=>{let v=h;v<1e-20&&(v=1e-20,rn("Thickness is set to minimum.")),t.setClippingRange(e.clippingRange[0],e.clippingRange[0]+v)},t.setThicknessFromFocalPoint=h=>{let v=h;v<1e-20&&(v=1e-20,rn("Thickness is set to minimum.")),t.setClippingRange(e.distance-v/2,e.distance+v/2)},t.setRoll=h=>{},t.getRoll=()=>{},t.setObliqueAngles=(h,v)=>{},t.getOrientation=()=>{},t.getOrientationWXYZ=()=>{},t.getFrustumPlanes=h=>{},t.getCameraLightTransformMatrix=h=>(ye(h,e.cameraLightTransform),h),t.computeCameraLightTransform=()=>{ye(s,t.getViewMatrix()),Re(s,s),cc(i,[e.distance,e.distance,e.distance]),de(s,s,i),j(e.cameraLightTransform),oe(e.cameraLightTransform,s,[0,0,-1])},t.deepCopy=h=>{},t.physicalOrientationToWorldDirection=h=>{const v=si(h[0],h[1],h[2],h[3]),x=Nt(),S=si(0,0,1,0);return y0(x,v),ai(S,v,S),ai(S,S,x),[S[0],S[1],S[2]]},t.getPhysicalToWorldMatrix=h=>{t.getWorldToPhysicalMatrix(h),Re(h,h)},t.getWorldToPhysicalMatrix=h=>{j(h);const v=[3];Or(e.physicalViewNorth,e.physicalViewUp,v),h[0]=v[0],h[1]=v[1],h[2]=v[2],h[4]=e.physicalViewUp[0],h[5]=e.physicalViewUp[1],h[6]=e.physicalViewUp[2],h[8]=-e.physicalViewNorth[0],h[9]=-e.physicalViewNorth[1],h[10]=-e.physicalViewNorth[2],te(h,h),wn(o,1/e.physicalScale,1/e.physicalScale,1/e.physicalScale),qt(h,h,o),oe(h,h,e.physicalTranslation)},t.computeViewParametersFromViewMatrix=h=>{Re(s,h),I(o,r,s),t.computeDistance();const v=e.distance;t.setPosition(o[0],o[1],o[2]),I(c,n,s),vt(c,c,o),xr(c,c),t.setDirectionOfProjection(c[0],c[1],c[2]),I(u,a,s),vt(u,u,o),xr(u,u),t.setViewUp(u[0],u[1],u[2]),t.setDistance(v)},t.computeViewParametersFromPhysicalMatrix=h=>{t.getWorldToPhysicalMatrix(s),de(s,h,s),t.computeViewParametersFromViewMatrix(s)},t.setViewMatrix=h=>{e.viewMatrix=h,e.viewMatrix&&(ye(s,e.viewMatrix),t.computeViewParametersFromViewMatrix(s),te(e.viewMatrix,e.viewMatrix))},t.getViewMatrix=()=>{if(e.viewMatrix)return e.viewMatrix;vc(s,e.position,e.focalPoint,e.viewUp),te(s,s);const h=new Float64Array(16);return ye(h,s),h},t.setProjectionMatrix=h=>{e.projectionMatrix=h},t.getProjectionMatrix=(h,v,x)=>{const S=new Float64Array(16);if(j(S),e.projectionMatrix){const w=1/e.physicalScale;return wn(o,w,w,w),ye(S,e.projectionMatrix),qt(S,S,o),te(S,S),S}j(s);const d=e.clippingRange[1]-e.clippingRange[0],T=[e.clippingRange[0]+(v+1)*d/2,e.clippingRange[0]+(x+1)*d/2];if(e.parallelProjection){const w=e.parallelScale*h,C=e.parallelScale,O=(e.windowCenter[0]-1)*w,R=(e.windowCenter[0]+1)*w,L=(e.windowCenter[1]-1)*C,M=(e.windowCenter[1]+1)*C;hc(s,O,R,L,M,T[0],T[1]),te(s,s)}else{if(e.useOffAxisProjection)throw new Error("Off-Axis projection is not supported at this time");{const w=Math.tan(ie(e.viewAngle)/2);let C,O;e.useHorizontalViewAngle===!0?(C=e.clippingRange[0]*w,O=e.clippingRange[0]*w/h):(C=e.clippingRange[0]*w*h,O=e.clippingRange[0]*w);const R=(e.windowCenter[0]-1)*C,L=(e.windowCenter[0]+1)*C,M=(e.windowCenter[1]-1)*O,D=(e.windowCenter[1]+1)*O,V=T[0],B=T[1];s[0]=2*V/(L-R),s[5]=2*V/(D-M),s[2]=(R+L)/(L-R),s[6]=(M+D)/(D-M),s[10]=-(V+B)/(B-V),s[14]=-1,s[11]=-2*V*B/(B-V),s[15]=0}}return ye(S,s),S},t.getCompositeProjectionMatrix=(h,v,x)=>{const S=t.getViewMatrix(),d=t.getProjectionMatrix(h,v,x);return de(d,S,d),d},t.setDirectionOfProjection=(h,v,x)=>{if(e.directionOfProjection[0]===h&&e.directionOfProjection[1]===v&&e.directionOfProjection[2]===x)return;e.directionOfProjection[0]=h,e.directionOfProjection[1]=v,e.directionOfProjection[2]=x;const S=e.directionOfProjection;e.focalPoint[0]=e.position[0]+S[0]*e.distance,e.focalPoint[1]=e.position[1]+S[1]*e.distance,e.focalPoint[2]=e.position[2]+S[2]*e.distance,y()},t.setDeviceAngles=(h,v,x,S)=>{const d=[3];Or(e.physicalViewNorth,e.physicalViewUp,d);const T=j(new Float64Array(16));ze(T,T,ie(h),e.physicalViewUp),ze(T,T,ie(v),d),ze(T,T,ie(x),e.physicalViewNorth),ze(T,T,ie(-S),e.physicalViewUp);const w=new Float64Array([-e.physicalViewUp[0],-e.physicalViewUp[1],-e.physicalViewUp[2]]),C=new Float64Array(e.physicalViewNorth);I(w,w,T),I(C,C,T),t.setDirectionOfProjection(w[0],w[1],w[2]),t.setViewUp(C[0],C[1],C[2]),t.modified()},t.setOrientationWXYZ=(h,v,x,S)=>{const d=j(new Float64Array(16));if(h!==0&&(v!==0||x!==0||S!==0)){const C=ie(h),O=Nt();ds(O,[v,x,S],C),Cn(d,O)}const T=new Float64Array(3);I(T,[0,0,-1],d);const w=new Float64Array(3);I(w,[0,1,0],d),t.setDirectionOfProjection(...T),t.setViewUp(...w),t.modified()},t.computeClippingRange=h=>{let v=null,x=null;v=e.viewPlaneNormal,x=e.position;const S=-v[0],d=-v[1],T=-v[2],w=-(S*x[0]+d*x[1]+T*x[2]),C=[S*h[0]+d*h[2]+T*h[4]+w,1e-18];for(let O=0;O<2;O++)for(let R=0;R<2;R++)for(let L=0;L<2;L++){const M=S*h[L]+d*h[2+R]+T*h[4+O]+w;C[0]=M<C[0]?M:C[0],C[1]=M>C[1]?M:C[1]}return C}}const XS={position:[0,0,1],focalPoint:[0,0,0],viewUp:[0,1,0],directionOfProjection:[0,0,-1],parallelProjection:!1,useHorizontalViewAngle:!1,viewAngle:30,parallelScale:1,clippingRange:[.01,1000.01],windowCenter:[0,0],viewPlaneNormal:[0,0,1],useOffAxisProjection:!1,screenBottomLeft:[-.5,-.5,-.5],screenBottomRight:[.5,-.5,-.5],screenTopRight:[.5,.5,-.5],freezeFocalPoint:!1,projectionMatrix:null,viewMatrix:null,cameraLightTransform:ys(),physicalTranslation:[0,0,0],physicalScale:1,physicalViewUp:[0,1,0],physicalViewNorth:[0,0,-1]};function pg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,XS,r),E.obj(t,e),E.get(t,e,["distance"]),E.setGet(t,e,["parallelProjection","useHorizontalViewAngle","viewAngle","parallelScale","useOffAxisProjection","freezeFocalPoint","physicalScale"]),E.getArray(t,e,["directionOfProjection","viewPlaneNormal","position","focalPoint"]),E.setGetArray(t,e,["clippingRange","windowCenter"],2),E.setGetArray(t,e,["viewUp","screenBottomLeft","screenBottomRight","screenTopRight","physicalTranslation","physicalViewUp","physicalViewNorth"],3),KS(t,e)}const PS=E.newInstance(pg,"vtkCamera");var YS={newInstance:PS,extend:pg};function qS(t,e){e.classHierarchy.push("vtkLight");const r=new Float64Array(3);t.getTransformedPosition=()=>(e.transformMatrix?I(r,e.position,e.transformMatrix):wn(r,e.position[0],e.position[1],e.position[2]),r),t.getTransformedFocalPoint=()=>(e.transformMatrix?I(r,e.focalPoint,e.transformMatrix):wn(r,e.focalPoint[0],e.focalPoint[1],e.focalPoint[2]),r),t.getDirection=()=>(e.directionMTime<e.mtime&&(Ya(e.direction,e.focalPoint,e.position),Rr(e.direction),e.directionMTime=e.mtime),e.direction),t.setDirection=n=>{const a=new Float64Array(3);Ya(a,e.position,n),e.focalPoint=a},t.setDirectionAngle=(n,a)=>{const s=ie(n),i=ie(a);t.setPosition(Math.cos(s)*Math.sin(i),Math.sin(s),Math.cos(s)*Math.cos(i)),t.setFocalPoint(0,0,0),t.setPositional(0)},t.setLightTypeToHeadLight=()=>{t.setLightType("HeadLight")},t.setLightTypeToCameraLight=()=>{t.setLightType("CameraLight")},t.setLightTypeToSceneLight=()=>{t.setTransformMatrix(null),t.setLightType("SceneLight")},t.lightTypeIsHeadLight=()=>e.lightType==="HeadLight",t.lightTypeIsSceneLight=()=>e.lightType==="SceneLight",t.lightTypeIsCameraLight=()=>e.lightType==="CameraLight"}const IS={switch:!0,intensity:1,color:[1,1,1],position:[0,0,1],focalPoint:[0,0,0],positional:!1,exponent:1,coneAngle:30,coneFalloff:5,attenuationValues:[1,0,0],transformMatrix:null,lightType:"SceneLight",shadowAttenuation:1,direction:[0,0,0],directionMTime:0};function QS(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,IS,r),E.obj(t,e),E.setGet(t,e,["intensity","switch","positional","exponent","coneAngle","coneFalloff","transformMatrix","lightType","shadowAttenuation","attenuationValues"]),E.setGetArray(t,e,["color","position","focalPoint","attenuationValues"],3),qS(t,e)}const ZS=E.newInstance(QS,"vtkLight");var JS={newInstance:ZS};const{vtkErrorMacro:Sn}=E;function e2(t){return()=>Sn(`vtkViewport::${t} - NOT IMPLEMENTED`)}function t2(t,e){e.classHierarchy.push("vtkViewport"),t.getViewProps=()=>e.props,t.hasViewProp=n=>e.props.includes(n),t.addViewProp=n=>{n&&!t.hasViewProp(n)&&e.props.push(n)},t.removeViewProp=n=>{const a=e.props.filter(s=>s!==n);e.props.length!==a.length&&(e.props=a)},t.removeAllViewProps=()=>{e.props=[]};function r(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];a.push(n);const s=n.getNestedProps();if(s&&s.length)for(let i=0;i<s.length;i++)r(s[i],a);return a}t.getViewPropsWithNestedProps=()=>{const n=[];for(let a=0;a<e.props.length;a++)r(e.props[a],n);return n},t.addActor2D=t.addViewProp,t.removeActor2D=n=>{t.removeViewProp(n)},t.getActors2D=()=>(e.actors2D=[],e.props.forEach(n=>{e.actors2D=e.actors2D.concat(n.getActors2D())}),e.actors2D),t.displayToView=()=>Sn("call displayToView on your view instead"),t.viewToDisplay=()=>Sn("callviewtodisplay on your view instead"),t.getSize=()=>Sn("call getSize on your View instead"),t.normalizedDisplayToProjection=(n,a,s)=>{const i=t.normalizedDisplayToNormalizedViewport(n,a,s);return t.normalizedViewportToProjection(i[0],i[1],i[2])},t.normalizedDisplayToNormalizedViewport=(n,a,s)=>{const i=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[(n-e.viewport[0])/i[0],(a-e.viewport[1])/i[1],s]},t.normalizedViewportToProjection=(n,a,s)=>[n*2-1,a*2-1,s*2-1],t.projectionToNormalizedDisplay=(n,a,s)=>{const i=t.projectionToNormalizedViewport(n,a,s);return t.normalizedViewportToNormalizedDisplay(i[0],i[1],i[2])},t.normalizedViewportToNormalizedDisplay=(n,a,s)=>{const i=[e.viewport[2]-e.viewport[0],e.viewport[3]-e.viewport[1]];return[n*i[0]+e.viewport[0],a*i[1]+e.viewport[1],s]},t.projectionToNormalizedViewport=(n,a,s)=>[(n+1)*.5,(a+1)*.5,(s+1)*.5],t.PickPropFrom=e2("PickPropFrom")}const r2={background:[0,0,0],background2:[.2,.2,.2],gradientBackground:!1,viewport:[0,0,1,1],aspect:[1,1],pixelAspect:[1,1],props:[],actors2D:[]};function hg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,r2,r),E.obj(t,e),E.event(t,e,"event"),E.setGetArray(t,e,["viewport"],4),E.setGetArray(t,e,["background","background2"],3),t2(t,e)}const n2=E.newInstance(hg,"vtkViewport");var a2={newInstance:n2,extend:hg};const{vtkDebugMacro:ur,vtkErrorMacro:lt,vtkWarningMacro:s2}=Pe;function No(t){return()=>lt(`vtkRenderer::${t} - NOT IMPLEMENTED`)}function i2(t,e){e.classHierarchy.push("vtkRenderer");const r={type:"ComputeVisiblePropBoundsEvent",renderer:t},n={type:"ResetCameraClippingRangeEvent",renderer:t},a={type:"ResetCameraEvent",renderer:t};t.updateCamera=()=>(e.activeCamera||(ur("No cameras are on, creating one."),t.getActiveCameraAndResetIfCreated()),e.activeCamera.render(t),!0),t.updateLightsGeometryToFollowCamera=()=>{const s=t.getActiveCameraAndResetIfCreated();e.lights.forEach(i=>{i.lightTypeIsSceneLight()||(i.lightTypeIsHeadLight()?(i.setPositionFrom(s.getPositionByReference()),i.setFocalPointFrom(s.getFocalPointByReference()),i.modified(s.getMTime())):i.lightTypeIsCameraLight()?i.setTransformMatrix(s.getCameraLightTransformMatrix(ys())):lt("light has unknown light type",i.get()))})},t.updateLightGeometry=()=>e.lightFollowCamera?t.updateLightsGeometryToFollowCamera():!0,t.allocateTime=No("allocateTime"),t.updateGeometry=No("updateGeometry"),t.getVTKWindow=()=>e._renderWindow,t.setLayer=s=>{ur(t.getClassName(),t,"setting Layer to ",s),e.layer!==s&&(e.layer=s,t.modified()),t.setPreserveColorBuffer(!!s)},t.setActiveCamera=s=>e.activeCamera===s?!1:(e.activeCamera=s,t.modified(),t.invokeEvent({type:"ActiveCameraEvent",camera:s}),!0),t.makeCamera=()=>{const s=YS.newInstance();return t.invokeEvent({type:"CreateCameraEvent",camera:s}),s},t.getActiveCamera=()=>(e.activeCamera||(e.activeCamera=t.makeCamera()),e.activeCamera),t.getActiveCameraAndResetIfCreated=()=>(e.activeCamera||(t.getActiveCamera(),t.resetCamera()),e.activeCamera),t.getActors=()=>(e.actors=[],e.props.forEach(s=>{e.actors=e.actors.concat(s.getActors())}),e.actors),t.addActor=t.addViewProp,t.removeActor=s=>{e.actors=e.actors.filter(i=>i!==s),t.removeViewProp(s),t.modified()},t.removeAllActors=()=>{t.getActors().forEach(i=>{t.removeViewProp(i)}),e.actors=[],t.modified()},t.getVolumes=()=>(e.volumes=[],e.props.forEach(s=>{e.volumes=e.volumes.concat(s.getVolumes())}),e.volumes),t.addVolume=t.addViewProp,t.removeVolume=s=>{e.volumes=e.volumes.filter(i=>i!==s),t.removeViewProp(s),t.modified()},t.removeAllVolumes=()=>{t.getVolumes().forEach(i=>{t.removeViewProp(i)}),e.volumes=[],t.modified()},t.hasLight=s=>e.lights.includes(s),t.addLight=s=>{s&&!t.hasLight(s)&&(e.lights.push(s),t.modified())},t.removeLight=s=>{e.lights=e.lights.filter(i=>i!==s),t.modified()},t.removeAllLights=()=>{e.lights=[],t.modified()},t.setLightCollection=s=>{e.lights=s,t.modified()},t.makeLight=JS.newInstance,t.createLight=()=>{e.automaticLightCreation&&(e._createdLight&&(t.removeLight(e._createdLight),e._createdLight.delete(),e._createdLight=null),e._createdLight=t.makeLight(),t.addLight(e._createdLight),e._createdLight.setLightTypeToHeadLight(),e._createdLight.setPosition(t.getActiveCamera().getPosition()),e._createdLight.setFocalPoint(t.getActiveCamera().getFocalPoint()))},t.normalizedDisplayToWorld=(s,i,o,c)=>{let u=t.normalizedDisplayToProjection(s,i,o);return u=t.projectionToView(u[0],u[1],u[2],c),t.viewToWorld(u[0],u[1],u[2])},t.worldToNormalizedDisplay=(s,i,o,c)=>{let u=t.worldToView(s,i,o);return u=t.viewToProjection(u[0],u[1],u[2],c),t.projectionToNormalizedDisplay(u[0],u[1],u[2])},t.viewToWorld=(s,i,o)=>{if(e.activeCamera===null)return lt("ViewToWorld: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();Re(c,c),te(c,c);const u=new Float64Array([s,i,o]);return I(u,u,c),u},t.projectionToView=(s,i,o,c)=>{if(e.activeCamera===null)return lt("ProjectionToView: no active camera, cannot compute projection to view, returning 0,0,0"),[0,0,0];const u=e.activeCamera.getProjectionMatrix(c,-1,1);Re(u,u),te(u,u);const g=new Float64Array([s,i,o]);return I(g,g,u),g},t.worldToView=(s,i,o)=>{if(e.activeCamera===null)return lt("WorldToView: no active camera, cannot compute view to world, returning 0,0,0"),[0,0,0];const c=e.activeCamera.getViewMatrix();te(c,c);const u=new Float64Array([s,i,o]);return I(u,u,c),u},t.viewToProjection=(s,i,o,c)=>{if(e.activeCamera===null)return lt("ViewToProjection: no active camera, cannot compute view to projection, returning 0,0,0"),[0,0,0];const u=e.activeCamera.getProjectionMatrix(c,-1,1);te(u,u);const g=new Float64Array([s,i,o]);return I(g,g,u),g},t.computeVisiblePropBounds=()=>{e.allBounds[0]=ee.INIT_BOUNDS[0],e.allBounds[1]=ee.INIT_BOUNDS[1],e.allBounds[2]=ee.INIT_BOUNDS[2],e.allBounds[3]=ee.INIT_BOUNDS[3],e.allBounds[4]=ee.INIT_BOUNDS[4],e.allBounds[5]=ee.INIT_BOUNDS[5];let s=!0;t.invokeEvent(r);for(let i=0;i<e.props.length;++i){const o=e.props[i];if(o.getVisibility()&&o.getUseBounds()){const c=o.getBounds();c&&Sa(c)&&(s=!1,c[0]<e.allBounds[0]&&(e.allBounds[0]=c[0]),c[1]>e.allBounds[1]&&(e.allBounds[1]=c[1]),c[2]<e.allBounds[2]&&(e.allBounds[2]=c[2]),c[3]>e.allBounds[3]&&(e.allBounds[3]=c[3]),c[4]<e.allBounds[4]&&(e.allBounds[4]=c[4]),c[5]>e.allBounds[5]&&(e.allBounds[5]=c[5]))}}return s&&(Bs(e.allBounds),ur("Can't compute bounds, no 3D props are visible")),e.allBounds},t.resetCamera=function(){const i=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds(),o=[0,0,0];if(!Sa(i))return ur("Cannot reset camera!"),!1;let c=null;if(t.getActiveCamera())c=e.activeCamera.getViewPlaneNormal();else return lt("Trying to reset non-existent camera"),!1;e.activeCamera.setViewAngle(30),o[0]=(i[0]+i[1])/2,o[1]=(i[2]+i[3])/2,o[2]=(i[4]+i[5])/2;let u=i[1]-i[0],g=i[3]-i[2],f=i[5]-i[4];u*=u,g*=g,f*=f;let l=u+g+f;l=l===0?1:l,l=Math.sqrt(l)*.5;const p=ie(e.activeCamera.getViewAngle()),y=l,h=l/Math.sin(p*.5),v=e.activeCamera.getViewUp();return Math.abs(K(v,c))>.999&&(s2("Resetting view-up since view plane normal is parallel"),e.activeCamera.setViewUp(-v[2],v[0],v[1])),e.activeCamera.setFocalPoint(o[0],o[1],o[2]),e.activeCamera.setPosition(o[0]+h*c[0],o[1]+h*c[1],o[2]+h*c[2]),t.resetCameraClippingRange(i),e.activeCamera.setParallelScale(y),e.activeCamera.setPhysicalScale(l),e.activeCamera.setPhysicalTranslation(-o[0],-o[1],-o[2]),t.invokeEvent(a),!0},t.resetCameraClippingRange=function(){const i=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:null)||t.computeVisiblePropBounds();if(!Sa(i))return ur("Cannot reset camera clipping range!"),!1;if(t.getActiveCameraAndResetIfCreated(),!e.activeCamera)return lt("Trying to reset clipping range of non-existent camera"),!1;const o=e.activeCamera.computeClippingRange(i);let c=0;if(e.activeCamera.getParallelProjection())c=.2*e.activeCamera.getParallelScale();else{const u=ie(e.activeCamera.getViewAngle());c=.2*Math.tan(u/2)*o[1]}return o[1]-o[0]<c&&(c=c-o[1]+o[0],o[1]+=c/2,o[0]-=c/2),o[0]<0&&(o[0]=0),o[0]=.99*o[0]-(o[1]-o[0])*e.clippingRangeExpansion,o[1]=1.01*o[1]+(o[1]-o[0])*e.clippingRangeExpansion,o[0]=o[0]>=o[1]?.01*o[1]:o[0],e.nearClippingPlaneTolerance||(e.nearClippingPlaneTolerance=.01),o[0]<e.nearClippingPlaneTolerance*o[1]&&(o[0]=e.nearClippingPlaneTolerance*o[1]),e.activeCamera.setClippingRange(o[0],o[1]),t.invokeEvent(n),!1},t.setRenderWindow=s=>{s!==e._renderWindow&&(e._vtkWindow=s,e._renderWindow=s)},t.visibleActorCount=()=>e.props.filter(s=>s.getVisibility()).length,t.visibleVolumeCount=t.visibleActorCount,t.getMTime=()=>{let s=e.mtime;const i=e.activeCamera?e.activeCamera.getMTime():0;i>s&&(s=i);const o=e._createdLight?e._createdLight.getMTime():0;return o>s&&(s=o),s},t.getTransparent=()=>!!e.preserveColorBuffer,t.isActiveCameraCreated=()=>!!e.activeCamera}const o2={pickedProp:null,activeCamera:null,allBounds:[],ambient:[1,1,1],allocatedRenderTime:100,timeFactor:1,automaticLightCreation:!0,twoSidedLighting:!0,lastRenderTimeInSeconds:-1,renderWindow:null,lights:[],actors:[],volumes:[],lightFollowCamera:!0,numberOfPropsRendered:0,propArray:null,pathArray:null,layer:0,preserveColorBuffer:!1,preserveDepthBuffer:!1,computeVisiblePropBounds:Fs(),interactive:!0,nearClippingPlaneTolerance:0,clippingRangeExpansion:.05,erase:!0,draw:!0,useShadows:!1,useDepthPeeling:!1,occlusionRatio:0,maximumNumberOfPeels:4,selector:null,delegate:null,texturedBackground:!1,backgroundTexture:null,environmentTexture:null,environmentTextureDiffuseStrength:1,environmentTextureSpecularStrength:1,useEnvironmentTextureAsBackground:!1,pass:0};function vg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};for(Object.assign(e,o2,r),a2.extend(t,e,r),e.background||(e.background=[0,0,0,1]);e.background.length<3;)e.background.push(0);e.background.length===3&&e.background.push(1),Ee(t,e,["_renderWindow","allocatedRenderTime","timeFactor","lastRenderTimeInSeconds","numberOfPropsRendered","lastRenderingUsedDepthPeeling","selector"]),ue(t,e,["twoSidedLighting","lightFollowCamera","automaticLightCreation","erase","draw","nearClippingPlaneTolerance","clippingRangeExpansion","backingStore","interactive","layer","preserveColorBuffer","preserveDepthBuffer","useDepthPeeling","occlusionRatio","maximumNumberOfPeels","delegate","backgroundTexture","texturedBackground","environmentTexture","environmentTextureDiffuseStrength","environmentTextureSpecularStrength","useEnvironmentTextureAsBackground","useShadows","pass"]),rr(t,e,["actors","volumes","lights"]),ws(t,e,["background"],4,1),Lr(t,e,["renderWindow"]),i2(t,e)}const c2=Z(vg,"vtkRenderer");var f2={newInstance:c2,extend:vg};const u2="WebGL",Wn=Object.create(null);function Ps(t,e){Wn[t]=e}function g2(){return Object.keys(Wn)}function yg(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Wn[t]&&Wn[t](e)}function l2(t,e){e.classHierarchy.push("vtkRenderWindow"),t.addRenderer=r=>{t.hasRenderer(r)||(r.setRenderWindow(t),e.renderers.push(r),t.modified())},t.removeRenderer=r=>{e.renderers=e.renderers.filter(n=>n!==r),t.modified()},t.hasRenderer=r=>e.renderers.indexOf(r)!==-1,t.newAPISpecificView=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return yg(r||e.defaultViewAPI,n)},t.addView=r=>{t.hasView(r)||(r.setRenderable(t),e._views.push(r),t.modified())},t.removeView=r=>{e._views=e._views.filter(n=>n!==r),t.modified()},t.hasView=r=>e._views.indexOf(r)!==-1,t.preRender=()=>{e.renderers.forEach(r=>{r.isActiveCameraCreated()||r.resetCamera()})},t.render=()=>{t.preRender(),e.interactor?e.interactor.render():e._views.forEach(r=>r.traverseAllPasses())},t.getStatistics=()=>{const r={propCount:0,invisiblePropCount:0,gpuMemoryMB:0};return e._views.forEach(n=>{n.getGraphicsMemoryInfo&&(r.gpuMemoryMB+=n.getGraphicsMemoryInfo()/1e6)}),e.renderers.forEach(n=>{const a=n.getViewProps(),s=e._views[0].getViewNodeFor(n);a.forEach(i=>{if(i.getVisibility()){r.propCount+=1;const o=i.getMapper&&i.getMapper();if(o&&o.getPrimitiveCount){const c=s.getViewNodeFor(o);if(c){c.getAllocatedGPUMemoryInBytes&&(r.gpuMemoryMB+=c.getAllocatedGPUMemoryInBytes()/1e6);const u=o.getPrimitiveCount();Object.keys(u).forEach(g=>{r[g]||(r[g]=0),r[g]+=u[g]})}}}else r.invisiblePropCount+=1})}),r.str=Object.keys(r).map(n=>`${n}: ${r[n]}`).join(`
`),r},t.captureImages=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return E.setImmediate(t.render),e._views.map(a=>a.captureNextImage?a.captureNextImage(r,n):void 0).filter(a=>!!a)},t.addRenderWindow=r=>e.childRenderWindows.includes(r)?!1:(e.childRenderWindows.push(r),t.modified(),!0),t.removeRenderWindow=r=>{const n=e.childRenderWindows.findIndex(a=>a===r);return n<0?!1:(e.childRenderWindows.splice(n,1),t.modified(),!0)}}const p2={defaultViewAPI:u2,renderers:[],views:[],interactor:null,neverRendered:!0,numberOfLayers:1,childRenderWindows:[]};function dg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,p2,r),E.obj(t,e),E.setGet(t,e,["interactor","numberOfLayers","_views","defaultViewAPI"]),E.get(t,e,["neverRendered"]),E.getArray(t,e,["renderers","childRenderWindows"]),E.moveToProtected(t,e,["views"]),E.event(t,e,"completion"),l2(t,e)}const h2=E.newInstance(dg,"vtkRenderWindow");var v2={newInstance:h2,extend:dg,registerViewConstructor:Ps,listViewAPIs:g2,newAPISpecificView:yg};const ps={Unknown:0,LeftController:1,RightController:2},vr={Unknown:0,Trigger:1,TrackPad:2,Grip:3,Thumbstick:4,A:5,B:6,ApplicationMenu:7},y2={Unknown:0,TouchpadX:1,TouchpadY:2,ThumbstickX:3,ThumbstickY:4};var Tg={Device:ps,Input:vr,Axis:y2};const{Device:nn,Input:Lt}=Tg,{vtkWarningMacro:an,vtkErrorMacro:sn,normalizeWheel:d2,vtkOnceErrorMacro:T2}=E,Ht={ctrlKey:!1,altKey:!1,shiftKey:!1},Na={"xr-standard":[Lt.Trigger,Lt.Grip,Lt.TrackPad,Lt.Thumbstick,Lt.A,Lt.B]},Ys=["StartAnimation","Animation","EndAnimation","PointerEnter","PointerLeave","MouseEnter","MouseLeave","StartMouseMove","MouseMove","EndMouseMove","LeftButtonPress","LeftButtonRelease","MiddleButtonPress","MiddleButtonRelease","RightButtonPress","RightButtonRelease","KeyPress","KeyDown","KeyUp","StartMouseWheel","MouseWheel","EndMouseWheel","StartPinch","Pinch","EndPinch","StartPan","Pan","EndPan","StartRotate","Rotate","EndRotate","Button3D","Move3D","StartPointerLock","EndPointerLock","StartInteraction","Interaction","EndInteraction","AnimationFrameRateUpdate"];function gr(t){t.cancelable&&t.preventDefault()}function on(t){const e=Object.create(null);return t.forEach(r=>{let{pointerId:n,position:a}=r;e[n]=a}),e}function x2(t,e){e.classHierarchy.push("vtkRenderWindowInteractor");const r={...t},n=new Set,a=new Map;let s=1;t.start=()=>{!e.initialized&&(t.initialize(),!e.initialized)||t.startEventLoop()},t.setRenderWindow=h=>{sn("you want to call setView(view) instead of setRenderWindow on a vtk.js interactor")},t.setInteractorStyle=h=>{e.interactorStyle!==h&&(e.interactorStyle!=null&&e.interactorStyle.setInteractor(null),e.interactorStyle=h,e.interactorStyle!=null&&e.interactorStyle.getInteractor()!==t&&e.interactorStyle.setInteractor(t))},t.initialize=()=>{e.initialized=!0,t.enable(),t.render()},t.enable=()=>t.setEnabled(!0),t.disable=()=>t.setEnabled(!1),t.startEventLoop=()=>an("empty event loop");function i(h,v){e._forcedRenderer||(e.currentRenderer=t.findPokedRenderer(h,v))}t.getCurrentRenderer=()=>(e.currentRenderer||i(0,0),e.currentRenderer);function o(h){const v=e._view.getCanvas(),x=v.getBoundingClientRect(),S=v.width/x.width,d=v.height/x.height,T={x:S*(h.clientX-x.left),y:d*(x.height-h.clientY+x.top),z:0};return(a.size<=1||!e.currentRenderer)&&i(T.x,T.y),T}const c=e._getScreenEventPositionFor||o;function u(h){return{controlKey:h.ctrlKey,altKey:h.altKey,shiftKey:h.shiftKey}}function g(h){const v=u(h);return{key:h.key,keyCode:h.charCode,...v}}function f(h){return h.pointerType||""}const l=()=>{if(e.container===null)return;const{container:h}=e;h.addEventListener("contextmenu",gr),h.addEventListener("wheel",t.handleWheel),h.addEventListener("DOMMouseScroll",t.handleWheel),h.addEventListener("pointerenter",t.handlePointerEnter),h.addEventListener("pointerleave",t.handlePointerLeave),h.addEventListener("pointermove",t.handlePointerMove,{passive:!1}),h.addEventListener("pointerdown",t.handlePointerDown,{passive:!1}),h.addEventListener("pointerup",t.handlePointerUp),h.addEventListener("pointercancel",t.handlePointerCancel),document.addEventListener("keypress",t.handleKeyPress),document.addEventListener("keydown",t.handleKeyDown),document.addEventListener("keyup",t.handleKeyUp),document.addEventListener("pointerlockchange",t.handlePointerLockChange),h.style.touchAction="none",h.style.userSelect="none",h.style.webkitTapHighlightColor="rgba(0,0,0,0)"};t.bindEvents=h=>{if(h===null)return;r.setContainer(h)&&l()};const p=()=>{clearTimeout(e.moveTimeoutID),clearTimeout(e.wheelTimeoutID),e.moveTimeoutID=0,e.wheelTimeoutID=0,s=1;const{container:h}=e;h&&(h.removeEventListener("contextmenu",gr),h.removeEventListener("wheel",t.handleWheel),h.removeEventListener("DOMMouseScroll",t.handleWheel),h.removeEventListener("pointerenter",t.handlePointerEnter),h.removeEventListener("pointerleave",t.handlePointerLeave),h.removeEventListener("pointermove",t.handlePointerMove,{passive:!1}),h.removeEventListener("pointerdown",t.handlePointerDown,{passive:!1}),h.removeEventListener("pointerup",t.handlePointerUp),h.removeEventListener("pointercancel",t.handlePointerCancel)),document.removeEventListener("keypress",t.handleKeyPress),document.removeEventListener("keydown",t.handleKeyDown),document.removeEventListener("keyup",t.handleKeyUp),document.removeEventListener("pointerlockchange",t.handlePointerLockChange),a.clear()};t.unbindEvents=()=>{p(),r.setContainer(null)},t.handleKeyPress=h=>{const v=g(h);t.keyPressEvent(v)},t.handleKeyDown=h=>{const v=g(h);t.keyDownEvent(v)},t.handleKeyUp=h=>{const v=g(h);t.keyUpEvent(v)},t.handlePointerEnter=h=>{const v={...u(h),position:c(h),deviceType:f(h)};t.pointerEnterEvent(v),v.deviceType==="mouse"&&t.mouseEnterEvent(v)},t.handlePointerLeave=h=>{const v={...u(h),position:c(h),deviceType:f(h)};t.pointerLeaveEvent(v),v.deviceType==="mouse"&&t.mouseLeaveEvent(v)},t.handlePointerDown=h=>{if(!(h.button>2||t.isPointerLocked()))switch(e.preventDefaultOnPointerDown&&gr(h),h.target.hasPointerCapture(h.pointerId)&&h.target.releasePointerCapture(h.pointerId),e.container.setPointerCapture(h.pointerId),a.has(h.pointerId)&&an("[RenderWindowInteractor] duplicate pointerId detected"),a.set(h.pointerId,{pointerId:h.pointerId,position:c(h)}),h.pointerType){case"pen":case"touch":t.handleTouchStart(h);break;case"mouse":default:t.handleMouseDown(h);break}},t.handlePointerUp=h=>{if(a.has(h.pointerId))switch(e.preventDefaultOnPointerUp&&gr(h),a.delete(h.pointerId),e.container.releasePointerCapture(h.pointerId),h.pointerType){case"pen":case"touch":t.handleTouchEnd(h);break;case"mouse":default:t.handleMouseUp(h);break}},t.handlePointerCancel=h=>{if(a.has(h.pointerId))switch(a.delete(h.pointerId),h.pointerType){case"pen":case"touch":t.handleTouchEnd(h);break;case"mouse":default:t.handleMouseUp(h);break}},t.handlePointerMove=h=>{if(a.has(h.pointerId)){const v=a.get(h.pointerId);v.position=c(h)}switch(h.pointerType){case"pen":case"touch":t.handleTouchMove(h);break;case"mouse":default:t.handleMouseMove(h);break}},t.handleMouseDown=h=>{const v={...u(h),position:c(h),deviceType:f(h)};switch(h.button){case 0:t.leftButtonPressEvent(v);break;case 1:t.middleButtonPressEvent(v);break;case 2:t.rightButtonPressEvent(v);break;default:sn(`Unknown mouse button pressed: ${h.button}`);break}},t.requestPointerLock=()=>{e.container&&e.container.requestPointerLock()},t.exitPointerLock=()=>{var h;return(h=document.exitPointerLock)==null?void 0:h.call(document)},t.isPointerLocked=()=>!!e.container&&document.pointerLockElement===e.container,t.handlePointerLockChange=()=>{t.isPointerLocked()?t.startPointerLockEvent():t.endPointerLockEvent()};function y(){e._view&&e.enabled&&e.enableRender&&(e.inRender=!0,e._view.traverseAllPasses(),e.inRender=!1),t.invokeRenderEvent()}t.requestAnimation=h=>{if(h===void 0){sn("undefined requester, can not start animating");return}if(n.has(h)){an("requester is already registered for animating");return}n.add(h),!e.animationRequest&&n.size===1&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.extendAnimation=h=>{const v=Date.now()+h;e._animationExtendedEnd=Math.max(e._animationExtendedEnd,v),!e.animationRequest&&n.size===0&&!e.xrAnimation&&(e._animationStartTime=Date.now(),e._animationFrameCount=0,e.animationRequest=requestAnimationFrame(t.handleAnimation),t.startAnimationEvent())},t.isAnimating=()=>e.xrAnimation||e.animationRequest!==null,t.cancelAnimation=function(h){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!n.has(h)){if(!v){const x=h&&h.getClassName?h.getClassName():h;an(`${x} did not request an animation`)}return}n.delete(h),e.animationRequest&&n.size===0&&Date.now()>e._animationExtendedEnd&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.switchToXRAnimation=()=>{e.animationRequest&&(cancelAnimationFrame(e.animationRequest),e.animationRequest=null),e.xrAnimation=!0},t.returnFromXRAnimation=()=>{e.xrAnimation=!1,n.size!==0&&(e.recentAnimationFrameRate=10,e.animationRequest=requestAnimationFrame(t.handleAnimation))},t.updateXRGamepads=(h,v,x)=>{h.inputSources.forEach(S=>{const d=S.gripSpace==null?null:v.getPose(S.gripSpace,x),T=S.gripSpace==null?null:v.getPose(S.targetRaySpace,x),w=S.gamepad,C=S.handedness;if(w){w.index in e.lastGamepadValues||(e.lastGamepadValues[w.index]={left:{buttons:{}},right:{buttons:{}},none:{buttons:{}}});for(let O=0;O<w.buttons.length;++O)O in e.lastGamepadValues[w.index][C].buttons||(e.lastGamepadValues[w.index][C].buttons[O]=!1),e.lastGamepadValues[w.index][C].buttons[O]!==w.buttons[O].pressed&&d!=null&&(t.button3DEvent({gamepad:w,position:d.transform.position,orientation:d.transform.orientation,targetPosition:T.transform.position,targetOrientation:T.transform.orientation,pressed:w.buttons[O].pressed,device:S.handedness==="left"?nn.LeftController:nn.RightController,input:Na[w.mapping]&&Na[w.mapping][O]?Na[w.mapping][O]:Lt.Trigger}),e.lastGamepadValues[w.index][C].buttons[O]=w.buttons[O].pressed),e.lastGamepadValues[w.index][C].buttons[O]&&d!=null&&t.move3DEvent({gamepad:w,position:d.transform.position,orientation:d.transform.orientation,targetPosition:T.transform.position,targetOrientation:T.transform.orientation,device:S.handedness==="left"?nn.LeftController:nn.RightController})}})},t.handleMouseMove=h=>{const v={...u(h),position:c(h),deviceType:f(h)};e.moveTimeoutID===0?t.startMouseMoveEvent(v):(t.mouseMoveEvent(v),clearTimeout(e.moveTimeoutID)),e.moveTimeoutID=setTimeout(()=>{t.endMouseMoveEvent(),e.moveTimeoutID=0},200)},t.handleAnimation=()=>{const h=Date.now();e._animationFrameCount++,h-e._animationStartTime>1e3&&e._animationFrameCount>1&&(e.recentAnimationFrameRate=1e3*(e._animationFrameCount-1)/(h-e._animationStartTime),e.lastFrameTime=1/e.recentAnimationFrameRate,t.animationFrameRateUpdateEvent(),e._animationStartTime=h,e._animationFrameCount=1),t.animationEvent(),y(),n.size>0||Date.now()<e._animationExtendedEnd?e.animationRequest=requestAnimationFrame(t.handleAnimation):(cancelAnimationFrame(e.animationRequest),e.animationRequest=null,t.endAnimationEvent(),t.render())},t.handleWheel=h=>{gr(h);const v={...d2(h),...u(h),position:c(h),deviceType:f(h)};e.wheelTimeoutID===0&&(Math.abs(v.spinY)>=.3?s=Math.abs(v.spinY):s=1),v.spinY/=s,e.wheelTimeoutID===0?(t.startMouseWheelEvent(v),t.mouseWheelEvent(v)):(t.mouseWheelEvent(v),clearTimeout(e.wheelTimeoutID)),e.mouseScrollDebounceByPass?(t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0):e.wheelTimeoutID=setTimeout(()=>{t.extendAnimation(600),t.endMouseWheelEvent(),e.wheelTimeoutID=0},200)},t.handleMouseUp=h=>{const v={...u(h),position:c(h),deviceType:f(h)};switch(h.button){case 0:t.leftButtonReleaseEvent(v);break;case 1:t.middleButtonReleaseEvent(v);break;case 2:t.rightButtonReleaseEvent(v);break;default:sn(`Unknown mouse button released: ${h.button}`);break}},t.handleTouchStart=h=>{const v=[...a.values()];if(e.recognizeGestures&&v.length>1){const x=on(a);if(v.length===2){const S={...u(Ht),position:v[0].position,deviceType:f(h)};t.leftButtonReleaseEvent(S)}t.recognizeGesture("TouchStart",x)}else if(v.length===1){const x={...u(Ht),position:c(h),deviceType:f(h)};t.leftButtonPressEvent(x)}},t.handleTouchMove=h=>{const v=[...a.values()];if(e.recognizeGestures&&v.length>1){const x=on(a);t.recognizeGesture("TouchMove",x)}else if(v.length===1){const x={...u(Ht),position:v[0].position,deviceType:f(h)};t.mouseMoveEvent(x)}},t.handleTouchEnd=h=>{const v=[...a.values()];if(e.recognizeGestures)if(v.length===0){const x={...u(Ht),position:c(h),deviceType:f(h)};t.leftButtonReleaseEvent(x)}else if(v.length===1){const x=on(a);t.recognizeGesture("TouchEnd",x);const S={...u(Ht),position:v[0].position,deviceType:f(h)};t.leftButtonPressEvent(S)}else{const x=on(a);t.recognizeGesture("TouchMove",x)}else if(v.length===1){const x={...u(Ht),position:v[0].position,deviceType:f(h)};t.leftButtonReleaseEvent(x)}},t.setView=h=>{e._view!==h&&(e._view=h,e._view.getRenderable().setInteractor(t),t.modified())},t.getFirstRenderer=()=>{var h,v,x;return(x=(v=(h=e._view)==null?void 0:h.getRenderable())==null?void 0:v.getRenderersByReference())==null?void 0:x[0]},t.findPokedRenderer=function(){var C,O;let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!e._view)return null;const x=(O=(C=e._view)==null?void 0:C.getRenderable())==null?void 0:O.getRenderers();if(!x||x.length===0)return null;x.sort((R,L)=>R.getLayer()-L.getLayer());let S=null,d=null,T=null,w=x.length;for(;w--;){const R=x[w];if(e._view.isInViewport(h,v,R)&&R.getInteractive()){T=R;break}S===null&&R.getInteractive()&&(S=R),d===null&&e._view.isInViewport(h,v,R)&&(d=R)}return T===null&&(T=S),T===null&&(T=d),T==null&&(T=x[0]),T},t.render=()=>{!t.isAnimating()&&!e.inRender&&y()},Ys.forEach(h=>{const v=h.charAt(0).toLowerCase()+h.slice(1);t[`${v}Event`]=x=>{if(!e.enabled)return;if(!t.getCurrentRenderer()){T2(`
          Can not forward events without a current renderer on the interactor.
        `);return}const d={type:h,pokedRenderer:e.currentRenderer,firstRenderer:t.getFirstRenderer(),...x};t[`invoke${h}`](d)}}),t.recognizeGesture=(h,v)=>{if(Object.keys(v).length>2)return;if(e.startingEventPositions||(e.startingEventPositions={}),h==="TouchStart"){Object.keys(v).forEach(M=>{e.startingEventPositions[M]=v[M]}),e.currentGesture="Start";return}if(h==="TouchEnd"){e.currentGesture==="Pinch"&&(t.render(),t.endPinchEvent()),e.currentGesture==="Rotate"&&(t.render(),t.endRotateEvent()),e.currentGesture==="Pan"&&(t.render(),t.endPanEvent()),e.currentGesture="Start",e.startingEventPositions={};return}let x=0;const S=[],d=[];Object.keys(v).forEach(M=>{S[x]=v[M],d[x]=e.startingEventPositions[M],x++});const T=Math.sqrt((d[0].x-d[1].x)*(d[0].x-d[1].x)+(d[0].y-d[1].y)*(d[0].y-d[1].y)),w=Math.sqrt((S[0].x-S[1].x)*(S[0].x-S[1].x)+(S[0].y-S[1].y)*(S[0].y-S[1].y));let C=Er(Math.atan2(d[1].y-d[0].y,d[1].x-d[0].x)),O=Er(Math.atan2(S[1].y-S[0].y,S[1].x-S[0].x)),R=O-C;O=O+180>=360?O-180:O+180,C=C+180>=360?C-180:C+180,Math.abs(O-C)<Math.abs(R)&&(R=O-C);const L=[];if(L[0]=(S[0].x-d[0].x+S[1].x-d[1].x)/2,L[1]=(S[0].y-d[0].y+S[1].y-d[1].y)/2,h==="TouchMove")if(e.currentGesture==="Start"){let M=.01*Math.sqrt(e.container.clientWidth*e.container.clientWidth+e.container.clientHeight*e.container.clientHeight);M<15&&(M=15);const D=Math.abs(w-T),V=w*3.1415926*Math.abs(R)/360,B=Math.sqrt(L[0]*L[0]+L[1]*L[1]);if(D>M&&D>V&&D>B){e.currentGesture="Pinch";const _={scale:1,touches:v};t.startPinchEvent(_)}else if(V>M&&V>B){e.currentGesture="Rotate";const _={rotation:0,touches:v};t.startRotateEvent(_)}else if(B>M){e.currentGesture="Pan";const _={translation:[0,0],touches:v};t.startPanEvent(_)}}else{if(e.currentGesture==="Rotate"){const M={rotation:R,touches:v};t.rotateEvent(M)}if(e.currentGesture==="Pinch"){const M={scale:w/T,touches:v};t.pinchEvent(M)}if(e.currentGesture==="Pan"){const M={translation:L,touches:v};t.panEvent(M)}}},t.handleVisibilityChange=()=>{e._animationStartTime=Date.now(),e._animationFrameCount=0},t.setCurrentRenderer=h=>{e._forcedRenderer=!!h,e.currentRenderer=h},t.setContainer=h=>{p();const v=r.setContainer(h??null);return v&&l(),v},t.delete=()=>{for(;n.size;)t.cancelAnimation(n.values().next().value);typeof document.hidden<"u"&&document.removeEventListener("visibilitychange",t.handleVisibilityChange),e.container&&t.setContainer(null),r.delete()},typeof document.hidden<"u"&&document.addEventListener("visibilitychange",t.handleVisibilityChange,!1)}const S2={renderWindow:null,interactorStyle:null,picker:null,pickingManager:null,initialized:!1,enabled:!1,enableRender:!0,currentRenderer:null,lightFollowCamera:!0,desiredUpdateRate:30,stillUpdateRate:2,container:null,recognizeGestures:!0,currentGesture:"Start",animationRequest:null,lastFrameTime:.1,recentAnimationFrameRate:10,wheelTimeoutID:0,moveTimeoutID:0,lastGamepadValues:{},preventDefaultOnPointerDown:!1,preventDefaultOnPointerUp:!1,mouseScrollDebounceByPass:!1};function xg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,S2,r),E.obj(t,e),e._animationExtendedEnd=0,E.event(t,e,"RenderEvent"),Ys.forEach(n=>E.event(t,e,n)),E.get(t,e,["initialized","interactorStyle","lastFrameTime","recentAnimationFrameRate","_view"]),E.setGet(t,e,["container","lightFollowCamera","enabled","enableRender","recognizeGestures","desiredUpdateRate","stillUpdateRate","picker","preventDefaultOnPointerDown","preventDefaultOnPointerUp","mouseScrollDebounceByPass"]),E.moveToProtected(t,e,["view"]),x2(t,e)}const C2=E.newInstance(xg,"vtkRenderWindowInteractor");var Sg={newInstance:C2,extend:xg,handledEvents:Ys,...Tg};const{vtkErrorMacro:w2,VOID:E2}=E;function O2(t,e,r,n){return t.getRenderWindow().getViews()[0].worldToDisplay(e,r,n,t)}function R2(t,e,r,n){return t.getRenderWindow().getViews()[0].displayToWorld(e,r,n,t)}const M2={computeWorldToDisplay:O2,computeDisplayToWorld:R2};function D2(t,e){e.classHierarchy.push("vtkInteractorObserver");const r={...t};function n(){for(;e.subscribedEvents.length;)e.subscribedEvents.pop().unsubscribe()}function a(){Sg.handledEvents.forEach(s=>{t[`handle${s}`]&&e.subscribedEvents.push(e._interactor[`on${s}`](i=>e.processEvents?t[`handle${s}`](i):E2,e.priority))})}t.setInteractor=s=>{s!==e._interactor&&(n(),e._interactor=s,s&&e.enabled&&a(),t.modified())},t.setEnabled=s=>{s!==e.enabled&&(n(),s&&(e._interactor?a():w2(`
          The interactor must be set before subscribing to events
        `)),e.enabled=s,t.modified())},t.computeDisplayToWorld=(s,i,o,c)=>s?e._interactor.getView().displayToWorld(i,o,c,s):null,t.computeWorldToDisplay=(s,i,o,c)=>s?e._interactor.getView().worldToDisplay(i,o,c,s):null,t.setPriority=s=>{r.setPriority(s)&&e._interactor&&(n(),a())}}const L2={enabled:!0,priority:0,processEvents:!0,subscribedEvents:[]};function Cg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,L2,r),E.obj(t,e),E.event(t,e,"InteractionEvent"),E.event(t,e,"StartInteractionEvent"),E.event(t,e,"EndInteractionEvent"),E.get(t,e,["_interactor","enabled"]),E.setGet(t,e,["priority","processEvents"]),E.moveToProtected(t,e,["interactor"]),D2(t,e)}const V2=E.newInstance(Cg,"vtkInteractorObserver");var _2={newInstance:V2,extend:Cg,...M2};const B2={IS_START:0,IS_NONE:0,IS_ROTATE:1,IS_PAN:2,IS_SPIN:3,IS_DOLLY:4,IS_CAMERA_POSE:11,IS_WINDOW_LEVEL:1024,IS_SLICE:1025};var qs={States:B2};const{States:je}=qs,Ga={Rotate:je.IS_ROTATE,Pan:je.IS_PAN,Spin:je.IS_SPIN,Dolly:je.IS_DOLLY,CameraPose:je.IS_CAMERA_POSE,WindowLevel:je.IS_WINDOW_LEVEL,Slice:je.IS_SLICE};function F2(t,e){e.classHierarchy.push("vtkInteractorStyle"),Object.keys(Ga).forEach(r=>{E.event(t,e,`Start${r}Event`),t[`start${r}`]=()=>{e.state===je.IS_NONE&&(e.state=Ga[r],e._interactor.requestAnimation(t),t.invokeStartInteractionEvent({type:"StartInteractionEvent"}),t[`invokeStart${r}Event`]({type:`Start${r}Event`}))},E.event(t,e,`End${r}Event`),t[`end${r}`]=()=>{e.state===Ga[r]&&(e.state=je.IS_NONE,e._interactor.cancelAnimation(t),t.invokeEndInteractionEvent({type:"EndInteractionEvent"}),t[`invokeEnd${r}Event`]({type:`End${r}Event`}),e._interactor.render())}}),e.getRenderer=r=>e.focusedRenderer||r.pokedRenderer,t.handleKeyPress=r=>{const n=e._interactor;let a=null;switch(r.key){case"r":case"R":e.getRenderer(r).resetCamera(),n.render();break;case"w":case"W":a=e.getRenderer(r).getActors(),a.forEach(s=>{const i=s.getProperty();i.setRepresentationToWireframe&&i.setRepresentationToWireframe()}),n.render();break;case"s":case"S":a=e.getRenderer(r).getActors(),a.forEach(s=>{const i=s.getProperty();i.setRepresentationToSurface&&i.setRepresentationToSurface()}),n.render();break;case"v":case"V":a=e.getRenderer(r).getActors(),a.forEach(s=>{const i=s.getProperty();i.setRepresentationToPoints&&i.setRepresentationToPoints()}),n.render();break}}}const U2={state:je.IS_NONE,handleObservers:1,autoAdjustCameraClippingRange:1};function wg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,U2,r),_2.extend(t,e,r),E.setGet(t,e,["focusedRenderer"]),F2(t,e)}const m2=E.newInstance(wg,"vtkInteractorStyle");var k2={newInstance:m2,extend:wg,...qs};const{States:We}=qs;function N2(t,e){e.classHierarchy.push("vtkInteractorStyleTrackballCamera"),t.handleMouseMove=r=>{const n=r.position,a=e.getRenderer(r);switch(e.state){case We.IS_ROTATE:t.handleMouseRotate(a,n),t.invokeInteractionEvent({type:"InteractionEvent"});break;case We.IS_PAN:t.handleMousePan(a,n),t.invokeInteractionEvent({type:"InteractionEvent"});break;case We.IS_DOLLY:t.handleMouseDolly(a,n),t.invokeInteractionEvent({type:"InteractionEvent"});break;case We.IS_SPIN:t.handleMouseSpin(a,n),t.invokeInteractionEvent({type:"InteractionEvent"});break}e.previousPosition=n},t.handleButton3D=r=>{if(r&&r.pressed&&r.device===ps.RightController&&(r.input===vr.Trigger||r.input===vr.TrackPad)){t.startCameraPose();return}r&&!r.pressed&&r.device===ps.RightController&&(r.input===vr.Trigger||r.input===vr.TrackPad)&&e.state===We.IS_CAMERA_POSE&&t.endCameraPose()},t.handleMove3D=r=>{switch(e.state){case We.IS_CAMERA_POSE:t.updateCameraPose(r);break}},t.updateCameraPose=r=>{const n=e.getRenderer(r).getActiveCamera(),a=n.getPhysicalTranslation(),i=.5*.05*n.getPhysicalScale(),o=n.physicalOrientationToWorldDirection([r.orientation.x,r.orientation.y,r.orientation.z,r.orientation.w]);n.setPhysicalTranslation(a[0]+o[0]*i,a[1]+o[1]*i,a[2]+o[2]*i)},t.handleLeftButtonPress=r=>{const n=r.position;e.previousPosition=n,r.shiftKey?r.controlKey||r.altKey?t.startDolly():t.startPan():r.controlKey||r.altKey?t.startSpin():t.startRotate()},t.handleLeftButtonRelease=()=>{switch(e.state){case We.IS_DOLLY:t.endDolly();break;case We.IS_PAN:t.endPan();break;case We.IS_SPIN:t.endSpin();break;case We.IS_ROTATE:t.endRotate();break}},t.handleStartMouseWheel=()=>{t.startDolly()},t.handleEndMouseWheel=()=>{t.endDolly()},t.handleStartPinch=r=>{e.previousScale=r.scale,t.startDolly()},t.handleEndPinch=()=>{t.endDolly()},t.handleStartRotate=r=>{e.previousRotation=r.rotation,t.startRotate()},t.handleEndRotate=()=>{t.endRotate()},t.handleStartPan=r=>{e.previousTranslation=r.translation,t.startPan()},t.handleEndPan=()=>{t.endPan()},t.handlePinch=r=>{t.dollyByFactor(e.getRenderer(r),r.scale/e.previousScale),e.previousScale=r.scale},t.handlePan=r=>{const n=e.getRenderer(r).getActiveCamera();let a=n.getFocalPoint();a=t.computeWorldToDisplay(e.getRenderer(r),a[0],a[1],a[2]);const s=a[2],i=r.translation,o=e.previousTranslation,c=t.computeDisplayToWorld(e.getRenderer(r),a[0]+i[0]-o[0],a[1]+i[1]-o[1],s),u=t.computeDisplayToWorld(e.getRenderer(r),a[0],a[1],s),g=[];g[0]=u[0]-c[0],g[1]=u[1]-c[1],g[2]=u[2]-c[2],a=n.getFocalPoint();const f=n.getPosition();n.setFocalPoint(g[0]+a[0],g[1]+a[1],g[2]+a[2]),n.setPosition(g[0]+f[0],g[1]+f[1],g[2]+f[2]),e._interactor.getLightFollowCamera()&&e.getRenderer(r).updateLightsGeometryToFollowCamera(),n.orthogonalizeViewUp(),e.previousTranslation=r.translation},t.handleRotate=r=>{const n=e.getRenderer(r).getActiveCamera();n.roll(r.rotation-e.previousRotation),n.orthogonalizeViewUp(),e.previousRotation=r.rotation},t.handleMouseRotate=(r,n)=>{if(!e.previousPosition)return;const a=e._interactor,s=n.x-e.previousPosition.x,i=n.y-e.previousPosition.y,o=a.getView().getViewportSize(r);let c=-.1,u=-.1;o[0]&&o[1]&&(c=-20/o[1],u=-20/o[0]);const g=s*u*e.motionFactor,f=i*c*e.motionFactor,l=r.getActiveCamera();!Number.isNaN(g)&&!Number.isNaN(f)&&(l.azimuth(g),l.elevation(f),l.orthogonalizeViewUp()),e.autoAdjustCameraClippingRange&&r.resetCameraClippingRange(),a.getLightFollowCamera()&&r.updateLightsGeometryToFollowCamera()},t.handleMouseSpin=(r,n)=>{if(!e.previousPosition)return;const a=e._interactor,s=r.getActiveCamera(),i=a.getView().getViewportCenter(r),o=Er(Math.atan2(e.previousPosition.y-i[1],e.previousPosition.x-i[0])),c=Er(Math.atan2(n.y-i[1],n.x-i[0]))-o;Number.isNaN(c)||(s.roll(c),s.orthogonalizeViewUp())},t.handleMousePan=(r,n)=>{if(!e.previousPosition)return;const a=r.getActiveCamera();let s=a.getFocalPoint();s=t.computeWorldToDisplay(r,s[0],s[1],s[2]);const i=s[2],o=t.computeDisplayToWorld(r,n.x,n.y,i),c=t.computeDisplayToWorld(r,e.previousPosition.x,e.previousPosition.y,i),u=[];u[0]=c[0]-o[0],u[1]=c[1]-o[1],u[2]=c[2]-o[2],s=a.getFocalPoint();const g=a.getPosition();a.setFocalPoint(u[0]+s[0],u[1]+s[1],u[2]+s[2]),a.setPosition(u[0]+g[0],u[1]+g[1],u[2]+g[2]),e._interactor.getLightFollowCamera()&&r.updateLightsGeometryToFollowCamera()},t.handleMouseDolly=(r,n)=>{if(!e.previousPosition)return;const a=n.y-e.previousPosition.y,i=e._interactor.getView().getViewportCenter(r),o=e.motionFactor*a/i[1];t.dollyByFactor(r,1.1**o)},t.handleMouseWheel=r=>{const n=1-r.spinY/e.zoomFactor;t.dollyByFactor(e.getRenderer(r),n)},t.dollyByFactor=(r,n)=>{if(Number.isNaN(n))return;const a=r.getActiveCamera();a.getParallelProjection()?a.setParallelScale(a.getParallelScale()/n):(a.dolly(n),e.autoAdjustCameraClippingRange&&r.resetCameraClippingRange()),e._interactor.getLightFollowCamera()&&r.updateLightsGeometryToFollowCamera()}}const G2={motionFactor:10,zoomFactor:10};function Eg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,G2,r),k2.extend(t,e,r),E.setGet(t,e,["motionFactor","zoomFactor"]),N2(t,e)}const b2=E.newInstance(Eg,"vtkInteractorStyleTrackballCamera");var $2={newInstance:b2,extend:Eg};function W2(t){return t}function Is(t){if(t===null||t==="null")return null;if(t==="true")return!0;if(t==="false")return!1;if(!(t===void 0||t==="undefined"))return t[0]==="["&&t[t.length-1]==="]"?t.substring(1,t.length-1).split(",").map(e=>Is(e.trim())):t===""||Number.isNaN(Number(t))?t:Number(t)}function z2(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:window.location.search;const r={},n=t?Is:W2;return new URLSearchParams(e).forEach((s,i)=>{i&&(r[i]=s?n(s):!0)}),r}var H2={toNativeType:Is,extractURLParameters:z2};function A2(t,e){e.classHierarchy.push("vtkFramebuffer"),t.getBothMode=()=>e.context.FRAMEBUFFER,t.saveCurrentBindingsAndBuffers=r=>{const n=typeof r<"u"?r:t.getBothMode();t.saveCurrentBindings(n),t.saveCurrentBuffers(n)},t.saveCurrentBindings=r=>{if(!e.context){A("you must set the OpenGLRenderWindow before calling saveCurrentBindings");return}const n=e.context;e.previousDrawBinding=n.getParameter(e.context.FRAMEBUFFER_BINDING),e.previousActiveFramebuffer=e._openGLRenderWindow.getActiveFramebuffer()},t.saveCurrentBuffers=r=>{},t.restorePreviousBindingsAndBuffers=r=>{const n=typeof r<"u"?r:t.getBothMode();t.restorePreviousBindings(n),t.restorePreviousBuffers(n)},t.restorePreviousBindings=r=>{if(!e.context){A("you must set the OpenGLRenderWindow before calling restorePreviousBindings");return}const n=e.context;n.bindFramebuffer(n.FRAMEBUFFER,e.previousDrawBinding),e._openGLRenderWindow.setActiveFramebuffer(e.previousActiveFramebuffer)},t.restorePreviousBuffers=r=>{},t.bind=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;n===null&&(n=e.context.FRAMEBUFFER),e.context.bindFramebuffer(n,e.glFramebuffer);for(let a=0;a<e.colorBuffers.length;a++)e.colorBuffers[a].bind();e._openGLRenderWindow.setActiveFramebuffer(t)},t.create=(r,n)=>{if(!e.context){A("you must set the OpenGLRenderWindow before calling create");return}e.glFramebuffer=e.context.createFramebuffer(),e.glFramebuffer.width=r,e.glFramebuffer.height=n},t.setColorBuffer=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const a=e.context;if(!a){A("you must set the OpenGLRenderWindow before calling setColorBuffer");return}let s=a.COLOR_ATTACHMENT0;if(n>0)if(e._openGLRenderWindow.getWebgl2())s+=n;else{A("Using multiple framebuffer attachments requires WebGL 2");return}e.colorBuffers[n]=r,a.framebufferTexture2D(a.FRAMEBUFFER,s,a.TEXTURE_2D,r.getHandle(),0)},t.removeColorBuffer=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;const n=e.context;if(!n){A("you must set the OpenGLRenderWindow before calling removeColorBuffer");return}let a=n.COLOR_ATTACHMENT0;if(r>0)if(e._openGLRenderWindow.getWebgl2())a+=r;else{A("Using multiple framebuffer attachments requires WebGL 2");return}n.framebufferTexture2D(n.FRAMEBUFFER,a,n.TEXTURE_2D,null,0),e.colorBuffers=e.colorBuffers.splice(r,1)},t.setDepthBuffer=r=>{if(!e.context){A("you must set the OpenGLRenderWindow before calling setDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const n=e.context;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,r.getHandle(),0)}else A("Attaching depth buffer textures to fbo requires WebGL 2")},t.removeDepthBuffer=()=>{if(!e.context){A("you must set the OpenGLRenderWindow before calling removeDepthBuffer");return}if(e._openGLRenderWindow.getWebgl2()){const r=e.context;r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,null,0)}else A("Attaching depth buffer textures to framebuffers requires WebGL 2")},t.getGLFramebuffer=()=>e.glFramebuffer,t.setOpenGLRenderWindow=r=>{e._openGLRenderWindow!==r&&(t.releaseGraphicsResources(),e._openGLRenderWindow=r,e.context=null,r&&(e.context=e._openGLRenderWindow.getContext()))},t.releaseGraphicsResources=()=>{e.glFramebuffer&&e.context.deleteFramebuffer(e.glFramebuffer)},t.getSize=()=>e.glFramebuffer==null?null:[e.glFramebuffer.width,e.glFramebuffer.height],t.populateFramebuffer=()=>{if(!e.context){A("you must set the OpenGLRenderWindow before calling populateFrameBuffer");return}t.bind();const r=e.context,n=mt.newInstance();n.setOpenGLRenderWindow(e._openGLRenderWindow),n.setMinificationFilter(us.LINEAR),n.setMagnificationFilter(us.LINEAR),n.create2DFromRaw(e.glFramebuffer.width,e.glFramebuffer.height,4,le.UNSIGNED_CHAR,null),t.setColorBuffer(n),e.depthTexture=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,e.depthTexture),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e.glFramebuffer.width,e.glFramebuffer.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e.depthTexture)},t.getColorTexture=()=>e.colorBuffers[0]}const j2={glFramebuffer:null,colorBuffers:null,depthTexture:null,previousDrawBinding:0,previousReadBinding:0,previousDrawBuffer:0,previousReadBuffer:0,previousActiveFramebuffer:null};function Og(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,j2,r),ve(t,e),e.colorBuffers&&A("you cannot initialize colorBuffers through the constructor. You should call setColorBuffer() instead."),e.colorBuffers=[],rr(t,e,["colorBuffers"]),A2(t,e)}const K2=Z(Og,"vtkFramebuffer");var Qs={newInstance:K2,extend:Og};function X2(t,e){e.classHierarchy.push("vtkRenderPass"),t.getOperation=()=>e.currentOperation,t.setCurrentOperation=r=>{e.currentOperation=r,e.currentTraverseOperation=`traverse${E.capitalize(e.currentOperation)}`},t.getTraverseOperation=()=>e.currentTraverseOperation,t.traverse=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;e.deleted||(e._currentParent=n,e.preDelegateOperations.forEach(a=>{t.setCurrentOperation(a),r.traverse(t)}),e.delegates.forEach(a=>{a.traverse(r,t)}),e.postDelegateOperations.forEach(a=>{t.setCurrentOperation(a),r.traverse(t)}))}}const P2={delegates:[],currentOperation:null,preDelegateOperations:[],postDelegateOperations:[],currentParent:null};function Rg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,P2,r),E.obj(t,e),E.get(t,e,["currentOperation"]),E.setGet(t,e,["delegates","_currentParent","preDelegateOperations","postDelegateOperations"]),E.moveToProtected(t,e,["currentParent"]),X2(t,e)}const Y2=E.newInstance(Rg,"vtkRenderPass");var at={newInstance:Y2,extend:Rg};const{Representation:q2}=nr,{vtkErrorMacro:Go}=E;function I2(t){const e=F.substitute(t.Fragment,"//VTK::RenderPassFragmentShader::Impl",`
      float weight = gl_FragData[0].a * pow(max(1.1 - gl_FragCoord.z, 0.0), 2.0);
      gl_FragData[0] = vec4(gl_FragData[0].rgb*weight, gl_FragData[0].a);
      gl_FragData[1].r = weight;
    `,!1);t.Fragment=e.result}const Q2=`//VTK::System::Dec

in vec2 tcoord;

uniform sampler2D translucentRTexture;
uniform sampler2D translucentRGBATexture;

// the output of this shader
//VTK::Output::Dec

void main()
{
  vec4 t1Color = texture(translucentRGBATexture, tcoord);
  float t2Color = texture(translucentRTexture, tcoord).r;
  gl_FragData[0] = vec4(t1Color.rgb/max(t2Color,0.01), 1.0 - t1Color.a);
}
`;function Z2(t,e){e.classHierarchy.push("vtkOpenGLOrderIndependentTranslucentPass"),t.createVertexBuffer=()=>{const r=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),n=new Float32Array([0,0,1,0,0,1,1,1]),a=new Uint16Array([4,0,1,3,2]),s=Q.newInstance({numberOfComponents:3,values:r});s.setName("points");const i=Q.newInstance({numberOfComponents:2,values:n});i.setName("tcoords");const o=Q.newInstance({numberOfComponents:1,values:a});e.tris.getCABO().createVBO(o,"polys",q2.SURFACE,{points:s,tcoords:i,cellOffset:0}),e.VBOBuildTime.modified()},t.createFramebuffer=r=>{const n=r.getSize(),a=r.getContext();e.framebuffer=Qs.newInstance(),e.framebuffer.setOpenGLRenderWindow(r),e.framebuffer.create(...n),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind(),e.translucentRGBATexture=mt.newInstance(),e.translucentRGBATexture.setInternalFormat(a.RGBA16F),e.translucentRGBATexture.setFormat(a.RGBA),e.translucentRGBATexture.setOpenGLDataType(a.HALF_FLOAT),e.translucentRGBATexture.setOpenGLRenderWindow(r),e.translucentRGBATexture.create2DFromRaw(n[0],n[1],4,"Float32Array",null),e.translucentRTexture=mt.newInstance(),e.translucentRTexture.setInternalFormat(a.R16F),e.translucentRTexture.setFormat(a.RED),e.translucentRTexture.setOpenGLDataType(a.HALF_FLOAT),e.translucentRTexture.setOpenGLRenderWindow(r),e.translucentRTexture.create2DFromRaw(n[0],n[1],1,"Float32Array",null),e.translucentZTexture=mt.newInstance(),e.translucentZTexture.setOpenGLRenderWindow(r),e.translucentZTexture.createDepthFromRaw(n[0],n[1],"Float32Array",null),e.framebuffer.setColorBuffer(e.translucentRGBATexture,0),e.framebuffer.setColorBuffer(e.translucentRTexture,1),e.framebuffer.setDepthBuffer(e.translucentZTexture)},t.createCopyShader=r=>{e.copyShader=r.getShaderCache().readyShaderProgramArray(["//VTK::System::Dec","attribute vec4 vertexDC;","attribute vec2 tcoordTC;","varying vec2 tcoord;","void main() { tcoord = tcoordTC; gl_Position = vertexDC; }"].join(`
`),Q2,"")},t.createVBO=r=>{const n=r.getContext();e.tris.setOpenGLRenderWindow(r),t.createVertexBuffer();const a=e.copyShader;e.tris.getCABO().bind(),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"vertexDC",e.tris.getCABO().getVertexOffset(),e.tris.getCABO().getStride(),n.FLOAT,3,n.FALSE)||Go("Error setting vertexDC in copy shader VAO."),e.copyVAO.addAttributeArray(a,e.tris.getCABO(),"tcoordTC",e.tris.getCABO().getTCoordOffset(),e.tris.getCABO().getStride(),n.FLOAT,2,n.FALSE)||Go("Error setting vertexDC in copy shader VAO.")},t.traverse=(r,n,a)=>{if(e.deleted)return;const s=r.getSize(),i=r.getContext();if(e._supported=!1,n.getSelector()||!i||!r.getWebgl2()||!i.getExtension("EXT_color_buffer_half_float")&&!i.getExtension("EXT_color_buffer_float")){t.setCurrentOperation("translucentPass"),n.traverse(t);return}if(e._supported=!0,e.framebuffer===null)t.createFramebuffer(r);else{const c=e.framebuffer.getSize();c===null||c[0]!==s[0]||c[1]!==s[1]?(e.framebuffer.releaseGraphicsResources(),e.translucentRGBATexture.releaseGraphicsResources(r),e.translucentRTexture.releaseGraphicsResources(r),e.translucentZTexture.releaseGraphicsResources(r),t.createFramebuffer(r)):(e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.bind())}i.drawBuffers([i.COLOR_ATTACHMENT0]),i.clearBufferfv(i.COLOR,0,[0,0,0,0]),i.clearBufferfv(i.DEPTH,0,[1]),i.colorMask(!1,!1,!1,!1),a.getOpaqueActorCount()>0&&(a.setCurrentOperation("opaqueZBufferPass"),n.traverse(a)),i.colorMask(!0,!0,!0,!0),i.drawBuffers([i.COLOR_ATTACHMENT0,i.COLOR_ATTACHMENT1]),i.viewport(0,0,s[0],s[1]),i.scissor(0,0,s[0],s[1]),i.clearBufferfv(i.COLOR,0,[0,0,0,1]),i.clearBufferfv(i.COLOR,1,[0,0,0,0]),i.enable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendFuncSeparate(i.ONE,i.ONE,i.ZERO,i.ONE_MINUS_SRC_ALPHA),t.setCurrentOperation("translucentPass"),n.traverse(t),i.drawBuffers([i.NONE]),e.framebuffer.restorePreviousBindingsAndBuffers(),e.copyShader===null?t.createCopyShader(r):r.getShaderCache().readyShaderProgram(e.copyShader),e.copyVAO||(e.copyVAO=Uu.newInstance(),e.copyVAO.setOpenGLRenderWindow(r)),e.copyVAO.bind(),e.VBOBuildTime.getMTime()<t.getMTime()&&t.createVBO(r),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA),i.depthMask(!1),i.depthFunc(i.ALWAYS),i.viewport(0,0,s[0],s[1]),i.scissor(0,0,s[0],s[1]),e.translucentRGBATexture.activate(),e.copyShader.setUniformi("translucentRGBATexture",e.translucentRGBATexture.getTextureUnit()),e.translucentRTexture.activate(),e.copyShader.setUniformi("translucentRTexture",e.translucentRTexture.getTextureUnit()),i.drawArrays(i.TRIANGLES,0,e.tris.getCABO().getElementCount()),i.depthMask(!0),i.depthFunc(i.LEQUAL),e.translucentRGBATexture.deactivate(),e.translucentRTexture.deactivate();const o=n.getTiledSizeAndOrigin();i.scissor(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize),i.viewport(o.lowerLeftU,o.lowerLeftV,o.usize,o.vsize)},t.getShaderReplacement=()=>e._supported?I2:null,t.releaseGraphicsResources=r=>{e.framebuffer&&(e.framebuffer.releaseGraphicsResources(r),e.framebuffer=null),e.translucentRGBATexture&&(e.translucentRGBATexture.releaseGraphicsResources(r),e.translucentRGBATexture=null),e.translucentRTexture&&(e.translucentRTexture.releaseGraphicsResources(r),e.translucentRTexture=null),e.translucentZTexture&&(e.translucentZTexture.releaseGraphicsResources(r),e.translucentZTexture=null),e.copyVAO&&(e.copyVAO.releaseGraphicsResources(r),e.copyVAO=null),e.copyShader&&(e.copyShader.releaseGraphicsResources(r),e.copyShader=null),e.tris&&(e.tris.releaseGraphicsResources(r),e.tris=null),t.modified()}}const J2={framebuffer:null,copyShader:null,tris:null};function Mg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,J2,r),at.extend(t,e,r),e.VBOBuildTime={},E.obj(e.VBOBuildTime,{mtime:0}),e.tris=ar.newInstance(),E.get(t,e,["framebuffer"]),Z2(t,e)}const eC=E.newInstance(Mg,"vtkOpenGLOrderIndependentTranslucentPass");var tC={newInstance:eC,extend:Mg};function rC(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=n,t.setCurrentOperation("buildPass"),r.traverse(t);const a=r.getRenderable().getNumberOfLayers(),s=r.getRenderable().getRenderersByReference();for(let i=0;i<a;i++)for(let o=0;o<s.length;o++){const c=s[o],u=r.getViewNodeFor(c);if(c.getDraw()&&c.getLayer()===i){if(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumeCount=0,e.overlayActorCount=0,t.setCurrentOperation("queryPass"),u.traverse(t),(e.opaqueActorCount>0||e.translucentActorCount>0)&&e.volumeCount>0||e.depthRequested){const g=r.getFramebufferSize();e.framebuffer===null&&(e.framebuffer=Qs.newInstance()),e.framebuffer.setOpenGLRenderWindow(r),e.framebuffer.saveCurrentBindingsAndBuffers();const f=e.framebuffer.getSize();(f===null||f[0]!==g[0]||f[1]!==g[1])&&(e.framebuffer.create(g[0],g[1]),e.framebuffer.populateFramebuffer()),e.framebuffer.bind(),t.setCurrentOperation("zBufferPass"),u.traverse(t),e.framebuffer.restorePreviousBindingsAndBuffers(),e.depthRequested=!1}t.setCurrentOperation("cameraPass"),u.traverse(t),e.opaqueActorCount>0&&(t.setCurrentOperation("opaquePass"),u.traverse(t)),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=tC.newInstance()),e.translucentPass.traverse(r,u,t)),e.volumeCount>0&&(t.setCurrentOperation("volumePass"),u.traverse(t)),e.overlayActorCount>0&&(t.setCurrentOperation("overlayPass"),u.traverse(t))}}},t.getZBufferTexture=()=>e.framebuffer?e.framebuffer.getColorTexture():null,t.requestDepth=()=>{e.depthRequested=!0},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.incrementVolumeCount=()=>e.volumeCount++,t.incrementOverlayActorCount=()=>e.overlayActorCount++}const nC={opaqueActorCount:0,translucentActorCount:0,volumeCount:0,overlayActorCount:0,framebuffer:null,depthRequested:!1};function Dg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,nC,r),at.extend(t,e,r),E.get(t,e,["framebuffer","opaqueActorCount","translucentActorCount","volumeCount"]),rC(t,e)}const aC=E.newInstance(Dg,"vtkForwardPass");var sC={newInstance:aC,extend:Dg};const{FieldAssociations:iC}=bt;function oC(t,e){e.classHierarchy.push("vtkHardwareSelector"),t.getSourceDataAsync=async(r,n,a,s,i)=>{},t.selectAsync=async(r,n,a,s,i)=>{const o=await t.getSourceDataAsync(r,n,a,s,i);return o?o.generateSelection(n,a,s,i):[]}}const cC={fieldAssociation:iC.FIELD_ASSOCIATION_CELLS,captureZValues:!1};function Lg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,cC,r),E.obj(t,e),E.setGet(t,e,["fieldAssociation","captureZValues"]),oC(t,e)}const fC=E.newInstance(Lg,"vtkHardwareSelector");var Vg={newInstance:fC,extend:Lg};const uC={GLOBALIDS:0,PEDIGREEIDS:1,VALUES:2,INDICES:3,FRUSTUM:4,LOCATIONS:5,THRESHOLDS:6,BLOCKS:7,QUERY:8},gC={CELL:0,POINT:1,FIELD:2,VERTEX:3,EDGE:4,ROW:5};var lC={SelectionContent:uC,SelectionField:gC};function pC(t,e){e.classHierarchy.push("vtkSelectionNode"),t.getBounds=()=>e.points.getBounds()}const hC={contentType:-1,fieldType:-1,properties:null,selectionList:[]};function _g(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,hC,r),E.obj(t,e),e.properties={},E.setGet(t,e,["contentType","fieldType","properties","selectionList"]),pC(t,e)}const vC=E.newInstance(_g,"vtkSelectionNode");var qn={newInstance:vC,extend:_g,...lC};const{PassTypes:se}=ou,{SelectionContent:yC,SelectionField:bo}=qn,{FieldAssociations:Tr}=bt,{vtkErrorMacro:Bg}=E,ht=1;function Fg(t){return`${t.propID} ${t.compositeID}`}function Ug(t,e,r,n){if(!r)return 0;const a=(e*(n[2]-n[0]+1)+t)*4;return r[a+3]}function Ze(t,e,r,n){if(!r)return 0;const a=(e*(n[2]-n[0]+1)+t)*4,s=r[a],i=r[a+1];return(r[a+2]*256+i)*256+s}function mg(t,e){let r=e;return r<<=24,r|=t,r}function dC(t,e,r,n){{if(n[0]=e[0],n[1]=e[1],e[0]<t.area[0]||e[0]>t.area[2]||e[1]<t.area[1]||e[1]>t.area[3])return null;const a=[e[0]-t.area[0],e[1]-t.area[1]],s=Ze(a[0],a[1],t.pixBuffer[se.ACTOR_PASS],t.area);if(s<=0||s-ht>=t.props.length)return null;const i={};i.valid=!0,i.propID=s-ht,i.prop=t.props[i.propID];let o=Ze(a[0],a[1],t.pixBuffer[se.COMPOSITE_INDEX_PASS],t.area);if((o<0||o>16777215)&&(o=0),i.compositeID=o-ht,t.captureZValues){const g=(a[1]*(t.area[2]-t.area[0]+1)+a[0])*4;i.zValue=(256*t.zBuffer[g]+t.zBuffer[g+1])/65535,i.displayPosition=e}if(t.pixBuffer[se.ID_LOW24]&&Ug(a[0],a[1],t.pixBuffer[se.ID_LOW24],t.area)===0)return i;const c=Ze(a[0],a[1],t.pixBuffer[se.ID_LOW24],t.area),u=Ze(a[0],a[1],t.pixBuffer[se.ID_HIGH24],t.area);return i.attributeID=mg(c,u),i}}function kg(t,e,r,n,a){const s=[];let i=0;return e.forEach((o,c)=>{const u=qn.newInstance();switch(u.setContentType(yC.INDICES),t){case Tr.FIELD_ASSOCIATION_CELLS:u.setFieldType(bo.CELL);break;case Tr.FIELD_ASSOCIATION_POINTS:u.setFieldType(bo.POINT);break;default:Bg("Unknown field association")}u.getProperties().propID=o.info.propID,u.getProperties().prop=o.info.prop,u.getProperties().compositeID=o.info.compositeID,u.getProperties().attributeID=o.info.attributeID,u.getProperties().pixelCount=o.pixelCount,r&&(u.getProperties().displayPosition=[o.info.displayPosition[0],o.info.displayPosition[1],o.info.zValue],u.getProperties().worldPosition=a.displayToWorld(o.info.displayPosition[0],o.info.displayPosition[1],o.info.zValue,n)),u.setSelectionList(o.attributeIDs),s[i]=u,i++}),s}function TC(t,e,r,n,a){const s=Math.floor(e),i=Math.floor(r),o=Math.floor(n),c=Math.floor(a),u=new Map,g=[0,0];for(let f=i;f<=c;f++)for(let l=s;l<=o;l++){const y=dC(t,[l,f],0,g);if(y&&y.valid){const h=Fg(y);if(!u.has(h))u.set(h,{info:y,pixelCount:1,attributeIDs:[y.attributeID]});else{const v=u.get(h);v.pixelCount++,t.captureZValues&&y.zValue<v.info.zValue&&(v.info=y),v.attributeIDs.indexOf(y.attributeID)===-1&&v.attributeIDs.push(y.attributeID)}}}return kg(t.fieldAssociation,u,t.captureZValues,t.renderer,t.openGLRenderWindow)}function xC(t,e){e.classHierarchy.push("vtkOpenGLHardwareSelector"),t.releasePixBuffers=()=>{e.rawPixBuffer=[],e.pixBuffer=[],e.zBuffer=null},t.beginSelection=()=>{e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e.maxAttributeId=0;const n=e._openGLRenderWindow.getSize();if(!e.framebuffer)e.framebuffer=Qs.newInstance(),e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers(),e.framebuffer.create(n[0],n[1]),e.framebuffer.populateFramebuffer();else{e.framebuffer.setOpenGLRenderWindow(e._openGLRenderWindow),e.framebuffer.saveCurrentBindingsAndBuffers();const a=e.framebuffer.getSize();!a||a[0]!==n[0]||a[1]!==n[1]?(e.framebuffer.create(n[0],n[1]),e.framebuffer.populateFramebuffer()):e.framebuffer.bind()}if(e._openGLRenderer.clear(),e._openGLRenderer.setSelector(t),e.hitProps={},e.propPixels={},e.props=[],t.releasePixBuffers(),e.fieldAssociation===Tr.FIELD_ASSOCIATION_POINTS){const a=e._openGLRenderWindow.getContext(),s=a.isEnabled(a.BLEND);a.disable(a.BLEND),e._openGLRenderWindow.traverseAllPasses(),s&&a.enable(a.BLEND)}},t.endSelection=()=>{e.hitProps={},e._openGLRenderer.setSelector(null),e.framebuffer.restorePreviousBindingsAndBuffers()},t.preCapturePass=()=>{const n=e._openGLRenderWindow.getContext();e.originalBlending=n.isEnabled(n.BLEND),n.disable(n.BLEND)},t.postCapturePass=()=>{const n=e._openGLRenderWindow.getContext();e.originalBlending&&n.enable(n.BLEND)},t.select=()=>{let n=null;return t.captureBuffers()&&(n=t.generateSelection(e.area[0],e.area[1],e.area[2],e.area[3]),t.releasePixBuffers()),n},t.getSourceDataAsync=async(n,a,s,i,o)=>{if(e._renderer=n,a===void 0){const u=e._openGLRenderWindow.getSize();t.setArea(0,0,u[0]-1,u[1]-1)}else t.setArea(a,s,i,o);if(!t.captureBuffers())return!1;const c={area:[...e.area],pixBuffer:[...e.pixBuffer],captureZValues:e.captureZValues,zBuffer:e.zBuffer,props:[...e.props],fieldAssociation:e.fieldAssociation,renderer:n,openGLRenderWindow:e._openGLRenderWindow};return c.generateSelection=function(){for(var u=arguments.length,g=new Array(u),f=0;f<u;f++)g[f]=arguments[f];return TC(c,...g)},c},t.captureBuffers=()=>{if(!e._renderer||!e._openGLRenderWindow)return Bg("Renderer and view must be set before calling Select."),!1;e._openGLRenderer=e._openGLRenderWindow.getViewNodeFor(e._renderer),e._openGLRenderWindow.getRenderable().preRender(),t.invokeEvent({type:"StartEvent"}),e.originalBackground=e._renderer.getBackgroundByReference(),e._renderer.setBackground(0,0,0,0);const n=e._openGLRenderWindow.getRenderPasses();t.beginSelection();const a=[];for(e.currentPass=se.MIN_KNOWN_PASS;e.currentPass<=se.MAX_KNOWN_PASS;e.currentPass++)t.passRequired(e.currentPass)&&(t.preCapturePass(e.currentPass),e.captureZValues&&e.currentPass===se.ACTOR_PASS&&typeof n[0].requestDepth=="function"&&typeof n[0].getFramebuffer=="function"&&n[0].requestDepth(),e._openGLRenderWindow.traverseAllPasses(),t.postCapturePass(e.currentPass),t.savePixelBuffer(e.currentPass),a.push(e.currentPass));return a.forEach(s=>{e.currentPass=s,t.processPixelBuffers()}),e.currentPass=se.MAX_KNOWN_PASS,t.endSelection(),e._renderer.setBackground(e.originalBackground),t.invokeEvent({type:"EndEvent"}),!0},t.processPixelBuffers=()=>{e.props.forEach((n,a)=>{t.isPropHit(a)&&n.processSelectorPixelBuffers(t,e.propPixels[a])})},t.passRequired=n=>{if(n===se.ID_HIGH24){if(e.fieldAssociation===Tr.FIELD_ASSOCIATION_POINTS)return e.maximumPointId>16777215;if(e.fieldAssociation===Tr.FIELD_ASSOCIATION_CELLS)return e.maximumCellId>16777215}return!0},t.savePixelBuffer=n=>{if(e.pixBuffer[n]=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),!e.rawPixBuffer[n]){const a=(e.area[2]-e.area[0]+1)*(e.area[3]-e.area[1]+1)*4;e.rawPixBuffer[n]=new Uint8Array(a),e.rawPixBuffer[n].set(e.pixBuffer[n])}if(n===se.ACTOR_PASS){if(e.captureZValues){const a=e._openGLRenderWindow.getRenderPasses();if(typeof a[0].requestDepth=="function"&&typeof a[0].getFramebuffer=="function"){const s=a[0].getFramebuffer();s.saveCurrentBindingsAndBuffers(),s.bind(),e.zBuffer=e._openGLRenderWindow.getPixelData(e.area[0],e.area[1],e.area[2],e.area[3]),s.restorePreviousBindingsAndBuffers()}}t.buildPropHitList(e.rawPixBuffer[n])}},t.buildPropHitList=n=>{let a=0;for(let s=0;s<=e.area[3]-e.area[1];s++)for(let i=0;i<=e.area[2]-e.area[0];i++){let o=Ze(i,s,n,e.area);o>0&&(o--,o in e.hitProps||(e.hitProps[o]=!0,e.propPixels[o]=[]),e.propPixels[o].push(a*4)),++a}},t.renderProp=n=>{e.currentPass===se.ACTOR_PASS&&(t.setPropColorValueFromInt(e.props.length+ht),e.props.push(n))},t.renderCompositeIndex=n=>{e.currentPass===se.COMPOSITE_INDEX_PASS&&t.setPropColorValueFromInt(n+ht)},t.renderAttributeId=n=>{n<0||(e.maxAttributeId=n>e.maxAttributeId?n:e.maxAttributeId)},t.passTypeToString=n=>E.enumToString(se,n),t.isPropHit=n=>!!e.hitProps[n],t.setPropColorValueFromInt=n=>{e.propColorValue[0]=n%256/255,e.propColorValue[1]=Math.floor(n/256)%256/255,e.propColorValue[2]=Math.floor(n/65536)%256/255},t.getPixelInformation=(n,a,s)=>{const i=a<0?0:a;if(i===0){if(s[0]=n[0],s[1]=n[1],n[0]<e.area[0]||n[0]>e.area[2]||n[1]<e.area[1]||n[1]>e.area[3])return null;const g=[n[0]-e.area[0],n[1]-e.area[1]],f=Ze(g[0],g[1],e.pixBuffer[se.ACTOR_PASS],e.area);if(f<=0||f-ht>=e.props.length)return null;const l={};l.valid=!0,l.propID=f-ht,l.prop=e.props[l.propID];let p=Ze(g[0],g[1],e.pixBuffer[se.COMPOSITE_INDEX_PASS],e.area);if((p<0||p>16777215)&&(p=0),l.compositeID=p-ht,e.captureZValues){const v=(g[1]*(e.area[2]-e.area[0]+1)+g[0])*4;l.zValue=(256*e.zBuffer[v]+e.zBuffer[v+1])/65535,l.displayPosition=n}if(e.pixBuffer[se.ID_LOW24]&&Ug(g[0],g[1],e.pixBuffer[se.ID_LOW24],e.area)===0)return l;const y=Ze(g[0],g[1],e.pixBuffer[se.ID_LOW24],e.area),h=Ze(g[0],g[1],e.pixBuffer[se.ID_HIGH24],e.area);return l.attributeID=mg(y,h),l}const o=[n[0],n[1]],c=[0,0];let u=t.getPixelInformation(n,0,s);if(u&&u.valid)return u;for(let g=1;g<i;++g){for(let f=o[1]>g?o[1]-g:0;f<=o[1]+g;++f)if(c[1]=f,o[0]>=g&&(c[0]=o[0]-g,u=t.getPixelInformation(c,0,s),u&&u.valid)||(c[0]=o[0]+g,u=t.getPixelInformation(c,0,s),u&&u.valid))return u;for(let f=o[0]>=g?o[0]-(g-1):0;f<=o[0]+(g-1);++f)if(c[0]=f,o[1]>=g&&(c[1]=o[1]-g,u=t.getPixelInformation(c,0,s),u&&u.valid)||(c[1]=o[1]+g,u=t.getPixelInformation(c,0,s),u&&u.valid))return u}return s[0]=n[0],s[1]=n[1],null},t.generateSelection=(n,a,s,i)=>{const o=Math.floor(n),c=Math.floor(a),u=Math.floor(s),g=Math.floor(i),f=new Map,l=[0,0];for(let p=c;p<=g;p++)for(let y=o;y<=u;y++){const h=[y,p],v=t.getPixelInformation(h,0,l);if(v&&v.valid){const x=Fg(v);if(!f.has(x))f.set(x,{info:v,pixelCount:1,attributeIDs:[v.attributeID]});else{const S=f.get(x);S.pixelCount++,e.captureZValues&&v.zValue<S.info.zValue&&(S.info=v),S.attributeIDs.indexOf(v.attributeID)===-1&&S.attributeIDs.push(v.attributeID)}}}return kg(e.fieldAssociation,f,e.captureZValues,e._renderer,e._openGLRenderWindow)},t.getRawPixelBuffer=n=>e.rawPixBuffer[n],t.getPixelBuffer=n=>e.pixBuffer[n],t.attach=(n,a)=>{e._openGLRenderWindow=n,e._renderer=a};const r=t.setArea;t.setArea=function(){return r(...arguments)?(e.area[0]=Math.floor(e.area[0]),e.area[1]=Math.floor(e.area[1]),e.area[2]=Math.floor(e.area[2]),e.area[3]=Math.floor(e.area[3]),!0):!1}}const SC={area:void 0,currentPass:-1,propColorValue:null,props:null,maximumPointId:0,maximumCellId:0,idOffset:1};function Ng(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,SC,r),Vg.extend(t,e,r),e.propColorValue=[0,0,0],e.props=[],e.area||(e.area=[0,0,0,0]),E.setGetArray(t,e,["area"],4),E.setGet(t,e,["_renderer","currentPass","_openGLRenderWindow","maximumPointId","maximumCellId"]),E.setGetArray(t,e,["propColorValue"],3),E.moveToProtected(t,e,["renderer","openGLRenderWindow"]),E.event(t,e,"event"),xC(t,e)}const CC=E.newInstance(Ng,"vtkOpenGLHardwareSelector");var Gg={newInstance:CC,extend:Ng,...ou},ba={exports:{}},$o;function wC(){return $o||($o=1,function(t,e){(function(r){t.exports=r()})(function(r){var n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function a(x,S){var d=x[0],T=x[1],w=x[2],C=x[3];d+=(T&w|~T&C)+S[0]-680876936|0,d=(d<<7|d>>>25)+T|0,C+=(d&T|~d&w)+S[1]-389564586|0,C=(C<<12|C>>>20)+d|0,w+=(C&d|~C&T)+S[2]+606105819|0,w=(w<<17|w>>>15)+C|0,T+=(w&C|~w&d)+S[3]-1044525330|0,T=(T<<22|T>>>10)+w|0,d+=(T&w|~T&C)+S[4]-176418897|0,d=(d<<7|d>>>25)+T|0,C+=(d&T|~d&w)+S[5]+1200080426|0,C=(C<<12|C>>>20)+d|0,w+=(C&d|~C&T)+S[6]-1473231341|0,w=(w<<17|w>>>15)+C|0,T+=(w&C|~w&d)+S[7]-45705983|0,T=(T<<22|T>>>10)+w|0,d+=(T&w|~T&C)+S[8]+1770035416|0,d=(d<<7|d>>>25)+T|0,C+=(d&T|~d&w)+S[9]-1958414417|0,C=(C<<12|C>>>20)+d|0,w+=(C&d|~C&T)+S[10]-42063|0,w=(w<<17|w>>>15)+C|0,T+=(w&C|~w&d)+S[11]-1990404162|0,T=(T<<22|T>>>10)+w|0,d+=(T&w|~T&C)+S[12]+1804603682|0,d=(d<<7|d>>>25)+T|0,C+=(d&T|~d&w)+S[13]-40341101|0,C=(C<<12|C>>>20)+d|0,w+=(C&d|~C&T)+S[14]-1502002290|0,w=(w<<17|w>>>15)+C|0,T+=(w&C|~w&d)+S[15]+1236535329|0,T=(T<<22|T>>>10)+w|0,d+=(T&C|w&~C)+S[1]-165796510|0,d=(d<<5|d>>>27)+T|0,C+=(d&w|T&~w)+S[6]-1069501632|0,C=(C<<9|C>>>23)+d|0,w+=(C&T|d&~T)+S[11]+643717713|0,w=(w<<14|w>>>18)+C|0,T+=(w&d|C&~d)+S[0]-373897302|0,T=(T<<20|T>>>12)+w|0,d+=(T&C|w&~C)+S[5]-701558691|0,d=(d<<5|d>>>27)+T|0,C+=(d&w|T&~w)+S[10]+38016083|0,C=(C<<9|C>>>23)+d|0,w+=(C&T|d&~T)+S[15]-660478335|0,w=(w<<14|w>>>18)+C|0,T+=(w&d|C&~d)+S[4]-405537848|0,T=(T<<20|T>>>12)+w|0,d+=(T&C|w&~C)+S[9]+568446438|0,d=(d<<5|d>>>27)+T|0,C+=(d&w|T&~w)+S[14]-1019803690|0,C=(C<<9|C>>>23)+d|0,w+=(C&T|d&~T)+S[3]-187363961|0,w=(w<<14|w>>>18)+C|0,T+=(w&d|C&~d)+S[8]+1163531501|0,T=(T<<20|T>>>12)+w|0,d+=(T&C|w&~C)+S[13]-1444681467|0,d=(d<<5|d>>>27)+T|0,C+=(d&w|T&~w)+S[2]-51403784|0,C=(C<<9|C>>>23)+d|0,w+=(C&T|d&~T)+S[7]+1735328473|0,w=(w<<14|w>>>18)+C|0,T+=(w&d|C&~d)+S[12]-1926607734|0,T=(T<<20|T>>>12)+w|0,d+=(T^w^C)+S[5]-378558|0,d=(d<<4|d>>>28)+T|0,C+=(d^T^w)+S[8]-2022574463|0,C=(C<<11|C>>>21)+d|0,w+=(C^d^T)+S[11]+1839030562|0,w=(w<<16|w>>>16)+C|0,T+=(w^C^d)+S[14]-35309556|0,T=(T<<23|T>>>9)+w|0,d+=(T^w^C)+S[1]-1530992060|0,d=(d<<4|d>>>28)+T|0,C+=(d^T^w)+S[4]+1272893353|0,C=(C<<11|C>>>21)+d|0,w+=(C^d^T)+S[7]-155497632|0,w=(w<<16|w>>>16)+C|0,T+=(w^C^d)+S[10]-1094730640|0,T=(T<<23|T>>>9)+w|0,d+=(T^w^C)+S[13]+681279174|0,d=(d<<4|d>>>28)+T|0,C+=(d^T^w)+S[0]-358537222|0,C=(C<<11|C>>>21)+d|0,w+=(C^d^T)+S[3]-722521979|0,w=(w<<16|w>>>16)+C|0,T+=(w^C^d)+S[6]+76029189|0,T=(T<<23|T>>>9)+w|0,d+=(T^w^C)+S[9]-640364487|0,d=(d<<4|d>>>28)+T|0,C+=(d^T^w)+S[12]-421815835|0,C=(C<<11|C>>>21)+d|0,w+=(C^d^T)+S[15]+530742520|0,w=(w<<16|w>>>16)+C|0,T+=(w^C^d)+S[2]-995338651|0,T=(T<<23|T>>>9)+w|0,d+=(w^(T|~C))+S[0]-198630844|0,d=(d<<6|d>>>26)+T|0,C+=(T^(d|~w))+S[7]+1126891415|0,C=(C<<10|C>>>22)+d|0,w+=(d^(C|~T))+S[14]-1416354905|0,w=(w<<15|w>>>17)+C|0,T+=(C^(w|~d))+S[5]-57434055|0,T=(T<<21|T>>>11)+w|0,d+=(w^(T|~C))+S[12]+1700485571|0,d=(d<<6|d>>>26)+T|0,C+=(T^(d|~w))+S[3]-1894986606|0,C=(C<<10|C>>>22)+d|0,w+=(d^(C|~T))+S[10]-1051523|0,w=(w<<15|w>>>17)+C|0,T+=(C^(w|~d))+S[1]-2054922799|0,T=(T<<21|T>>>11)+w|0,d+=(w^(T|~C))+S[8]+1873313359|0,d=(d<<6|d>>>26)+T|0,C+=(T^(d|~w))+S[15]-30611744|0,C=(C<<10|C>>>22)+d|0,w+=(d^(C|~T))+S[6]-1560198380|0,w=(w<<15|w>>>17)+C|0,T+=(C^(w|~d))+S[13]+1309151649|0,T=(T<<21|T>>>11)+w|0,d+=(w^(T|~C))+S[4]-145523070|0,d=(d<<6|d>>>26)+T|0,C+=(T^(d|~w))+S[11]-1120210379|0,C=(C<<10|C>>>22)+d|0,w+=(d^(C|~T))+S[2]+718787259|0,w=(w<<15|w>>>17)+C|0,T+=(C^(w|~d))+S[9]-343485551|0,T=(T<<21|T>>>11)+w|0,x[0]=d+x[0]|0,x[1]=T+x[1]|0,x[2]=w+x[2]|0,x[3]=C+x[3]|0}function s(x){var S=[],d;for(d=0;d<64;d+=4)S[d>>2]=x.charCodeAt(d)+(x.charCodeAt(d+1)<<8)+(x.charCodeAt(d+2)<<16)+(x.charCodeAt(d+3)<<24);return S}function i(x){var S=[],d;for(d=0;d<64;d+=4)S[d>>2]=x[d]+(x[d+1]<<8)+(x[d+2]<<16)+(x[d+3]<<24);return S}function o(x){var S=x.length,d=[1732584193,-271733879,-1732584194,271733878],T,w,C,O,R,L;for(T=64;T<=S;T+=64)a(d,s(x.substring(T-64,T)));for(x=x.substring(T-64),w=x.length,C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],T=0;T<w;T+=1)C[T>>2]|=x.charCodeAt(T)<<(T%4<<3);if(C[T>>2]|=128<<(T%4<<3),T>55)for(a(d,C),T=0;T<16;T+=1)C[T]=0;return O=S*8,O=O.toString(16).match(/(.*?)(.{0,8})$/),R=parseInt(O[2],16),L=parseInt(O[1],16)||0,C[14]=R,C[15]=L,a(d,C),d}function c(x){var S=x.length,d=[1732584193,-271733879,-1732584194,271733878],T,w,C,O,R,L;for(T=64;T<=S;T+=64)a(d,i(x.subarray(T-64,T)));for(x=T-64<S?x.subarray(T-64):new Uint8Array(0),w=x.length,C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],T=0;T<w;T+=1)C[T>>2]|=x[T]<<(T%4<<3);if(C[T>>2]|=128<<(T%4<<3),T>55)for(a(d,C),T=0;T<16;T+=1)C[T]=0;return O=S*8,O=O.toString(16).match(/(.*?)(.{0,8})$/),R=parseInt(O[2],16),L=parseInt(O[1],16)||0,C[14]=R,C[15]=L,a(d,C),d}function u(x){var S="",d;for(d=0;d<4;d+=1)S+=n[x>>d*8+4&15]+n[x>>d*8&15];return S}function g(x){var S;for(S=0;S<x.length;S+=1)x[S]=u(x[S]);return x.join("")}g(o("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function x(S,d){return S=S|0||0,S<0?Math.max(S+d,0):Math.min(S,d)}ArrayBuffer.prototype.slice=function(S,d){var T=this.byteLength,w=x(S,T),C=T,O,R,L,M;return d!==r&&(C=x(d,T)),w>C?new ArrayBuffer(0):(O=C-w,R=new ArrayBuffer(O),L=new Uint8Array(R),M=new Uint8Array(this,w,O),L.set(M),R)}}();function f(x){return/[\u0080-\uFFFF]/.test(x)&&(x=unescape(encodeURIComponent(x))),x}function l(x,S){var d=x.length,T=new ArrayBuffer(d),w=new Uint8Array(T),C;for(C=0;C<d;C+=1)w[C]=x.charCodeAt(C);return S?w:T}function p(x){return String.fromCharCode.apply(null,new Uint8Array(x))}function y(x,S,d){var T=new Uint8Array(x.byteLength+S.byteLength);return T.set(new Uint8Array(x)),T.set(new Uint8Array(S),x.byteLength),T}function h(x){var S=[],d=x.length,T;for(T=0;T<d-1;T+=2)S.push(parseInt(x.substr(T,2),16));return String.fromCharCode.apply(String,S)}function v(){this.reset()}return v.prototype.append=function(x){return this.appendBinary(f(x)),this},v.prototype.appendBinary=function(x){this._buff+=x,this._length+=x.length;var S=this._buff.length,d;for(d=64;d<=S;d+=64)a(this._hash,s(this._buff.substring(d-64,d)));return this._buff=this._buff.substring(d-64),this},v.prototype.end=function(x){var S=this._buff,d=S.length,T,w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],C;for(T=0;T<d;T+=1)w[T>>2]|=S.charCodeAt(T)<<(T%4<<3);return this._finish(w,d),C=g(this._hash),x&&(C=h(C)),this.reset(),C},v.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},v.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},v.prototype.setState=function(x){return this._buff=x.buff,this._length=x.length,this._hash=x.hash,this},v.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},v.prototype._finish=function(x,S){var d=S,T,w,C;if(x[d>>2]|=128<<(d%4<<3),d>55)for(a(this._hash,x),d=0;d<16;d+=1)x[d]=0;T=this._length*8,T=T.toString(16).match(/(.*?)(.{0,8})$/),w=parseInt(T[2],16),C=parseInt(T[1],16)||0,x[14]=w,x[15]=C,a(this._hash,x)},v.hash=function(x,S){return v.hashBinary(f(x),S)},v.hashBinary=function(x,S){var d=o(x),T=g(d);return S?h(T):T},v.ArrayBuffer=function(){this.reset()},v.ArrayBuffer.prototype.append=function(x){var S=y(this._buff.buffer,x),d=S.length,T;for(this._length+=x.byteLength,T=64;T<=d;T+=64)a(this._hash,i(S.subarray(T-64,T)));return this._buff=T-64<d?new Uint8Array(S.buffer.slice(T-64)):new Uint8Array(0),this},v.ArrayBuffer.prototype.end=function(x){var S=this._buff,d=S.length,T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w,C;for(w=0;w<d;w+=1)T[w>>2]|=S[w]<<(w%4<<3);return this._finish(T,d),C=g(this._hash),x&&(C=h(C)),this.reset(),C},v.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},v.ArrayBuffer.prototype.getState=function(){var x=v.prototype.getState.call(this);return x.buff=p(x.buff),x},v.ArrayBuffer.prototype.setState=function(x){return x.buff=l(x.buff,!0),v.prototype.setState.call(this,x)},v.ArrayBuffer.prototype.destroy=v.prototype.destroy,v.ArrayBuffer.prototype._finish=v.prototype._finish,v.ArrayBuffer.hash=function(x,S){var d=c(new Uint8Array(x)),T=g(d);return S?h(T):T},v})}(ba)),ba.exports}var EC=wC();const OC=Ts(EC),RC=["lastShaderProgramBound","context","_openGLRenderWindow"];function MC(t,e){e.classHierarchy.push("vtkShaderCache"),t.replaceShaderValues=(r,n,a)=>{let s=n;a.length>0&&(s=F.substitute(s,"VSOut","GSOut").result);const i=e._openGLRenderWindow.getWebgl2();let o=`
`,c=`#version 100
`;i?c=`#version 300 es
#define attribute in
#define textureCube texture
#define texture2D texture
#define textureCubeLod textureLod
#define texture2DLod textureLod
`:(e.context.getExtension("OES_standard_derivatives"),e.context.getExtension("EXT_frag_depth")&&(o=`#extension GL_EXT_frag_depth : enable
`),e.context.getExtension("EXT_shader_texture_lod")&&(o+=`#extension GL_EXT_shader_texture_lod : enable
#define textureCubeLod textureCubeLodEXT
#define texture2DLod texture2DLodEXT`)),s=F.substitute(s,"//VTK::System::Dec",[`${c}
`,i?"":`#extension GL_OES_standard_derivatives : enable
`,o,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;let u=F.substitute(r,"//VTK::System::Dec",[`${c}
`,"#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","#else","precision mediump float;","precision mediump int;","#endif"]).result;if(i){u=F.substitute(u,"varying","out").result,s=F.substitute(s,"varying","in").result;let f="",l=0;for(;s.includes(`gl_FragData[${l}]`);)s=F.substitute(s,`gl_FragData\\[${l}\\]`,`fragOutput${l}`).result,f+=`layout(location = ${l}) out vec4 fragOutput${l};
`,l++;s=F.substitute(s,"//VTK::Output::Dec",f).result}const g=F.substitute(a,"//VTK::System::Dec",c).result;return{VSSource:u,FSSource:s,GSSource:g}},t.readyShaderProgramArray=(r,n,a)=>{const s=t.replaceShaderValues(r,n,a),i=t.getShaderProgram(s.VSSource,s.FSSource,s.GSSource);return t.readyShaderProgram(i)},t.readyShaderProgram=r=>!r||!r.getCompiled()&&!r.compileShader()||!t.bindShaderProgram(r)?null:r,t.getShaderProgram=(r,n,a)=>{const s=`${r}${n}${a}`,i=OC.hash(s);if(!(i in e.shaderPrograms)){const o=F.newInstance();return o.setContext(e.context),o.getVertexShader().setSource(r),o.getFragmentShader().setSource(n),a&&o.getGeometryShader().setSource(a),o.setMd5Hash(i),e.shaderPrograms[i]=o,o}return e.shaderPrograms[i]},t.releaseGraphicsResources=r=>{t.releaseCurrentShaderProgram(),Object.keys(e.shaderPrograms).map(n=>e.shaderPrograms[n]).forEach(n=>n.cleanup()),e.shaderPrograms={}},t.releaseCurrentShaderProgram=()=>{e.lastShaderProgramBound&&(e.lastShaderProgramBound.cleanup(),e.lastShaderProgramBound=null)},t.bindShaderProgram=r=>(e.lastShaderProgramBound===r||(e.lastShaderProgramBound&&e.lastShaderProgramBound.release(),r.bind(),e.lastShaderProgramBound=r),1)}const DC={lastShaderProgramBound:null,shaderPrograms:null,context:null};function bg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,DC,r),e.shaderPrograms={},E.obj(t,e),E.setGet(t,e,RC),E.moveToProtected(t,e,["openGLRenderWindow"]),MC(t,e)}const LC=E.newInstance(bg,"vtkShaderCache");var VC={newInstance:LC,extend:bg};const{vtkErrorMacro:_C}=E;function BC(t,e){e.classHierarchy.push("vtkOpenGLTextureUnitManager"),t.deleteTable=()=>{for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]===!0&&_C("some texture units  were not properly released");e.textureUnits=[],e.numberOfTextureUnits=0},t.setContext=r=>{if(e.context!==r){if(e.context!==0&&t.deleteTable(),e.context=r,e.context){e.numberOfTextureUnits=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS);for(let n=0;n<e.numberOfTextureUnits;++n)e.textureUnits[n]=!1}t.modified()}},t.allocate=()=>{for(let r=0;r<e.numberOfTextureUnits;r++)if(!t.isAllocated(r))return e.textureUnits[r]=!0,r;return-1},t.allocateUnit=r=>t.isAllocated(r)?-1:(e.textureUnits[r]=!0,r),t.isAllocated=r=>e.textureUnits[r],t.free=r=>{e.textureUnits[r]=!1},t.freeAll=()=>{for(let r=0;r<e.numberOfTextureUnits;++r)e.textureUnits[r]=!1}}const FC={context:null,numberOfTextureUnits:0,textureUnits:0};function $g(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,FC,r),E.obj(t,e),e.textureUnits=[],E.get(t,e,["numberOfTextureUnits"]),E.setGet(t,e,["context"]),BC(t,e)}const UC=E.newInstance($g,"vtkOpenGLTextureUnitManager");var mC={newInstance:UC,extend:$g};function kC(t,e){e.classHierarchy.push("vtkRenderWindowViewNode"),t.getViewNodeFactory=()=>null,t.getAspectRatio=()=>e.size[0]/e.size[1],t.getAspectRatioForRenderer=r=>{const n=r.getViewportByReference();return e.size[0]*(n[2]-n[0])/((n[3]-n[1])*e.size[1])},t.isInViewport=(r,n,a)=>{const s=a.getViewportByReference(),i=t.getFramebufferSize();return s[0]*i[0]<=r&&s[2]*i[0]>=r&&s[1]*i[1]<=n&&s[3]*i[1]>=n},t.getViewportSize=r=>{const n=r.getViewportByReference(),a=t.getFramebufferSize();return[(n[2]-n[0])*a[0],(n[3]-n[1])*a[1]]},t.getViewportCenter=r=>{const n=t.getViewportSize(r);return[n[0]*.5,n[1]*.5]},t.displayToNormalizedDisplay=(r,n,a)=>{const s=t.getFramebufferSize();return[r/s[0],n/s[1],a]},t.normalizedDisplayToDisplay=(r,n,a)=>{const s=t.getFramebufferSize();return[r*s[0],n*s[1],a]},t.worldToView=(r,n,a,s)=>s.worldToView(r,n,a),t.viewToWorld=(r,n,a,s)=>s.viewToWorld(r,n,a),t.worldToDisplay=(r,n,a,s)=>{const i=s.worldToView(r,n,a),o=t.getViewportSize(s),c=s.viewToProjection(i[0],i[1],i[2],o[0]/o[1]),u=s.projectionToNormalizedDisplay(c[0],c[1],c[2]);return t.normalizedDisplayToDisplay(u[0],u[1],u[2])},t.displayToWorld=(r,n,a,s)=>{const i=t.displayToNormalizedDisplay(r,n,a),o=s.normalizedDisplayToProjection(i[0],i[1],i[2]),c=t.getViewportSize(s),u=s.projectionToView(o[0],o[1],o[2],c[0]/c[1]);return s.viewToWorld(u[0],u[1],u[2])},t.normalizedDisplayToViewport=(r,n,a,s)=>{let i=s.getViewportByReference();i=t.normalizedDisplayToDisplay(i[0],i[1],0);const o=t.normalizedDisplayToDisplay(r,n,a);return[o[0]-i[0]-.5,o[1]-i[1]-.5,a]},t.viewportToNormalizedViewport=(r,n,a,s)=>{const i=t.getViewportSize(s);return i&&i[0]!==0&&i[1]!==0?[r/(i[0]-1),n/(i[1]-1),a]:[r,n,a]},t.normalizedViewportToViewport=(r,n,a,s)=>{const i=t.getViewportSize(s);return[r*(i[0]-1),n*(i[1]-1),a]},t.displayToLocalDisplay=(r,n,a)=>{const s=t.getFramebufferSize();return[r,s[1]-n-1,a]},t.viewportToNormalizedDisplay=(r,n,a,s)=>{let i=s.getViewportByReference();i=t.normalizedDisplayToDisplay(i[0],i[1],0);const o=r+i[0]+.5,c=n+i[1]+.5;return t.displayToNormalizedDisplay(o,c,a)},t.getComputedDevicePixelRatio=()=>e.size[0]/t.getContainerSize()[0],t.getContainerSize=()=>{E.vtkErrorMacro("not implemented")},t.getPixelData=(r,n,a,s)=>{E.vtkErrorMacro("not implemented")},t.createSelector=()=>{E.vtkErrorMacro("not implemented")}}const NC={size:void 0,selector:void 0};function Wg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,NC,r),e.size||(e.size=[300,300]),E.getArray(t,e,["size"],2),E.get(t,e,["selector"]),ae.extend(t,e,r),kC(t,e)}const GC=E.newInstance(Wg,"vtkRenderWindowViewNode");var zg={newInstance:GC,extend:Wg};const bC="__getUnderlyingContext";function $C(){const t=new Map,e={apply(a,s,i){return t.has(i[0])?t.get(i[0]):a.apply(s,i)}};function r(a){return{apply(s,i,o){return t.set(a,o[0]),s.apply(i,o)}}}const n=Object.create(null);return n.getParameter=(a,s,i,o)=>new Proxy(o.bind(a),e),n.depthMask=(a,s,i,o)=>new Proxy(o.bind(a),r(a.DEPTH_WRITEMASK)),{get(a,s,i){if(s===bC)return()=>a;let o=Reflect.get(a,s,a);o instanceof Function&&(o=o.bind(a));const c=n[s];return c?c(a,s,i,o):o}}}const{vtkDebugMacro:Wo,vtkErrorMacro:zo}=E,WC={position:"absolute",top:0,left:0,width:"100%",height:"100%"},zC=["activateTexture","deactivateTexture","disableCullFace","enableCullFace","get3DContext","getActiveFramebuffer","getContext","getDefaultTextureByteSize","getDefaultTextureInternalFormat","getDefaultToWebgl2","getGLInformations","getGraphicsMemoryInfo","getGraphicsResourceForObject","getHardwareMaximumLineWidth","getPixelData","getShaderCache","getTextureUnitForTexture","getTextureUnitManager","getWebgl2","makeCurrent","releaseGraphicsResources","registerGraphicsResourceUser","unregisterGraphicsResourceUser","restoreContext","setActiveFramebuffer","setContext","setDefaultToWebgl2","setGraphicsResourceForObject"];function Se(t,e,r){const n=t.createFramebuffer(),a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,e,2,2,0,e,r,null),t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a,0);const s=t.checkFramebufferStatus(t.FRAMEBUFFER);return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),s===t.FRAMEBUFFER_COMPLETE}let zn=0;const Hg=[];function HC(){zn++,Hg.forEach(t=>t(zn))}function AC(){zn--,Hg.forEach(t=>t(zn))}function Ho(t){t.preventDefault()}function jC(t,e){e.classHierarchy.push("vtkOpenGLRenderWindow");let r;function n(){return r||(r=$C()),r}t.getViewNodeFactory=()=>e.myFactory,e.canvas.addEventListener("webglcontextlost",Ho,!1),e.canvas.addEventListener("webglcontextrestored",t.restoreContext,!1);const a=[0,0];function s(){e.renderable&&(e.size[0]!==a[0]||e.size[1]!==a[1])&&(a[0]=e.size[0],a[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1])),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(s),t.buildPass=f=>{if(f){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.addMissingNodes(e.renderable.getChildRenderWindowsByReference()),t.removeUnusedNodes(),t.initialize(),e.children.forEach(l=>{var p;(p=l.setOpenGLRenderWindow)==null||p.call(l,t)})}},t.initialize=()=>{if(!e.initialized){if(e.rootOpenGLRenderWindow=t.getLastAncestorOfType("vtkOpenGLRenderWindow"),e.rootOpenGLRenderWindow)e.context2D=t.get2DContext();else{e.context=t.get3DContext(),t.resizeFromChildRenderWindows(),e.context&&HC(),e.textureUnitManager=mC.newInstance(),e.textureUnitManager.setContext(e.context),e.shaderCache.setContext(e.context);const f=e.context;f.blendFuncSeparate(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA),f.depthFunc(f.LEQUAL),f.enable(f.BLEND)}e.initialized=!0}},t.makeCurrent=()=>{e.context.makeCurrent()},t.setContainer=f=>{e.el&&e.el!==f&&(e.canvas.parentNode!==e.el&&zo("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==f&&(e.el=f,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:f,height:l}=e.el.getBoundingClientRect();e.containerSize=[f,l]}return e.containerSize||e.size},t.getFramebufferSize=()=>{var l;return((l=e.activeFramebuffer)==null?void 0:l.getSize())||e.size},t.getPixelData=(f,l,p,y)=>{const h=new Uint8Array((p-f+1)*(y-l+1)*4);return e.context.readPixels(f,l,p-f+1,y-l+1,e.context.RGBA,e.context.UNSIGNED_BYTE,h),h},t.get3DContext=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{preserveDrawingBuffer:!1,depth:!0,alpha:!0,powerPreference:"high-performance"},l=null;const p=typeof WebGL2RenderingContext<"u";return e.webgl2=!1,e.defaultToWebgl2&&p&&(l=e.canvas.getContext("webgl2",f),l&&(e.webgl2=!0,Wo("using webgl2"))),l||(Wo("using webgl1"),l=e.canvas.getContext("webgl",f)||e.canvas.getContext("experimental-webgl",f)),new Proxy(l,n())},t.get2DContext=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e.canvas.getContext("2d",f)},t.restoreContext=()=>{const f=at.newInstance();f.setCurrentOperation("Release"),f.traverse(t,null)},t.activateTexture=f=>{const l=e._textureResourceIds.get(f);if(l!==void 0){e.context.activeTexture(e.context.TEXTURE0+l);return}const p=t.getTextureUnitManager().allocate();if(p<0){zo("Hardware does not support the number of textures defined.");return}e._textureResourceIds.set(f,p),e.context.activeTexture(e.context.TEXTURE0+p)},t.deactivateTexture=f=>{const l=e._textureResourceIds.get(f);l!==void 0&&(t.getTextureUnitManager().free(l),e._textureResourceIds.delete(f))},t.getTextureUnitForTexture=f=>{const l=e._textureResourceIds.get(f);return l!==void 0?l:-1},t.getDefaultTextureByteSize=function(f){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(e.webgl2)switch(f){case le.CHAR:case le.SIGNED_CHAR:case le.UNSIGNED_CHAR:return 1;case l:case p:case le.UNSIGNED_SHORT:case le.SHORT:case le.VOID:return 2;default:return 4}return 1},t.getDefaultTextureInternalFormat=function(f,l){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.webgl2)switch(f){case le.UNSIGNED_CHAR:switch(l){case 1:return e.context.R8;case 2:return e.context.RG8;case 3:return e.context.RGB8;case 4:default:return e.context.RGBA8}case(p&&!y&&le.UNSIGNED_SHORT):switch(l){case 1:return p.R16_EXT;case 2:return p.RG16_EXT;case 3:return p.RGB16_EXT;case 4:default:return p.RGBA16_EXT}case(p&&!y&&le.SHORT):switch(l){case 1:return p.R16_SNORM_EXT;case 2:return p.RG16_SNORM_EXT;case 3:return p.RGB16_SNORM_EXT;case 4:default:return p.RGBA16_SNORM_EXT}case le.UNSIGNED_SHORT:case le.SHORT:case le.FLOAT:default:switch(l){case 1:return y?e.context.R16F:e.context.R32F;case 2:return y?e.context.RG16F:e.context.RG32F;case 3:return y?e.context.RGB16F:e.context.RGB32F;case 4:default:return y?e.context.RGBA16F:e.context.RGBA32F}}switch(l){case 1:return e.context.LUMINANCE;case 2:return e.context.LUMINANCE_ALPHA;case 3:return e.context.RGB;case 4:default:return e.context.RGBA}},t.setBackgroundImage=f=>{e.bgImage.src=f.src},t.setUseBackgroundImage=f=>{e.useBackgroundImage=f,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};function i(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const l=document.createElement("canvas"),p=l.getContext("2d");l.width=e.canvas.width,l.height=e.canvas.height,p.drawImage(e.canvas,0,0);const y=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(S=>{S.getViewProps().forEach(T=>{if(T.getContainer){const C=T.getContainer().getElementsByTagName("canvas");for(let O=0;O<C.length;O++){const R=C[O],L=R.getBoundingClientRect(),M=L.x-y.x,D=L.y-y.y;p.drawImage(R,M,D)}}})});const x=l.toDataURL(f);l.remove(),t.invokeImageReady(x)}t.captureNextImage=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:l=!1,size:p=null,scale:y=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=f;const h=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:p||y!==1?p||e.size.map(v=>v*y):null},new Promise((v,x)=>{const S=t.onImageReady(d=>{var T;if(e._screenshot.size===null)e.notifyStartCaptureImage=h,S.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(w=>{let{restoreParamsFn:C,arg:O}=w;return C(O)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),v(d);else{const w=document.createElement("img");if(w.style=WC,w.src=d,e._screenshot.placeHolder=e.el.appendChild(w),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,(T=e.rootOpenGLRenderWindow)==null||T.resizeFromChildRenderWindows(),e._screenshot.size=null,t.modified(),l){const C=l!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(O=>{const R=O.getActiveCamera(),L=R.get("focalPoint","position","parallelScale");return{resetCameraArgs:C?{renderer:O}:void 0,resetCameraFn:C?l:O.resetCamera,restoreParamsFn:R.set,arg:JSON.parse(JSON.stringify(L))}}),e._screenshot.cameras.forEach(O=>{let{resetCameraFn:R,resetCameraArgs:L}=O;return R(L)})}t.traverseAllPasses()}})})};let o;t.getHardwareMaximumLineWidth=()=>{if(o!=null)return o;const f=t.get3DContext(),l=f.getParameter(f.ALIASED_LINE_WIDTH_RANGE);return o=l[1],l[1]},t.getGLInformations=()=>{if(e._glInformation)return e._glInformation;const f=t.get3DContext(),l=f.getExtension("OES_texture_float"),p=f.getExtension("OES_texture_half_float"),y=f.getExtension("WEBGL_debug_renderer_info"),h=f.getExtension("WEBGL_draw_buffers"),v=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),x=[["Max Vertex Attributes","MAX_VERTEX_ATTRIBS",f.getParameter(f.MAX_VERTEX_ATTRIBS)],["Max Varying Vectors","MAX_VARYING_VECTORS",f.getParameter(f.MAX_VARYING_VECTORS)],["Max Vertex Uniform Vectors","MAX_VERTEX_UNIFORM_VECTORS",f.getParameter(f.MAX_VERTEX_UNIFORM_VECTORS)],["Max Fragment Uniform Vectors","MAX_FRAGMENT_UNIFORM_VECTORS",f.getParameter(f.MAX_FRAGMENT_UNIFORM_VECTORS)],["Max Fragment Texture Image Units","MAX_TEXTURE_IMAGE_UNITS",f.getParameter(f.MAX_TEXTURE_IMAGE_UNITS)],["Max Vertex Texture Image Units","MAX_VERTEX_TEXTURE_IMAGE_UNITS",f.getParameter(f.MAX_VERTEX_TEXTURE_IMAGE_UNITS)],["Max Combined Texture Image Units","MAX_COMBINED_TEXTURE_IMAGE_UNITS",f.getParameter(f.MAX_COMBINED_TEXTURE_IMAGE_UNITS)],["Max 2D Texture Size","MAX_TEXTURE_SIZE",f.getParameter(f.MAX_TEXTURE_SIZE)],["Max Cube Texture Size","MAX_CUBE_MAP_TEXTURE_SIZE",f.getParameter(f.MAX_CUBE_MAP_TEXTURE_SIZE)],["Max Texture Anisotropy","MAX_TEXTURE_MAX_ANISOTROPY_EXT",v&&f.getParameter(v.MAX_TEXTURE_MAX_ANISOTROPY_EXT)],["Point Size Range","ALIASED_POINT_SIZE_RANGE",f.getParameter(f.ALIASED_POINT_SIZE_RANGE).join(" - ")],["Line Width Range","ALIASED_LINE_WIDTH_RANGE",f.getParameter(f.ALIASED_LINE_WIDTH_RANGE).join(" - ")],["Max Viewport Dimensions","MAX_VIEWPORT_DIMS",f.getParameter(f.MAX_VIEWPORT_DIMS).join(" - ")],["Max Renderbuffer Size","MAX_RENDERBUFFER_SIZE",f.getParameter(f.MAX_RENDERBUFFER_SIZE)],["Framebuffer Red Bits","RED_BITS",f.getParameter(f.RED_BITS)],["Framebuffer Green Bits","GREEN_BITS",f.getParameter(f.GREEN_BITS)],["Framebuffer Blue Bits","BLUE_BITS",f.getParameter(f.BLUE_BITS)],["Framebuffer Alpha Bits","ALPHA_BITS",f.getParameter(f.ALPHA_BITS)],["Framebuffer Depth Bits","DEPTH_BITS",f.getParameter(f.DEPTH_BITS)],["Framebuffer Stencil Bits","STENCIL_BITS",f.getParameter(f.STENCIL_BITS)],["Framebuffer Subpixel Bits","SUBPIXEL_BITS",f.getParameter(f.SUBPIXEL_BITS)],["MSAA Samples","SAMPLES",f.getParameter(f.SAMPLES)],["MSAA Sample Buffers","SAMPLE_BUFFERS",f.getParameter(f.SAMPLE_BUFFERS)],["Supported Formats for UByte Render Targets     ","UNSIGNED_BYTE RENDER TARGET FORMATS",[l&&Se(f,f.RGBA,f.UNSIGNED_BYTE)?"RGBA":"",l&&Se(f,f.RGB,f.UNSIGNED_BYTE)?"RGB":"",l&&Se(f,f.LUMINANCE,f.UNSIGNED_BYTE)?"LUMINANCE":"",l&&Se(f,f.ALPHA,f.UNSIGNED_BYTE)?"ALPHA":"",l&&Se(f,f.LUMINANCE_ALPHA,f.UNSIGNED_BYTE)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Half Float Render Targets","HALF FLOAT RENDER TARGET FORMATS",[p&&Se(f,f.RGBA,p.HALF_FLOAT_OES)?"RGBA":"",p&&Se(f,f.RGB,p.HALF_FLOAT_OES)?"RGB":"",p&&Se(f,f.LUMINANCE,p.HALF_FLOAT_OES)?"LUMINANCE":"",p&&Se(f,f.ALPHA,p.HALF_FLOAT_OES)?"ALPHA":"",p&&Se(f,f.LUMINANCE_ALPHA,p.HALF_FLOAT_OES)?"LUMINANCE_ALPHA":""].join(" ")],["Supported Formats for Full Float Render Targets","FLOAT RENDER TARGET FORMATS",[l&&Se(f,f.RGBA,f.FLOAT)?"RGBA":"",l&&Se(f,f.RGB,f.FLOAT)?"RGB":"",l&&Se(f,f.LUMINANCE,f.FLOAT)?"LUMINANCE":"",l&&Se(f,f.ALPHA,f.FLOAT)?"ALPHA":"",l&&Se(f,f.LUMINANCE_ALPHA,f.FLOAT)?"LUMINANCE_ALPHA":""].join(" ")],["Max Multiple Render Targets Buffers","MAX_DRAW_BUFFERS_WEBGL",h?f.getParameter(h.MAX_DRAW_BUFFERS_WEBGL):0],["High Float Precision in Vertex Shader","HIGH_FLOAT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Vertex Shader","MEDIUM_FLOAT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Vertex Shader","LOW_FLOAT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Float Precision in Fragment Shader","HIGH_FLOAT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_FLOAT).rangeMax,"</sup>)"].join("")],["Medium Float Precision in Fragment Shader","MEDIUM_FLOAT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_FLOAT).rangeMax,"</sup>)"].join("")],["Low Float Precision in Fragment Shader","LOW_FLOAT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_FLOAT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_FLOAT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_FLOAT).rangeMax,"</sup>)"].join("")],["High Int Precision in Vertex Shader","HIGH_INT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Vertex Shader","MEDIUM_INT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Vertex Shader","LOW_INT VERTEX_SHADER",[f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.VERTEX_SHADER,f.LOW_INT).rangeMax,"</sup>)"].join("")],["High Int Precision in Fragment Shader","HIGH_INT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.HIGH_INT).rangeMax,"</sup>)"].join("")],["Medium Int Precision in Fragment Shader","MEDIUM_INT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.MEDIUM_INT).rangeMax,"</sup>)"].join("")],["Low Int Precision in Fragment Shader","LOW_INT FRAGMENT_SHADER",[f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_INT).precision," (-2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_INT).rangeMin,"</sup> - 2<sup>",f.getShaderPrecisionFormat(f.FRAGMENT_SHADER,f.LOW_INT).rangeMax,"</sup>)"].join("")],["Supported Extensions","EXTENSIONS",f.getSupportedExtensions().join("<br/>					    ")],["WebGL Renderer","RENDERER",f.getParameter(f.RENDERER)],["WebGL Vendor","VENDOR",f.getParameter(f.VENDOR)],["WebGL Version","VERSION",f.getParameter(f.VERSION)],["Shading Language Version","SHADING_LANGUAGE_VERSION",f.getParameter(f.SHADING_LANGUAGE_VERSION)],["Unmasked Renderer","UNMASKED_RENDERER",y&&f.getParameter(y.UNMASKED_RENDERER_WEBGL)],["Unmasked Vendor","UNMASKED_VENDOR",y&&f.getParameter(y.UNMASKED_VENDOR_WEBGL)],["WebGL Version","WEBGL_VERSION",e.webgl2?2:1]],S={};for(;x.length;){const[d,T,w]=x.pop();T&&(S[T]={label:d,value:w})}return e._glInformation=S,S},t.traverseAllPasses=()=>{var l;if(e.renderPasses)for(let p=0;p<e.renderPasses.length;++p)e.renderPasses[p].traverse(t,null);t.copyParentContent(),e.notifyStartCaptureImage&&i();const f=e.renderable.getChildRenderWindowsByReference();for(let p=0;p<f.length;++p)(l=t.getViewNodeFor(f[p]))==null||l.traverseAllPasses()},t.copyParentContent=()=>{const f=e.rootOpenGLRenderWindow;if(!f||!e.context2D||e.children.some(y=>{var h;return!!((h=y.getSelector)!=null&&h.call(y))}))return;const l=f.getCanvas(),p=e.canvas;e.context2D.drawImage(l,0,l.height-p.height,p.width,p.height,0,0,p.width,p.height)},t.resizeFromChildRenderWindows=()=>{var l;const f=e.renderable.getChildRenderWindowsByReference();if(f.length>0){const p=[0,0];for(let y=0;y<f.length;++y){const h=(l=t.getViewNodeFor(f[y]))==null?void 0:l.getSize();h&&(p[0]=h[0]>p[0]?h[0]:p[0],p[1]=h[1]>p[1]?h[1]:p[1])}t.setSize(...p)}},t.disableCullFace=()=>{e.cullFaceEnabled&&(e.context.disable(e.context.CULL_FACE),e.cullFaceEnabled=!1)},t.enableCullFace=()=>{e.cullFaceEnabled||(e.context.enable(e.context.CULL_FACE),e.cullFaceEnabled=!0)},t.setViewStream=f=>{if(e.viewStream===f)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=f,e.viewStream){const l=e.renderable.getRenderers()[0];l.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(p=>t.setBackgroundImage(p.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.createSelector=()=>{const f=Gg.newInstance();return f.setOpenGLRenderWindow(t),f};function c(){e.canvas.removeEventListener("webglcontextlost",Ho),e.canvas.removeEventListener("webglcontextrestored",t.restoreContext)}t.delete=E.chain(()=>{e.context&&AC(),t.setContainer(),t.setViewStream()},c,t.delete),t.setActiveFramebuffer=f=>{e.activeFramebuffer=f};const u=t.setSize;t.setSize=(f,l)=>{const p=u(f,l);return p&&t.invokeWindowResizeEvent({width:f,height:l}),p},t.registerGraphicsResourceUser=(f,l)=>{e._graphicsResources.has(f)||t.setGraphicsResourceForObject(f,null,null);const p=e._graphicsResources.get(f);p==null||p.users.add(l)},t.unregisterGraphicsResourceUser=(f,l)=>{var y;const p=e._graphicsResources.get(f);p&&(p.users.delete(l),p.users.size||((y=p.oglObject)==null||y.releaseGraphicsResources(t),e._graphicsResources.delete(f)))},t.getGraphicsResourceForObject=f=>e._graphicsResources.get(f),t.setGraphicsResourceForObject=(f,l,p)=>{var h;if(!f)return;const y=e._graphicsResources.get(f);(h=y==null?void 0:y.oglObject)==null||h.releaseGraphicsResources(t),e._graphicsResources.set(f,{coreObject:f,oglObject:l,hash:p,users:(y==null?void 0:y.users)??new Set})},t.getGraphicsMemoryInfo=()=>{let f=0;return e._graphicsResources.forEach(l=>{let{oglObject:p}=l;f+=p.getAllocatedGPUMemoryInBytes()}),f},t.releaseGraphicsResources=()=>{e.shaderCache!==null&&e.shaderCache.releaseGraphicsResources(t),e._graphicsResources.forEach(f=>{let{oglObject:l}=f;l.releaseGraphicsResources(t)}),e._graphicsResources.clear(),e.textureUnitManager!==null&&e.textureUnitManager.freeAll(),e.renderable.getRenderersByReference().forEach(f=>{const l=t.getViewNodeFor(f);l==null||l.releaseGraphicsResources()})};const g={...t};zC.forEach(f=>{t[f]=function(){return e.rootOpenGLRenderWindow?e.rootOpenGLRenderWindow[f](...arguments):g[f](...arguments)}})}const KC={cullFaceEnabled:!1,shaderCache:null,initialized:!1,context:null,context2D:null,canvas:null,cursorVisibility:!0,cursor:"pointer",textureUnitManager:null,textureResourceIds:null,containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,webgl2:!1,defaultToWebgl2:!0,activeFramebuffer:null,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1};function XC(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,KC,r),zg.extend(t,e,r),e.canvas||(e.canvas=document.createElement("canvas"),e.canvas.style.width="100%"),e.selector||(e.selector=Gg.newInstance(),e.selector.setOpenGLRenderWindow(t)),e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",e._textureResourceIds=new Map,e._graphicsResources=new Map,e._glInformation=null,e.myFactory=J0.newInstance(),e.shaderCache=VC.newInstance(),e.shaderCache.setOpenGLRenderWindow(t),e.renderPasses[0]=sC.newInstance(),E.get(t,e,["shaderCache","textureUnitManager","webgl2","useBackgroundImage","activeFramebuffer","rootOpenGLRenderWindow"]),E.setGet(t,e,["initialized","context","context2D","canvas","renderPasses","notifyStartCaptureImage","defaultToWebgl2","cursor","useOffScreen"]),E.setGetArray(t,e,["size"],2),E.event(t,e,"imageReady"),E.event(t,e,"windowResizeEvent"),jC(t,e)}const Ag=E.newInstance(XC,"vtkOpenGLRenderWindow");Ps("WebGL",Ag);Ve("vtkRenderWindow",Ag);const $a=["setBindGroup","setIndexBuffer","setVertexBuffer","draw","drawIndexed"];function PC(t,e){e.classHierarchy.push("vtkWebGPURenderEncoder"),t.begin=r=>{e.drawCallbacks=[],e.handle=r.beginRenderPass(e.description),e.label&&e.handle.pushDebugGroup(e.label)},t.end=()=>{for(let r=0;r<e.drawCallbacks.length;r++){const n=e.drawCallbacks[r],a=n.pipeline;t.setPipeline(a);for(let s=0;s<n.callbacks.length;s++)n.callbacks[s](t)}e.label&&e.handle.popDebugGroup(),e.handle.end(),e.boundPipeline=null},t.setPipeline=r=>{var a,s;if(e.boundPipeline===r)return;e.handle.setPipeline(r.getHandle());const n=r.getPipelineDescription();if(e.colorTextureViews.length!==n.fragment.targets.length)console.log(`mismatched attachment counts on pipeline ${n.fragment.targets.length} while encoder has ${e.colorTextureViews.length}`),console.trace();else for(let i=0;i<e.colorTextureViews.length;i++){const o=(a=e.colorTextureViews[i].getTexture())==null?void 0:a.getFormat();o&&o!==n.fragment.targets[i].format&&(console.log(`mismatched attachments for attachment ${i} on pipeline ${n.fragment.targets[i].format} while encoder has ${o}`),console.trace())}if(!e.depthTextureView!=!("depthStencil"in n))console.log("mismatched depth attachments"),console.trace();else if(e.depthTextureView){const i=(s=e.depthTextureView.getTexture())==null?void 0:s.getFormat();i&&i!==n.depthStencil.format&&(console.log(`mismatched depth attachments on pipeline ${n.depthStencil.format} while encoder has ${i}`),console.trace())}e.boundPipeline=r},t.replaceShaderCode=r=>{e.replaceShaderCodeFunction(r)},t.setColorTextureView=(r,n)=>{e.colorTextureViews[r]!==n&&(e.colorTextureViews[r]=n)},t.activateBindGroup=r=>{const n=e.boundPipeline.getDevice(),a=e.boundPipeline.getBindGroupLayoutCount(r.getLabel());e.handle.setBindGroup(a,r.getBindGroup(n));const s=n.getBindGroupLayoutDescription(r.getBindGroupLayout(n)),i=n.getBindGroupLayoutDescription(e.boundPipeline.getBindGroupLayout(a));s!==i&&(console.log(`renderEncoder ${e.pipelineHash} mismatched bind group layouts bind group has
${s}
 versus pipeline
${i}
`),console.trace())},t.attachTextureViews=()=>{for(let r=0;r<e.colorTextureViews.length;r++)e.description.colorAttachments[r]?e.description.colorAttachments[r].view=e.colorTextureViews[r].getHandle():e.description.colorAttachments[r]={view:e.colorTextureViews[r].getHandle()};e.depthTextureView&&(e.description.depthStencilAttachment.view=e.depthTextureView.getHandle())},t.registerDrawCallback=(r,n)=>{for(let a=0;a<e.drawCallbacks.length;a++)if(e.drawCallbacks[a].pipeline===r){e.drawCallbacks[a].callbacks.push(n);return}e.drawCallbacks.push({pipeline:r,callbacks:[n]})};for(let r=0;r<$a.length;r++)t[$a[r]]=function(){return e.handle[$a[r]](...arguments)}}const YC={description:null,handle:null,boundPipeline:null,pipelineHash:null,pipelineSettings:null,replaceShaderCodeFunction:null,depthTextureView:null,label:null};function jg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,YC,r),ve(t,e),e.description={colorAttachments:[{view:void 0,loadOp:"load",storeOp:"store"}],depthStencilAttachment:{view:void 0,depthLoadOp:"clear",depthClearValue:0,depthStoreOp:"store"}},e.replaceShaderCodeFunction=n=>{const a=n.getShaderDescription("fragment");a.addOutput("vec4<f32>","outColor");let s=a.getCode();s=H.substitute(s,"//VTK::RenderEncoder::Impl",["output.outColor = computedColor;"]).result,a.setCode(s)},e.pipelineSettings={primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!0,depthCompare:"greater-equal",format:"depth32float"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcfactor:"one",dstFactor:"one-minus-src-alpha"}}}]}},e.colorTextureViews=[],Ee(t,e,["boundPipeline","colorTextureViews"]),ue(t,e,["depthTextureView","description","handle","label","pipelineHash","pipelineSettings","replaceShaderCodeFunction"]),PC(t,e)}const qC=Z(jg,"vtkWebGPURenderEncoder");var Je={newInstance:qC,extend:jg};function IC(t,e){e.classHierarchy.push("vtkWebGPUOpaquePass"),t.traverse=(r,n)=>{if(e.deleted)return;e._currentParent=n;const a=n.getDevice();if(e.renderEncoder)e.colorTexture.resize(n.getCanvas().width,n.getCanvas().height),e.depthTexture.resize(n.getCanvas().width,n.getCanvas().height);else{t.createRenderEncoder(),e.colorTexture=Xe.newInstance({label:"opaquePassColor"}),e.colorTexture.create(a,{width:n.getCanvas().width,height:n.getCanvas().height,format:"rgba16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC});const s=e.colorTexture.createView("opaquePassColorTexture");e.renderEncoder.setColorTextureView(0,s),e.depthFormat="depth32float",e.depthTexture=Xe.newInstance({label:"opaquePassDepth"}),e.depthTexture.create(a,{width:n.getCanvas().width,height:n.getCanvas().height,format:e.depthFormat,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC});const i=e.depthTexture.createView("opaquePassDepthTexture");e.renderEncoder.setDepthTextureView(i)}e.renderEncoder.attachTextureViews(),t.setCurrentOperation("opaquePass"),r.setRenderEncoder(e.renderEncoder),r.traverse(t)},t.getColorTextureView=()=>e.renderEncoder.getColorTextureViews()[0],t.getDepthTextureView=()=>e.renderEncoder.getDepthTextureView(),t.createRenderEncoder=()=>{e.renderEncoder=Je.newInstance({label:"OpaquePass"}),e.renderEncoder.setPipelineHash("op")}}const QC={renderEncoder:null,colorTexture:null,depthTexture:null};function Kg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,QC,r),at.extend(t,e,r),E.get(t,e,["colorTexture","depthTexture"]),IC(t,e)}const ZC=E.newInstance(Kg,"vtkWebGPUOpaquePass");var JC={newInstance:ZC,extend:Kg};const ew=`
//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var tcoord: vec2<i32> = vec2<i32>(i32(input.fragPos.x), i32(input.fragPos.y));
  var reveal: f32 = textureLoad(oitpAccumTexture, tcoord, 0).r;
  if (reveal == 1.0) { discard; }
  var tcolor: vec4<f32> = textureLoad(oitpColorTexture, tcoord, 0);
  var total: f32 = max(tcolor.a, 0.01);
  var computedColor: vec4<f32> = vec4<f32>(tcolor.r/total, tcolor.g/total, tcolor.b/total, 1.0 - reveal);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function tw(t,e){e.classHierarchy.push("vtkWebGPUOrderIndependentTranslucentPass"),t.traverse=(r,n)=>{if(e.deleted)return;e._currentParent=n;const a=n.getDevice();if(e.translucentRenderEncoder)e.translucentColorTexture.resizeToMatch(e.colorTextureView.getTexture()),e.translucentAccumulateTexture.resizeToMatch(e.colorTextureView.getTexture());else{t.createRenderEncoder(),t.createFinalEncoder(),e.translucentColorTexture=Xe.newInstance({label:"translucentPassColor"}),e.translucentColorTexture.create(a,{width:n.getCanvas().width,height:n.getCanvas().height,format:"rgba16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const s=e.translucentColorTexture.createView("oitpColorTexture");e.translucentRenderEncoder.setColorTextureView(0,s),e.translucentAccumulateTexture=Xe.newInstance({label:"translucentPassAccumulate"}),e.translucentAccumulateTexture.create(a,{width:n.getCanvas().width,height:n.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const i=e.translucentAccumulateTexture.createView("oitpAccumTexture");e.translucentRenderEncoder.setColorTextureView(1,i),e.fullScreenQuad=Zt.newInstance(),e.fullScreenQuad.setDevice(n.getDevice()),e.fullScreenQuad.setPipelineHash("oitpfsq"),e.fullScreenQuad.setTextureViews(e.translucentRenderEncoder.getColorTextureViews()),e.fullScreenQuad.setFragmentShaderTemplate(ew)}e.translucentRenderEncoder.setDepthTextureView(e.depthTextureView),e.translucentRenderEncoder.attachTextureViews(),t.setCurrentOperation("translucentPass"),r.setRenderEncoder(e.translucentRenderEncoder),r.traverse(t),t.finalPass(n,r)},t.finalPass=(r,n)=>{e.translucentFinalEncoder.setColorTextureView(0,e.colorTextureView),e.translucentFinalEncoder.attachTextureViews(),e.translucentFinalEncoder.begin(r.getCommandEncoder()),n.scissorAndViewport(e.translucentFinalEncoder),e.fullScreenQuad.prepareAndDraw(e.translucentFinalEncoder),e.translucentFinalEncoder.end()},t.getTextures=()=>[e.translucentColorTexture,e.translucentAccumulateTexture],t.createRenderEncoder=()=>{e.translucentRenderEncoder=Je.newInstance({label:"translucentRender"});const r=e.translucentRenderEncoder.getDescription();r.colorAttachments=[{view:void 0,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"},{view:void 0,clearValue:[1,0,0,0],loadOp:"clear",storeOp:"store"}],r.depthStencilAttachment={view:void 0,depthLoadOp:"load",depthStoreOp:"store"},e.translucentRenderEncoder.setReplaceShaderCodeFunction(n=>{const a=n.getShaderDescription("fragment");a.addOutput("vec4<f32>","outColor"),a.addOutput("f32","outAccum"),a.addBuiltinInput("vec4<f32>","@builtin(position) fragPos");let s=a.getCode();s=H.substitute(s,"//VTK::RenderEncoder::Impl",["var w: f32 = computedColor.a * pow(0.1 + input.fragPos.z, 2.0);","output.outColor = vec4<f32>(computedColor.rgb*w, w);","output.outAccum = computedColor.a;"]).result,a.setCode(s)}),e.translucentRenderEncoder.setPipelineHash("oitpr"),e.translucentRenderEncoder.setPipelineSettings({primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!1,depthCompare:"greater",format:"depth32float"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"one",dstFactor:"one"},alpha:{srcfactor:"one",dstFactor:"one"}}},{format:"r16float",blend:{color:{srcFactor:"zero",dstFactor:"one-minus-src"},alpha:{srcfactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createFinalEncoder=()=>{e.translucentFinalEncoder=Je.newInstance({label:"translucentFinal"}),e.translucentFinalEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e.translucentFinalEncoder.setReplaceShaderCodeFunction(r=>{const n=r.getShaderDescription("fragment");n.addOutput("vec4<f32>","outColor"),n.addBuiltinInput("vec4<f32>","@builtin(position) fragPos");let a=n.getCode();a=H.substitute(a,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<f32>(computedColor.rgb, computedColor.a);"]).result,n.setCode(a)}),e.translucentFinalEncoder.setPipelineHash("oitpf"),e.translucentFinalEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcfactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})}}const rw={colorTextureView:null,depthTextureView:null};function Xg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,rw,r),at.extend(t,e,r),E.setGet(t,e,["colorTextureView","depthTextureView"]),tw(t,e)}const nw=E.newInstance(Xg,"vtkWebGPUOrderIndependentTranslucentPass");var aw={newInstance:nw,extend:Xg};const At={COMPOSITE_BLEND:0,MAXIMUM_INTENSITY_BLEND:1,MINIMUM_INTENSITY_BLEND:2,AVERAGE_INTENSITY_BLEND:3,ADDITIVE_INTENSITY_BLEND:4},sw=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::Volume::TraverseDec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

fn getTextureValue(vTex: texture_3d<f32>, tpos: vec4<f32>) -> f32
{
  // todo multicomponent support
  return textureSampleLevel(vTex, clampSampler, tpos.xyz, 0.0).r;
}

fn getGradient(vTex: texture_3d<f32>, tpos: vec4<f32>, vNum: i32, scalar: f32) -> vec4<f32>
{
  var result: vec4<f32>;

  var tstep: vec4<f32> = volumeSSBO.values[vNum].tstep;
  result.x = getTextureValue(vTex, tpos + vec4<f32>(tstep.x, 0.0, 0.0, 1.0)) - scalar;
  result.y = getTextureValue(vTex, tpos + vec4<f32>(0.0, tstep.y, 0.0, 1.0)) - scalar;
  result.z = getTextureValue(vTex, tpos + vec4<f32>(0.0, 0.0, tstep.z, 1.0)) - scalar;
  result.w = 0.0;

  // divide by spacing as that is our delta
  result = result / volumeSSBO.values[vNum].spacing;
  // now we have a gradient in unit tcoords

  var grad: f32 = length(result.xyz);
  if (grad > 0.0)
  {
    // rotate to View Coords, needed for lighting and shading
    var nMat: mat4x4<f32> = rendererUBO.SCVCMatrix * volumeSSBO.values[vNum].planeNormals;
    result = nMat * result;
    result = result / length(result);
  }

  // store gradient magnitude in .w
  result.w = grad;

  return result;
}

fn processVolume(vTex: texture_3d<f32>, vNum: i32, cNum: i32, posSC: vec4<f32>, tfunRows: f32) -> vec4<f32>
{
  var outColor: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);

  // convert to tcoords and reject if outside the volume
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*posSC;
  if (tpos.x < 0.0 || tpos.y < 0.0 || tpos.z < 0.0 ||
      tpos.x > 1.0 || tpos.y > 1.0 || tpos.z > 1.0) { return outColor; }

  var scalar: f32 = getTextureValue(vTex, tpos);

  var coord: vec2<f32> =
    vec2<f32>(scalar * componentSSBO.values[cNum].cScale + componentSSBO.values[cNum].cShift,
      (0.5 + 2.0 * f32(vNum)) / tfunRows);
  var color: vec4<f32> = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);

  var gofactor: f32 = 1.0;
  var normal: vec4<f32> = vec4<f32>(0.0,0.0,0.0,0.0);
  if (componentSSBO.values[cNum].gomin <  1.0 || volumeSSBO.values[vNum].shade[0] > 0.0)
  {
    normal = getGradient(vTex, tpos, vNum, scalar);
    if (componentSSBO.values[cNum].gomin <  1.0)
    {
      gofactor = clamp(normal.a*componentSSBO.values[cNum].goScale + componentSSBO.values[cNum].goShift,
      componentSSBO.values[cNum].gomin, componentSSBO.values[cNum].gomax);
    }
  }

  coord.x = (scalar * componentSSBO.values[cNum].oScale + componentSSBO.values[cNum].oShift);
  var opacity: f32 = textureSampleLevel(ofunTexture, clampSampler, coord, 0.0).r;

  if (volumeSSBO.values[vNum].shade[0] > 0.0)
  {
    color = color*abs(normal.z);
  }

  outColor = vec4<f32>(color.rgb, gofactor * opacity);

  return outColor;
}

// adjust the start and end point of a raycast such that it intersects the unit cube.
// This function is used to take a raycast starting point and step vector
// and numSteps and return the startijng and ending steps for intersecting the
// unit cube. Recall for a 3D texture, the unit cube is the range of texture coordsinates
// that have valid values. So this funtion can be used to take a ray in texture coordinates
// and bound it to intersecting the texture.
//
fn adjustBounds(tpos: vec4<f32>, tstep: vec4<f32>, numSteps: f32) -> vec2<f32>
{
  var result: vec2<f32> = vec2<f32>(0.0, numSteps);
  var tpos2: vec4<f32> = tpos + tstep*numSteps;

  // move tpos to the start of the volume
  var adjust: f32 =
    min(
      max(tpos.x/tstep.x, (tpos.x - 1.0)/tstep.x),
      min(
        max((tpos.y - 1.0)/tstep.y, tpos.y/tstep.y),
        max((tpos.z - 1.0)/tstep.z, tpos.z/tstep.z)));
  if (adjust < 0.0)
  {
    result.x = result.x - adjust;
  }

  // adjust length to the end
  adjust =
    max(
      min(tpos2.x/tstep.x, (tpos2.x - 1.0)/tstep.x),
      max(
        min((tpos2.y - 1.0)/tstep.y, tpos2.y/tstep.y),
        min((tpos2.z - 1.0)/tstep.z, tpos2.z/tstep.z)));
  if (adjust > 0.0)
  {
    result.y = result.y - adjust;
  }

  return result;
}

fn getSimpleColor(scalar: f32, vNum: i32, cNum: i32) -> vec4<f32>
{
  // how many rows (tfuns) do we have in our tfunTexture
  var tfunRows: f32 = f32(textureDimensions(tfunTexture).y);

  var coord: vec2<f32> =
    vec2<f32>(scalar * componentSSBO.values[cNum].cScale + componentSSBO.values[cNum].cShift,
      (0.5 + 2.0 * f32(vNum)) / tfunRows);
  var color: vec4<f32> = textureSampleLevel(tfunTexture, clampSampler, coord, 0.0);
  coord.x = (scalar * componentSSBO.values[cNum].oScale + componentSSBO.values[cNum].oShift);
  var opacity: f32 = textureSampleLevel(ofunTexture, clampSampler, coord, 0.0).r;
  return vec4<f32>(color.rgb, opacity);
}

fn traverseMax(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var maxVal: f32 = -1.0e37;
  loop
  {
    var scalar: f32 = getTextureValue(vTex, tpos);
    if (scalar > maxVal)
    {
      maxVal = scalar;
    }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(maxVal, vNum, cNum);
}

fn traverseMin(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var minVal: f32 = 1.0e37;
  loop
  {
    var scalar: f32 = getTextureValue(vTex, tpos);
    if (scalar < minVal)
    {
      minVal = scalar;
    }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(minVal, vNum, cNum);
}

fn traverseAverage(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  let ipRange: vec4<f32> = volumeSSBO.values[vNum].ipScalarRange;
  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var avgVal: f32 = 0.0;
  var sampleCount: f32 = 0.0;
  loop
  {
    var sample: f32 = getTextureValue(vTex, tpos);
    // right now leave filtering off until WebGL changes get merged
    // if (ipRange.z == 0.0 || sample >= ipRange.x && sample <= ipRange.y)
    // {
      avgVal = avgVal + sample;
      sampleCount = sampleCount + 1.0;
    // }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  if (sampleCount <= 0.0)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(avgVal/sampleCount, vNum, cNum);
}

fn traverseAdditive(vTex: texture_3d<f32>, vNum: i32, cNum: i32, rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>)
{
  // convert to tcoords and reject if outside the volume
  var numSteps: f32 = rayLengthSC/mapperUBO.SampleDistance;
  var tpos: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*minPosSC;
  var tpos2: vec4<f32> = volumeSSBO.values[vNum].SCTCMatrix*(minPosSC + rayStepSC);
  var tstep: vec4<f32> = tpos2 - tpos;

  var rayBounds: vec2<f32> = adjustBounds(tpos, tstep, numSteps);

  // did we hit anything
  if (rayBounds.x >= rayBounds.y)
  {
    traverseVals[vNum] = vec4<f32>(0.0,0.0,0.0,0.0);
    return;
  }

  let ipRange: vec4<f32> = volumeSSBO.values[vNum].ipScalarRange;
  tpos = tpos + tstep*rayBounds.x;
  var curDist: f32 = rayBounds.x;
  var sumVal: f32 = 0.0;
  loop
  {
    var sample: f32 = getTextureValue(vTex, tpos);
    // right now leave filtering off until WebGL changes get merged
    // if (ipRange.z == 0.0 || sample >= ipRange.x && sample <= ipRange.y)
    // {
      sumVal = sumVal + sample;
    // }

    // increment position
    curDist = curDist + 1.0;
    tpos = tpos + tstep;

    // check if we have reached a terminating condition
    if (curDist > rayBounds.y) { break; }
  }

  // process to get the color and opacity
  traverseVals[vNum] = getSimpleColor(sumVal, vNum, cNum);
}

fn composite(rayLengthSC: f32, minPosSC: vec4<f32>, rayStepSC: vec4<f32>) -> vec4<f32>
{
  // initial ray position is at the beginning
  var rayPosSC: vec4<f32> = minPosSC;

  // how many rows (tfuns) do we have in our tfunTexture
  var tfunRows: f32 = f32(textureDimensions(tfunTexture).y);

  var curDist: f32 = 0.0;
  var computedColor: vec4<f32> = vec4<f32>(0.0, 0.0, 0.0, 0.0);
  var sampleColor: vec4<f32>;
//VTK::Volume::TraverseCalls

  loop
  {
    // for each volume, sample and accumulate color
//VTK::Volume::CompositeCalls

    // increment position
    curDist = curDist + mapperUBO.SampleDistance;
    rayPosSC = rayPosSC + rayStepSC;

    // check if we have reached a terminating condition
    if (curDist > rayLengthSC) { break; }
    if (computedColor.a > 0.98) { break; }
  }
  return computedColor;
}

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var rayMax: f32 = textureSampleLevel(maxTexture, clampSampler, input.tcoordVS, 0.0).r;
  var rayMin: f32 = textureSampleLevel(minTexture, clampSampler, input.tcoordVS, 0.0).r;

  // discard empty rays
  if (rayMax <= rayMin) { discard; }
  else
  {
    // compute start and end ray positions in view coordinates
    var minPosSC: vec4<f32> = rendererUBO.PCSCMatrix*vec4<f32>(2.0 * input.tcoordVS.x - 1.0, 1.0 - 2.0 * input.tcoordVS.y, rayMax, 1.0);
    minPosSC = minPosSC * (1.0 / minPosSC.w);
    var maxPosSC: vec4<f32> = rendererUBO.PCSCMatrix*vec4<f32>(2.0 * input.tcoordVS.x - 1.0, 1.0 - 2.0 * input.tcoordVS.y, rayMin, 1.0);
    maxPosSC = maxPosSC * (1.0 / maxPosSC.w);

    var rayLengthSC: f32 = distance(minPosSC.xyz, maxPosSC.xyz);
    var rayStepSC: vec4<f32> = (maxPosSC - minPosSC)*(mapperUBO.SampleDistance/rayLengthSC);
    rayStepSC.w = 0.0;

    var computedColor: vec4<f32>;

//VTK::Volume::Loop

//VTK::RenderEncoder::Impl
  }

  return output;
}
`,Ce=new Float64Array(16),ft=new Float64Array(16);function iw(t,e){e.classHierarchy.push("vtkWebGPUVolumePassFSQ"),t.replaceShaderPosition=(a,s,i)=>{const o=s.getShaderDescription("vertex");o.addBuiltinOutput("vec4<f32>","@builtin(position) Position");let c=o.getCode();c=H.substitute(c,"//VTK::Position::Impl",["output.tcoordVS = vec2<f32>(vertexBC.x * 0.5 + 0.5, 1.0 - vertexBC.y * 0.5 - 0.5);","output.Position = vec4<f32>(vertexBC, 1.0);"]).result,o.setCode(c),s.getShaderDescription("fragment").addBuiltinInput("vec4<f32>","@builtin(position) fragPos")},e.shaderReplacements.set("replaceShaderPosition",t.replaceShaderPosition),t.replaceShaderVolume=(a,s,i)=>{const o=s.getShaderDescription("fragment");let c=o.getCode();const u=[],g=[];for(let l=0;l<e.volumes.length;l++)e.volumes[l].getRenderable().getMapper().getBlendMode()===At.COMPOSITE_BLEND?(u.push(`    sampleColor = processVolume(volTexture${l}, ${l}, ${e.rowStarts[l]}, rayPosSC, tfunRows);`),u.push(`    computedColor = vec4<f32>(
          sampleColor.a * sampleColor.rgb * (1.0 - computedColor.a) + computedColor.rgb,
          (1.0 - computedColor.a)*sampleColor.a + computedColor.a);`)):(g.push(`  sampleColor = traverseVals[${l}];`),g.push(`  computedColor = vec4<f32>(
          sampleColor.a * sampleColor.rgb * (1.0 - computedColor.a) + computedColor.rgb,
          (1.0 - computedColor.a)*sampleColor.a + computedColor.a);`));c=H.substitute(c,"//VTK::Volume::CompositeCalls",u).result,c=H.substitute(c,"//VTK::Volume::TraverseCalls",g).result,c=H.substitute(c,"//VTK::Volume::TraverseDec",[`var<private> traverseVals: array<vec4<f32>,${e.volumes.length}>;`]).result;let f=!1;for(let l=0;l<e.volumes.length;l++){const p=e.volumes[l].getRenderable().getMapper().getBlendMode();p===At.COMPOSITE_BLEND?f=!0:p===At.MAXIMUM_INTENSITY_BLEND?c=H.substitute(c,"//VTK::Volume::Loop",[`    traverseMax(volTexture${l}, ${l}, ${l}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${l}];`,"//VTK::Volume::Loop"]).result:p===At.MINIMUM_INTENSITY_BLEND?c=H.substitute(c,"//VTK::Volume::Loop",[`    traverseMin(volTexture${l}, ${l}, ${l}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${l}];`,"//VTK::Volume::Loop"]).result:p===At.AVERAGE_INTENSITY_BLEND?c=H.substitute(c,"//VTK::Volume::Loop",[`    traverseAverage(volTexture${l}, ${l}, ${l}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${l}];`,"//VTK::Volume::Loop"]).result:p===At.ADDITIVE_INTENSITY_BLEND&&(c=H.substitute(c,"//VTK::Volume::Loop",[`    traverseAdditive(volTexture${l}, ${l}, ${l}, rayLengthSC, minPosSC, rayStepSC);`,`    computedColor = traverseVals[${l}];`,"//VTK::Volume::Loop"]).result)}f&&(c=H.substitute(c,"//VTK::Volume::Loop",["    computedColor = composite(rayLengthSC, minPosSC, rayStepSC);"]).result),o.setCode(c)},e.shaderReplacements.set("replaceShaderVolume",t.replaceShaderVolume),t.updateLUTImage=a=>{let s=t.getMTime();for(let f=0;f<e.volumes.length;f++){const l=e.volumes[f].getRenderable(),p=l.getMapper().getInputData();s=Math.max(s,l.getMTime(),p.getMTime())}if(s<e.lutBuildTime.getMTime())return;e.numRows=0,e.rowStarts=[];for(let f=0;f<e.volumes.length;f++){e.rowStarts.push(e.numRows);const p=e.volumes[f].getRenderable(),y=p.getMapper(),h=p.getProperty(),v=y.getInputData(),S=(v.getPointData()&&v.getPointData().getScalars()).getNumberOfComponents(),T=h.getIndependentComponents()?S:1;e.numRows+=T}const i=new Uint8ClampedArray(e.numRows*2*e.rowLength*4),o=new Float32Array(e.numRows*2*e.rowLength);let c=0;const u=new Float32Array(e.rowLength*3),g=e.rowLength;for(let f=0;f<e.volumes.length;f++){const p=e.volumes[f].getRenderable(),y=p.getMapper(),h=p.getProperty(),v=y.getInputData(),S=(v.getPointData()&&v.getPointData().getScalars()).getNumberOfComponents(),T=h.getIndependentComponents()?S:1;for(let w=0;w<T;++w){const C=h.getRGBTransferFunction(w),O=C.getRange();C.getTable(O[0],O[1],g,u,1);let R=c*g*4;for(let V=0;V<g;++V){i[R+V*4]=255*u[V*3],i[R+V*4+1]=255*u[V*3+1],i[R+V*4+2]=255*u[V*3+2],i[R+V*4+3]=255;for(let B=0;B<4;B++)i[R+(g+V)*4+B]=i[R+V*4+B]}const L=h.getScalarOpacity(w),M=e.sampleDist/h.getScalarOpacityUnitDistance(w),D=L.getRange();L.getTable(D[0],D[1],g,u,1),R=c*g;for(let V=0;V<g;++V)o[R+V]=1-(1-u[V])**M,o[R+V+g]=o[R+V];c+=2}}{const f={nativeArray:i,width:e.rowLength,height:e.numRows*2,depth:1,format:"rgba8unorm"},p=a.getTextureManager().getTexture(f).createView("tfunTexture");e.textureViews[2]=p}{const f={nativeArray:o,width:e.rowLength,height:e.numRows*2,depth:1,format:"r16float"},p=a.getTextureManager().getTexture(f).createView("ofunTexture");e.textureViews[3]=p}e.lutBuildTime.modified()},t.updateSSBO=a=>{let s=Math.max(t.getMTime(),e.WebGPURenderer.getStabilizedTime());for(let C=0;C<e.volumes.length;C++){const O=e.volumes[C].getRenderable(),R=O.getMapper(),L=R.getInputData();s=Math.max(s,O.getMTime(),L.getMTime(),R.getMTime())}if(s<e.SSBO.getSendTime())return;const i=e.WebGPURenderer.getStabilizedCenterByReference();e.SSBO.clearData(),e.SSBO.setNumberOfInstances(e.volumes.length);const o=new Float64Array(e.volumes.length*16),c=new Float64Array(e.volumes.length*16),u=new Float64Array(e.volumes.length*4),g=new Float64Array(e.volumes.length*4),f=new Float64Array(e.volumes.length*4),l=new Float64Array(e.volumes.length*4);for(let C=0;C<e.volumes.length;C++){const R=e.volumes[C].getRenderable(),L=R.getMapper(),M=L.getInputData();j(Ce),oe(Ce,Ce,i);const D=R.getMatrix();te(ft,D),Re(ft,ft),de(Ce,ft,Ce);const V=M.getWorldToIndex();de(Ce,V,Ce);const B=M.getDimensions();j(ft),qt(ft,ft,[1/B[0],1/B[1],1/B[2]]),de(Ce,ft,Ce);for(let b=0;b<16;b++)o[C*16+b]=Ce[b];Re(Ce,Ce);for(let b=0;b<4;b++)c[C*16+b*4]=Ce[b*4],c[C*16+b*4+1]=Ce[b*4+1],c[C*16+b*4+2]=Ce[b*4+2],c[C*16+b*4+3]=0;u[C*4]=1/B[0],u[C*4+1]=1/B[1],u[C*4+2]=1/B[2],u[C*4+3]=1,g[C*4]=R.getProperty().getShade()?1:0;const _=M.getSpacing();f[C*4]=_[0],f[C*4+1]=_[1],f[C*4+2]=_[2],f[C*4+3]=1;const k=e.textureViews[C+4].getTexture().getScale(),G=L.getIpScalarRange();l[C*4]=G[0]/k,l[C*4+1]=G[1]/k,l[C*4+2]=L.getFilterMode()}e.SSBO.addEntry("SCTCMatrix","mat4x4<f32>"),e.SSBO.addEntry("planeNormals","mat4x4<f32>"),e.SSBO.addEntry("shade","vec4<f32>"),e.SSBO.addEntry("tstep","vec4<f32>"),e.SSBO.addEntry("spacing","vec4<f32>"),e.SSBO.addEntry("ipScalarRange","vec4<f32>"),e.SSBO.setAllInstancesFromArray("SCTCMatrix",o),e.SSBO.setAllInstancesFromArray("planeNormals",c),e.SSBO.setAllInstancesFromArray("shade",g),e.SSBO.setAllInstancesFromArray("tstep",u),e.SSBO.setAllInstancesFromArray("spacing",f),e.SSBO.setAllInstancesFromArray("ipScalarRange",l),e.SSBO.send(a),e.componentSSBO.clearData(),e.componentSSBO.setNumberOfInstances(e.numRows);const p=new Float64Array(e.numRows),y=new Float64Array(e.numRows),h=new Float64Array(e.numRows),v=new Float64Array(e.numRows),x=new Float64Array(e.numRows),S=new Float64Array(e.numRows),d=new Float64Array(e.numRows),T=new Float64Array(e.numRows);let w=0;for(let C=0;C<e.volumes.length;C++){const R=e.volumes[C].getRenderable(),L=R.getMapper(),M=R.getProperty(),D=L.getInputData(),B=(D.getPointData()&&D.getPointData().getScalars()).getNumberOfComponents(),_=M.getIndependentComponents(),k=e.textureViews[C+4].getTexture().getFormat(),G=pe.getDetailsFromTextureFormat(k),b=G.elementSize===2&&G.sampleType==="float",Y={scale:[255],offset:[0]};b&&(Y.scale[0]=1);for(let U=0;U<B;U++){const m=_?U:0,$=Y.scale[U],N=M.getScalarOpacity(m).getRange(),be=$/(N[1]-N[0]),Qn=(Y.offset[U]-N[0])/(N[1]-N[0]);v[w]=Qn,h[w]=be;const _e=M.getRGBTransferFunction(m).getRange();if(y[w]=(Y.offset[U]-_e[0])/(_e[1]-_e[0]),p[w]=$/(_e[1]-_e[0]),M.getUseGradientOpacity(m)){const Ur=M.getGradientOpacityMinimumOpacity(m),Zn=M.getGradientOpacityMaximumOpacity(m);x[w]=Ur,S[w]=Zn;const ir=[M.getGradientOpacityMinimumValue(m),M.getGradientOpacityMaximumValue(m)];T[w]=$*(Zn-Ur)/(ir[1]-ir[0]),d[w]=-ir[0]*(Zn-Ur)/(ir[1]-ir[0])+Ur}else x[w]=1,S[w]=1,T[w]=0,d[w]=1;w++}}e.componentSSBO.addEntry("cScale","f32"),e.componentSSBO.addEntry("cShift","f32"),e.componentSSBO.addEntry("oScale","f32"),e.componentSSBO.addEntry("oShift","f32"),e.componentSSBO.addEntry("goShift","f32"),e.componentSSBO.addEntry("goScale","f32"),e.componentSSBO.addEntry("gomin","f32"),e.componentSSBO.addEntry("gomax","f32"),e.componentSSBO.setAllInstancesFromArray("cScale",p),e.componentSSBO.setAllInstancesFromArray("cShift",y),e.componentSSBO.setAllInstancesFromArray("oScale",h),e.componentSSBO.setAllInstancesFromArray("oShift",v),e.componentSSBO.setAllInstancesFromArray("goScale",T),e.componentSSBO.setAllInstancesFromArray("goShift",d),e.componentSSBO.setAllInstancesFromArray("gomin",x),e.componentSSBO.setAllInstancesFromArray("gomax",S),e.componentSSBO.send(a)};const r=t.updateBuffers;t.updateBuffers=()=>{r();let a=e.volumes[0].getRenderable().getMapper().getSampleDistance();for(let s=0;s<e.volumes.length;s++){const c=e.volumes[s].getRenderable().getMapper().getSampleDistance();c<a&&(a=c)}e.sampleDist!==a&&(e.sampleDist=a,e.UBO.setValue("SampleDistance",a),e.UBO.sendIfNeeded(e.device));for(let s=0;s<e.volumes.length;s++){const u=e.volumes[s].getRenderable().getMapper().getInputData(),g=e.device.getTextureManager().getTextureForImageData(u);if(!e.textureViews[s+4]||e.textureViews[s+4].getTexture()!==g){const f=g.createView(`volTexture${s}`);e.textureViews[s+4]=f}}if(e.volumes.length<e.lastVolumeLength)for(let s=e.volumes.length;s<e.lastVolumeLength;s++)e.textureViews.pop();e.lastVolumeLength=e.volumes.length,t.updateLUTImage(e.device),t.updateSSBO(e.device),e.clampSampler||(e.clampSampler=Xs.newInstance({label:"clampSampler"}),e.clampSampler.create(e.device,{minFilter:"linear",magFilter:"linear"}))},t.computePipelineHash=()=>{e.pipelineHash="volfsq";for(let a=0;a<e.volumes.length;a++){const s=e.volumes[a].getRenderable().getMapper().getBlendMode();e.pipelineHash+=`${s}`}},t.setVolumes=a=>{if(!e.volumes||e.volumes.length!==a.length){e.volumes=[...a],t.modified();return}for(let s=0;s<a.length;s++)if(a[s]!==e.volumes[s]){e.volumes=[...a],t.modified();return}};const n=t.getBindables;t.getBindables=()=>{const a=n();return a.push(e.componentSSBO),a.push(e.clampSampler),a}}const ow={volumes:null,rowLength:1024,lastVolumeLength:0};function Pg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,ow,r),Zt.extend(t,e,r),e.fragmentShaderTemplate=sw,e.UBO=kt.newInstance({label:"mapperUBO"}),e.UBO.addEntry("SampleDistance","f32"),e.SSBO=gs.newInstance({label:"volumeSSBO"}),e.componentSSBO=gs.newInstance({label:"componentSSBO"}),e.lutBuildTime={},E.obj(e.lutBuildTime,{mtime:0}),iw(t,e)}const cw=E.newInstance(Pg,"vtkWebGPUVolumePassFSQ");var fw={newInstance:cw,extend:Pg};const{Representation:uw}=nr,{BufferUsage:Ao,PrimitiveTypes:gw}=xt,Wa=[[0,4,6],[0,6,2],[1,3,7],[1,7,5],[0,5,4],[0,1,5],[2,6,7],[2,7,3],[0,3,1],[0,2,3],[4,5,7],[4,7,6]],lw=`
//VTK::Renderer::Dec

//VTK::Select::Dec

//VTK::VolumePass::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::Mapper::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output : fragmentOutput;

  //VTK::Select::Impl

  //VTK::TCoord::Impl

  //VTK::VolumePass::Impl

  // use the maximum (closest) of the current value and the zbuffer
  // the blend func will then take the min to find the farthest stop value
  var stopval: f32 = max(input.fragPos.z, textureLoad(opaquePassDepthTexture, vec2<i32>(i32(input.fragPos.x), i32(input.fragPos.y)), 0));

  //VTK::RenderEncoder::Impl
  return output;
}
`,pw=`
//VTK::Renderer::Dec

//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = textureSample(volumePassColorTexture,
    volumePassColorTextureSampler, mapperUBO.tscale*input.tcoordVS);

  //VTK::RenderEncoder::Impl
  return output;
}
`;function hw(t,e){e.classHierarchy.push("vtkWebGPUVolumePass"),t.initialize=r=>{e._clearEncoder||t.createClearEncoder(r),e._mergeEncoder||t.createMergeEncoder(r),e._copyEncoder||t.createCopyEncoder(r),e._depthRangeEncoder||t.createDepthRangeEncoder(r),e.fullScreenQuad||(e.fullScreenQuad=fw.newInstance(),e.fullScreenQuad.setDevice(r.getDevice()),e.fullScreenQuad.setTextureViews([...e._depthRangeEncoder.getColorTextureViews()])),e._volumeCopyQuad||(e._volumeCopyQuad=Zt.newInstance(),e._volumeCopyQuad.setPipelineHash("volpassfsq"),e._volumeCopyQuad.setDevice(r.getDevice()),e._volumeCopyQuad.setFragmentShaderTemplate(pw),e._copyUBO=kt.newInstance({label:"mapperUBO"}),e._copyUBO.addEntry("tscale","vec2<f32>"),e._volumeCopyQuad.setUBO(e._copyUBO),e._volumeCopyQuad.setTextureViews([e._colorTextureView]))},t.traverse=(r,n)=>{if(e.deleted)return;e._currentParent=n,t.initialize(n),t.computeTiming(n),t.renderDepthBounds(r,n),e._firstGroup=!0;const a=n.getDevice(),s=a.getHandle().limits.maxSampledTexturesPerShaderStage-4;if(e.volumes.length>s){const i=r.getRenderable().getActiveCamera().getPosition(),o=[];for(let f=0;f<e.volumes.length;f++){const l=e.volumes[f].getRenderable().getBounds(),p=[.5*(l[1]+l[0]),.5*(l[3]+l[2]),.5*(l[5]+l[4])];o[f]=Ae(p,i)}const c=[...Array(e.volumes.length).keys()];c.sort((f,l)=>o[l]-o[f]);let u=[],g=c.length%s;for(let f=0;f<c.length;f++)u.push(e.volumes[c[f]]),u.length>=g&&(t.rayCastPass(n,r,u),u=[],g=s,e._firstGroup=!1)}else t.rayCastPass(n,r,e.volumes);if(e._volumeCopyQuad.setWebGPURenderer(r),e._useSmallViewport){const i=e._colorTextureView.getTexture().getWidth(),o=e._colorTextureView.getTexture().getHeight();e._copyUBO.setArray("tscale",[e._smallViewportWidth/i,e._smallViewportHeight/o])}else e._copyUBO.setArray("tscale",[1,1]);e._copyUBO.sendIfNeeded(a),e._copyEncoder.setColorTextureView(0,e.colorTextureView),e._copyEncoder.attachTextureViews(),e._copyEncoder.begin(n.getCommandEncoder()),r.scissorAndViewport(e._copyEncoder),e._volumeCopyQuad.prepareAndDraw(e._copyEncoder),e._copyEncoder.end()},t.delete=E.chain(()=>{e._animationRateSubscription&&(e._animationRateSubscription.unsubscribe(),e._animationRateSubscription=null)},t.delete),t.computeTiming=r=>{const n=r.getRenderable().getInteractor();if(e._lastScale==null){const a=e.volumes[0].getRenderable().getMapper();e._lastScale=a.getInitialInteractionScale()||1}e._useSmallViewport=!1,n.isAnimating()&&e._lastScale>1.5&&(e._useSmallViewport=!0),e._colorTexture.resize(r.getCanvas().width,r.getCanvas().height),e._animationRateSubscription||(e._animationRateSubscription=n.onAnimationFrameRateUpdate(()=>{const a=e.volumes[0].getRenderable().getMapper();if(a.getAutoAdjustSampleDistances()){const s=n.getRecentAnimationFrameRate(),i=e._lastScale*n.getDesiredUpdateRate()/s;e._lastScale=i,e._lastScale>400&&(e._lastScale=400)}else e._lastScale=a.getImageSampleDistance()*a.getImageSampleDistance();e._lastScale<1.5&&(e._lastScale=1.5)}))},t.rayCastPass=(r,n,a)=>{const s=e._firstGroup?e._clearEncoder:e._mergeEncoder;s.attachTextureViews(),s.begin(r.getCommandEncoder());let i=e._colorTextureView.getTexture().getWidth(),o=e._colorTextureView.getTexture().getHeight();if(e._useSmallViewport){const c=r.getCanvas(),u=1/Math.sqrt(e._lastScale);e._smallViewportWidth=Math.ceil(u*c.width),e._smallViewportHeight=Math.ceil(u*c.height),i=e._smallViewportWidth,o=e._smallViewportHeight}s.getHandle().setViewport(0,0,i,o,0,1),s.getHandle().setScissorRect(0,0,i,o),e.fullScreenQuad.setWebGPURenderer(n),e.fullScreenQuad.setVolumes(a),e.fullScreenQuad.prepareAndDraw(s),s.end()},t.renderDepthBounds=(r,n)=>{t.updateDepthPolyData(r);const a=e._boundsPoly,s=a.getPoints(),i=a.getPolys();let o={hash:`vp${i.getMTime()}`,usage:Ao.Index,cells:i,numberOfPoints:s.getNumberOfPoints(),primitiveType:gw.Triangles,representation:uw.SURFACE};const c=n.getDevice().getBufferManager().getBuffer(o);e._mapper.getVertexInput().setIndexBuffer(c),o={usage:Ao.PointArray,format:"float32x4",hash:`vp${s.getMTime()}${i.getMTime()}`,dataArray:s,indexBuffer:c,packExtra:!0};const u=n.getDevice().getBufferManager().getBuffer(o);e._mapper.getVertexInput().addBuffer(u,["vertexBC"]),e._mapper.setNumberOfVertices(u.getSizeInBytes()/u.getStrideInBytes()),t.drawDepthRange(r,n)},t.updateDepthPolyData=r=>{let n=!1;for(let g=0;g<e.volumes.length;g++){const f=e.volumes[g].getMTime();(!e._lastMTimes[g]||f!==e._lastMTimes[g])&&(n=!0,e._lastMTimes[g]=f)}const a=r.getStabilizedTime();if((e._lastMTimes.length<=e.volumes.length||a!==e._lastMTimes[e.volumes.length])&&(n=!0,e._lastMTimes[e.volumes.length]=a),!n)return;const s=r.getStabilizedCenterByReference(),i=e.volumes.length*8,o=new Float64Array(i*3),c=e.volumes.length*12,u=new Uint16Array(c*4);for(let g=0;g<e.volumes.length;g++){e.volumes[g].getBoundingCubePoints(o,g*24);let f=g*12*4;const l=g*8;for(let p=0;p<12;p++)u[f++]=3,u[f++]=l+Wa[p][0],u[f++]=l+Wa[p][1],u[f++]=l+Wa[p][2]}for(let g=0;g<o.length;g+=3)o[g]-=s[0],o[g+1]-=s[1],o[g+2]-=s[2];e._boundsPoly.getPoints().setData(o,3),e._boundsPoly.getPoints().modified(),e._boundsPoly.getPolys().setData(u,1),e._boundsPoly.getPolys().modified(),e._boundsPoly.modified()},t.drawDepthRange=(r,n)=>{e._depthRangeTexture.resizeToMatch(e.colorTextureView.getTexture()),e._depthRangeTexture2.resizeToMatch(e.colorTextureView.getTexture()),e._depthRangeEncoder.attachTextureViews(),t.setCurrentOperation("volumeDepthRangePass"),r.setRenderEncoder(e._depthRangeEncoder),r.volumeDepthRangePass(!0),e._mapper.setWebGPURenderer(r),e._mapper.prepareToDraw(e._depthRangeEncoder),e._mapper.registerDrawCallback(e._depthRangeEncoder),r.volumeDepthRangePass(!1)},t.createDepthRangeEncoder=r=>{const n=r.getDevice();e._depthRangeEncoder=Je.newInstance({label:"VolumePass DepthRange"}),e._depthRangeEncoder.setPipelineHash("volr"),e._depthRangeEncoder.setReplaceShaderCodeFunction(i=>{const o=i.getShaderDescription("fragment");o.addOutput("vec4<f32>","outColor1"),o.addOutput("vec4<f32>","outColor2");let c=o.getCode();c=H.substitute(c,"//VTK::RenderEncoder::Impl",["output.outColor1 = vec4<f32>(input.fragPos.z, 0.0, 0.0, 0.0);","output.outColor2 = vec4<f32>(stopval, 0.0, 0.0, 0.0);"]).result,o.setCode(c)}),e._depthRangeEncoder.setDescription({colorAttachments:[{view:null,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"},{view:null,clearValue:[1,1,1,1],loadOp:"clear",storeOp:"store"}]}),e._depthRangeEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"r16float",blend:{color:{srcFactor:"one",dstFactor:"one",operation:"max"},alpha:{srcfactor:"one",dstFactor:"one",operation:"max"}}},{format:"r16float",blend:{color:{srcFactor:"one",dstFactor:"one",operation:"min"},alpha:{srcfactor:"one",dstFactor:"one",operation:"min"}}}]}}),e._depthRangeTexture=Xe.newInstance({label:"volumePassMaxDepth"}),e._depthRangeTexture.create(n,{width:r.getCanvas().width,height:r.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const a=e._depthRangeTexture.createView("maxTexture");e._depthRangeEncoder.setColorTextureView(0,a),e._depthRangeTexture2=Xe.newInstance({label:"volumePassDepthMin"}),e._depthRangeTexture2.create(n,{width:r.getCanvas().width,height:r.getCanvas().height,format:"r16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING});const s=e._depthRangeTexture2.createView("minTexture");e._depthRangeEncoder.setColorTextureView(1,s),e._mapper.setDevice(r.getDevice()),e._mapper.setTextureViews([e.depthTextureView])},t.createClearEncoder=r=>{e._colorTexture=Xe.newInstance({label:"volumePassColor"}),e._colorTexture.create(r.getDevice(),{width:r.getCanvas().width,height:r.getCanvas().height,format:"bgra8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC}),e._colorTextureView=e._colorTexture.createView("volumePassColorTexture"),e._colorTextureView.addSampler(r.getDevice(),{minFilter:"linear",magFilter:"linear"}),e._clearEncoder=Je.newInstance({label:"VolumePass Clear"}),e._clearEncoder.setColorTextureView(0,e._colorTextureView),e._clearEncoder.setDescription({colorAttachments:[{view:null,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}]}),e._clearEncoder.setPipelineHash("volpf"),e._clearEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"bgra8unorm",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcfactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createCopyEncoder=r=>{e._copyEncoder=Je.newInstance({label:"volumePassCopy"}),e._copyEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._copyEncoder.setPipelineHash("volcopypf"),e._copyEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"rgba16float",blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha"},alpha:{srcfactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.createMergeEncoder=r=>{e._mergeEncoder=Je.newInstance({label:"volumePassMerge"}),e._mergeEncoder.setColorTextureView(0,e._colorTextureView),e._mergeEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._mergeEncoder.setReplaceShaderCodeFunction(n=>{const a=n.getShaderDescription("fragment");a.addOutput("vec4<f32>","outColor");let s=a.getCode();s=H.substitute(s,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<f32>(computedColor.rgb, computedColor.a);"]).result,a.setCode(s)}),e._mergeEncoder.setPipelineHash("volpf"),e._mergeEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:"bgra8unorm",blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcfactor:"one",dstFactor:"one-minus-src-alpha"}}}]}})},t.setVolumes=r=>{if(!e.volumes||e.volumes.length!==r.length){e.volumes=[...r],t.modified();return}for(let n=0;n<r.length;n++)if(r[n]!==e.volumes[n]){e.volumes=[...r],t.modified();return}}}const vw={colorTextureView:null,depthTextureView:null,volumes:null};function Yg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,vw,r),at.extend(t,e,r),e._mapper=Ks.newInstance(),e._mapper.setFragmentShaderTemplate(lw),e._mapper.getShaderReplacements().set("replaceShaderVolumePass",(n,a,s)=>{a.getShaderDescription("fragment").addBuiltinInput("vec4<f32>","@builtin(position) fragPos")}),e._boundsPoly=nt.newInstance(),e._lastMTimes=[],E.setGet(t,e,["colorTextureView","depthTextureView"]),hw(t,e)}const yw=E.newInstance(Yg,"vtkWebGPUVolumePass");var dw={newInstance:yw,extend:Yg};const Tw=`
//VTK::Mapper::Dec

//VTK::TCoord::Dec

//VTK::RenderEncoder::Dec

//VTK::IOStructs::Dec

@fragment
fn main(
//VTK::IOStructs::Input
)
//VTK::IOStructs::Output
{
  var output: fragmentOutput;

  var computedColor: vec4<f32> = clamp(textureSampleLevel(opaquePassColorTexture, finalPassSampler, input.tcoordVS, 0.0),vec4<f32>(0.0),vec4<f32>(1.0));

  //VTK::RenderEncoder::Impl
  return output;
}
`;function xw(t,e){e.classHierarchy.push("vtkForwardPass"),t.traverse=function(r){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(e.deleted)return;e._currentParent=n,t.setCurrentOperation("buildPass"),r.traverse(t),e.opaquePass||(e.opaquePass=JC.newInstance());const a=r.getRenderable().getNumberOfLayers(),s=r.getChildren();for(let i=0;i<a;i++)for(let o=0;o<s.length;o++){const c=s[o],u=r.getRenderable().getRenderers()[o];u.getDraw()&&u.getLayer()===i&&(e.opaqueActorCount=0,e.translucentActorCount=0,e.volumes=[],t.setCurrentOperation("queryPass"),c.traverse(t),t.setCurrentOperation("cameraPass"),c.traverse(t),e.opaquePass.traverse(c,r),e.translucentActorCount>0&&(e.translucentPass||(e.translucentPass=aw.newInstance()),e.translucentPass.setColorTextureView(e.opaquePass.getColorTextureView()),e.translucentPass.setDepthTextureView(e.opaquePass.getDepthTextureView()),e.translucentPass.traverse(c,r)),e.volumes.length>0&&(e.volumePass||(e.volumePass=dw.newInstance()),e.volumePass.setColorTextureView(e.opaquePass.getColorTextureView()),e.volumePass.setDepthTextureView(e.opaquePass.getDepthTextureView()),e.volumePass.setVolumes(e.volumes),e.volumePass.traverse(c,r)),t.finalPass(r,c))}},t.finalPass=(r,n)=>{e._finalBlitEncoder||t.createFinalBlitEncoder(r),e._finalBlitOutputTextureView.createFromTextureHandle(r.getCurrentTexture(),{depth:1,format:r.getPresentationFormat()}),e._finalBlitEncoder.attachTextureViews(),e._finalBlitEncoder.begin(r.getCommandEncoder()),n.scissorAndViewport(e._finalBlitEncoder),e._fullScreenQuad.prepareAndDraw(e._finalBlitEncoder),e._finalBlitEncoder.end()},t.createFinalBlitEncoder=r=>{e._finalBlitEncoder=Je.newInstance({label:"forwardPassBlit"}),e._finalBlitEncoder.setDescription({colorAttachments:[{view:null,loadOp:"load",storeOp:"store"}]}),e._finalBlitEncoder.setPipelineHash("fpf"),e._finalBlitEncoder.setPipelineSettings({primitive:{cullMode:"none"},fragment:{targets:[{format:r.getPresentationFormat(),blend:{color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{srcfactor:"one",dstFactor:"one-minus-src-alpha"}}}]}}),e._fsqSampler=Xs.newInstance({label:"finalPassSampler"}),e._fsqSampler.create(r.getDevice(),{minFilter:"linear",magFilter:"linear"}),e._fullScreenQuad=Zt.newInstance(),e._fullScreenQuad.setDevice(r.getDevice()),e._fullScreenQuad.setPipelineHash("fpfsq"),e._fullScreenQuad.setTextureViews([e.opaquePass.getColorTextureView()]),e._fullScreenQuad.setAdditionalBindables([e._fsqSampler]),e._fullScreenQuad.setFragmentShaderTemplate(Tw),e._finalBlitOutputTextureView=gg.newInstance(),e._finalBlitEncoder.setColorTextureView(0,e._finalBlitOutputTextureView)},t.incrementOpaqueActorCount=()=>e.opaqueActorCount++,t.incrementTranslucentActorCount=()=>e.translucentActorCount++,t.addVolume=r=>{e.volumes.push(r)}}const Sw={opaqueActorCount:0,translucentActorCount:0,volumes:null,opaqueRenderEncoder:null,translucentPass:null,volumePass:null};function qg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Sw,r),at.extend(t,e,r),E.setGet(t,e,["opaquePass","translucentPass","volumePass"]),xw(t,e)}const Cw=E.newInstance(qg,"vtkForwardPass");var ww={newInstance:Cw,extend:qg};const{VtkDataTypes:Dt}=Q;function Ew(t,e){e.classHierarchy.push("vtkWebGPUTextureManager");function r(a){if(a.imageData){a.dataArray=a.imageData.getPointData().getScalars(),a.time=a.dataArray.getMTime(),a.nativeArray=a.dataArray.getData();const s=a.imageData.getDimensions();switch(a.width=s[0],a.height=s[1],a.depth=s[2],a.dataArray.getNumberOfComponents()){case 1:a.format="r";break;case 2:a.format="rg";break;case 3:case 4:default:a.format="rgba";break}switch(a.dataArray.getDataType()){case Dt.UNSIGNED_CHAR:a.format+="8unorm";break;case Dt.FLOAT:case Dt.UNSIGNED_INT:case Dt.INT:case Dt.DOUBLE:case Dt.UNSIGNED_SHORT:case Dt.SHORT:default:a.format+="16float";break}}a.image&&(a.width=a.image.width,a.height=a.image.height,a.depth=1,a.format="rgba8unorm"),a.jsImageData&&(a.width=a.jsImageData.width,a.height=a.jsImageData.height,a.depth=1,a.format="rgba8unorm",a.flip=!0,a.nativeArray=a.jsImageData.data),a.canvas&&(a.width=a.canvas.width,a.height=a.canvas.height,a.depth=1,a.format="rgba8unorm",a.flip=!0,a.usage=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT)}function n(a){const s=Xe.newInstance();return s.create(e.device,{width:a.width,height:a.height,depth:a.depth,format:a.format,usage:a.usage,mipLevel:a.mipLevel}),(a.nativeArray||a.image||a.canvas)&&s.writeImageData(a),s}t.getTexture=a=>a.hash?e.device.getCachedObject(a.hash,n,a):n(a),t.getTextureForImageData=a=>{const s={time:a.getMTime()};return s.imageData=a,r(s),s.hash=s.time+s.format+s.mipLevel,e.device.getTextureManager().getTexture(s)},t.getTextureForVTKTexture=a=>{const s={time:a.getMTime()};return a.getInputData()?s.imageData=a.getInputData():a.getImage()?s.image=a.getImage():a.getJsImageData()?s.jsImageData=a.getJsImageData():a.getCanvas()&&(s.canvas=a.getCanvas()),r(s),s.mipLevel=a.getMipLevel(),s.hash=s.time+s.format+s.mipLevel,e.device.getTextureManager().getTexture(s)}}const Ow={handle:null,device:null};function Ig(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Ow,r),E.obj(t,e),E.setGet(t,e,["device"]),Ew(t,e)}const Rw=E.newInstance(Ig);var Mw={newInstance:Rw,extend:Ig};class Dw extends Map{constructor(){super(),this.registry=new FinalizationRegistry(e=>{const r=super.get(e);r&&r.deref&&r.deref()===void 0&&super.delete(e)})}getValue(e){const r=super.get(e);if(r){const n=r.deref();if(n!==void 0)return n;super.delete(e)}}setValue(e,r){let n;return r&&typeof r=="object"&&(n=new WeakRef(r),this.registry.register(r,e),super.set(e,n)),n}}function Lw(t,e){e.classHierarchy.push("vtkWebGPUDevice"),t.initialize=r=>{e.handle=r},t.createCommandEncoder=()=>e.handle.createCommandEncoder(),t.submitCommandEncoder=r=>{e.handle.queue.submit([r.finish()])},t.getShaderModule=r=>e.shaderCache.getShaderModule(r),t.getBindGroupLayout=r=>{if(!r.entries)return null;for(let s=0;s<r.entries.length;s++){const i=r.entries[s];i.binding=i.binding||0,i.visibility=i.visibility||GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT}const n=JSON.stringify(r);for(let s=0;s<e.bindGroupLayouts.length;s++)if(e.bindGroupLayouts[s].sval===n)return e.bindGroupLayouts[s].layout;const a=e.handle.createBindGroupLayout(r);return e.bindGroupLayouts.push({sval:n,layout:a}),a},t.getBindGroupLayoutDescription=r=>{for(let n=0;n<e.bindGroupLayouts.length;n++)if(e.bindGroupLayouts[n].layout===r)return e.bindGroupLayouts[n].sval;return vtkErrorMacro("layout not found"),console.trace(),null},t.getPipeline=r=>r in e.pipelines?e.pipelines[r]:null,t.createPipeline=(r,n)=>{n.initialize(t,r),e.pipelines[r]=n},t.onSubmittedWorkDone=()=>e.handle.queue.onSubmittedWorkDone(),t.hasCachedObject=r=>e.objectCache.getValue(r),t.getCachedObject=function(r,n){if(!r)return vtkErrorMacro("attempt to cache an object without a hash"),null;const a=e.objectCache.getValue(r);if(a)return a;for(var s=arguments.length,i=new Array(s>2?s-2:0),o=2;o<s;o++)i[o-2]=arguments[o];const c=n(...i);return e.objectCache.setValue(r,c),c}}const Vw={handle:null,pipelines:null,shaderCache:null,bindGroupLayouts:null,bufferManager:null,textureManager:null};function Qg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Vw,r),ve(t,e),ue(t,e,["handle"]),Ee(t,e,["bufferManager","shaderCache","textureManager"]),e.objectCache=new Dw,e.shaderCache=H.newInstance(),e.shaderCache.setDevice(t),e.bindGroupLayouts=[],e.bufferManager=xt.newInstance(),e.bufferManager.setDevice(t),e.textureManager=Mw.newInstance(),e.textureManager.setDevice(t),e.pipelines={},Lw(t,e)}const _w=Z(Qg,"vtkWebGPUDevice");var Bw={newInstance:_w,extend:Qg};function Fw(t,e){e.classHierarchy.push("vtkWebGPUHardwareSelectionPass"),t.traverse=(r,n)=>{if(e.deleted)return;e._currentParent=null,t.setCurrentOperation("buildPass"),r.traverse(t);const a=r.getDevice();if(e.selectionRenderEncoder)e.colorTexture.resize(r.getCanvas().width,r.getCanvas().height),e.depthTexture.resizeToMatch(e.colorTexture);else{t.createRenderEncoder(),e.colorTexture=Xe.newInstance({label:"hardwareSelectorColor"}),e.colorTexture.create(a,{width:r.getCanvas().width,height:r.getCanvas().height,format:"rgba32uint",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC});const s=e.colorTexture.createView("hardwareSelectColorTexture");e.selectionRenderEncoder.setColorTextureView(0,s),e.depthTexture=Xe.newInstance({label:"hardwareSelectorDepth"}),e.depthTexture.create(a,{width:r.getCanvas().width,height:r.getCanvas().height,format:"depth32float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC});const i=e.depthTexture.createView("hardwareSelectDepthTexture");e.selectionRenderEncoder.setDepthTextureView(i)}e.selectionRenderEncoder.attachTextureViews(),n.setRenderEncoder(e.selectionRenderEncoder),t.setCurrentOperation("cameraPass"),n.traverse(t),t.setCurrentOperation("opaquePass"),n.traverse(t)},t.createRenderEncoder=()=>{e.selectionRenderEncoder=Je.newInstance({label:"HardwareSelectionPass"}),e.selectionRenderEncoder.setPipelineHash("sel"),e.selectionRenderEncoder.setReplaceShaderCodeFunction(n=>{const a=n.getShaderDescription("fragment");a.addOutput("vec4<u32>","outColor");let s=a.getCode();s=H.substitute(s,"//VTK::RenderEncoder::Impl",["output.outColor = vec4<u32>(mapperUBO.PropID, compositeID, 0u, 0u);"]).result,a.setCode(s)});const r=e.selectionRenderEncoder.getDescription();r.colorAttachments[0].clearValue=[0,0,0,0],e.selectionRenderEncoder.setPipelineSettings({primitive:{cullMode:"none"},depthStencil:{depthWriteEnabled:!0,depthCompare:"greater",format:"depth32float"},fragment:{targets:[{format:"rgba32uint",blend:void 0}]}})}}const Uw={selectionRenderEncoder:null,colorTexture:null,depthTexture:null};function Zg(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Uw,r),at.extend(t,e,r),E.get(t,e,["colorTexture","depthTexture"]),Fw(t,e)}const mw=E.newInstance(Zg,"vtkWebGPUHardwareSelectionPass");var kw={newInstance:mw,extend:Zg};const{SelectionContent:Nw,SelectionField:jo}=qn,{FieldAssociations:Ko}=bt,{vtkErrorMacro:Jg}=E;function Gw(t){return`${t.propID} ${t.compositeID}`}function Xo(t,e,r,n){const a=((r.height-e-1)*r.colorBufferWidth+t)*4+n;return r.colorValues[a]}function bw(t,e,r,n){{if(n[0]=e[0],n[1]=e[1],e[0]<0||e[0]>=t.width||e[1]<0||e[1]>=t.height)return null;const a=Xo(e[0],e[1],t,0);if(a<=0)return null;const s={};s.propID=a;let i=Xo(e[0],e[1],t,1);if((i<0||i>16777215)&&(i=0),s.compositeID=i,t.captureZValues){const o=(t.height-e[1]-1)*t.zbufferBufferWidth+e[0];s.zValue=t.depthValues[o],s.zValue=t.webGPURenderer.convertToOpenGLDepth(s.zValue),s.displayPosition=e}return s}}function $w(t,e,r){const n=[];let a=0;return e.forEach((s,i)=>{const o=qn.newInstance();switch(o.setContentType(Nw.INDICES),t){case Ko.FIELD_ASSOCIATION_CELLS:o.setFieldType(jo.CELL);break;case Ko.FIELD_ASSOCIATION_POINTS:o.setFieldType(jo.POINT);break;default:Jg("Unknown field association")}o.getProperties().propID=s.info.propID;const c=r.webGPURenderer.getPropFromID(s.info.propID);o.getProperties().prop=c.getRenderable(),o.getProperties().compositeID=s.info.compositeID,o.getProperties().pixelCount=s.pixelCount,r.captureZValues&&(o.getProperties().displayPosition=[s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue],o.getProperties().worldPosition=r.webGPURenderWindow.displayToWorld(s.info.displayPosition[0],s.info.displayPosition[1],s.info.zValue,r.renderer)),o.setSelectionList(s.attributeIDs),n[a]=o,a++}),n}function Ww(t,e,r,n,a){const s=Math.floor(e),i=Math.floor(r),o=Math.floor(n),c=Math.floor(a),u=new Map,g=[0,0];for(let f=i;f<=c;f++)for(let l=s;l<=o;l++){const y=bw(t,[l,f],0,g);if(y){const h=Gw(y);if(!u.has(h))u.set(h,{info:y,pixelCount:1,attributeIDs:[y.attributeID]});else{const v=u.get(h);v.pixelCount++,t.captureZValues&&y.zValue<v.info.zValue&&(v.info=y),v.attributeIDs.indexOf(y.attributeID)===-1&&v.attributeIDs.push(y.attributeID)}}}return $w(t.fieldAssociation,u,t)}function zw(t,e){e.classHierarchy.push("vtkWebGPUHardwareSelector"),t.endSelection=()=>{e.WebGPURenderer.setSelector(null)},t.getSourceDataAsync=async r=>{if(!r||!e._WebGPURenderWindow)return Jg("Renderer and view must be set before calling Select."),!1;e._WebGPURenderWindow.getRenderable().preRender(),e._WebGPURenderWindow.getInitialized()||(e._WebGPURenderWindow.initialize(),await new Promise(p=>{e._WebGPURenderWindow.onInitialized(p)}));const n=e._WebGPURenderWindow.getViewNodeFor(r);if(!n)return!1;const a=n.getSuppressClear();n.setSuppressClear(!0),e._selectionPass.traverse(e._WebGPURenderWindow,n),n.setSuppressClear(a);const s=e._WebGPURenderWindow.getDevice(),i=e._selectionPass.getColorTexture(),o=e._selectionPass.getDepthTexture(),c={area:[0,0,i.getWidth()-1,i.getHeight()-1],captureZValues:e.captureZValues,fieldAssociation:e.fieldAssociation,renderer:r,webGPURenderer:n,webGPURenderWindow:e._WebGPURenderWindow,width:i.getWidth(),height:i.getHeight()};c.colorBufferWidth=16*Math.floor((c.width+15)/16),c.colorBufferSizeInBytes=c.colorBufferWidth*c.height*4*4;const u=Jt.newInstance({label:"hardwareSelectColorBuffer"});u.setDevice(s),u.create(c.colorBufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);const g=e._WebGPURenderWindow.getCommandEncoder();g.copyTextureToBuffer({texture:i.getHandle()},{buffer:u.getHandle(),bytesPerRow:16*c.colorBufferWidth,rowsPerImage:c.height},{width:c.width,height:c.height,depthOrArrayLayers:1});let f;e.captureZValues&&(c.zbufferBufferWidth=64*Math.floor((c.width+63)/64),f=Jt.newInstance({label:"hardwareSelectDepthBuffer"}),f.setDevice(s),c.zbufferSizeInBytes=c.height*c.zbufferBufferWidth*4,f.create(c.zbufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST),g.copyTextureToBuffer({texture:o.getHandle(),aspect:"depth-only"},{buffer:f.getHandle(),bytesPerRow:4*c.zbufferBufferWidth,rowsPerImage:c.height},{width:c.width,height:c.height,depthOrArrayLayers:1})),s.submitCommandEncoder(g);const l=u.mapAsync(GPUMapMode.READ);if(e.captureZValues){const p=f.mapAsync(GPUMapMode.READ);await Promise.all([l,p]),c.depthValues=new Float32Array(f.getMappedRange().slice()),f.unmap()}else await l;return c.colorValues=new Uint32Array(u.getMappedRange().slice()),u.unmap(),c.generateSelection=(p,y,h,v)=>Ww(c,p,y,h,v),c}}const Hw={};function el(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Hw,r),Vg.extend(t,e,r),e._selectionPass=kw.newInstance(),E.setGet(t,e,["_WebGPURenderWindow"]),E.moveToProtected(t,e,["WebGPURenderWindow"]),zw(t,e)}const Aw=E.newInstance(el,"vtkWebGPUHardwareSelector");var tl={newInstance:Aw,extend:el};const{vtkErrorMacro:Po}=E,jw={position:"absolute",top:0,left:0,width:"100%",height:"100%"};function Kw(t,e){e.classHierarchy.push("vtkWebGPURenderWindow"),t.getViewNodeFactory=()=>e.myFactory;const r=[0,0];function n(){e.renderable&&(e.size[0]!==r[0]||e.size[1]!==r[1])&&(r[0]=e.size[0],r[1]=e.size[1],e.canvas.setAttribute("width",e.size[0]),e.canvas.setAttribute("height",e.size[1]),t.recreateSwapChain()),e.viewStream&&e.viewStream.setSize(e.size[0],e.size[1]),e.canvas.style.display=e.useOffScreen?"none":"block",e.el&&(e.el.style.cursor=e.cursorVisibility?e.cursor:"none"),e.containerSize=null}t.onModified(n),t.recreateSwapChain=()=>{e.context&&(e.context.unconfigure(),e.presentationFormat=navigator.gpu.getPreferredCanvasFormat(e.adapter),e.context.configure({device:e.device.getHandle(),format:e.presentationFormat,alphaMode:"premultiplied",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST,width:e.size[0],height:e.size[1]}),e._configured=!0)},t.getCurrentTexture=()=>e.context.getCurrentTexture(),t.buildPass=i=>{if(i){if(!e.renderable)return;t.prepareNodes(),t.addMissingNodes(e.renderable.getRenderersByReference()),t.removeUnusedNodes(),t.initialize()}else e.initialized&&(e._configured||t.recreateSwapChain(),e.commandEncoder=e.device.createCommandEncoder())},t.initialize=()=>{if(!e.initializing){if(e.initializing=!0,!navigator.gpu){Po("WebGPU is not enabled.");return}t.create3DContextAsync().then(()=>{e.initialized=!0,!e.deleted&&t.invokeInitialized()})}},t.setContainer=i=>{e.el&&e.el!==i&&(e.canvas.parentNode!==e.el&&Po("Error: canvas parent node does not match container"),e.el.removeChild(e.canvas),e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)),e.el!==i&&(e.el=i,e.el&&(e.el.appendChild(e.canvas),e.useBackgroundImage&&e.el.appendChild(e.bgImage)),t.modified())},t.getContainer=()=>e.el,t.getContainerSize=()=>{if(!e.containerSize&&e.el){const{width:i,height:o}=e.el.getBoundingClientRect();e.containerSize=[i,o]}return e.containerSize||e.size},t.getFramebufferSize=()=>e.size,t.create3DContextAsync=async()=>{if(e.adapter=await navigator.gpu.requestAdapter({powerPreference:"high-performance"}),!e.deleted){if(e.device=Bw.newInstance(),e.device.initialize(await e.adapter.requestDevice()),e.deleted){e.device=null;return}e.context=e.canvas.getContext("webgpu")}},t.releaseGraphicsResources=()=>{const i=at.newInstance();i.setCurrentOperation("Release"),i.traverse(t,null),e.adapter=null,e.device=null,e.context=null,e.initialized=!1,e.initializing=!1},t.setBackgroundImage=i=>{e.bgImage.src=i.src},t.setUseBackgroundImage=i=>{e.useBackgroundImage=i,e.useBackgroundImage&&!e.el.contains(e.bgImage)?e.el.appendChild(e.bgImage):!e.useBackgroundImage&&e.el.contains(e.bgImage)&&e.el.removeChild(e.bgImage)};async function a(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.imageFormat;const o=document.createElement("canvas"),c=o.getContext("2d");o.width=e.canvas.width,o.height=e.canvas.height;const u=await t.getPixelsAsync(),g=new ImageData(u.colorValues,u.width,u.height);c.putImageData(g,0,0);const f=e.canvas.getBoundingClientRect();e.renderable.getRenderers().forEach(h=>{h.getViewProps().forEach(x=>{if(x.getContainer){const d=x.getContainer().getElementsByTagName("canvas");for(let T=0;T<d.length;T++){const w=d[T],C=w.getBoundingClientRect(),O=C.x-f.x,R=C.y-f.y;c.drawImage(w,O,R)}}})});const y=o.toDataURL(i);o.remove(),t.invokeImageReady(y)}t.captureNextImage=function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"image/png",{resetCamera:o=!1,size:c=null,scale:u=1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e.deleted)return null;e.imageFormat=i;const g=e.notifyStartCaptureImage;return e.notifyStartCaptureImage=!0,e._screenshot={size:c||u!==1?c||e.size.map(f=>f*u):null},new Promise((f,l)=>{const p=t.onImageReady(y=>{if(e._screenshot.size===null)e.notifyStartCaptureImage=g,p.unsubscribe(),e._screenshot.placeHolder&&(e.size=e._screenshot.originalSize,t.modified(),e._screenshot.cameras&&e._screenshot.cameras.forEach(h=>{let{restoreParamsFn:v,arg:x}=h;return v(x)}),t.traverseAllPasses(),e.el.removeChild(e._screenshot.placeHolder),e._screenshot.placeHolder.remove(),e._screenshot=null),f(y);else{const h=document.createElement("img");if(h.style=jw,h.src=y,e._screenshot.placeHolder=e.el.appendChild(h),e.canvas.style.display="none",e._screenshot.originalSize=e.size,e.size=e._screenshot.size,e._screenshot.size=null,t.modified(),o){const v=o!==!0;e._screenshot.cameras=e.renderable.getRenderers().map(x=>{const S=x.getActiveCamera(),d=S.get("focalPoint","position","parallelScale");return{resetCameraArgs:v?{renderer:x}:void 0,resetCameraFn:v?o:x.resetCamera,restoreParamsFn:S.set,arg:JSON.parse(JSON.stringify(d))}}),e._screenshot.cameras.forEach(x=>{let{resetCameraFn:S,resetCameraArgs:d}=x;return S(d)})}t.traverseAllPasses()}})})},t.traverseAllPasses=()=>{if(!e.deleted)if(e.initialized){if(e.renderPasses)for(let i=0;i<e.renderPasses.length;++i)e.renderPasses[i].traverse(t,null);e.commandEncoder&&(e.device.submitCommandEncoder(e.commandEncoder),e.commandEncoder=null,e.notifyStartCaptureImage&&e.device.onSubmittedWorkDone().then(()=>{a()}))}else{t.initialize();const i=t.onInitialized(()=>{i.unsubscribe(),t.traverseAllPasses()})}},t.setViewStream=i=>{if(e.viewStream===i)return!1;if(e.subscription&&(e.subscription.unsubscribe(),e.subscription=null),e.viewStream=i,e.viewStream){const o=e.renderable.getRenderers()[0];o.getBackgroundByReference()[3]=0,t.setUseBackgroundImage(!0),e.subscription=e.viewStream.onImageReady(c=>t.setBackgroundImage(c.image)),e.viewStream.setSize(e.size[0],e.size[1]),e.viewStream.invalidateCache(),e.viewStream.render(),t.modified()}return!0},t.getUniquePropID=()=>e.nextPropID++,t.getPropFromID=i=>{for(let o=0;o<e.children.length;o++){const c=e.children[o].getPropFromID(i);if(c!==null)return c}return null},t.getPixelsAsync=async()=>{const i=e.device,o=e.renderPasses[0].getOpaquePass().getColorTexture(),c={width:o.getWidth(),height:o.getHeight()};c.colorBufferWidth=32*Math.floor((c.width+31)/32),c.colorBufferSizeInBytes=c.colorBufferWidth*c.height*8;const u=Jt.newInstance();u.setDevice(i),u.create(c.colorBufferSizeInBytes,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);const g=e.device.createCommandEncoder();g.copyTextureToBuffer({texture:o.getHandle()},{buffer:u.getHandle(),bytesPerRow:8*c.colorBufferWidth,rowsPerImage:c.height},{width:c.width,height:c.height,depthOrArrayLayers:1}),i.submitCommandEncoder(g),await u.mapAsync(GPUMapMode.READ),c.colorValues=new Uint16Array(u.getMappedRange().slice()),u.unmap();const l=new Uint8ClampedArray(c.height*c.width*4);for(let p=0;p<c.height;p++)for(let y=0;y<c.width;y++){const h=(p*c.width+y)*4,v=(p*c.colorBufferWidth+y)*4;l[h]=255*Ne.fromHalf(c.colorValues[v]),l[h+1]=255*Ne.fromHalf(c.colorValues[v+1]),l[h+2]=255*Ne.fromHalf(c.colorValues[v+2]),l[h+3]=255*Ne.fromHalf(c.colorValues[v+3])}return c.colorValues=l,c},t.createSelector=()=>{const i=tl.newInstance();return i.setWebGPURenderWindow(t),i};const s=t.setSize;t.setSize=(i,o)=>{const c=s(i,o);return c&&t.invokeWindowResizeEvent({width:i,height:o}),c},t.delete=E.chain(t.delete,t.setViewStream)}const Xw={initialized:!1,context:null,adapter:null,device:null,canvas:null,cursorVisibility:!0,cursor:"pointer",containerSize:null,renderPasses:[],notifyStartCaptureImage:!1,imageFormat:"image/png",useOffScreen:!1,useBackgroundImage:!1,nextPropID:1,xrSupported:!1,presentationFormat:null};function Pw(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Xw,r),e.canvas=document.createElement("canvas"),e.canvas.style.width="100%",e.bgImage=new Image,e.bgImage.style.position="absolute",e.bgImage.style.left="0",e.bgImage.style.top="0",e.bgImage.style.width="100%",e.bgImage.style.height="100%",e.bgImage.style.zIndex="-1",zg.extend(t,e,r),e.myFactory=RT.newInstance(),e.renderPasses[0]=ww.newInstance(),e.selector||(e.selector=tl.newInstance(),e.selector.setWebGPURenderWindow(t)),E.event(t,e,"imageReady"),E.event(t,e,"initialized"),E.get(t,e,["commandEncoder","device","presentationFormat","useBackgroundImage","xrSupported"]),E.setGet(t,e,["initialized","context","canvas","device","renderPasses","notifyStartCaptureImage","cursor","useOffScreen"]),E.setGetArray(t,e,["size"],2),E.event(t,e,"windowResizeEvent"),Kw(t,e)}const rl=E.newInstance(Pw,"vtkWebGPURenderWindow");Ps("WebGPU",rl);Ye("vtkRenderWindow",rl);const Yw=H2.extractURLParameters(),qw={margin:"0",padding:"0",position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden"},Iw={position:"absolute",left:"25px",top:"25px",backgroundColor:"white",borderRadius:"5px",listStyle:"none",padding:"5px 10px",margin:"0",display:"block",border:"solid 1px black",maxWidth:"calc(100% - 70px)",maxHeight:"calc(100% - 60px)",overflow:"auto"};function Yo(t,e){Object.keys(e).forEach(r=>{t.style[r]=e[r]})}function Qw(t,e){e.classHierarchy.push("vtkFullScreenRenderWindow");const r=document.querySelector("body");e.rootContainer||(e.rootContainer=r),e.container||(e.container=document.createElement("div"),Yo(e.container,e.containerStyle||qw),e.rootContainer.appendChild(e.container)),e.rootContainer===r&&(document.documentElement.style.height="100%",r.style.height="100%",r.style.padding="0",r.style.margin="0"),e.renderWindow=v2.newInstance(),e.renderer=f2.newInstance(),e.renderWindow.addRenderer(e.renderer),e.apiSpecificRenderWindow=e.renderWindow.newAPISpecificView(Yw.viewAPI??e.defaultViewAPI),e.apiSpecificRenderWindow.setContainer(e.container),e.renderWindow.addView(e.apiSpecificRenderWindow),e.interactor=Sg.newInstance(),e.interactor.setInteractorStyle($2.newInstance()),e.interactor.setView(e.apiSpecificRenderWindow),e.interactor.initialize(),e.interactor.bindEvents(e.container),t.setBackground=e.renderer.setBackground,t.removeController=()=>{const a=e.controlContainer;a&&a.parentNode.removeChild(a)},t.setControllerVisibility=a=>{e.controllerVisibility=a,e.controlContainer&&(a?e.controlContainer.style.display="block":e.controlContainer.style.display="none")},t.toggleControllerVisibility=()=>{t.setControllerVisibility(!e.controllerVisibility)};function n(a){String.fromCharCode(a.charCode)==="c"&&t.toggleControllerVisibility()}t.addController=a=>{e.controlContainer=document.createElement("div"),Yo(e.controlContainer,e.controlPanelStyle||Iw),e.rootContainer.appendChild(e.controlContainer),e.controlContainer.innerHTML=a,t.setControllerVisibility(e.controllerVisibility),e.rootContainer.addEventListener("keypress",n)},t.setBackground(...e.background),t.addRepresentation=a=>{a.getActors().forEach(s=>{e.renderer.addActor(s)})},t.removeRepresentation=a=>{a.getActors().forEach(s=>e.renderer.removeActor(s))},t.delete=E.chain(t.setContainer,e.apiSpecificRenderWindow.delete,()=>{var a;(a=e.rootContainer)==null||a.removeEventListener("keypress",n),window.removeEventListener("resize",t.resize)},t.delete),t.resize=()=>{const a=e.container.getBoundingClientRect(),s=window.devicePixelRatio||1;e.apiSpecificRenderWindow.setSize(Math.floor(a.width*s),Math.floor(a.height*s)),e.resizeCallback&&e.resizeCallback(a),e.renderWindow.render()},t.setResizeCallback=a=>{e.resizeCallback=a,t.resize()},e.listenWindowResize&&window.addEventListener("resize",t.resize),t.resize()}const Zw={background:[.32,.34,.43],containerStyle:null,controlPanelStyle:null,listenWindowResize:!0,resizeCallback:null,controllerVisibility:!0};function nl(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,Zw,r),E.obj(t,e),E.get(t,e,["renderWindow","renderer","apiSpecificRenderWindow","interactor","rootContainer","container","controlContainer"]),Qw(t,e)}const Jw=E.newInstance(nl);var eE={newInstance:Jw,extend:nl};function al(t){return new TextDecoder("latin1").decode(t)}function tE(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const n=al(t),a=e.exec(n);if(!a)return{text:n};const s=a.index+a[0].length,i=n.substring(0,s);let o=null;const c=r?r.exec(n):null;if(c){const u=n.substr(c.index);o={text:i+u,binaryBuffer:t.slice(s,c.index)}}else o={text:i,binaryBuffer:t.slice(s)};return o}var qo={arrayBufferToString:al,extractBinary:tE};const Zs={};function sl(t){return!!Zs[t]}function rE(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"http",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Zs[t](e)}function il(t,e){Zs[t]=e}var nE={get:rE,has:sl,registerType:il};function ol(){const t=new ArrayBuffer(4),e=new Uint8Array(t),r=new Uint32Array(t);return e[0]=161,e[1]=178,e[2]=195,e[3]=212,r[0]===3569595041?"LittleEndian":r[0]===2712847316?"BigEndian":null}const aE=ol();function sE(t,e){if(e<2)return;const r=new Int8Array(t),n=r.length,a=[];for(let s=0;s<n;s+=e){for(let i=0;i<e;i++)a.push(r[s+i]);for(let i=0;i<e;i++)r[s+i]=a.pop()}}var za={ENDIANNESS:aE,getEndianness:ol,swapBytes:sE};const{vtkErrorMacro:cl,vtkDebugMacro:iE}=E,Js=()=>(cl("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead."),Promise.reject(new Error("LiteHttpDataAccessHelper does not support compression. Need to register HttpDataAccessHelper instead.")));let er=0;function In(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n=new XMLHttpRequest;return n.open(t,e,!0),r.headers&&Object.entries(r.headers).forEach(a=>{let[s,i]=a;return n.setRequestHeader(s,i)}),r.progressCallback&&n.addEventListener("progress",r.progressCallback),n}function oE(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((r,n)=>{const a=In("GET",t,e);a.onreadystatechange=s=>{a.readyState===4&&(a.status===200||a.status===0?r(a.response):n({xhr:a,e:s}))},a.responseType="arraybuffer",a.send()})}function cE(t,e,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return n&&n.compression?Js():r.ref&&!r.ref.pending?new Promise((a,s)=>{const i=[e,r.ref.basepath,r.ref.id].join("/"),o=In("GET",i,n);o.onreadystatechange=c=>{o.readyState===1&&(r.ref.pending=!0,++er===1&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!0)),o.readyState===4&&(r.ref.pending=!1,o.status===200||o.status===0?(r.buffer=o.response,r.ref.encode==="JSON"?r.values=JSON.parse(r.buffer):(za.ENDIANNESS!==r.ref.encode&&za.ENDIANNESS&&(iE(`Swap bytes of ${r.name}`),za.swapBytes(r.buffer,jf[r.dataType])),r.values=E.newTypedArray(r.dataType,r.buffer)),r.values.length!==r.size&&cl(`Error in FetchArray: ${r.name}, does not have the proper array size. Got ${r.values.length}, instead of ${r.size}`),delete r.ref,--er===0&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!1),t!=null&&t.modified&&t.modified(),a(r)):s({xhr:o,e:c}))},o.responseType=r.dataType!=="string"?"arraybuffer":"text",o.send()}):Promise.resolve(r)}function fE(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return r&&r.compression?Js():new Promise((n,a)=>{const s=In("GET",e,r);s.onreadystatechange=i=>{s.readyState===1&&++er===1&&t!=null&&t.invokeBusy&&t.invokeBusy(!0),s.readyState===4&&(--er===0&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!1),s.status===200||s.status===0?n(JSON.parse(s.responseText)):a({xhr:s,e:i}))},s.responseType="text",s.send()})}function uE(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return r&&r.compression?Js():new Promise((n,a)=>{const s=In("GET",e,r);s.onreadystatechange=i=>{s.readyState===1&&++er===1&&t!=null&&t.invokeBusy&&t.invokeBusy(!0),s.readyState===4&&(--er===0&&(t!=null&&t.invokeBusy)&&t.invokeBusy(!1),s.status===200||s.status===0?n(s.responseText):a({xhr:s,e:i}))},s.responseType="text",s.send()})}function gE(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return new Promise((n,a)=>{const s=new Image;r.crossOrigin&&(s.crossOrigin=r.crossOrigin),s.onload=()=>n(s),s.onerror=a,s.src=e})}const lE={fetchArray:cE,fetchJSON:fE,fetchText:uE,fetchBinary:oE,fetchImage:gE};sl("http")||il("http",t=>lE);const Ha={ASCII:"ascii",BINARY_LITTLE_ENDIAN:"binary_little_endian"},Io={diffuse_red:"red",diffuse_green:"green",diffuse_blue:"blue"},fl={patternHeader:/ply([\s\S]*)end_header\r?\n/,patternBody:/end_header\s([\s\S]*)$/};function Qo(t){let e="",r=0;const n=fl.patternHeader.exec(t);n!==null&&(e=n[1],r=n[0].length);const a={comments:[],elements:[],headerLength:r},s=e.split(`
`);let i,o,c;for(let u=0;u<s.length;u++){let g=s[u];if(g=g.trim(),g!==""){let f;switch(c=g.split(/\s+/),o=c.shift(),g=c.join(" "),o){case"format":a.format=c[0],a.version=c[1];break;case"comment":a.comments.push(g);break;case"element":i!==void 0&&a.elements.push(i),i={},i.name=c[0],i.count=parseInt(c[1],10),i.properties=[];break;case"property":f={type:c[0]},f.type==="list"?(f.name=c[3],f.countType=c[1],f.itemType=c[2]):f.name=c[1],f.name in Io&&(f.name=Io[f.name]),i.properties.push(f);break;case"obj_info":a.objInfo=g;break;default:console.warn("unhandled",o,c);break}}}return i!==void 0&&a.elements.push(i),a}function Zo(t,e){const r=e.find(h=>h.name==="vertex"),n=e.find(h=>h.name==="face");let a=0,s=0;r&&(a=r.count),n&&(s=n.count);const i=new Float32Array(a*3),o=new Uint8Array(a*3),c=new Float32Array(a*2),u=new Float32Array(a*3),g=t.colors.length>0,f=t.uvs.length>0,l=t.normals.length>0,p=t.faceVertexUvs.length>0;for(let h=0;h<a;h++){let v=h*3+0,x=h*3+1;const S=h*3+2;i[v]=t.vertices[v],i[x]=t.vertices[x],i[S]=t.vertices[S],g&&(o[v]=t.colors[v],o[x]=t.colors[x],o[S]=t.colors[S]),f&&(v=h*2+0,x=h*2+1,c[v]=t.uvs[v],c[x]=t.uvs[x]),l&&(u[v]=t.normals[v],u[x]=t.normals[x],u[S]=t.normals[S])}if(!f&&p){let h=0,v=0;for(let x=0;x<s;++x){const S=t.indices[h++],d=t.faceVertexUvs[v++];if(d&&S*2===d.length)for(let T=0;T<S;++T){const w=t.indices[h++];c[w*2+0]=d[T*2+0],c[w*2+1]=d[T*2+1]}else h+=S}}const y=nt.newInstance();if(y.getPoints().setData(i,3),g&&y.getPointData().setScalars(Q.newInstance({numberOfComponents:3,values:o,name:"Scalars"})),f||p){const h=Q.newInstance({numberOfComponents:2,values:c,name:"TextureCoordinates"}),v=y.getPointData();v.addArray(h),v.setActiveTCoords(h.getName())}return l&&y.getPointData().setNormals(Q.newInstance({numberOfComponents:3,name:"Normals",values:u})),y.getPolys().setData(Uint32Array.from(t.indices)),y}function Aa(t,e){let r;switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":r=parseInt(t,10);break;case"float":case"double":case"float32":case"float64":r=parseFloat(t);break;default:console.log("Unsupported type");break}return r}function pE(t,e){const r=e.split(/\s+/),n={};for(let a=0;a<t.length;a++)if(t[a].type==="list"){const s=[],i=Aa(r.shift(),t[a].countType);for(let o=0;o<i;o++)s.push(Aa(r.shift(),t[a].itemType));n[t[a].name]=s}else n[t[a].name]=Aa(r.shift(),t[a].type);return n}function Jo(t,e,r){if(e==="vertex")t.vertices.push(r.x,r.y,r.z),"nx"in r&&"ny"in r&&"nz"in r&&t.normals.push(r.nx,r.ny,r.nz),"s"in r&&"t"in r?t.uvs.push(r.s,r.t):"u"in r&&"v"in r?t.uvs.push(r.u,r.v):"texture_u"in r&&"texture_v"in r&&t.uvs.push(r.texture_u,r.texture_v),"red"in r&&"green"in r&&"blue"in r&&t.colors.push(r.red,r.green,r.blue);else if(e==="face"){const n=r.vertex_indices||r.vertex_index,a=r.texcoord;n&&n.length>0&&(t.indices.push(n.length),n.forEach((s,i)=>{t.indices.push(s)})),t.faceVertexUvs.push(a)}}function ja(t,e,r,n){let a;switch(r){case"int8":case"char":a=[t.getInt8(e),1];break;case"uint8":case"uchar":a=[t.getUint8(e),1];break;case"int16":case"short":a=[t.getInt16(e,n),2];break;case"uint16":case"ushort":a=[t.getUint16(e,n),2];break;case"int32":case"int":a=[t.getInt32(e,n),4];break;case"uint32":case"uint":a=[t.getUint32(e,n),4];break;case"float32":case"float":a=[t.getFloat32(e,n),4];break;case"float64":case"double":a=[t.getFloat64(e,n),8];break;default:console.log("Unsupported type");break}return a}function hE(t,e,r,n){const a={};let s,i=0;for(let o=0;o<r.length;o++)if(r[o].type==="list"){const c=[];s=ja(t,e+i,r[o].countType,n);const u=s[0];i+=s[1];for(let g=0;g<u;g++)s=ja(t,e+i,r[o].itemType,n),c.push(s[0]),i+=s[1];a[r[o].name]=c}else s=ja(t,e+i,r[o].type,n),a[r[o].name]=s[0],i+=s[1];return[a,i]}function vE(t,e){e.classHierarchy.push("vtkPLYReader"),e.dataAccessHelper||(e.dataAccessHelper=nE.get("http"));function r(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{compression:s,progressCallback:i}=e;return a.binary?e.dataAccessHelper.fetchBinary(n,{compression:s,progressCallback:i}):e.dataAccessHelper.fetchText(t,n,{compression:s,progressCallback:i})}t.setUrl=function(n){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{binary:!0};e.url=n;const s=n.split("/");return s.pop(),e.baseURL=s.join("/"),e.compression=a.compression,t.loadData({progressCallback:a.progressCallback,binary:!!a.binary})},t.loadData=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const a=r(e.url,n);return a.then(t.parse),a},t.parse=n=>{typeof n=="string"?t.parseAsText(n):t.parseAsArrayBuffer(n)},t.parseAsArrayBuffer=n=>{if(!n)return;if(n!==e.parseData)t.modified();else return;const a=qo.arrayBufferToString(n),s=Qo(a);if(!(s.format!==Ha.ASCII)){t.parseAsText(n);return}e.parseData=n;const o={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},c=s.format===Ha.BINARY_LITTLE_ENDIAN,u=n instanceof ArrayBuffer?n:n.buffer,g=new DataView(u,s.headerLength);let f,l=0;for(let y=0;y<s.elements.length;y++)for(let h=0;h<s.elements[y].count;h++){f=hE(g,l,s.elements[y].properties,c),l+=f[1];const v=f[0];Jo(o,s.elements[y].name,v)}const p=Zo(o,s.elements);e.output[0]=p},t.parseAsText=n=>{if(!n)return;if(n!==e.parseData)t.modified();else return;e.parseData=n;const a=qo.arrayBufferToString(n),s=Qo(a);if(s.format!==Ha.ASCII){t.parseAsArrayBuffer(n);return}const o={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},c=fl.patternBody.exec(a);let u="";c!==null&&(u=c[1]);const g=u.split(`
`);let f=0,l=0;for(let y=0;y<g.length;y++){let h=g[y];if(h=h.trim(),h!==""){l>=s.elements[f].count&&(f++,l=0);const v=pE(s.elements[f].properties,h);Jo(o,s.elements[f].name,v),l++}}const p=Zo(o,s.elements);e.output[0]=p},t.requestData=(n,a)=>{t.parse(e.parseData)}}const yE={};function ul(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.assign(e,yE,r),E.obj(t,e),E.get(t,e,["url","baseURL"]),E.setGet(t,e,["dataAccessHelper"]),E.algo(t,e,0,1),vE(t,e),e.compression||(e.compression=null),e.progressCallback||(e.progressCallback=null)}const dE=E.newInstance(ul,"vtkPLYReader");var gl={extend:ul,newInstance:dE};const TE=`
<div class="vtk-container">
    <table>
        <tr>
            <td></td>
            <td><b>Toggle layers</b></td>
            <td><b>Set opacity</b></td>
        </tr>
        <tr>
            <td><div class="circular-box pointcloud-color"></div></td>
            <td><label><input type="checkbox" class="togglePointCloud" checked /> Point Cloud</label></td>
            <td><input type="range" id="opacity-slider-pointcloud" min="0" max="1" step="0.1" value="1.0"></td>
        </tr>
        <tr>
            <td><div class="legend-box mesh-color"></div></td>
            <td><label><input type="checkbox" class="toggleMesh" /> Mesh voxels</label></td>
            <td><input type="range" id="opacity-slider-mesh-voxels" min="0" max="1" step="0.1" value="0.1"></td>
        </tr>
        <tr>
            <td><div class="quadrant-box scanned-color"></div></td>
            <td><label><input type="checkbox" class="toggleScanned" /> Scanned voxel</label></td>
            <td><input type="range" id="opacity-slider-scanned" min="0" max="1" step="0.1" value="0.9"></td>
        </tr>
        <tr>
            <td><div class="legend-box voidvoxels-color"></div></td>
            <td><label><input type="checkbox" class="toggleVoidVoxels" /> Void voxels</label></td>
            <td><input type="range" id="opacity-slider-void-voxels" min="0" max="1" step="0.1" value="0.4"></td>
        </tr>
        <tr>
            <td><div class="legend-box unknownvoxels-color"></div></td>
            <td><label><input type="checkbox" class="toggleUnknownVoxels" /> Unknown voxels</label></td>
            <td><input type="range" id="opacity-slider-unknown-voxels" min="0" max="1" step="0.1" value="0.4"></td>
        </tr>
        <tr>
            <td><div class="legend-box buildinghull-color"></div></td>
            <td><label><input type="checkbox" class="toggleHull" /> Building hull</label></td>
            <td><input type="range" id="opacity-slider-building-hull" min="0" max="1" step="0.1" value="0.4"></td>
        </tr>
    </table>
</div>
`,ei=eE.newInstance({rootContainer:document.getElementById("viewer-container")}),Pt=ei.getRenderer();Pt.setBackground(.2,.2,.2,1);const Yt=ei.getRenderWindow();function sr(t,e,r,n,a=2,s=1,i=!0){const o=gl.newInstance(),u=`/unscanned_areas.github.io/models/${t}`;o.setUrl(u).then(()=>{const g=o.getOutputData(),f=rt.newInstance();f.addInputData(g);const l=tt.newInstance();l.setMapper(f),l.getProperty().setOpacity(e),l.getProperty().setRepresentation(a),a===1&&l.getProperty().setLineWidth(s),l.setVisibility(i),Pt.addActor(l),Pt.resetCamera(),Yt.render();const p=document.querySelector(`.${r}`),y=document.getElementById(n);p&&(p.checked=i,p.addEventListener("change",()=>{l.setVisibility(p.checked),Yt.render()})),y&&y.addEventListener("input",h=>{l.getProperty().setOpacity(parseFloat(h.target.value)),Yt.render()})}).catch(g=>console.error(`Error loading ${url}:`,g))}function xE(t,e,r,n){const a=document.querySelector(".vtk-container table");if(!a)return;const s=document.createElement("tr"),i=document.createElement("td"),o=document.createElement("canvas");o.width=40,o.height=10,o.classList.add("legend-line"),CE(o,e[0].getProperty().getColor()),i.appendChild(o),s.appendChild(i);const c=document.createElement("td"),u=document.createElement("label");u.innerHTML=`<input type="checkbox" class="${r}" checked /> ${t}`,c.appendChild(u),s.appendChild(c);const g=document.createElement("td"),f=document.createElement("input");f.type="range",f.min="0",f.max="1",f.step="0.1",f.value="1.0",f.id=n,g.appendChild(f),s.appendChild(g),a.appendChild(s);const l=document.querySelector(`.${r}`);l.addEventListener("change",()=>{e.forEach(p=>p.setVisibility(l.checked)),Yt.render()}),f.addEventListener("input",p=>{e.forEach(y=>y.getProperty().setOpacity(parseFloat(p.target.value))),Yt.render()})}function SE(t,e=2,r=[1,1,1],n=5,a=[1,0,0],s=!0){const o=`/unscanned_areas.github.io/models/${t}`,c=gl.newInstance();c.setUrl(o).then(()=>{const u=c.getOutputData(),g=Mr.newInstance(),f=u.getPoints().getData();for(let O=0;O<f.length;O+=3)g.insertNextPoint(f[O],f[O+1],f[O+2]);const l=Nn.newInstance(),p=g.getNumberOfPoints(),y=new Uint16Array(p+1);y[0]=p;for(let O=0;O<p;O++)y[O+1]=O;l.setData(y);const h=nt.newInstance();h.setPoints(g),h.setLines(l);const v=rt.newInstance();v.setInputData(h);const x=tt.newInstance();x.setMapper(v),x.getProperty().setColor(...r),x.getProperty().setLineWidth(e),x.setVisibility(s);const S=Nn.newInstance(),d=new Uint16Array(p*2);for(let O=0;O<p;O++)d[O*2]=1,d[O*2+1]=O;S.setData(d);const T=nt.newInstance();T.setPoints(g),T.setVerts(S);const w=rt.newInstance();w.setInputData(T);const C=tt.newInstance();C.setMapper(w),C.getProperty().setColor(...a),C.getProperty().setRepresentation(0),C.getProperty().setPointSize(n),C.setVisibility(s),Pt.addActor(x),Pt.addActor(C),Pt.resetCamera(),Yt.render(),xE("Camera trajectory",[x,C],"toggleLinePoints","opacity-slider-linepoints")}).catch(u=>console.error("Error loading PLY file:",u))}function CE(t,e){const r=t.getContext("2d"),n=`rgb(${e.map(s=>s*255).join(",")})`;r.clearRect(0,0,t.width,t.height),r.strokeStyle=n,r.lineWidth=2,r.beginPath(),r.moveTo(5,t.height/2),r.lineTo(t.width-5,t.height/2),r.stroke(),r.fillStyle=n,[5,20,35].forEach(s=>{r.beginPath(),r.arc(s,t.height/2,2,0,2*Math.PI),r.fill()})}sr("pointcloud2.ply",1,"togglePointCloud","opacity-slider-pointcloud",0,0,!0);sr("Scanned.ply",.9,"toggleScanned","opacity-slider-scanned",2,0,!1);sr("mesh.ply",.1,"toggleMesh","opacity-slider-mesh-voxels",2,0,!1);sr("Seen.ply",.4,"toggleVoidVoxels","opacity-slider-void-voxels",2,0,!1);sr("Unknown.ply",.4,"toggleUnknownVoxels","opacity-slider-unknown-voxels",2,0,!1);sr("hull_new.ply",.4,"toggleHull","opacity-slider-building-hull",2,0,!1);SE("camera_line.ply",1,[1,1,1],3,[1,0,0]);ei.addController(TE);setTimeout(()=>{const t=document.querySelectorAll("#viewer-container > div"),e=t[t.length-1];e&&(document.body.appendChild(e),e.classList.add("control-panel"),e.style.position="fixed",e.style.top="50%",e.style.transform="translateY(-50%)",e.style.left="0px",e.style.background="rgba(92, 92, 92, 0.29)",e.style.padding="20px",e.style.borderRadius="0 8px 8px 0",e.style.boxShadow="4px 4px 12px rgba(0, 0, 0, 0.5)",e.style.zIndex="900",e.style.width="300px",e.style.maxWidth="300px",e.addEventListener("mouseenter",()=>{e.style.opacity="1"}),e.addEventListener("mouseleave",()=>{e.style.opacity="0.8"}))},100);document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector(".collapsible-btn"),e=document.querySelector(".collapsible-container");t.addEventListener("click",()=>{e.classList.toggle("open")})});
